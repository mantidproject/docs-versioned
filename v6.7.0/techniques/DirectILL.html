<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Data reduction for ILL’s direct geometry instruments</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="directtools" href="DirecttoolsPythonModule.html" />
    <link rel="prev" title="Crystal Field Examples" href="CrystalField.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.7</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Techniques</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">Data reduction for ILL’s direct geometry instruments</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="data-reduction-for-ill-s-direct-geometry-instruments">
<span id="directill"></span><h1>Data reduction for ILL’s direct geometry instruments<a class="headerlink" href="#data-reduction-for-ill-s-direct-geometry-instruments" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#instrument-specific-defaults-and-recommendations" id="id2">Instrument specific defaults and recommendations</a></p></li>
<li><p><a class="reference internal" href="#reduction-basics" id="id3">Reduction basics</a></p></li>
<li><p><a class="reference internal" href="#connecting-inputs-and-outputs" id="id4">Connecting inputs and outputs</a></p></li>
<li><p><a class="reference internal" href="#time-independent-background-for-position-sensitive-tubes" id="id5">Time-independent background for position sensitive tubes</a></p></li>
<li><p><a class="reference internal" href="#self-shielding-corrections" id="id6">Self-shielding corrections</a></p></li>
<li><p><a class="reference internal" href="#workspace-compatibility" id="id7">Workspace compatibility</a></p></li>
<li><p><a class="reference internal" href="#container-subtraction" id="id8">Container subtraction</a></p>
<ul>
<li><p><a class="reference internal" href="#interpolation-of-container-data-to-different-temperatures" id="id9">Interpolation of container data to different temperatures</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#finding-out-what-went-wrong" id="id10">Finding out what went wrong</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id11">Instrument specific defaults and recommendations</a></p>
<ul>
<li><p><a class="reference internal" href="#elastic-peak-positions" id="id12">Elastic peak positions</a></p></li>
<li><p><a class="reference internal" href="#diagnostics" id="id13">Diagnostics</a></p></li>
<li><p><a class="reference internal" href="#memory-management" id="id14">Memory management</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#full-example" id="id15">Full example</a></p></li>
</ul>
</nav>
<p>There are seven workflow algorithms supporting data reduction at ILL’s time-of-flight instruments. These algorithms are:</p>
<dl class="simple">
<dt><a class="reference internal" href="../algorithms/DirectILLCollectData-v1.html#algm-directillcollectdata"><span class="std std-ref">DirectILLCollectData v1</span></a></dt><dd><p>Loads data from disk and applies some simple reduction steps. The starting point of all reductions, as most of the other DirectILL algorithms expect their input data to originate from here.</p>
</dd>
<dt><a class="reference internal" href="../algorithms/DirectILLReduction-v1.html#algm-directillreduction"><span class="std std-ref">DirectILLReduction v1</span></a></dt><dd><p>Does the actual reduction and produces the final <span class="math notranslate nohighlight">\(S(q,\omega)\)</span>.</p>
</dd>
<dt><a class="reference internal" href="../algorithms/DirectILLIntegrateVanadium-v1.html#algm-directillintegratevanadium"><span class="std std-ref">DirectILLIntegrateVanadium v1</span></a></dt><dd><p>Integrates a calibration workspace.</p>
</dd>
<dt><a class="reference internal" href="../algorithms/DirectILLDiagnostics-v1.html#algm-directilldiagnostics"><span class="std std-ref">DirectILLDiagnostics v1</span></a></dt><dd><p>Provides a masking workspace to remove detectors (faulty or otherwise) from the reduction.</p>
</dd>
<dt><a class="reference internal" href="../algorithms/DirectILLSelfShielding-v1.html#algm-directillselfshielding"><span class="std std-ref">DirectILLSelfShielding v1</span></a></dt><dd><p>Calculates absorption corrections for usage with <a class="reference internal" href="../algorithms/DirectILLApplySelfShielding-v1.html#algm-directillapplyselfshielding"><span class="std std-ref">DirectILLApplySelfShielding v1</span></a>.</p>
</dd>
<dt><a class="reference internal" href="../algorithms/DirectILLApplySelfShielding-v1.html#algm-directillapplyselfshielding"><span class="std std-ref">DirectILLApplySelfShielding v1</span></a></dt><dd><p>Applies absorption corrections and subtracts an empty container measurement.</p>
</dd>
<dt><a class="reference internal" href="../algorithms/DirectILLTubeBackground-v1.html#algm-directilltubebackground"><span class="std std-ref">DirectILLTubeBackground v1</span></a></dt><dd><p>Calculates a per-tube backgrounds for position sensitive tubes such as those found in IN5.</p>
</dd>
</dl>
<p>The algorithms can be used as flexible building blocks in Python scripts. Not all of them need to be necessarily used in a reduction: the simplest script could call <a class="reference internal" href="../algorithms/DirectILLCollectData-v1.html#algm-directillcollectdata"><span class="std std-ref">DirectILLCollectData v1</span></a> and <a class="reference internal" href="../algorithms/DirectILLReduction-v1.html#algm-directillreduction"><span class="std std-ref">DirectILLReduction v1</span></a> only.</p>
<p>Together with the other algorithms and services provided by the Mantid framework, the reduction algorithms can handle a great number of reduction scenarios. If this proves insufficient, however, the algorithms can be accessed using Python. Before making modifications it is recommended to copy the source files and rename the algorithms as not to break the original behavior.</p>
<p>Additionally, there is an algorithm that streamlines the reduction process, which is the recommended way of performing the reduction:</p>
<dl class="simple">
<dt><a class="reference internal" href="../algorithms/DirectILLAutoProcess-v1.html#algm-directillautoprocess"><span class="std std-ref">DirectILLAutoProcess v1</span></a></dt><dd><p>Performs full data treatment of a defined reduction technique and process.</p>
</dd>
</dl>
<p>The <a class="reference internal" href="../algorithms/DirectILLAutoProcess-v1.html#algm-directillautoprocess"><span class="std std-ref">DirectILLAutoProcess v1</span></a> algorithm calls and properly connects inputs for the algorithms specified above to provide a simplified interface for standard reductions. The number of possible
workflows is necessarily more limited than when calls to intermediate algorithms are made individually and from a user-defined script. The individual algorithms should be used only in case when
the order of corrections needs changing or any other custom modifications to the standard workflow in the <a class="reference internal" href="../algorithms/DirectILLAutoProcess-v1.html#algm-directillautoprocess"><span class="std std-ref">DirectILLAutoProcess v1</span></a> are necessary.</p>
<p>This document tries to give an overview on how the algorithms work together via Python examples. Please refer to the algorithm documentation for details of each individual algorithm.</p>
<section id="instrument-specific-defaults-and-recommendations">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Instrument specific defaults and recommendations</a><a class="headerlink" href="#instrument-specific-defaults-and-recommendations" title="Permalink to this heading">¶</a></h2>
<p>Some algorithm properties have the word ‘AUTO’ in their default value. This means that the default will be chosen according to the instrument by reading the actual default from the instrument parameters. The documentation of the algorithms which have these types of properties includes tables showing the defaults for supported ILL instruments.</p>
</section>
<section id="reduction-basics">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Reduction basics</a><a class="headerlink" href="#reduction-basics" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p>A very basic reduction would include a vanadium reference and a sample and follow the steps:</p>
<ol class="arabic simple">
<li><p>Load vanadium data.</p></li>
<li><p>Integrate vanadium.</p></li>
<li><p>Run diagnostics.</p>
<ul class="simple">
<li><p>Generally, this step should not be skipped even if no actual diagnostics were performed, as <a class="reference internal" href="../algorithms/DirectILLDiagnostics-v1.html#algm-directilldiagnostics"><span class="std std-ref">DirectILLDiagnostics v1</span></a> may create a default mask for the instrument. This is the case of IN5, for example, where the pixels at the detector tube ends are masked.</p></li>
</ul>
</li>
<li><p>Load sample data.</p></li>
<li><p>Reduce the data applying vanadium calibration coefficients and diagnostics mask.</p></li>
</ol>
<p>On instruments like IN4 and IN6, these steps would translate to something like the following simple Python script:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment to add a temporary data search directory.</span>
<span class="c1">#mantid.config.appendDataSearchDir(&#39;/data/&#39;)</span>

<span class="c1"># Vanadium</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/085801-085802.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputEPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span><span class="p">,</span>  <span class="c1"># Elastic peak positions.</span>
    <span class="n">OutputRawWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-raw&#39;</span>    <span class="c1"># &#39;Raw&#39; data for diagnostics.</span>
<span class="p">)</span>
<span class="n">DirectILLIntegrateVanadium</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span>
<span class="p">)</span>
<span class="n">DirectILLDiagnostics</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-raw&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Sample</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087294+087295.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span>
<span class="p">)</span>
<span class="n">DirectILLReduction</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;SofQW&#39;</span><span class="p">,</span>
    <span class="n">IntegratedVanadiumWorkspace</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span><span class="p">,</span>
    <span class="n">DiagnosticsWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span>
<span class="p">)</span>
<span class="n">SofQW</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;SofQW&#39;</span><span class="p">]</span>
<span class="n">qAxis</span> <span class="o">=</span> <span class="n">SofQW</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Vertical axis</span>
<span class="n">eAxis</span> <span class="o">=</span> <span class="n">SofQW</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Horizontal axis</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;S(Q,W): Q range: </span><span class="si">{:.3}</span><span class="s1">...</span><span class="si">{:.3}</span><span class="s1">A; W range </span><span class="si">{:.3}</span><span class="s1">...</span><span class="si">{:.3}</span><span class="s1">meV&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">qAxis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">qAxis</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">eAxis</span><span class="o">.</span><span class="n">getMin</span><span class="p">(),</span> <span class="n">eAxis</span><span class="o">.</span><span class="n">getMax</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>S(Q,W): Q range: 0.0...9.21A; W range -97.0...7.62meV
</pre></div>
</div>
<p>The basic reduction for IN5 and PANTHER differs slightly with regards to the diagnostics step. In this case, the “raw” workspace is not needed, and it is not necessary to pass the EPP workspace to <a class="reference internal" href="../algorithms/DirectILLDiagnostics-v1.html#algm-directilldiagnostics"><span class="std std-ref">DirectILLDiagnostics v1</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment to add a temporary data search directory.</span>
<span class="c1">#mantid.config.appendDataSearchDir(&#39;/data/&#39;)</span>

<span class="c1"># Vanadium</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;085801-085802&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputEPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span><span class="p">,</span>  <span class="c1"># Elastic peak positions.</span>
<span class="p">)</span>
<span class="n">DirectILLIntegrateVanadium</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span>
<span class="p">)</span>
<span class="n">DirectILLDiagnostics</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Sample</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;087294+087295&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span>
<span class="p">)</span>
<span class="n">DirectILLReduction</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;SofQW&#39;</span><span class="p">,</span>
    <span class="n">IntegratedVanadiumWorkspace</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span><span class="p">,</span>
    <span class="n">DiagnosticsWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The same effect can be achieved by calling the <a class="reference internal" href="../algorithms/DirectILLAutoProcess-v1.html#algm-directillautoprocess"><span class="std std-ref">DirectILLAutoProcess v1</span></a> algorithm, and the syntax is the same regardless of the instrument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Vanadium</span>
<span class="n">DirectILLAutoProcess</span><span class="p">(</span>
    <span class="n">Runs</span><span class="o">=</span><span class="s1">&#39;085801-085802&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Vanadium&#39;</span><span class="p">,</span>
    <span class="n">ClearCache</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="c1"># Sample</span>
<span class="n">DirectILLAutoProcess</span><span class="p">(</span>
    <span class="n">Runs</span><span class="o">=</span><span class="s1">&#39;087294+087295&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
    <span class="n">VanadiumWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">ClearCache</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="connecting-inputs-and-outputs">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Connecting inputs and outputs</a><a class="headerlink" href="#connecting-inputs-and-outputs" title="Permalink to this heading">¶</a></h2>
<p>Every <code class="docutils literal notranslate"><span class="pre">DirectILL</span></code> algorithm has an <em>OutputWorkspace</em> property which provides the main output workspace. Additionally, the algorithms may provide optional output workspaces to be used with other algorithms or for reporting/debugging purposes. The linking of outputs to inputs is an important feature of the <code class="docutils literal notranslate"><span class="pre">DirectILL</span></code> algorithms and allows for great flexibility in the reduction. An example of the usage of these optional output workspaces is the <em>OutputEPPWorkspace</em> which in the vanadium case above is needed in the integration and diagnostics steps:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="o">...</span>
    <span class="n">OutputEPPWorkspace</span><span class="o">=</span><span class="s1">&#39;epps&#39;</span>  <span class="c1"># This workspace...</span>
<span class="p">)</span>
<span class="n">DirectILLIntegrateVanadium</span><span class="p">(</span>
    <span class="o">...</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;epps&#39;</span>        <span class="c1"># ...is needed here...</span>
<span class="p">)</span>
<span class="n">DirectILLDiagnostics</span><span class="p">(</span>
    <span class="o">...</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;epps&#39;</span>        <span class="c1"># ...and here.</span>
<span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>As shown above, these optional outputs are sometimes named similarly the corresponding inputs giving a hint were they are supposed to be used.</p>
<p>The information regarding which numors were loaded by relevant NeXus data loaders to create the current workspace is available in the sample logs under the entry <cite>run_list</cite>.</p>
<p>In the case of <a class="reference internal" href="../algorithms/DirectILLAutoProcess-v1.html#algm-directillautoprocess"><span class="std std-ref">DirectILLAutoProcess v1</span></a> the connection of outputs and inputs of the workflow is handled by the algorithm internally.</p>
</section>
<section id="time-independent-background-for-position-sensitive-tubes">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Time-independent background for position sensitive tubes</a><a class="headerlink" href="#time-independent-background-for-position-sensitive-tubes" title="Permalink to this heading">¶</a></h2>
<p>The flat background subtraction in <a class="reference internal" href="../algorithms/DirectILLCollectData-v1.html#algm-directillcollectdata"><span class="std std-ref">DirectILLCollectData v1</span></a> does not work properly for instruments such as IN5. Another algorithm, <a class="reference internal" href="../algorithms/DirectILLTubeBackground-v1.html#algm-directilltubebackground"><span class="std std-ref">DirectILLTubeBackground v1</span></a> should be used instead. For this algorithm, one should run <a class="reference internal" href="../algorithms/DirectILLDiagnostics-v1.html#algm-directilldiagnostics"><span class="std std-ref">DirectILLDiagnostics v1</span></a> to utilize the default hard mask and beam stop masking in the background determination.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add a temporary data search directory.</span>
<span class="n">mantid</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">appendDataSearchDir</span><span class="p">(</span><span class="s1">&#39;/data/&#39;</span><span class="p">)</span>

<span class="c1"># Vanadium</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;0100-0109&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputEPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span><span class="p">,</span>  <span class="c1"># Elastic peak positions.</span>
<span class="p">)</span>

<span class="n">DirectILLDiagnostics</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-raw&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Determine time-independent background</span>
<span class="n">DirectILLTubeBackground</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-background&#39;</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadiums-epps&#39;</span><span class="p">,</span>
    <span class="n">DiagnosticsWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span>
<span class="p">)</span>
<span class="c1"># Subtract the background</span>
<span class="n">Subtract</span><span class="p">(</span>
    <span class="n">LHSWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span>
    <span class="n">RHSWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-background&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-bkgsubtr&#39;</span>
<span class="p">)</span>

<span class="n">DirectILLIntegrateVanadium</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-bkgsubtr&#39;</span><span class="p">,</span>  <span class="c1"># Integrate background subtracted data</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span>
<span class="p">)</span>

<span class="c1"># Sample</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;0201+0205+0209-0210&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
    <span class="n">OutputEPPWorkspace</span><span class="o">=</span><span class="s1">&#39;sample-epps&#39;</span>
<span class="p">)</span>

<span class="c1"># Determine time-independent background</span>
<span class="n">DirectILLTubeBackground</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample-background&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;sample-epps&#39;</span><span class="p">,</span>
    <span class="n">DiagnosticsWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span>
<span class="p">)</span>
<span class="n">Subtract</span><span class="p">(</span>
    <span class="n">LHSWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
    <span class="n">RHSWorkspace</span><span class="o">=</span><span class="s1">&#39;sample-background&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample-bkgsubtr&#39;</span>
<span class="p">)</span>

<span class="n">DirectILLReduction</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample-bkgsubtr&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;SofQW&#39;</span><span class="p">,</span>
    <span class="n">IntegratedVanadiumWorkspace</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span>
    <span class="n">DiagnosticsWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="self-shielding-corrections">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Self-shielding corrections</a><a class="headerlink" href="#self-shielding-corrections" title="Permalink to this heading">¶</a></h2>
<p>A more complete reduction example would include corrections for self-shielding:</p>
<ol class="arabic simple">
<li><p>Load vanadium data.</p></li>
<li><p>Integrate vanadium.</p></li>
<li><p>Run diagnostics.</p></li>
<li><p>Load sample data.</p></li>
<li><p>Calculate absorption corrections for the sample.</p>
<ul class="simple">
<li><p>This may be a time consuming step. Fortunately, the resulting correction factors can be reused as many times as needed.</p></li>
<li><p>Sample and beam parameters can be set using <a class="reference internal" href="../algorithms/SetSample-v1.html#algm-setsample"><span class="std std-ref">SetSample v1</span></a> and <a class="reference internal" href="../algorithms/SetBeam-v1.html#algm-setbeam"><span class="std std-ref">SetBeam v1</span></a>.</p></li>
</ul>
</li>
<li><p>Apply the corrections.</p></li>
<li><p>Reduce the data applying vanadium calibration coefficients and diagnostics mask.</p></li>
</ol>
<p>The above workflow would translate to this kind of Python script for IN4 and IN6:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment to add a temporary data search directory.</span>
<span class="c1">#mantid.config.appendDataSearchDir(&#39;/data/&#39;)</span>

<span class="c1"># Vanadium</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/085801-085801.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputEPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span><span class="p">,</span>  <span class="c1"># Elastic peak positions.</span>
    <span class="n">OutputRawWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-raw&#39;</span>    <span class="c1"># &#39;Raw&#39; data for diagnostics.</span>
<span class="p">)</span>
<span class="n">DirectILLIntegrateVanadium</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span>
<span class="p">)</span>
<span class="n">DirectILLDiagnostics</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-raw&#39;</span><span class="p">,</span>  <span class="c1"># For IN5/PANTHER, &#39;vanadium&#39; could be used</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span><span class="p">,</span>  <span class="c1"># Can be omitted for IN5/PANTHER</span>
<span class="p">)</span>
<span class="c1"># Sample</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087294+087295.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Shape&#39;</span><span class="p">:</span> <span class="s1">&#39;FlatPlate&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Width&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
    <span class="s1">&#39;Height&#39;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span>
    <span class="s1">&#39;Thick&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="s1">&#39;Center&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="s1">&#39;Angle&#39;</span><span class="p">:</span> <span class="mf">45.0</span>
<span class="p">}</span>
<span class="n">material</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ChemicalFormula&#39;</span><span class="p">:</span> <span class="s1">&#39;Cd S&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SampleNumberDensity&#39;</span><span class="p">:</span> <span class="mf">0.01</span>
<span class="p">}</span>
<span class="n">SetSample</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
    <span class="n">Geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span>
    <span class="n">Material</span><span class="o">=</span><span class="n">material</span>
<span class="p">)</span>
<span class="n">DirectILLSelfShielding</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;corrections&#39;</span><span class="p">,</span>
    <span class="n">EventsPerPoint</span><span class="o">=</span><span class="mi">10000</span>
<span class="p">)</span>
<span class="n">DirectILLApplySelfShielding</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample-corrected&#39;</span><span class="p">,</span>
    <span class="n">SelfShieldingCorrectionWorkspace</span><span class="o">=</span><span class="s1">&#39;corrections&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">DirectILLReduction</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample-corrected&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;SofQW&#39;</span><span class="p">,</span>
    <span class="n">IntegratedVanadiumWorkspace</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span><span class="p">,</span>
    <span class="n">DiagnosticsWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span>
<span class="p">)</span>
<span class="n">SofQW</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;SofQW&#39;</span><span class="p">]</span>
<span class="n">qAxis</span> <span class="o">=</span> <span class="n">SofQW</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Vertical axis</span>
<span class="n">eAxis</span> <span class="o">=</span> <span class="n">SofQW</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Horizontal axis</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;S(Q,W): Q range: </span><span class="si">{:.3}</span><span class="s1">...</span><span class="si">{:.3}</span><span class="s1">A; W range </span><span class="si">{:.3}</span><span class="s1">...</span><span class="si">{:.3}</span><span class="s1">meV&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">qAxis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">qAxis</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">eAxis</span><span class="o">.</span><span class="n">getMin</span><span class="p">(),</span> <span class="n">eAxis</span><span class="o">.</span><span class="n">getMax</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>S(Q,W): Q range: 0.0...9.21A; W range -97.0...7.62meV
</pre></div>
</div>
<p>In the case of <a class="reference internal" href="../algorithms/DirectILLAutoProcess-v1.html#algm-directillautoprocess"><span class="std std-ref">DirectILLAutoProcess v1</span></a>, the self-attenuation correction is handled internally when the <cite>AbsorptionCorrection</cite> property is set to either <cite>Fast</cite> or <cite>Full</cite>, which denote the granularity of the geometry to be used for calculations. Another property, <cite>SelfAbsorptionCorrection</cite> allows to choose whether to use Monte Carlo or numerical integration methods. Similarly to the case presented above, at least the geometry and material of the sample need of the provided as input, via <cite>SampleMaterial</cite> and <cite>SampleGeometry</cite> properties.</p>
</section>
<section id="workspace-compatibility">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Workspace compatibility</a><a class="headerlink" href="#workspace-compatibility" title="Permalink to this heading">¶</a></h2>
<p>Mantid can be picky with binning when doing arithmetics between workspaces. This is an issue for the time-of-flight instruments at ILL as the time axis needs to be corrected to correspond to a physical flight distance. Even thought data is recorded with the same nominal wavelength, the actual value written in the NeXus files may differ between runs. Incident energy calibration further complicates matters. As the correction to the time-of-flight axis depends on the wavelength, two datasets loaded into Mantid with <a class="reference internal" href="../algorithms/DirectILLCollectData-v1.html#algm-directillcollectdata"><span class="std std-ref">DirectILLCollectData v1</span></a> may have slightly different time-of-flight axis. This prevents arithmetics between the workspaces. The situation is most often encountered between a sample and the corresponding empty container.</p>
<p>To alleviate the situation, the output workspaces of <a class="reference internal" href="../algorithms/DirectILLCollectData-v1.html#algm-directillcollectdata"><span class="std std-ref">DirectILLCollectData v1</span></a> can be forced to use the same wavelength. The following Python script shows how to propagate the calibrated incident energy from the first loaded workspace into the rest:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087294-087295.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
    <span class="n">OutputIncidentEnergyWorkspace</span><span class="o">=</span><span class="s1">&#39;Ei&#39;</span>  <span class="c1"># Get a common incident energy.</span>
<span class="p">)</span>
<span class="c1"># Empty container.</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087306-087309.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;container&#39;</span><span class="p">,</span>
    <span class="n">IncidentEnergyWorkspace</span><span class="o">=</span><span class="s1">&#39;Ei&#39;</span>  <span class="c1"># Ensure same TOF binning.</span>
<span class="p">)</span>
<span class="n">x_sample</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x_container</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sample&#39;s TOF axis starts at </span><span class="si">{:.4}</span><span class="s2">mus, container&#39;s at </span><span class="si">{:.4}</span><span class="s2">mus&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">x_sample</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_container</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Sample&#39;s TOF axis starts at 965.4mus, container&#39;s at 965.7mus
</pre></div>
</div>
</section>
<section id="container-subtraction">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Container subtraction</a><a class="headerlink" href="#container-subtraction" title="Permalink to this heading">¶</a></h2>
<p>The container subtraction is done perhaps a bit counterintuitively in <a class="reference internal" href="../algorithms/DirectILLApplySelfShielding-v1.html#algm-directillapplyselfshielding"><span class="std std-ref">DirectILLApplySelfShielding v1</span></a>. At the moment the self-shielding corrections and the empty container data do not have much to do with each other but this may change in the future if the so called Paalman-Pings corrections are used.</p>
<p>With empty container data, the steps to reduce the experimental data might look like this:</p>
<ol class="arabic simple">
<li><p>Load vanadium data.</p></li>
<li><p>Integrate vanadium.</p></li>
<li><p>Run diagnostics.</p></li>
<li><p>Load sample data.</p></li>
<li><p>Load container data.</p>
<ul class="simple">
<li><p>Propagate the incident energy from the sample, see <a class="reference internal" href="#workspace-compatibility">Workspace compatibility</a>.</p></li>
</ul>
</li>
<li><p>Calculate and apply absorption corrections for the container.</p></li>
<li><p>Calculate the absorption corrections for the sample.</p></li>
<li><p>Apply the absoprtion corrections and subtract the container.</p></li>
<li><p>Reduce the data applying vanadium calibration coefficients and diagnostics mask.</p></li>
</ol>
<p>A corresponding Python script follows.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment to add a temporary data search directory.</span>
<span class="c1">#mantid.config.appendDataSearchDir(&#39;/data/&#39;)</span>

<span class="c1"># Vanadium</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/085801-085802.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputEPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span><span class="p">,</span>
    <span class="n">OutputRawWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-raw&#39;</span>  <span class="c1"># Can be omitted for IN5/PANTHER</span>
<span class="p">)</span>
<span class="n">DirectILLIntegrateVanadium</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span>
<span class="p">)</span>
<span class="n">DirectILLDiagnostics</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-raw&#39;</span><span class="p">,</span>  <span class="c1"># IN5/PANTHER can use &#39;vanadium&#39;</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span><span class="p">,</span>  <span class="c1"># Can be omitted for IN5/PANTHER</span>
<span class="p">)</span>
<span class="c1"># Sample</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087294+087295.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
    <span class="n">OutputIncidentEnergyWorkspace</span><span class="o">=</span><span class="s1">&#39;Ei&#39;</span>  <span class="c1"># For empty container</span>
<span class="p">)</span>
<span class="c1"># Container</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087306-087309.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;container&#39;</span><span class="p">,</span>
    <span class="n">IncidentEnergyWorkspace</span><span class="o">=</span><span class="s1">&#39;Ei&#39;</span>  <span class="c1"># Ensure common TOF axis</span>
<span class="p">)</span>
<span class="c1"># Sample self-shielding and container subtraction.</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Shape&#39;</span><span class="p">:</span> <span class="s1">&#39;HollowCylinder&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Height&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
    <span class="s1">&#39;InnerRadius&#39;</span><span class="p">:</span> <span class="mf">1.9</span><span class="p">,</span>
    <span class="s1">&#39;OuterRadius&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
    <span class="s1">&#39;Center&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">material</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ChemicalFormula&#39;</span><span class="p">:</span> <span class="s1">&#39;Cd S&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SampleNumberDensity&#39;</span><span class="p">:</span> <span class="mf">0.01</span>
<span class="p">}</span>
<span class="n">SetSample</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span>
<span class="n">DirectILLSelfShielding</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample-corrections&#39;</span><span class="p">,</span>
    <span class="n">EventsPerPoint</span><span class="o">=</span><span class="mi">10000</span>
<span class="p">)</span>
<span class="n">DirectILLApplySelfShielding</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample-corrected&#39;</span><span class="p">,</span>
    <span class="n">SelfShieldingCorrectionWorkspace</span><span class="o">=</span><span class="s1">&#39;sample-corrections&#39;</span><span class="p">,</span>
    <span class="n">EmptyContainerWorkspace</span><span class="o">=</span><span class="s1">&#39;container&#39;</span>  <span class="c1"># Also subtract container</span>
<span class="p">)</span>
<span class="n">DirectILLReduction</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample-corrected&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;SofQW&#39;</span><span class="p">,</span>
    <span class="n">IntegratedVanadiumWorkspace</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span><span class="p">,</span>
    <span class="n">DiagnosticsWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span>
<span class="p">)</span>
<span class="n">SofQW</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;SofQW&#39;</span><span class="p">]</span>
<span class="n">qAxis</span> <span class="o">=</span> <span class="n">SofQW</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Vertical axis</span>
<span class="n">eAxis</span> <span class="o">=</span> <span class="n">SofQW</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Horizontal axis</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;S(Q,W): Q range: </span><span class="si">{:.3}</span><span class="s1">...</span><span class="si">{:.3}</span><span class="s1">A; W range </span><span class="si">{:.3}</span><span class="s1">...</span><span class="si">{:.3}</span><span class="s1">meV&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">qAxis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">qAxis</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">eAxis</span><span class="o">.</span><span class="n">getMin</span><span class="p">(),</span> <span class="n">eAxis</span><span class="o">.</span><span class="n">getMax</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>S(Q,W): Q range: 0.0...9.21A; W range -97.0...7.62meV
</pre></div>
</div>
<p>Container subtraction is handled internally by the <a class="reference internal" href="../algorithms/DirectILLAutoProcess-v1.html#algm-directillautoprocess"><span class="std std-ref">DirectILLAutoProcess v1</span></a> algorithm, provided the X-axis binning is compatible between the current sample and the empty container workspace.
For the correction to be taken into account, the <cite>EmptyContainerWorkspace</cite> needs to be pointed to the empty container workspace.</p>
<section id="interpolation-of-container-data-to-different-temperatures">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Interpolation of container data to different temperatures</a><a class="headerlink" href="#interpolation-of-container-data-to-different-temperatures" title="Permalink to this heading">¶</a></h3>
<p>Sometimes the empty container is not measured at all the experiment’s temperature points. One can use Mantid’s workspace arithmetics to perform simple linear interpolation in temperature:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087283-087290.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample_50K&#39;</span><span class="p">,</span>
    <span class="n">OutputIncidentEnergyWorkspace</span><span class="o">=</span><span class="s1">&#39;E_i&#39;</span>
<span class="p">)</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087306-087309.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;container_1.5K&#39;</span><span class="p">,</span>
    <span class="n">IncidentEnergyWorkspace</span><span class="o">=</span><span class="s1">&#39;E_i&#39;</span>
<span class="p">)</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087311-087314.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;container_100K&#39;</span><span class="p">,</span>
    <span class="n">IncidentEnergyWorkspace</span><span class="o">=</span><span class="s1">&#39;E_i&#39;</span>
<span class="p">)</span>
<span class="c1"># Container measurement temperatures.</span>
<span class="n">T0</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">T1</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">DT</span> <span class="o">=</span> <span class="n">T1</span> <span class="o">-</span> <span class="n">T0</span>
<span class="c1"># Target sample temperature.</span>
<span class="n">Ts</span> <span class="o">=</span> <span class="mf">50.0</span>
<span class="c1"># Linear interpolation.</span>
<span class="n">RebinToWorkspace</span><span class="p">(</span>
    <span class="n">WorkspaceToRebin</span><span class="o">=</span><span class="s1">&#39;container_100K&#39;</span><span class="p">,</span>
    <span class="n">WorkspaceToMatch</span><span class="o">=</span><span class="s1">&#39;container_1.5K&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;container_100K_rebinned1p5K&#39;</span>
<span class="p">)</span>
<span class="n">container_50K</span> <span class="o">=</span> <span class="p">(</span><span class="n">T1</span> <span class="o">-</span> <span class="n">Ts</span><span class="p">)</span> <span class="o">/</span> <span class="n">DT</span> <span class="o">*</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;container_1.5K&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">Ts</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)</span> <span class="o">/</span> <span class="n">DT</span> <span class="o">*</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;container_100K_rebinned1p5K&#39;</span><span class="p">]</span>
<span class="n">T_sample_logs</span> <span class="o">=</span> <span class="n">container_50K</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;sample.temperature&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
<span class="n">mean_T</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">T_sample_logs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Note, that the mean temperature from the sample logs is </span><span class="si">{:.4}</span><span class="s1">K, a bit off.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean_T</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Note, that the mean temperature from the sample logs is 51.0K, a bit off.
</pre></div>
</div>
<p>As usual, care should be taken when extrapolating the container data outside the measured range.</p>
</section>
</section>
<section id="finding-out-what-went-wrong">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Finding out what went wrong</a><a class="headerlink" href="#finding-out-what-went-wrong" title="Permalink to this heading">¶</a></h2>
<p>The reduction algorithms do not produce much output to Mantid logs by default. Also, none of the intermediate workspaces generated during the run of the <code class="docutils literal notranslate"><span class="pre">DirectILL</span></code> algorithms will show up in the analysis data service. Both behaviors can be controlled by the <em>SubalgorithmLogging</em> and <em>Cleanup</em> properties. Enabling <em>SubalgorithmLogging</em> will log all messages from child algorithms to Mantid’s logs. Disabling <em>Cleanup</em> will unhide the intermediate workspaces created during the algorithm run and disable their deletion.</p>
<p>Note, that disabling <em>Cleanup</em> might produce a large number of workspaces and cause the computer to run out of memory.</p>
</section>
<section id="id1">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Instrument specific defaults and recommendations</a><a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<section id="elastic-peak-positions">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Elastic peak positions</a><a class="headerlink" href="#elastic-peak-positions" title="Permalink to this heading">¶</a></h3>
<p>The intensities of individual pixels on position sensitive detectors are very low. This makes the fitting procedure employed by <a class="reference internal" href="../algorithms/FindEPP-v2.html#algm-findepp"><span class="std std-ref">FindEPP v2</span></a> to work unreliably or fail altogether. Because of this, <a class="reference internal" href="../algorithms/DirectILLCollectData-v1.html#algm-directillcollectdata"><span class="std std-ref">DirectILLCollectData v1</span></a> will use <a class="reference internal" href="../algorithms/CreateEPP-v1.html#algm-createepp"><span class="std std-ref">CreateEPP v1</span></a> instead by default for IN5 and PANTHER. <a class="reference internal" href="../algorithms/CreateEPP-v1.html#algm-createepp"><span class="std std-ref">CreateEPP v1</span></a> produces an artificial EPP workspace based on the instrument geometry. This should be accurate enough for vanadium integration and diagnostics.</p>
</section>
<section id="diagnostics">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Diagnostics</a><a class="headerlink" href="#diagnostics" title="Permalink to this heading">¶</a></h3>
<p>The elastic peak and background diagnostics are turned off by default for IN5 and PANTHER as it makes no sense to mask individual pixels based on them.</p>
</section>
<section id="memory-management">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Memory management</a><a class="headerlink" href="#memory-management" title="Permalink to this heading">¶</a></h3>
<p>When working on memory constrained systems, it is recommended to manually delete the workspaces which are not needed anymore in the reduction script. The <a class="reference internal" href="../algorithms/SaveNexus-v1.html#algm-savenexus"><span class="std std-ref">SaveNexus v1</span></a> can be used to save the data to disk.</p>
</section>
</section>
<section id="full-example">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Full example</a><a class="headerlink" href="#full-example" title="Permalink to this heading">¶</a></h2>
<p>Lets put it all together into a complex Python script. The script below reduces the following dataset:</p>
<ul class="simple">
<li><p>Vanadium reference.</p></li>
<li><p>Sample measured at 1.5 and 50K.</p>
<ul>
<li><p>Share time-independent backgrounds from the measurement at 1.5K.</p></li>
</ul>
</li>
<li><p>Empty container measured at 1.5 and 100K.</p>
<ul>
<li><p>Need to interpolate to 50K.</p></li>
</ul>
</li>
</ul>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment to add a temporary data search directory.</span>
<span class="c1">#mantid.config.appendDataSearchDir(&#39;/data/&#39;)</span>

<span class="c1"># Vanadium</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/085801-085802.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputEPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span><span class="p">,</span>
    <span class="n">OutputRawWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-raw&#39;</span>  <span class="c1"># Can be omitted for IN5/PANTHER</span>
<span class="p">)</span>
<span class="n">DirectILLIntegrateVanadium</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span>
<span class="p">)</span>
<span class="n">DirectILLDiagnostics</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-raw&#39;</span><span class="p">,</span>  <span class="c1"># IN5/PANTHER can use &#39;vanadium&#39;</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium-epps&#39;</span><span class="p">,</span>  <span class="c1"># Can be omitted for IN5/PANTHER</span>
<span class="p">)</span>
<span class="c1"># Samples</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087294+087295.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample_1.5K&#39;</span><span class="p">,</span>
    <span class="n">OutputIncidentEnergyWorkspace</span><span class="o">=</span><span class="s1">&#39;Ei&#39;</span><span class="p">,</span>  <span class="c1"># For other datasets</span>
    <span class="n">OutputFlatBkgWorkspace</span><span class="o">=</span><span class="s1">&#39;bkgs&#39;</span>  <span class="c1"># For sample at 50K</span>
<span class="p">)</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087283-087290.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample_50K&#39;</span><span class="p">,</span>
    <span class="n">IncidentEnergyWorkspace</span><span class="o">=</span><span class="s1">&#39;Ei&#39;</span><span class="p">,</span>  <span class="c1"># Ensure common TOF axis</span>
    <span class="n">FlatBkgWorkspace</span><span class="o">=</span><span class="s1">&#39;bkgs&#39;</span>  <span class="c1"># Use flat backgrounds from 1.5K</span>
<span class="p">)</span>
<span class="c1"># Containers</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087306-087309.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;container_1.5K&#39;</span><span class="p">,</span>
    <span class="n">IncidentEnergyWorkspace</span><span class="o">=</span><span class="s1">&#39;Ei&#39;</span>  <span class="c1"># Ensure common TOF axis</span>
<span class="p">)</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087311-087314.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;container_100K&#39;</span><span class="p">,</span>
    <span class="n">IncidentEnergyWorkspace</span><span class="o">=</span><span class="s1">&#39;Ei&#39;</span>  <span class="c1"># Ensure common TOF axis</span>
<span class="p">)</span>
<span class="c1"># Sample self-shielding and container subtraction.</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Shape&#39;</span><span class="p">:</span> <span class="s1">&#39;HollowCylinder&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Height&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
    <span class="s1">&#39;InnerRadius&#39;</span><span class="p">:</span> <span class="mf">1.9</span><span class="p">,</span>
    <span class="s1">&#39;OuterRadius&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
    <span class="s1">&#39;Center&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">material</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ChemicalFormula&#39;</span><span class="p">:</span> <span class="s1">&#39;Cd S&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SampleNumberDensity&#39;</span><span class="p">:</span> <span class="mf">0.01</span>
<span class="p">}</span>
<span class="n">SetSample</span><span class="p">(</span><span class="s1">&#39;sample_1.5K&#39;</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span>
<span class="n">SetSample</span><span class="p">(</span><span class="s1">&#39;sample_50K&#39;</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">material</span><span class="p">)</span>
<span class="c1"># Self-shielding corrections need to be calculated only once.</span>
<span class="n">DirectILLSelfShielding</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample_1.5K&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;corrections&#39;</span><span class="p">,</span>
    <span class="n">EventsPerPoint</span><span class="o">=</span><span class="mi">10000</span>
<span class="p">)</span>
<span class="n">DirectILLApplySelfShielding</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample_1.5K&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;corrected_1.5K&#39;</span><span class="p">,</span>
    <span class="n">SelfShieldingCorrectionWorkspace</span><span class="o">=</span><span class="s1">&#39;corrections&#39;</span><span class="p">,</span>
    <span class="n">EmptyContainerWorkspace</span><span class="o">=</span><span class="s1">&#39;container_1.5K&#39;</span>
<span class="p">)</span>
<span class="c1"># Need to interpolate container to 50K</span>
<span class="n">T0</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">T1</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">DT</span> <span class="o">=</span> <span class="n">T1</span> <span class="o">-</span> <span class="n">T0</span>
<span class="n">Ts</span> <span class="o">=</span> <span class="mf">50.0</span> <span class="c1"># Target T</span>
<span class="n">RebinToWorkspace</span><span class="p">(</span>
    <span class="n">WorkspaceToRebin</span><span class="o">=</span><span class="s1">&#39;container_100K&#39;</span><span class="p">,</span>
    <span class="n">WorkspaceToMatch</span><span class="o">=</span><span class="s1">&#39;container_1.5K&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;container_100K_rebinned1p5K&#39;</span>
<span class="p">)</span>
<span class="n">container_50K</span> <span class="o">=</span> <span class="p">(</span><span class="n">T1</span> <span class="o">-</span> <span class="n">Ts</span><span class="p">)</span> <span class="o">/</span> <span class="n">DT</span> <span class="o">*</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;container_1.5K&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">Ts</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)</span> <span class="o">/</span> <span class="n">DT</span> <span class="o">*</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;container_100K_rebinned1p5K&#39;</span><span class="p">]</span>
<span class="n">DirectILLApplySelfShielding</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample_50K&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;corrected_50K&#39;</span><span class="p">,</span>
    <span class="n">SelfShieldingCorrectionWorkspace</span><span class="o">=</span><span class="s1">&#39;corrections&#39;</span><span class="p">,</span>
    <span class="n">EmptyContainerWorkspace</span><span class="o">=</span><span class="n">container_50K</span>
<span class="p">)</span>
<span class="n">DirectILLReduction</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;corrected_1.5K&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;SofQW_1.5K&#39;</span><span class="p">,</span>
    <span class="n">IntegratedVanadiumWorkspace</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span><span class="p">,</span>
    <span class="n">DiagnosticsWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span>
<span class="p">)</span>
<span class="n">DirectILLReduction</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;corrected_50K&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;SofQW_50K&#39;</span><span class="p">,</span>
    <span class="n">IntegratedVanadiumWorkspace</span><span class="o">=</span><span class="s1">&#39;integrated&#39;</span><span class="p">,</span>
    <span class="n">DiagnosticsWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics&#39;</span>
<span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SofQW_1.5K&#39;</span><span class="p">,</span> <span class="s1">&#39;SofQW_50K&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
    <span class="n">SofQW</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="n">output</span><span class="p">]</span>
    <span class="n">qAxis</span> <span class="o">=</span> <span class="n">SofQW</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Vertical axis</span>
    <span class="n">eAxis</span> <span class="o">=</span> <span class="n">SofQW</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Horizontal axis</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: Q range: </span><span class="si">{:.3}</span><span class="s1">...</span><span class="si">{:.3}</span><span class="s1">A; W range </span><span class="si">{:.3}</span><span class="s1">...</span><span class="si">{:.3}</span><span class="s1">meV&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">output</span><span class="p">,</span> <span class="n">qAxis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">qAxis</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">eAxis</span><span class="o">.</span><span class="n">getMin</span><span class="p">(),</span> <span class="n">eAxis</span><span class="o">.</span><span class="n">getMax</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SofQW_1.5K: Q range: 0.0...9.21A; W range -97.0...7.62meV
SofQW_50K: Q range: 0.0...9.19A; W range -96.6...7.62meV
</pre></div>
</div>
<p>And the same reduction, but with the use of the <a class="reference internal" href="../algorithms/DirectILLAutoProcess-v1.html#algm-directillautoprocess"><span class="std std-ref">DirectILLAutoProcess v1</span></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">vanadium_runs</span> <span class="o">=</span> <span class="s1">&#39;085801-085802&#39;</span>
<span class="n">sample_runs</span> <span class="o">=</span> <span class="s1">&#39;087294+087295,087283-087290&#39;</span>
<span class="n">container_runs</span> <span class="o">=</span> <span class="s1">&#39;087306-087309,087311-087314&#39;</span>

<span class="n">vanadium_ws</span> <span class="o">=</span> <span class="s1">&#39;vanadium_auto&#39;</span>
<span class="n">container_ws</span> <span class="o">=</span> <span class="s1">&#39;container&#39;</span>
<span class="n">sample_ws</span> <span class="o">=</span> <span class="s1">&#39;sample&#39;</span>

<span class="c1"># Sample self-shielding and container subtraction.</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Shape&#39;</span><span class="p">:</span> <span class="s1">&#39;HollowCylinder&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Height&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
    <span class="s1">&#39;InnerRadius&#39;</span><span class="p">:</span> <span class="mf">1.9</span><span class="p">,</span>
    <span class="s1">&#39;OuterRadius&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
    <span class="s1">&#39;Center&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">material</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ChemicalFormula&#39;</span><span class="p">:</span> <span class="s1">&#39;Cd S&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SampleNumberDensity&#39;</span><span class="p">:</span> <span class="mf">0.01</span>
<span class="p">}</span>
<span class="n">Ei</span> <span class="o">=</span> <span class="mf">8.804337831263577</span>

<span class="n">DirectILLAutoProcess</span><span class="p">(</span>
    <span class="n">Runs</span><span class="o">=</span><span class="n">vanadium_runs</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">vanadium_ws</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Vanadium&#39;</span><span class="p">,</span>
    <span class="n">ReductionType</span><span class="o">=</span><span class="s1">&#39;Powder&#39;</span><span class="p">,</span>
    <span class="n">FlatBkg</span> <span class="o">=</span> <span class="s1">&#39;Flat Bkg ON&#39;</span><span class="p">,</span>
    <span class="n">ElasticChannel</span><span class="o">=</span><span class="s1">&#39;Elastic Channel AUTO&#39;</span><span class="p">,</span>
    <span class="n">EPPCreationMethod</span><span class="o">=</span><span class="s1">&#39;Fit EPP&#39;</span>
<span class="p">)</span>

<span class="n">DirectILLAutoProcess</span><span class="p">(</span>
    <span class="n">Runs</span><span class="o">=</span><span class="n">container_runs</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">container_ws</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Empty&#39;</span><span class="p">,</span>
    <span class="n">ReductionType</span><span class="o">=</span><span class="s1">&#39;Powder&#39;</span><span class="p">,</span>
    <span class="n">IncidentEnergyCalibration</span><span class="o">=</span><span class="s2">&quot;Energy Calibration ON&quot;</span><span class="p">,</span>
    <span class="n">IncidentEnergy</span><span class="o">=</span><span class="n">Ei</span>
<span class="p">)</span>

<span class="c1"># Need to interpolate container to 50K</span>
<span class="n">T0</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">T1</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">DT</span> <span class="o">=</span> <span class="n">T1</span> <span class="o">-</span> <span class="n">T0</span>
<span class="n">Ts</span> <span class="o">=</span> <span class="mf">50.0</span> <span class="c1"># Target T</span>
<span class="n">RebinToWorkspace</span><span class="p">(</span>
    <span class="n">WorkspaceToRebin</span><span class="o">=</span><span class="s1">&#39;container_087311_Ei9meV_T100.0K&#39;</span><span class="p">,</span>
    <span class="n">WorkspaceToMatch</span><span class="o">=</span><span class="s1">&#39;container_087306_Ei9meV_T1.5K&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;container_087311_Ei9meV_T100.0K&#39;</span>
<span class="p">)</span>
<span class="n">container_Ei9meV_50K</span> <span class="o">=</span> <span class="p">(</span><span class="n">T1</span> <span class="o">-</span> <span class="n">Ts</span><span class="p">)</span> <span class="o">/</span> <span class="n">DT</span> <span class="o">*</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;container_087306_Ei9meV_T1.5K&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">Ts</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)</span> <span class="o">/</span> <span class="n">DT</span> <span class="o">*</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;container_087311_Ei9meV_T100.0K&#39;</span><span class="p">]</span>
<span class="n">mtd</span><span class="p">[</span><span class="n">container_ws</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;container_Ei9meV_50K&#39;</span><span class="p">)</span>

<span class="n">DirectILLAutoProcess</span><span class="p">(</span>
    <span class="n">Runs</span><span class="o">=</span><span class="n">sample_runs</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">sample_ws</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Sample&#39;</span><span class="p">,</span>
    <span class="n">ReductionType</span><span class="o">=</span><span class="s1">&#39;Powder&#39;</span><span class="p">,</span>
    <span class="n">VanadiumWorkspace</span><span class="o">=</span><span class="n">vanadium_ws</span><span class="p">,</span>
    <span class="n">EmptyContainerWorkspace</span><span class="o">=</span><span class="n">container_ws</span><span class="p">,</span>
    <span class="n">IncidentEnergyCalibration</span><span class="o">=</span><span class="s2">&quot;Energy Calibration ON&quot;</span><span class="p">,</span>
    <span class="n">IncidentEnergy</span><span class="o">=</span><span class="n">Ei</span><span class="p">,</span>
    <span class="n">SampleMaterial</span><span class="o">=</span><span class="n">material</span><span class="p">,</span>
    <span class="n">SampleGeometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span>
    <span class="n">SaveOutput</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ClearCache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sample_SofQW_087294_Ei9meV_T1.5K&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_SofQW_087283_Ei9meV_T50.0K&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
    <span class="n">SofQW</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="n">output</span><span class="p">]</span>
    <span class="n">qAxis</span> <span class="o">=</span> <span class="n">SofQW</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Vertical axis</span>
    <span class="n">eAxis</span> <span class="o">=</span> <span class="n">SofQW</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Horizontal axis</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: Q range: </span><span class="si">{:.3}</span><span class="s1">...</span><span class="si">{:.3}</span><span class="s1">A; W range </span><span class="si">{:.3}</span><span class="s1">...</span><span class="si">{:.3}</span><span class="s1">meV&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">output</span><span class="p">,</span> <span class="n">qAxis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">qAxis</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">eAxis</span><span class="o">.</span><span class="n">getMin</span><span class="p">(),</span> <span class="n">eAxis</span><span class="o">.</span><span class="n">getMax</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sample_SofQW_087294_Ei9meV_T1.5K: Q range: 0.0...9.21A; W range -97.0...7.62meV
sample_SofQW_087283_Ei9meV_T50.0K: Q range: 0.0...9.19A; W range -96.6...7.62meV
</pre></div>
</div>
<p><strong>Category</strong>: <a class="reference external" href="categories/Techniques.html">Techniques</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CrystalField.html" title="Previous Chapter: Crystal Field Examples"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Crystal Field...</span>
    </a>
  </li>
  <li>
    <a href="DirecttoolsPythonModule.html" title="Next Chapter: directtools"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">directtools &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>