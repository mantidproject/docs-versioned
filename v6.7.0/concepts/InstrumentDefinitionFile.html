<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Instrument Definition File</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Instrument Parameter File" href="InstrumentParameterFile.html" />
    <link rel="prev" title="Instrument Data Service" href="InstrumentDataService.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.7</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Concepts</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">Instrument Definition File</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="instrument-definition-file">
<span id="instrumentdefinitionfile"></span><h1><a class="toc-backref" href="#id24" role="doc-backlink">Instrument Definition File</a><a class="headerlink" href="#instrument-definition-file" title="Permalink to this heading">¶</a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#instrument-definition-file" id="id24">Instrument Definition File</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id25">Introduction</a></p></li>
<li><p><a class="reference internal" href="#idf-filename-convention" id="id26">IDF filename convention</a></p>
<ul>
<li><p><a class="reference internal" href="#instrument-definition-directories" id="id27">Instrument Definition Directories</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#more-detailed-descriptions-of-various-parts-of-the-idf" id="id28">More detailed descriptions of various parts of the IDF</a></p>
<ul>
<li><p><a class="reference internal" href="#geometry-shapes" id="id29">Geometry shapes</a></p></li>
<li><p><a class="reference internal" href="#top-level-instrument" id="id30">Top level &lt;instrument&gt;</a></p></li>
<li><p><a class="reference internal" href="#using-component-and-type" id="id31">Using &lt;component&gt; and &lt;type&gt;</a></p></li>
<li><p><a class="reference internal" href="#using-detector-monitor-ids" id="id32">Using detector/monitor IDs</a></p></li>
<li><p><a class="reference internal" href="#creating-grid-voxel-banks" id="id33">Creating Grid (Voxel) Banks</a></p></li>
<li><p><a class="reference internal" href="#creating-rectangular-area-detectors" id="id34">Creating Rectangular Area Detectors</a></p></li>
<li><p><a class="reference internal" href="#creating-structured-irregular-geometry-detectors" id="id35">Creating Structured (Irregular Geometry) Detectors</a></p></li>
<li><p><a class="reference internal" href="#using-location" id="id36">Using &lt;location&gt;</a></p></li>
<li><p><a class="reference internal" href="#using-locations" id="id37">Using &lt;locations&gt;</a></p></li>
<li><p><a class="reference internal" href="#using-side-by-side-view-location" id="id38">Using &lt;side-by-side-view-location&gt;</a></p></li>
<li><p><a class="reference internal" href="#using-parameter" id="id39">Using &lt;parameter&gt;</a></p></li>
<li><p><a class="reference internal" href="#accessing-parameter" id="id40">Accessing &lt;parameter&gt;</a></p></li>
<li><p><a class="reference internal" href="#using-string-parameter" id="id41">Using <em>string</em> &lt;parameter&gt;</a></p></li>
<li><p><a class="reference internal" href="#using-fitting-parameter" id="id42">Using <em>fitting</em> &lt;parameter&gt;</a></p></li>
<li><p><a class="reference internal" href="#using-component-link" id="id43">Using &lt;component-link&gt;</a></p></li>
<li><p><a class="reference internal" href="#using-combine-components-into-one-shape" id="id44">Using &lt;combine-components-into-one-shape&gt;</a></p></li>
<li><p><a class="reference internal" href="#using-defaults" id="id45">Using &lt;defaults&gt;</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#parameter-files" id="id46">Parameter Files</a></p></li>
<li><p><a class="reference internal" href="#deprecated-features" id="id47">Deprecated Features</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>The documentation on this wiki page is the full detailed description of
the syntax you can use in an IDF to describe an instrument (note
parameters of instrument components may optionally be stored in
<a class="reference internal" href="InstrumentParameterFile.html#instrumentparameterfile"><span class="std std-ref">parameter file</span></a>).</p>
<p>To get started creating an IDF follow the instructions on the <a class="reference internal" href="CreateanIDF.html#create-an-idf"><span class="std std-ref">Create an
IDF</span></a> page, then return here for more detailed
explanations of syntax and structures.</p>
<section id="introduction">
<h2><a class="toc-backref" href="#id25" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>An instrument definition file (IDF) aims to describe an instrument, in
particular providing details about those components of the instruments
that are critically affecting the observed signal from an experiment.
Parameter values of components may also be specified such as information
about the opening height of a slit, the final energy of a detector and
so on. The value of such parameters can optionally be linked to values
stored in log-files.</p>
<p>In summary an IDF may be used to describe any or all of the following:</p>
<ol class="arabic simple">
<li><p>Instrument components defined using a hierarchical structure. Take,
for example, a detector bank containing 100 identical tubes each
containing 100 detector pixels. One option is to describe this setup
using a flat structure of 100*100=10000 pixel components. Although
this is a valid approach it
#. create unnecessarily large files
#. but most importantly it does not capture the layout of the instrument.
The preferred option is to describe this example by first defining a
“pixel” type, then a “tube” type containing 100 “pixels” and finally
a “bank” component containing 100 “tubes”. This latter approach
requires the specification of 1(the bank)+100(tubes)+100(pixels)=201
components as compared to specifying 10000 components using the
former approach. The other benefit of organising the IDF according to
the layout of the instrument is that users can subsequently refer to
the structure of the instrument as it is laid out. For example can
then subsequently easily move entire ‘bank’ or associate parameters
which relevant for a specific say ‘tube’ or ‘bank’.</p></li>
<li><p>The geometric shape and position of any component including: slits,
mirrors, detectors etc.</p></li>
<li><p>A number of <a class="reference internal" href="#special-types"><span class="std std-ref">specialised component
types</span></a> are defined
including:</p>
<ul class="simple">
<li><p>detector and monitor components: required to be associated with
unique detector or monitor ID numbers. The importance of these IDs
are described further in
<a class="reference external" href="Using_detector.2Fmonitor_IDs_.3Cidlist.3E">1</a></p></li>
<li><p>SamplePos component: Purpose to store the sample position. Needed
e.g. to calculate sample-to-detector distances</p></li>
<li><p>Source component: Purpose to store the source position or a
position along the beamline but before the sample. Needed e.g. for
spallation source instruments to calculate neutron flightpaths
including the source-to-sample (primary path) distance. Also, used
to define a point along the beam located before the sample. The
direction from this position to the SamplePos is currently used to
calculate the beam direction in some calculates (for example
two-theta scattering angles).</p></li>
</ul>
</li>
<li><p>Handling of log-files. Values specified in log-files can be used to
modify parameters of components, such as a detector position
coordinate or a slit opening height, in addition to assign values to
such parameters directly</p></li>
<li><p>Specifying ‘fitting’ parameters of instrument profile functions and
other function to be used when data from the instrument are analysed.</p></li>
<li><p>Choice of preferred coordinate system. For example the default is to
define the beam along the z-axis and the y-axis to point up.</p></li>
</ol>
<p>An IDF is structured as an <a class="reference external" href="http://en.wikipedia.org/wiki/XML">XML</a>
document. For the purpose here it is enough to know that an XML document
follows a tree-based structure of elements with attributes. For example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;main-detector-bank&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;main-detector-pixel&quot;</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;-0.31&quot;</span> <span class="na">y=</span><span class="s">&quot;0.1&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;-0.32&quot;</span> <span class="na">y=</span><span class="s">&quot;0.1&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;-0.33&quot;</span> <span class="na">y=</span><span class="s">&quot;0.1&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/component&gt;</span>
<span class="nt">&lt;/type&gt;</span>
</pre></div>
</div>
<p>defines an XML element with has the attribute name=”main-detector-bank”.
This element contains one sub-element , which again contains 3 elements.
In plain English the above XML code aims to describe a
“main-detector-bank” that contains 3 detector pixels and their locations
within the bank.</p>
<p>If a component is a cylindrical tube where slices of this types are
treated as detector pixels the tube detector performance enhancement can
optionally be used, which will e.g. make the display of this tube in the
instrument viewer faster. This can be done by adding ‘outline’ attribute
to the tag and setting its value to “yes”.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;standard-tube&quot;</span> <span class="na">outline=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;standard-pixel&quot;</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;-1.4635693359375&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;-1.4607080078125&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;-1.4578466796875&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/component&gt;</span>
<span class="nt">&lt;/type&gt;</span>
</pre></div>
</div>
<p>The ‘outline attribute’ only affects the 3D view of the instrument,
which appears by default. It may lead to a less accurate placing of the
detector pixels and in particular may not show the effects of tube
calibration. However a 2D view of the instrument will still place pixel
detectors accurately.</p>
</section>
<section id="idf-filename-convention">
<h2><a class="toc-backref" href="#id26" role="doc-backlink">IDF filename convention</a><a class="headerlink" href="#idf-filename-convention" title="Permalink to this heading">¶</a></h2>
<p>An IDF can be loaded manually from any file with extension .xml or .XML
using <a class="reference internal" href="../algorithms/LoadInstrument-v1.html#algm-loadinstrument"><span class="std std-ref">LoadInstrument</span></a> or
<a class="reference internal" href="../algorithms/LoadEmptyInstrument-v1.html#algm-loademptyinstrument"><span class="std std-ref">LoadEmptyInstrument</span></a>.</p>
<p>When loading a data file if the file has an embedded mantid instrument definition
(as in some nexus files) then this one will be used, otherwise we will attempt to
determine a matching file from the IDFs located in the MantidInstall instrument directory.</p>
<p>To be found automatically Instrument definition files are
required to have the format INSTRUMENTNAME_DefinitionANYTHING.xml,
where INSTRUMENTNAME is the name of the instrument and ANYTHING can be
any string including an empty string. Where more than one IDF is defined
for an instrument the appropriate IDF is loaded based on its
<a class="reference internal" href="#top-level-instrument"><span class="std std-ref">valid-from</span></a> date. Note for this to work
the <a class="reference internal" href="Workspace.html#workspace"><span class="std std-ref">Workspace</span></a> for which an IDF is loaded into must
contain a record of when the data were collected. This information is
taken from the workspace’s <a class="reference internal" href="Run.html#run"><span class="std std-ref">Run</span></a> object, more specifically the
<em>run_start</em> property of this object.</p>
<p>You can determine which file would be selected for an instrument and date
using the following python:</p>
<p><strong>Example: Getting the right instrument filename</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if no date is given it will default to returning the IDF filename that is currently valid.</span>
<span class="kn">from</span> <span class="nn">mantid.api</span> <span class="kn">import</span> <span class="n">ExperimentInfo</span>
<span class="n">currentIDF</span> <span class="o">=</span> <span class="n">ExperimentInfo</span><span class="o">.</span><span class="n">getInstrumentFilename</span><span class="p">(</span><span class="s2">&quot;ARCS&quot;</span><span class="p">)</span>
<span class="n">otherIDF</span> <span class="o">=</span> <span class="n">ExperimentInfo</span><span class="o">.</span><span class="n">getInstrumentFilename</span><span class="p">(</span><span class="s2">&quot;ARCS&quot;</span><span class="p">,</span> <span class="s2">&quot;2012-10-30T00:00:00&quot;</span><span class="p">)</span>
</pre></div>
</div>
<section id="instrument-definition-directories">
<span id="instrumentdefinitionfile-directories"></span><h3><a class="toc-backref" href="#id27" role="doc-backlink">Instrument Definition Directories</a><a class="headerlink" href="#instrument-definition-directories" title="Permalink to this heading">¶</a></h3>
<p>Mantid ships with many instrument definition files within the installation but
also has the capability of fetching new instrument definitions by running the
<a class="reference internal" href="../algorithms/DownloadInstrument-v1.html#algm-downloadinstrument"><span class="std std-ref">DownloadInstrument</span></a> algorithm (this is run
automatically on startup). Downloaded definitions are written to a different
directory to the shipped versions so that they do not overwrite them. The default list
of directories searched (in the this order) for an IDF for a given instrument are:</p>
<p>For Windows:</p>
<ul class="simple">
<li><p>%APPDATA%\mantidproject\instrument: location of downloaded files</p></li>
<li><p>[INSTALLDIR]\instrument: location of shipped files</p></li>
</ul>
<p>For Linux/OSX:</p>
<ul class="simple">
<li><p>$HOME/.mantid/instrument: location of downloaded files</p></li>
<li><p>/etc/mantid/instrument: system-wide location for all users of a machine</p></li>
<li><p>[INSTALLDIR]/instrument: location of shipped files</p></li>
</ul>
<section id="editing-downloaded-definitions">
<h4>Editing Downloaded Definitions<a class="headerlink" href="#editing-downloaded-definitions" title="Permalink to this heading">¶</a></h4>
<p>You should not edit files in the downloaded location, or add new ones as the may be deleted or overwritten.
If you have a change to an instrument definition you wish to use then edit a copy in the
[INSTALLDIR] instrument directory, but update the valid-from date so mantid will pick that one
up in preference.  Or if you just wish to force a particular instrument definition for a particular
workspace just run <a class="reference internal" href="../algorithms/LoadInstrument-v1.html#algm-loadinstrument"><span class="std std-ref">LoadInstrument</span></a> for that workspace.</p>
</section>
</section>
</section>
<section id="more-detailed-descriptions-of-various-parts-of-the-idf">
<h2><a class="toc-backref" href="#id28" role="doc-backlink">More detailed descriptions of various parts of the IDF</a><a class="headerlink" href="#more-detailed-descriptions-of-various-parts-of-the-idf" title="Permalink to this heading">¶</a></h2>
<section id="geometry-shapes">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">Geometry shapes</a><a class="headerlink" href="#geometry-shapes" title="Permalink to this heading">¶</a></h3>
<p>For information on how to define geometric shapes see
<a class="reference internal" href="HowToDefineGeometricShape.html#howtodefinegeometricshape"><span class="std std-ref">HowToDefineGeometricShape</span></a>.</p>
</section>
<section id="top-level-instrument">
<span id="id2"></span><h3><a class="toc-backref" href="#id30" role="doc-backlink">Top level &lt;instrument&gt;</a><a class="headerlink" href="#top-level-instrument" title="Permalink to this heading">¶</a></h3>
<p>&lt;instrument&gt; is the top level XML element of an IDF. It takes attributes, three of
which must be included. An example is</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;instrument</span> <span class="na">xmlns=</span><span class="s">&quot;http://schema.mantidproject.org/IDF/1.0&quot;</span>
            <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
            <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://schema.mantidproject.org/IDF/1.0 http://schema.mantidproject.org/IDF/1.0/IDFSchema.xsd&quot;</span>
            <span class="na">name=</span><span class="s">&quot;ARCS&quot;</span>
            <span class="na">valid-from=</span><span class="s">&quot;1900-01-31 23:59:59&quot;</span>
            <span class="na">valid-to=</span><span class="s">&quot;2100-01-31 23:59:59&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>
<p>Of the attributes in the example above</p>
<ul class="simple">
<li><p>xmlns, xmlns:xsi, xsi:schemaLocation are required attributes that can
be copied verbatim as above</p></li>
<li><p>name is (at present) optional, although it is recommended to specify
something sensible</p></li>
<li><p>valid-from is compulsory and is the date from which the IDF is valid
from (+). This date must be larger than or equal to 1900-01-31
23:59:01</p></li>
<li><p>valid-to may optionally be added to indicate the date to which the
IDF is valid to. If not used, the file is permanently valid. (+)</p></li>
</ul>
<p>(+) Both valid-from and valid-to are required to be set using the ISO
8601 date-time format, i.e. as YYYY-MM-DD HH:MM:SS or
YYYY-MM-DDTHH:MM:SS <a class="reference external" href="http://en.wikipedia.org/wiki/ISO_8601">2</a>.
Valid ranges may overlap, provided the valid-from times are all
different. If several files are currently valid, the one with the most
recent valid-from time is selected.</p>
</section>
<section id="using-component-and-type">
<span id="id3"></span><h3><a class="toc-backref" href="#id31" role="doc-backlink">Using &lt;component&gt; and &lt;type&gt;</a><a class="headerlink" href="#using-component-and-type" title="Permalink to this heading">¶</a></h3>
<p>Use the element to define a physical part of the instrument. A requires
two things</p>
<ol class="arabic simple">
<li><p>It must have a type=”some type” attribute. This specify the ‘type’ of
the component and this type must be specified somewhere in the IDF
using: .</p></li>
<li><p>It must contain at least one &lt;location&gt; element. If multiple &lt;location&gt; are specified then
this is essentially a shorthand notation for defining multiple
components of the same type at different locations.</p></li>
</ol>
<p>Here is an example</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;slit&quot;</span> <span class="na">name=</span><span class="s">&quot;bob&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;10.651&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;11.983&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;slit&quot;</span><span class="nt">&gt;&lt;/type&gt;</span>
</pre></div>
</div>
<p>Which defined two slits at two difference locations. Optionally a &lt;component&gt; can be
given a ‘name’, in the above example this name is “bob”. If no ‘name’
attribute is specified the name of the &lt;component&gt; defaults to the ‘type’ string, in
the above this is “slit”. Giving sensible names to components is
recommended for a number of reasons including
#. The ‘Instrument Tree’ view of an instrument viewer uses these names
#. when specifying &lt;parameter&gt;s through  &lt;component-link&gt;s these names are used.</p>
<section id="special-type-s">
<span id="special-types"></span><h4>Special &lt;type&gt;s<a class="headerlink" href="#special-type-s" title="Permalink to this heading">¶</a></h4>
<p>Within Mantid certain &lt;type&gt;s have special meaning. A special &lt;type&gt; is specified by
including an ‘is’ attribute as demonstrated below</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;pixel&quot;</span> <span class="na">is=</span><span class="s">&quot;detector&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;cuboid</span> <span class="na">id=</span><span class="s">&quot;app-shape&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;left-front-bottom-point</span> <span class="na">x=</span><span class="s">&quot;0.0025&quot;</span> <span class="na">y=</span><span class="s">&quot;-0.1&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;left-front-top-point</span>  <span class="na">x=</span><span class="s">&quot;0.0025&quot;</span> <span class="na">y=</span><span class="s">&quot;-0.1&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0002&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;left-back-bottom-point</span>  <span class="na">x=</span><span class="s">&quot;-0.0025&quot;</span> <span class="na">y=</span><span class="s">&quot;-0.1&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;right-front-bottom-point</span>  <span class="na">x=</span><span class="s">&quot;0.0025&quot;</span> <span class="na">y=</span><span class="s">&quot;0.1&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span>  <span class="nt">/&gt;</span>
  <span class="nt">&lt;/cuboid&gt;</span>
<span class="nt">&lt;/type&gt;</span>
</pre></div>
</div>
<p>where the ‘is’ attribute of is used to say this is a detector-&lt;type&gt; (note
this particular detector-&lt;type&gt; has been assigned a geometric shape, in this
case a cuboid, see
<a class="reference internal" href="HowToDefineGeometricShape.html#howtodefinegeometricshape"><span class="std std-ref">HowToDefineGeometricShape</span></a>). Special
types recognised are:</p>
<ol class="arabic simple">
<li><p>Detector (or detector)</p></li>
<li><p>Monitor (or monitor)</p></li>
<li><p><a class="reference internal" href="#creating-rectangular-area-detectors"><span class="std std-ref">RectangularDetector</span></a>
(or rectangularDetector, rectangulardetector, or
rectangular_detector)</p></li>
<li><p><a class="reference internal" href="#creating-structured-detectors"><span class="std std-ref">StructuredDetector</span></a>
(or structuredDetector, structureddetector, or
structured_detector)</p></li>
<li><p>Source (or source)</p></li>
<li><p>SamplePos (or samplePos)</p></li>
<li><p>ChopperPos (or chopperPos)</p></li>
</ol>
<p>For example it is important to specify the location of one Source-&lt;type&gt; and
one SamplePos-&lt;type&gt; in order for Mantid to be able to calculate L1 and L2
distances and convert time-of-flight to, for instance, d-spacing. An
example of specifying a Source and SamplePos is shown below</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;neutron moderator&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;location</span> <span class="na">z=</span><span class="s">&quot;-10.0&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;/component&gt;</span>
<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;neutron moderator&quot;</span> <span class="na">is=</span><span class="s">&quot;Source&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;some sample holder&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;location</span> <span class="nt">/&gt;</span> <span class="nt">&lt;/component&gt;</span>
<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;some sample holder&quot;</span> <span class="na">is=</span><span class="s">&quot;SamplePos&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="using-detector-monitor-ids">
<h3><a class="toc-backref" href="#id32" role="doc-backlink">Using detector/monitor IDs</a><a class="headerlink" href="#using-detector-monitor-ids" title="Permalink to this heading">¶</a></h3>
<p>Any component that is either a detector or monitor must be assigned a
unique detector/monitor ID numbers (note this is <em>not</em> spectrum
numbers but detector/monitor ID numbers). There are at least two
important reason to insist on this.</p>
<ul class="simple">
<li><p>Data stored in files need to have a way to be linked to
detectors/monitors defined in the IDF. For example, at the ISIS
facility, data are recorded together with unique detector ID numbers.
Hence the job here to match the IDs in the data file with the IDs of
the IDF. Where unique IDs are not stored with the data the creator of
an IDF have some flexibility to chose these ID numbers since the data
themselves does not contain such number. However a link between the IDs
and spectra in a workspace still needs to be made. By default the
<a class="reference internal" href="../algorithms/LoadInstrument-v1.html#algm-loadinstrument"><span class="std std-ref">LoadInstrument</span></a> algorithm, see in particular the
RewriteSpectraMap parameter of this algorithm, will map the
detector/monitor IDs with spectrum numbers as follows: the
detector/monitor IDs in the IDF are ordered from smallest to largest
number and then assigned in that order to the spectra in the
workspace used to hold the data in Mantid.</p></li>
<li><p>Mantid needs to have a way to associate data which the
detectors/monitors of the instrument, which is do this using the
detector IDs. Although not mandatory it is recommended to give
memorisable names to collection of detectors/monitors or individual
detectors/monitors that a user is likely to want to refer. This allow
a user to refer to a collection of detectors by name rather than
trying to remember a sequence of IDs. Note the counts in a histogram
spectrum may be the sum of counts from a number of detectors and
Mantid, behind the scene, use the IDs to keep track of this.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As of version 3.12 of Mantid, Instruments in Mantid will no longer silently discard detectors defined with duplicate IDs. Detector IDs (including Monitors) must be unique across the Instrument. IDFs cannot be loaded if they violate this.</p>
</div>
<p>The &lt;idlist&gt; element and the idlist attribute of the elements is used to assign
detector IDs. The notation for using idlist is</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;monitor&quot;</span> <span class="na">idlist=</span><span class="s">&quot;monitor-id-list&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;5.15800&quot;</span> <span class="na">t=</span><span class="s">&quot;180.0&quot;</span> <span class="na">p=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span> <span class="cm">&lt;!-- set to ID=500 in list below --&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;5.20400&quot;</span> <span class="na">t=</span><span class="s">&quot;180.0&quot;</span> <span class="na">p=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span> <span class="cm">&lt;!-- set to ID=510 --&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;5.30400&quot;</span> <span class="na">t=</span><span class="s">&quot;180.0&quot;</span> <span class="na">p=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span> <span class="cm">&lt;!-- set to ID=520 --&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;5.40400&quot;</span> <span class="na">t=</span><span class="s">&quot;180.0&quot;</span> <span class="na">p=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span> <span class="cm">&lt;!-- set to ID=531 --&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;6.10400&quot;</span> <span class="na">t=</span><span class="s">&quot;180.0&quot;</span> <span class="na">p=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span> <span class="cm">&lt;!-- set to ID=611 --&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;6.24700&quot;</span> <span class="na">t=</span><span class="s">&quot;0.000&quot;</span> <span class="na">p=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span> <span class="cm">&lt;!-- set to ID=612 --&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;6.34700&quot;</span> <span class="na">t=</span><span class="s">&quot;0.000&quot;</span> <span class="na">p=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span> <span class="cm">&lt;!-- set to ID=613 --&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;6.50000&quot;</span> <span class="na">t=</span><span class="s">&quot;0.000&quot;</span> <span class="na">p=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span> <span class="cm">&lt;!-- set to ID=650 --&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;monitor&quot;</span> <span class="na">is=</span><span class="s">&quot;monitor&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;idlist</span> <span class="na">idname=</span><span class="s">&quot;monitor-id-list&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;id</span> <span class="na">start=</span><span class="s">&quot;500&quot;</span> <span class="na">step=</span><span class="s">&quot;10&quot;</span> <span class="na">end=</span><span class="s">&quot;530&quot;</span> <span class="nt">/&gt;</span>  <span class="cm">&lt;!-- specifies IDs: 500, 510, 520, 530 --&gt;</span>
  <span class="nt">&lt;id</span> <span class="na">start=</span><span class="s">&quot;611&quot;</span> <span class="na">end=</span><span class="s">&quot;613&quot;</span> <span class="nt">/&gt;</span>            <span class="cm">&lt;!-- specifies IDs: 611, 612 and 613 --&gt;</span>
  <span class="nt">&lt;id</span> <span class="na">val=</span><span class="s">&quot;650&quot;</span> <span class="nt">/&gt;</span>                        <span class="cm">&lt;!-- specifies ID: 650 --&gt;</span>
<span class="nt">&lt;/idlist&gt;</span>
</pre></div>
</div>
<p>As can be seen to specify a sequence of IDs use the notation &lt;id start=”500” step=”10” end=”530” /&gt;, where if
the step attribute defaults to step=”1” if it is left out. Just specify
just a single ID number you may alternatively use the notation &lt;id val=”650” /&gt;. Please
note the number of ID specified must match the number of
detectors/monitors defined.</p>
</section>
<section id="creating-grid-voxel-banks">
<span id="id4"></span><h3><a class="toc-backref" href="#id33" role="doc-backlink">Creating Grid (Voxel) Banks</a><a class="headerlink" href="#creating-grid-voxel-banks" title="Permalink to this heading">¶</a></h3>
<p>There is a shortcut way to create 3D arrays of detector pixels. These pixels represent volumetric detectors. Here is an example how to do this:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;block&quot;</span>  <span class="na">idstart=</span><span class="s">&quot;1&quot;</span> <span class="na">idfillorder=</span><span class="s">&quot;zxy&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;0&quot;</span> <span class="na">y=</span><span class="s">&quot;0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.2&quot;</span> <span class="na">name=</span><span class="s">&quot;bank2&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/location&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;block&quot;</span> <span class="na">is=</span><span class="s">&quot;GridDetector&quot;</span> <span class="na">type=</span><span class="s">&quot;voxel&quot;</span>
    <span class="na">xpixels=</span><span class="s">&quot;4&quot;</span> <span class="na">xstart=</span><span class="s">&quot;-0.04&quot;</span> <span class="na">xstep=</span><span class="s">&quot;+0.02&quot;</span>
    <span class="na">ypixels=</span><span class="s">&quot;48&quot;</span> <span class="na">ystart=</span><span class="s">&quot;-0.48&quot;</span> <span class="na">ystep=</span><span class="s">&quot;+0.02&quot;</span>
    <span class="na">zpixels=</span><span class="s">&quot;16&quot;</span> <span class="na">zstart=</span><span class="s">&quot;-0.08&quot;</span> <span class="na">zstep=</span><span class="s">&quot;+0.01&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;properties/&gt;</span>
<span class="nt">&lt;/type&gt;</span>

<span class="cm">&lt;!-- Pixel for Detectors--&gt;</span>
<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;voxel&quot;</span> <span class="na">is=</span><span class="s">&quot;detector&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;cuboid</span> <span class="na">id=</span><span class="s">&quot;shape&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;left-front-bottom-point</span> <span class="na">x=</span><span class="s">&quot;-0.01&quot;</span> <span class="na">y=</span><span class="s">&quot;-0.01&quot;</span> <span class="na">z=</span><span class="s">&quot;-0.005&quot;</span>  <span class="nt">/&gt;</span>
            <span class="nt">&lt;left-front-top-point</span>  <span class="na">x=</span><span class="s">&quot;-0.01&quot;</span> <span class="na">y=</span><span class="s">&quot;0.01&quot;</span> <span class="na">z=</span><span class="s">&quot;-0.005&quot;</span>  <span class="nt">/&gt;</span>
            <span class="nt">&lt;left-back-bottom-point</span>  <span class="na">x=</span><span class="s">&quot;0.01&quot;</span> <span class="na">y=</span><span class="s">&quot;-0.01&quot;</span> <span class="na">z=</span><span class="s">&quot;-0.005&quot;</span>  <span class="nt">/&gt;</span>
            <span class="nt">&lt;right-front-bottom-point</span>  <span class="na">x=</span><span class="s">&quot;-0.01&quot;</span> <span class="na">y=</span><span class="s">&quot;-0.01&quot;</span> <span class="na">z=</span><span class="s">&quot;0.005&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cuboid&gt;</span>
<span class="nt">&lt;algebra</span> <span class="na">val=</span><span class="s">&quot;shape&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/type&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The “block” type defined above has the special “is” tag of “GridDetector”. The same type definition
then needs these attributes specified:</p>
<ul>
<li><p>type: point to another type defining your pixel shape and size.</p></li>
<li><p>xpixels: number of pixels in X</p></li>
<li><p>xstart: x-position of the 0-th pixel (in length units, normally meters)</p></li>
<li><p>xstep: step size between pixels in the horizontal direction (in length units, normally meters)</p></li>
<li><p>ypixels: number of pixels in Y</p></li>
<li><p>ystart: y-position of the 0-th pixel (in length units, normally meters)</p></li>
<li><p>ystep: step size between pixels in the vertical direction (in length units, normally meters)</p></li>
<li><p>zpixels: number of pixels in Z</p></li>
<li><p>zstart: z-position of the 0-th pixel (in length units, normally meters)</p></li>
<li><p>zstep: step size between pixels in the z (usually beam) direction (in length units, normally meters)</p></li>
</ul>
</li>
<li><p>Detectors of the type specified (“pixel” in the example) will be replicated at the X Y and Z coordinates
given. The usual rotation and translation of the panel will rotate the pixels as needed.</p></li>
<li><p>Each instance of a “block” needs to set these attributes, at the &lt;component&gt; tag, in order to specify the
Pixel IDs of the 2D array.</p>
<ul>
<li><p>idstart: detector ID of the first pixel</p></li>
<li><p>idfillorder: a string which determines the ordering of the axes. For example “zxy”: (0,0,0)=1;
(0,0,1)=1, (0, 0, 2)=2 and so on. Default is idfillorder=”xyz”. Other characters are not allowed and
the string must contain all three axes.</p></li>
<li><p>idstepbyrow: amount to increase the ID number on each row (2nd order). e.g, if idfillorder=”zyx”,and set
idstepbyrow=”100”, and have 10 Z pixels, you would get: (0,0,0)=0; (0,0,1)=1; … (0,0,9)=9;
(0,1,0)=100;(0,1,1)=101; etc. The last order is always calculated automatically.</p></li>
<li><p>idstep. Default to 1. Set the ID increment within a row (1st order).</p></li>
</ul>
</li>
<li><p>DO NOT also specify an “idlist” attribute for rectangular detectors, as it will not be used.</p></li>
<li><p>Advantages of using a GridDetector tag:</p>
<ul>
<li><p>Convenient way of defining voxel-based instruments.</p></li>
<li><p>Special handling/rendering of each voxel layer (z plane) as textures in the instrument view.</p></li>
<li><p>Smaller IDF and faster instrument loading times.</p></li>
<li><p>No need to make a script to generate the pixel positions.</p></li>
</ul>
</li>
<li><p>Disadvantages/Limitations:</p>
<ul>
<li><p>Must have constant pixel spacing in each direction.</p></li>
<li><p>Bank must be cuboid (box) shape.</p></li>
</ul>
</li>
</ul>
</section>
<section id="creating-rectangular-area-detectors">
<span id="id5"></span><h3><a class="toc-backref" href="#id34" role="doc-backlink">Creating Rectangular Area Detectors</a><a class="headerlink" href="#creating-rectangular-area-detectors" title="Permalink to this heading">¶</a></h3>
<p>There is a shortcut way to create 2D arrays of detector pixels. Here is
an example of how to do it:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;panel&quot;</span>  <span class="na">idstart=</span><span class="s">&quot;1000&quot;</span> <span class="na">idfillbyfirst=</span><span class="s">&quot;y&quot;</span> <span class="na">idstepbyrow=</span><span class="s">&quot;300&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;0&quot;</span> <span class="na">t=</span><span class="s">&quot;0&quot;</span> <span class="na">name=</span><span class="s">&quot;bank1&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/location&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;panel&quot;</span>  <span class="na">idstart=</span><span class="s">&quot;100000&quot;</span> <span class="na">idfillbyfirst=</span><span class="s">&quot;y&quot;</span> <span class="na">idstepbyrow=</span><span class="s">&quot;300&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;45.0&quot;</span> <span class="na">t=</span><span class="s">&quot;0&quot;</span> <span class="na">name=</span><span class="s">&quot;bank2&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/location&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="cm">&lt;!-- Rectangular Detector Panel. Position 100 &quot;pixel&quot; along x from -0.1 to 0.1</span>
<span class="cm">     and 200 &quot;pixel&quot; along y from -0.2 to 0.2 (relative to the coordinate system of the bank) --&gt;</span>
<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;panel&quot;</span> <span class="na">is=</span><span class="s">&quot;RectangularDetector&quot;</span> <span class="na">type=</span><span class="s">&quot;pixel&quot;</span>
    <span class="na">xpixels=</span><span class="s">&quot;100&quot;</span> <span class="na">xstart=</span><span class="s">&quot;-0.100&quot;</span> <span class="na">xstep=</span><span class="s">&quot;+0.002&quot;</span>
    <span class="na">ypixels=</span><span class="s">&quot;200&quot;</span> <span class="na">ystart=</span><span class="s">&quot;-0.200&quot;</span> <span class="na">ystep=</span><span class="s">&quot;+0.002&quot;</span> <span class="nt">&gt;</span>
<span class="nt">&lt;/type&gt;</span>

<span class="cm">&lt;!-- Pixel for Detectors. Shape defined to be a (0.001m)^2 square in XY-plane with tickness 0.0001m --&gt;</span>
<span class="nt">&lt;type</span> <span class="na">is=</span><span class="s">&quot;detector&quot;</span> <span class="na">name=</span><span class="s">&quot;pixel&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;cuboid</span> <span class="na">id=</span><span class="s">&quot;pixel-shape&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;left-front-bottom-point</span> <span class="na">y=</span><span class="s">&quot;-0.001&quot;</span> <span class="na">x=</span><span class="s">&quot;-0.001&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;left-front-top-point</span> <span class="na">y=</span><span class="s">&quot;0.001&quot;</span> <span class="na">x=</span><span class="s">&quot;-0.001&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;left-back-bottom-point</span> <span class="na">y=</span><span class="s">&quot;-0.001&quot;</span> <span class="na">x=</span><span class="s">&quot;-0.001&quot;</span> <span class="na">z=</span><span class="s">&quot;-0.0001&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;right-front-bottom-point</span> <span class="na">y=</span><span class="s">&quot;-0.001&quot;</span> <span class="na">x=</span><span class="s">&quot;0.001&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/cuboid&gt;</span>
  <span class="nt">&lt;algebra</span> <span class="na">val=</span><span class="s">&quot;pixel-shape&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/type&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The “panel” type defined above has the special “is” tag of
“RectangularDetector”. The same type definition then needs these
attributes specified:</p>
<ul>
<li><p>type: point to another type defining your pixel shape and size.</p></li>
<li><p>xpixels: number of pixels in X</p></li>
<li><p>xstart: x-position of the 0-th pixel (in length units, normally
meters)</p></li>
<li><p>xstep: step size between pixels in the horizontal direction (in
length units, normally meters)</p></li>
<li><p>ypixels: number of pixels in Y</p></li>
<li><p>ystart: y-position of the 0-th pixel (in length units, normally
meters)</p></li>
<li><p>ystep: step size between pixels in the vertical direction (in
length units, normally meters)</p></li>
</ul>
</li>
<li><p>Detectors of the type specified (“pixel” in the example) will be
replicated at the X Y coordinates given. The usual rotation and
translation of the panel will rotate the pixels as needed.</p></li>
<li><p>Each instance of a “panel” needs to set these attributes, at the &lt;component&gt; tag,
in order to specify the Pixel IDs of the 2D array.</p>
<ul>
<li><p>idstart: detector ID of the first pixel</p></li>
<li><p>idfillbyfirst: set to true if ID numbers increase with Y indices
first. That is: (0,0)=0; (0,1)=1, (0,2)=2 and so on. Default is
idfillbyfirst=”y”.</p></li>
<li><p>idstepbyrow: amount to increase the ID number on each row. e.g, if
you fill by Y first,and set idstepbyrow = 100, and have 50 Y
pixels, you would get: (0,0)=0; (0,1)=1; … (0,49)=49; (1,0)=100;
(1,1)=101; etc.</p></li>
<li><p>idstep. Default to 1. Set the ID increment within a row.</p></li>
</ul>
</li>
<li><p>DO NOT also specify an “idlist” attribute for rectangular detectors,
as it will not be used.</p></li>
<li><p>Advantages of using a Rectangular Detector tag instead of defining
every single pixel:</p>
<ul>
<li><p>The data will be displayed as a bitmap in the instrument 3D view,
making rendering much faster.</p></li>
<li><p>Smaller IDF and faster instrument loading times.</p></li>
<li><p>No need to make a script to generate the pixel positions.</p></li>
</ul>
</li>
<li><p>Disadvantages/Limitations:</p>
<ul>
<li><p>Must have constant pixel spacing in each direction.</p></li>
<li><p>Must be rectangular shape.</p></li>
</ul>
</li>
</ul>
</section>
<section id="creating-structured-irregular-geometry-detectors">
<span id="creating-structured-detectors"></span><h3><a class="toc-backref" href="#id35" role="doc-backlink">Creating Structured (Irregular Geometry) Detectors</a><a class="headerlink" href="#creating-structured-irregular-geometry-detectors" title="Permalink to this heading">¶</a></h3>
<p>In the previous example, we saw that Rectangular Detectors provide a simple way
of producing detectors with regular topology and geometry. The StructuredDetector
provides a way of producing detectors with regular topology and irregular geometry. It
can be thought of as a warped RectangularDetector:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&quot;DetectorBank&quot;</span> <span class="na">type=</span><span class="s">&quot;fan&quot;</span> <span class="na">idstart=</span><span class="s">&quot;0&quot;</span> <span class="na">idfillfirst=</span><span class="s">&quot;y&quot;</span> <span class="na">idstepbyrow=</span><span class="s">&quot;100&quot;</span> <span class="na">idstep=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;fan&quot;</span> <span class="na">is=</span><span class="s">&quot;StructuredDetector&quot;</span> <span class="na">xpixels=</span><span class="s">&quot;4&quot;</span> <span class="na">ypixels=</span><span class="s">&quot;5&quot;</span> <span class="na">type=</span><span class="s">&quot;pixel&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;-0.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;-0.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;-0.00138071187457&quot;</span> <span class="na">y=</span><span class="s">&quot;0.00333333333333&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;-0.000663041224598&quot;</span> <span class="na">y=</span><span class="s">&quot;0.00333333333333&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.00333333333333&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.000663041224597&quot;</span> <span class="na">y=</span><span class="s">&quot;0.00333333333333&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.00138071187457&quot;</span> <span class="na">y=</span><span class="s">&quot;0.00333333333333&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;-0.00276142374915&quot;</span> <span class="na">y=</span><span class="s">&quot;0.00666666666667&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;-0.0013260824492&quot;</span> <span class="na">y=</span><span class="s">&quot;0.00666666666667&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.00666666666667&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.00132608244919&quot;</span> <span class="na">y=</span><span class="s">&quot;0.00666666666667&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.00276142374915&quot;</span> <span class="na">y=</span><span class="s">&quot;0.00666666666667&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;-0.00414213562372&quot;</span> <span class="na">y=</span><span class="s">&quot;0.01&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;-0.00198912367379&quot;</span> <span class="na">y=</span><span class="s">&quot;0.01&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.01&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.00198912367379&quot;</span> <span class="na">y=</span><span class="s">&quot;0.01&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.00414213562372&quot;</span> <span class="na">y=</span><span class="s">&quot;0.01&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;-0.0055228474983&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0133333333333&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;-0.00265216489839&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0133333333333&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0133333333333&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.00265216489839&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0133333333333&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.00552284749829&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0133333333333&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;-0.00690355937287&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0166666666667&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;-0.00331520612299&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0166666666667&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0166666666667&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.00331520612299&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0166666666667&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;vertex</span> <span class="na">x=</span><span class="s">&quot;0.00690355937287&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0166666666667&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/type&gt;</span>

<span class="nt">&lt;type</span> <span class="na">is=</span><span class="s">&quot;detector&quot;</span> <span class="na">name=</span><span class="s">&quot;pixel&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The “DetectorBank” type defined above has the special “is” tag of
“StructuredDetector”. The same type definition then needs these
attributes specified:</p>
<ul>
<li><p>type: point to another type defining your pixel shape and size.</p></li>
<li><p>xpixels: number of pixels in X.</p></li>
<li><p>ypixels: number of pixels in Y.</p></li>
</ul>
</li>
<li><p>The StrucuredDetector type contains special &lt;vertex&gt; tags enclosed by this type.
There are some useful points to note about this type of definition:</p>
<ul>
<li><p>All vertices for a single detector panel must be defined.</p></li>
<li><p>Detector panels can be duplicated and repositioned using &lt;component&gt; and &lt;location&gt; tags.</p></li>
<li><p>Vertices appear in a particular winding order increasing in x then y then z e.g
(1, 0, 0) (2, 0, 0) / (1, 1, 0) (2, 1, 0)/ (1, 2, 0) (2, 2, 0) etc. Z
is assumed to be fixed.</p></li>
<li><p>The total number of vertices are strictly (xpixels + 1) * (ypixels + 1)</p></li>
</ul>
</li>
<li><p>Detectors of the type specified (“pixel” in the example) will be
replicated at the X Y coordinates given. Shapes do not need to be
provided for the structured detector, hexahedra are assumed. Any
shape provided will be ignored.</p></li>
<li><p>Each instance of a “DetectorBank” needs to set these attributes, at the &lt;component&gt; tag,
in order to specify the Pixel IDs of the 2D array.</p>
<ul>
<li><p>idstart: detector ID of the first pixel</p></li>
<li><p>idfillbyfirst: set to true if ID numbers increase with Y indices
first. That is: (0,0)=0; (0,1)=1, (0,2)=2 and so on. Default is
idfillbyfirst=”y”.</p></li>
<li><p>idstepbyrow: amount to increase the ID number on each row. e.g, if
you fill by Y first,and set idstepbyrow = 100, and have 50 Y
pixels, you would get: (0,0)=0; (0,1)=1; … (0,49)=49; (1,0)=100;
(1,1)=101; etc.</p></li>
<li><p>idstep. Default to 1. Set the ID increment within a row.</p></li>
</ul>
</li>
<li><p>DO NOT also specify an “idlist” attribute for structured detectors,
as it will not be used.</p></li>
<li><p>Advantages of using a Structured Detector tag instead of defining
every single pixel:</p>
<ul>
<li><p>Smaller IDF and faster instrument loading times.</p></li>
<li><p>Can be used to produced any desired irregular shape once the winding order is correct.</p></li>
</ul>
</li>
<li><p>Disadvantages/Limitations:</p>
<ul>
<li><p>Must define every vertex in one panel although significantly simpler than defining every detector in the IDF.</p></li>
<li><p>Mistakes in the vertex winding order can lead to unpredictable geometries.</p></li>
<li><p>Vertices will most likely need to be generated using a script for complex geometries.</p></li>
</ul>
</li>
</ul>
</section>
<section id="using-location">
<span id="id6"></span><h3><a class="toc-backref" href="#id36" role="doc-backlink">Using &lt;location&gt;</a><a class="headerlink" href="#using-location" title="Permalink to this heading">¶</a></h3>
<p>The &lt;location&gt; element allows the specification of both the position of a component
and a rotation or the component’s coordinate system. The position part
can be specified either using standard x, y and z coordinates or using
spherical coordinates: r, t and p, which stands for radius, theta and
phi, t is the angle from the z-axis towards the x-axis and p is the
azimuth angle in the xy-plane
<a class="reference external" href="http://en.wikipedia.org/wiki/Spherical_coordinate_system">3</a>.
Examples of translations include</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;something&quot;</span> <span class="na">name=</span><span class="s">&quot;bob&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;1.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="na">name=</span><span class="s">&quot;benny&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;1.0&quot;</span> <span class="na">t=</span><span class="s">&quot;90.0&quot;</span> <span class="na">p=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<p>The above two translations have identical effect. They both translate a
component along the x-axis by “1.0”. Note that optionally a &lt;location&gt; can be given
a name similarly to how a &lt;location&gt; can optionally be given a name. If a ‘name’
attribute is not specified for a &lt;location&gt; element it defaults to the name of the
&lt;component&gt;.</p>
<p>The rotation part is specified using the attributes ‘rot’, ‘axis-x’,
‘axis-y’, ‘axis-z’ and these result in a rotation about the axis defined
by the latter three attributes. As an example the effect of</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;location</span> <span class="na">rot=</span><span class="s">&quot;45.0&quot;</span> <span class="na">axis-x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">axis-y=</span><span class="s">&quot;0.0&quot;</span> <span class="na">axis-z=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>is to set the coordinate frame of the this component equal to that of
the parent component rotated by 45 degrees around the z-axis.</p>
<p>Both a translation and rotation can be defined within one &lt;location&gt; element. For
example</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;1.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="na">rot=</span><span class="s">&quot;45.0&quot;</span> <span class="na">axis-x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">axis-y=</span><span class="s">&quot;0.0&quot;</span> <span class="na">axis-z=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>will cause this component to be translation along the x-axis by “1.0”
relative to the coordinate frame of the parent component followed by a
rotation of the coordinate frame by 45 degrees around the z-axis as
demonstrated in the figure below.</p>
<figure class="align-default" id="id22">
<img alt="Location-element-transformation.png" src="../_images/Location-element-transformation.png" />
<figcaption>
<p><span class="caption-text">Location-element-transformation.png</span><a class="headerlink" href="#id22" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Any rotation of a coordinate system can be performed by a rotation about
some axis, however, sometime it may be advantageous to think of such a
rotation as a composite of two or more rotations. For this reason a &lt;location&gt;
element is allowed to have sub-rotation-elements, and an example of a
composite rotation is</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;4.8&quot;</span> <span class="na">t=</span><span class="s">&quot;5.3&quot;</span> <span class="na">p=</span><span class="s">&quot;102.8&quot;</span> <span class="na">rot=</span><span class="s">&quot;-20.6&quot;</span> <span class="na">axis-x=</span><span class="s">&quot;0&quot;</span> <span class="na">axis-y=</span><span class="s">&quot;1&quot;</span> <span class="na">axis-z=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;rot</span> <span class="na">val=</span><span class="s">&quot;102.8&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rot</span> <span class="na">val=</span><span class="s">&quot;50&quot;</span> <span class="na">axis-x=</span><span class="s">&quot;0&quot;</span> <span class="na">axis-y=</span><span class="s">&quot;1&quot;</span> <span class="na">axis-z=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/rot&gt;</span>
<span class="nt">&lt;/location&gt;</span>
</pre></div>
</div>
<p>The outermost is applied first followed by the 2nd outermost operation
and so on. In the above example this results in a -20.6 degree rotation
about the y-axis followed by a 102.8 degree rotation about the z-axis
(of the frame which has just be rotated by -20.6 degrees) and finally
followed by another rotation about the y-axis, this time by 50 degrees.
Note that the z-axis for the second rotation is implicit since no other axis
information provided for the second rotation. This is hard-coded.
The ISIS NIMROD instrument (NIM_Definition.xml) uses this feature.</p>
<p>The translation part of a &lt;location&gt; element can like the rotation part also be
split up into a nested set of translations. This is demonstrated below</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;location</span>  <span class="na">r=</span><span class="s">&quot;10&quot;</span> <span class="na">t=</span><span class="s">&quot;90&quot;</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;trans</span> <span class="na">r=</span><span class="s">&quot;8&quot;</span> <span class="na">t=</span><span class="s">&quot;-90&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/location&gt;</span>
</pre></div>
</div>
<p>This combination of two translations: one moving 10 along the x-axis in
the positive direction and the other in the opposite direction by 8 adds
up to a total translation of 2 in the positive x-direction. This
feature, for example, is useful when the positions of detectors are best
described in spherical coordinates with respect to an origin different
from the origin of the parent component. For example, say you have
defined a &lt;type name=”bank”&gt; with contains 3 pixels. The centre of the bank is at the
location r=”1” with respect to the sample and the positions of the 3
pixels are known with respect to the sample to be at r=”1” and with
t=”-1”, t=”0” and t=”1”. One option is to describe this bank/pixels
structure as</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;bank&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;bank&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;pixel&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;1&quot;</span> <span class="na">t=</span><span class="s">&quot;-1&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;1&quot;</span> <span class="na">t=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;1&quot;</span> <span class="na">t=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/component&gt;</span>
<span class="nt">&lt;/type&gt;</span>
</pre></div>
</div>
<p>However a better option for this case is to use nested translations as
demonstrated below</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;bank&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;bank&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;pixel&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;1&quot;</span> <span class="na">t=</span><span class="s">&quot;180&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;trans</span> <span class="na">r=</span><span class="s">&quot;1&quot;</span> <span class="na">t=</span><span class="s">&quot;-1&quot;</span> <span class="nt">/&gt;</span> <span class="nt">&lt;/location&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;1&quot;</span> <span class="na">t=</span><span class="s">&quot;180&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;trans</span> <span class="na">r=</span><span class="s">&quot;1&quot;</span> <span class="na">t=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;</span> <span class="nt">&lt;/location&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;1&quot;</span> <span class="na">t=</span><span class="s">&quot;180&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;trans</span> <span class="na">r=</span><span class="s">&quot;1&quot;</span> <span class="na">t=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span> <span class="nt">&lt;/location&gt;</span>
  <span class="nt">&lt;/component&gt;</span>
<span class="nt">&lt;/type&gt;</span>
</pre></div>
</div>
<p>since this means the bank is actually specified at the right location,
and not artificially at the sample position.</p>
<p>Finally a combination of &lt;trans&gt; and  &lt;rot&gt; sub-elements of a &lt;location&gt; element can be used as
demonstrated below</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;10&quot;</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;rot</span> <span class="na">val=</span><span class="s">&quot;90&quot;</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;trans</span> <span class="na">x=</span><span class="s">&quot;-8&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/rot&gt;</span>
<span class="nt">&lt;/location&gt;</span>
</pre></div>
</div>
<p>which put something at the location (x,y,z)=(10,-8,0) relative to the
parent component and with a 90 rotation around the z-axis, which causes
the x-axis to be rotated onto the y-axis.</p>
<p>Most of the attributes of have default values. These are: x=”0” y=”0”
z=”0” rot=”0” axis-x=”0” axis-y=”0” axis-z=”1”</p>
<section id="using-facing">
<span id="id7"></span><h4>Using &lt;facing&gt;<a class="headerlink" href="#using-facing" title="Permalink to this heading">¶</a></h4>
<p>The &lt;facing&gt; element is an element you can use together with a &lt;location&gt;. Its purpose is
to be able, with one line of IDF code, to make a given component face a
point in space. For example many detectors on ISIS instruments are setup
to face the sample. A &lt;facing&gt;element must be specified as a sub-element of a
&lt;location&gt; element, and the facing operation is applied after the translation
and/or rotation operation as specified by the location element. An
example of a &lt;facing&gt; element is</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;facing</span> <span class="na">x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
or
<span class="nt">&lt;facing</span> <span class="na">r=</span><span class="s">&quot;0.0&quot;</span> <span class="na">t=</span><span class="s">&quot;0.0&quot;</span> <span class="na">p=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>In addition if the &lt;components-are-facing&gt; is set under &lt;defaults&gt;,
i.e. by default any component in the IDF will be rotated to face a
default position then</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;facing</span> <span class="na">val=</span><span class="s">&quot;none&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>can be used to overwrite this default to say you don’t want to apply
‘facing’ to given component.</p>
<p>The process of facing is to make the xy-plane of the geometric shape
of the component face the position specified in the &lt;facing&gt; element.
The z-axis is normal to the xy-plan, and the operation of facing is
to change the direction of the z-axis so that it points in the direction
from the position specified in the facing &lt;facing&gt; towards the position
of the component.</p>
<p>&lt;facing&gt; supports a rot attribute, which allow rotation of the
z-axis around it own axis before changing its direction. The
effect of rot here is identical to the effect of using rot in a
&lt;location&gt; where axis-x=”0.0” axis-y=”0.0” axis-z=”1.0”. Allowing
rot here perhaps make it slightly clearly that such a rot is as
part of facing a component towards another component.</p>
<p>which rotate the is a convenient element for adjusting the orientation
of the z-axis. The base rotation is to take the direction the z-axis
points and change it to point from the position specified by the
&lt;facing&gt; element to the position of the component.</p>
</section>
<section id="using-exclude">
<span id="id8"></span><h4>Using &lt;exclude&gt;<a class="headerlink" href="#using-exclude" title="Permalink to this heading">¶</a></h4>
<p>A &lt;location&gt; specifies the location of a &lt;type&gt;. If this type consists
of a number of sub-parts &lt;exclude&gt; can be used to exclude certain parts
of a type. For example say the type below is defined in an IDF</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;door&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;standard-tube&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;2.5&quot;</span> <span class="na">t=</span><span class="s">&quot;19.163020&quot;</span> <span class="na">name=</span><span class="s">&quot;tube1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;2.5&quot;</span> <span class="na">t=</span><span class="s">&quot;19.793250&quot;</span> <span class="na">name=</span><span class="s">&quot;tube2&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;2.5&quot;</span> <span class="na">t=</span><span class="s">&quot;20.423470&quot;</span> <span class="na">name=</span><span class="s">&quot;tube3&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;2.5&quot;</span> <span class="na">t=</span><span class="s">&quot;21.053700&quot;</span> <span class="na">name=</span><span class="s">&quot;tube4&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;2.5&quot;</span> <span class="na">t=</span><span class="s">&quot;21.683930&quot;</span> <span class="na">name=</span><span class="s">&quot;tube5&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/component&gt;</span>
<span class="nt">&lt;/type&gt;</span>
</pre></div>
</div>
<p>and the instrument consists of a number of these doors but where some of
the doors are different in the sense that for example the 1st and/or the
2nd tube is missing from some of these. Using &lt;exclude&gt; this can be
succinctly described as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;door&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;exclude</span> <span class="na">sub-part=</span><span class="s">&quot;tube1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;exclude</span> <span class="na">sub-part=</span><span class="s">&quot;tube3&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/location&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;2&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;location</span> <span class="na">x=</span><span class="s">&quot;3&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;exclude</span> <span class="na">sub-part=</span><span class="s">&quot;tube3&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/location&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<p>where the sub-part of refers to the ‘name’ of a part of the type ‘door’.</p>
</section>
<section id="extra-options-for-indirect-geometry-instruments">
<h4>Extra options for indirect geometry instruments<a class="headerlink" href="#extra-options-for-indirect-geometry-instruments" title="Permalink to this heading">¶</a></h4>
<p>Optionally, both physical and ‘neutronic’ detector positions can be
specified for indirect geometry instrument.
For an example of this usage see the
<a class="reference external" href="https://github.com/mantidproject/mantid/blob/main/instrument/IN16B_Definition.xml">IN16B IDF</a>.</p>
</section>
</section>
<section id="using-locations">
<span id="id9"></span><h3><a class="toc-backref" href="#id37" role="doc-backlink">Using &lt;locations&gt;</a><a class="headerlink" href="#using-locations" title="Permalink to this heading">¶</a></h3>
<p>Most instruments have detectors which are ordered in some way. For a
<a class="reference internal" href="#creating-rectangular-area-detectors"><span class="std std-ref">rectangular array of
detectors</span></a> we have a
shorthand notation. The &lt;locations&gt; tag is a shorthand notation to use
for a linear/spherical sequence of detectors, as any of the position
coordinates or the coordinate rotation angles of a &lt;location&gt; tag are changing.</p>
<p>For example a &lt;locations&gt; element may be used to describe the position
of equally distanced pixels along a tube, in the example below along
the y variable</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;locations</span> <span class="na">y=</span><span class="s">&quot;1.0&quot;</span> <span class="na">y-end=</span><span class="s">&quot;10.0&quot;</span> <span class="na">n-elements=</span><span class="s">&quot;10&quot;</span> <span class="na">name=</span><span class="s">&quot;det&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>The above one line of XML is shorthand notation for</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;1.0&quot;</span> <span class="na">name=</span><span class="s">&quot;det0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;2.0&quot;</span> <span class="na">name=</span><span class="s">&quot;det1&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;3.0&quot;</span> <span class="na">name=</span><span class="s">&quot;det2&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;4.0&quot;</span> <span class="na">name=</span><span class="s">&quot;det3&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;5.0&quot;</span> <span class="na">name=</span><span class="s">&quot;det4&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;6.0&quot;</span> <span class="na">name=</span><span class="s">&quot;det5&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;7.0&quot;</span> <span class="na">name=</span><span class="s">&quot;det6&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;8.0&quot;</span> <span class="na">name=</span><span class="s">&quot;det7&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;9.0&quot;</span> <span class="na">name=</span><span class="s">&quot;det8&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;10.0&quot;</span> <span class="na">name=</span><span class="s">&quot;det9&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>As is seen n-elements is the number of &lt;location&gt; elements this &lt;locations&gt;
element is shorthand for. y-end specifies the y end position, and the equal
distance in y between the pixels is calculated in the code as
(‘y’-‘y-end’)/(‘n-elements’-1). Multiple ‘variable’-end attributes can be
specified for the &lt;locations&gt; tag, where ‘variable’ here is any of the
&lt;location&gt; attributes: x, y, z, r, t, p and rot. The example below
describes a list of detectors aligned in a semi-circle:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;locations</span> <span class="na">n-elements=</span><span class="s">&quot;7&quot;</span> <span class="na">r=</span><span class="s">&quot;0.5&quot;</span> <span class="na">t=</span><span class="s">&quot;0.0&quot;</span> <span class="na">t-end=</span><span class="s">&quot;180.0&quot;</span> <span class="na">rot=</span><span class="s">&quot;0.0&quot;</span> <span class="na">rot-end=</span><span class="s">&quot;180.0&quot;</span> <span class="na">axis-x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">axis-y=</span><span class="s">&quot;1.0&quot;</span> <span class="na">axis-z=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>The above one line of XML is shorthand notation for</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;0.5&quot;</span> <span class="na">t=</span><span class="s">&quot;0&quot;</span>   <span class="na">rot=</span><span class="s">&quot;0&quot;</span>   <span class="na">axis-x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">axis-y=</span><span class="s">&quot;1.0&quot;</span> <span class="na">axis-z=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;0.5&quot;</span> <span class="na">t=</span><span class="s">&quot;30&quot;</span>  <span class="na">rot=</span><span class="s">&quot;30&quot;</span>  <span class="na">axis-x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">axis-y=</span><span class="s">&quot;1.0&quot;</span> <span class="na">axis-z=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;0.5&quot;</span> <span class="na">t=</span><span class="s">&quot;60&quot;</span>  <span class="na">rot=</span><span class="s">&quot;60&quot;</span>  <span class="na">axis-x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">axis-y=</span><span class="s">&quot;1.0&quot;</span> <span class="na">axis-z=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;0.5&quot;</span> <span class="na">t=</span><span class="s">&quot;90&quot;</span>  <span class="na">rot=</span><span class="s">&quot;90&quot;</span>  <span class="na">axis-x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">axis-y=</span><span class="s">&quot;1.0&quot;</span> <span class="na">axis-z=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;0.5&quot;</span> <span class="na">t=</span><span class="s">&quot;120&quot;</span> <span class="na">rot=</span><span class="s">&quot;120&quot;</span> <span class="na">axis-x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">axis-y=</span><span class="s">&quot;1.0&quot;</span> <span class="na">axis-z=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;0.5&quot;</span> <span class="na">t=</span><span class="s">&quot;150&quot;</span> <span class="na">rot=</span><span class="s">&quot;150&quot;</span> <span class="na">axis-x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">axis-y=</span><span class="s">&quot;1.0&quot;</span> <span class="na">axis-z=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;0.5&quot;</span> <span class="na">t=</span><span class="s">&quot;180&quot;</span> <span class="na">rot=</span><span class="s">&quot;180&quot;</span> <span class="na">axis-x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">axis-y=</span><span class="s">&quot;1.0&quot;</span> <span class="na">axis-z=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>If name is specified, e.g. as name=”det” in the first example, then as seen the
&lt;location&gt; elements are given the ‘name’ plus a counter, where by default this counter starts from zero. This counter can optionally be changed by using
attribute name-count-start, e.g. setting name-count-start=”1” in the above
example would have named the 10 &lt;location&gt; elements det1, det2, …, det10. Additionally, using the name-count-increment attribute, e.g setting
name-count-increment=”2” would have named the 10 &lt;location&gt; elements dat1, det3, …, det21. By default, this increment is one.</p>
<p>When one &lt;locations&gt; tag was used in ISIS LET_Definition.xml the number of
lines of this file reduced from 1590 to 567.</p>
</section>
<section id="using-side-by-side-view-location">
<span id="side-by-side-view-location"></span><h3><a class="toc-backref" href="#id38" role="doc-backlink">Using &lt;side-by-side-view-location&gt;</a><a class="headerlink" href="#using-side-by-side-view-location" title="Permalink to this heading">¶</a></h3>
<p>The arrangement of detector banks in the side by side view of the instrument viewer can be overridden using the &lt;side-by-side-view-location&gt; tag.
This takes an x and a y coordinate which specifies the location of the centre of the component containing the tag in the view.
The tag is optional and if not present the components will be arranged using the default method as described in the <a class="reference internal" href="../workbench/instrumentviewer.html#instrumentviewer-render-tab"><span class="std std-ref">Instrument Viewer</span></a> documentation.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;side-by-side-view-location</span> <span class="na">x=</span><span class="s">&quot;0.1&quot;</span> <span class="na">y=</span><span class="s">&quot;0.7&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</section>
<section id="using-parameter">
<span id="id10"></span><h3><a class="toc-backref" href="#id39" role="doc-backlink">Using &lt;parameter&gt;</a><a class="headerlink" href="#using-parameter" title="Permalink to this heading">¶</a></h3>
<p>Parameters which do not change or are changed via &lt;logfile&gt; should be stored using
this element inside the IDF, however parameters which may need to be
accessed and changed manually on a regular basis should be stored in a
separate <a class="reference internal" href="InstrumentParameterFile.html#instrumentparameterfile"><span class="std std-ref">parameter file</span></a>.</p>
<p>&lt;parameter&gt; is used to specify a value to a parameter which can then be extracted
from Mantid. One usage of &lt;parameter&gt; is to link values stored in log-files to
parameter names. For example</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;x&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;logfile</span> <span class="na">id=</span><span class="s">&quot;trolley2_x_displacement&quot;</span> <span class="na">extract-single-value-as=</span><span class="s">&quot;position 1&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/parameter&gt;</span>
</pre></div>
</div>
<p>reads: “take the first value in the “trolley2_x_displacement” log-file
and use this value to set the parameter named ‘x’.</p>
<p>The name of the &lt;parameter&gt; is specified using the ‘name’ tag. You may specify any
name for a parameter except for name=”pos” and name=”rot”. These are
reserved keywords. Further a few names have a special effect when
processed by Mantid</p>
<ul class="simple">
<li><p>“x”, “y”, and “z” overwrite the x, y and z coordinate respectively of
the element of the component the is a sub-element of.</p></li>
<li><p>“r-position”, “t-position” and “p-position” like “x”, “y” and “z”
overwrite the x, y, z coordinates but specified using spherical
coordinates (as defined ). Note that the parameters “t-position” and
“p-position” are ignored if the parameter “r-position” is not also
set for the same component. If only “r-position” is set, say to
r-position=”10.0”, than the component will be set to
(x,y,z)=(0,0,10.0) i.e. theta and phi default to zero where not
specified.</p></li>
<li><p>“rotx”, “roty” and “rotz” rotate the component’s coordinate system
around the x-axis, y-axis and z-axis respectively in units of
degrees. If any of these are specified they re-define the rotation
for the component. You can specify two or three of these to create
any rotation. Regardless of what order rotx, roty and rotz is
specified in the IDF the combined rotation is equals that obtained by
applying rotx, then roty and finally rotz.</p></li>
<li><p>“Efixed”. If specified the <a class="reference internal" href="../algorithms/ConvertUnits-v1.html#algm-convertunits"><span class="std std-ref">ConvertUnits</span></a> algorithm
uses this value in unit conversion</p></li>
<li><p>“SplitInto”. How many MD boxes to split into when converting to MD.</p></li>
<li><p>“SplitThreshold”. The threshold number of MDEvents in an MDBox before
splitting into a new MDBox. Concerns convert to MD.</p></li>
<li><p>“MaxRecursionDepth”. The maximum depth of the MDBox tree when
converting to MD.</p></li>
<li><p>“offset-phi”. Effective boolean for turning on/off Phi offsets by PI.
Set to Always to apply.</p></li>
</ul>
<p>The value of the parameter is in the above example specified using a log-file as
specified with the element &lt;logfile&gt;. The required attribute of &lt;logfile&gt; is</p>
<ul class="simple">
<li><p><em>id</em> - the logfile name minus the file extension and the ISIS raw
file name. For example the id for the logfile ‘CSP78173_height.txt’
is ‘height’.</p></li>
</ul>
<p>Optional attributes of &lt;logfile&gt; are:</p>
<ul class="simple">
<li><p><em>extract-single-value-as</em> - specify which value (or values) from the
logfile should be used to. This attribute takes any of the following
strings</p>
<ul>
<li><p><strong>mean</strong> (default)</p></li>
<li><p><strong>position n</strong> where n is an integer</p></li>
<li><p><strong>first_value</strong> The first value in the run</p></li>
<li><p><strong>last_value</strong> The last value in the run</p></li>
<li><p><strong>median</strong> The median value in the run</p></li>
<li><p><strong>minimum</strong> The minimum value in the run</p></li>
<li><p><strong>maximum</strong> The maximum value in the run</p></li>
</ul>
</li>
<li><p><em>eq</em> - the values in the log-file may not directly specify the
parameter you want to set in the IDF. A simple example is where the
values in the logfile are in units of mm, whereas the unit of length
in the IDF is meters. Hence for this case by setting
eq=”0.001*value” the values in the logfile are automatically
converted to meters. A more complicated example is where the height
of a detector is recorded in a log-file as the angle between from the
horizontal plane to the detector in unit of degrees. Say the distance
between the sample (which is assumed to be in the horizontal plane)
and the detector is 1.863m then by specifying
eq=”1.863*sin(value*0.0174533)” the values in the log-file are
automatically converted into the height of the detector from the
horizontal plane in units of meters. Note pi/180=0.0174533 in
“sin(value*0.0174533)” above is to transform degrees to radians.</p></li>
</ul>
<p>Another option for specifying a value for a parameter is to use the
notation:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;x&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;7.2&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/parameter&gt;</span>
</pre></div>
</div>
<p>Here a value for the parameter with name “x” is set directly to 7.2. The only and
required attribute of the &lt;value&gt; element is ‘val’.</p>
<p>For a given &lt;parameter&gt; you should specify its value only once. If by mistake you
specify a value twice as demonstrated in the example below then the first encountered
&lt;value&gt; element is used, and if no &lt;value&gt; element is present then the first
encountered &lt;logfile&gt; element is used.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;x&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;7.2&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;logfile</span> <span class="na">id=</span><span class="s">&quot;trolley2_x_displacement&quot;</span> <span class="na">extract-single-value-as=</span><span class="s">&quot;position 1&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/parameter&gt;</span>
</pre></div>
</div>
<p>In the above example &lt;value val=”7.2”/&gt; is used.</p>
</section>
<section id="accessing-parameter">
<span id="id11"></span><h3><a class="toc-backref" href="#id40" role="doc-backlink">Accessing &lt;parameter&gt;</a><a class="headerlink" href="#accessing-parameter" title="Permalink to this heading">¶</a></h3>
<p>Parameters are by default accessed recursively.
Demonstrated with an example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;dummy&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location/&gt;</span>
  <span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;something&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;35.0&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;/parameter&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;dummy&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;pixel&quot;</span> <span class="na">name=</span><span class="s">&quot;pixel1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;0.0&quot;</span> <span class="na">x=</span><span class="s">&quot;0.707&quot;</span> <span class="na">z=</span><span class="s">&quot;0.707&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;something1&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;25.0&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;/parameter&gt;</span>
  <span class="nt">&lt;/component&gt;</span>

  <span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;pixel&quot;</span> <span class="na">name=</span><span class="s">&quot;pixel2&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">y=</span><span class="s">&quot;0.0&quot;</span> <span class="na">x=</span><span class="s">&quot;1.0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;something2&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;15.0&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;/parameter&gt;</span>
  <span class="nt">&lt;/component&gt;</span>
<span class="nt">&lt;/type&gt;</span>
</pre></div>
</div>
<p>this implies that if you for instance ask the component with
name=”pixel1” what parameters it has then the answer is two:
something1=25.5 and something=35.0. If you ask the component
name=”dummy” the same question the answer is one: something=35.0 and so
on.</p>
</section>
<section id="using-string-parameter">
<span id="id12"></span><h3><a class="toc-backref" href="#id41" role="doc-backlink">Using <em>string</em> &lt;parameter&gt;</a><a class="headerlink" href="#using-string-parameter" title="Permalink to this heading">¶</a></h3>
<p>This is a special category of parameters where the value specified for
the parameter is string rather than a double. The syntax is</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;instrument-status&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;closed&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/parameter&gt;</span>
</pre></div>
</div>
</section>
<section id="using-fitting-parameter">
<span id="id13"></span><h3><a class="toc-backref" href="#id42" role="doc-backlink">Using <em>fitting</em> &lt;parameter&gt;</a><a class="headerlink" href="#using-fitting-parameter" title="Permalink to this heading">¶</a></h3>
<p>This is a special category of parameters, which follows the same syntax
as other but allows a few extra features. Fitting parameters are meant
to be used when raw data are fitted against models that contain
parameters, where some of these parameters are instrument specific. If
such parameters are specified these will be pulled in before the fitting
process starts, where optionally these may, for instance, be specified
to be treated as fixed by default. To specify a fitting parameter use
the additional tag type=”fitting” as shown in the example below</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;IkedaCarpenterPV:Alpha0&quot;</span> <span class="na">type=</span><span class="s">&quot;fitting&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;7.2&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/parameter&gt;</span>
</pre></div>
</div>
<p>It is required that the parameter name uses the syntax
NameOfFunction:Parameter, where NameOfFunction is the name of the
fitting function the parameter is associated with. In the example above
the fitting function name is <a class="reference internal" href="../fitting/fitfunctions/IkedaCarpenterPV.html#func-ikedacarpenterpv"><span class="std std-ref">IkedaCarpenterPV</span></a> and
the parameter name is Alpha0.</p>
<p>To specify that a parameter should be treated as fixed in the fitting
process use the element as demonstrated in the example below</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;IkedaCarpenterPV:Alpha0&quot;</span> <span class="na">type=</span><span class="s">&quot;fitting&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;7.2&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;fixed</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/parameter&gt;</span>
</pre></div>
</div>
<p>A parameter can be specified to have a min/max value, which results in a
constraint being applied to this parameter. An example of this is shown
below</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;IkedaCarpenterPV:Alpha0&quot;</span> <span class="na">type=</span><span class="s">&quot;fitting&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;7.2&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;min</span> <span class="na">val=</span><span class="s">&quot;4&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;max</span> <span class="na">val=</span><span class="s">&quot;12&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/parameter&gt;</span>
</pre></div>
</div>
<p>The min/max values may also be specified as percentage values. For
example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;IkedaCarpenterPV:Alpha0&quot;</span> <span class="na">type=</span><span class="s">&quot;fitting&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;250&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;min</span> <span class="na">val=</span><span class="s">&quot;80%&quot;</span><span class="nt">/&gt;</span> <span class="nt">&lt;max</span> <span class="na">val=</span><span class="s">&quot;120%&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;penalty-factor</span> <span class="na">val=</span><span class="s">&quot;2000&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/parameter&gt;</span>
</pre></div>
</div>
<p>results in Alpha0 being constrained to sit between 250*0.8=200 and
250*1.20=300. Further this example also demonstrates how a can be
specified to tell how strongly the min/max constraints should be
enforced. The default value for the penalty-factor is 1000. For more
information about this factor see <a class="reference internal" href="FitConstraint.html#fitconstraint"><span class="std std-ref">FitConstraint</span></a>.</p>
<p>A value for a parameter may alternatively be set using a look-up-table
or a formula. An example demonstrating a formula is</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;IkedaCarpenterPV:Alpha0&quot;</span> <span class="na">type=</span><span class="s">&quot;fitting&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;formula</span> <span class="na">eq=</span><span class="s">&quot;100.0+10*centre+centre^2&quot;</span> <span class="na">unit=</span><span class="s">&quot;TOF&quot;</span> <span class="na">result-unit=</span><span class="s">&quot;1/dSpacing^2&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/parameter&gt;</span>
</pre></div>
</div>
<p>‘centre’ in the formula is substituted with the centre-value of the peak
shape function as known prior to the start of the fitting process. The
attributes ‘unit’ is optional. If it is not set then the peak
centre-value is directly substituted for the centre variable in the
formula. If it is set then it must be set to no one of the units defined
in <a class="reference internal" href="UnitFactory.html#unit-factory"><span class="std std-ref">Unit Factory</span></a>, and what happens is that the peak
centre-value is converted to this unit before assigned to the centre
variable in the formula.</p>
<p>The optional ‘result-unit’ attribute tells what the unit is of the
output of the formula. In the example above this unit is “1/dSpacing^2”
(for the ‘result-unit’ this attribute can be set to an algebraic
expression of the units defined in <a class="reference internal" href="UnitFactory.html#unit-factory"><span class="std std-ref">Unit Factory</span></a>). If
the x-axis unit of the data you are trying to fit is dSpacing then the
output of the formula is left as it is. But for example if the x-axis
unit of the data is TOF then the formula output is converted into, it in
this case, the unit “1/TOF^2”. Examples where ‘unit’ and ‘result-unit’
are used include:
<a class="reference internal" href="../techniques/CreateBackToBackParameters.html#createbacktobackparameters"><span class="std std-ref">CreateBackToBackParameters</span></a> and
<a class="reference internal" href="../techniques/CreateIkedaCarpenterParameters.html#createikedacarpenterparameters"><span class="std std-ref">CreateIkedaCarpenterParameters</span></a>.</p>
<p>An example which demonstrate using a look-up-table is</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;IkedaCarpenterPV:Alpha0&quot;</span> <span class="na">type=</span><span class="s">&quot;fitting&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;lookuptable</span> <span class="na">interpolation=</span><span class="s">&quot;linear&quot;</span> <span class="na">x-unit=</span><span class="s">&quot;TOF&quot;</span> <span class="na">y-unit=</span><span class="s">&quot;dSpacing&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;point</span> <span class="na">x=</span><span class="s">&quot;1&quot;</span> <span class="na">y=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;point</span> <span class="na">x=</span><span class="s">&quot;3&quot;</span> <span class="na">y=</span><span class="s">&quot;100&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;point</span> <span class="na">x=</span><span class="s">&quot;5&quot;</span> <span class="na">y=</span><span class="s">&quot;1120&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;point</span> <span class="na">x=</span><span class="s">&quot;10&quot;</span> <span class="na">y=</span><span class="s">&quot;1140&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/lookuptable&gt;</span>
<span class="nt">&lt;/parameter&gt;</span>
</pre></div>
</div>
<p>As with a formula the look-up is done for the ‘x’-value that corresponds
to the centre of the peak as known prior to the start of the fitting
process. The only interpolation option currently supported is ‘linear’.
The optional ‘x-unit’ and ‘y-unit’ attributes must be set to one of the
units defined in <a class="reference internal" href="UnitFactory.html#unit-factory"><span class="std std-ref">Unit Factory</span></a>. The ‘x-unit’ and
‘y-unit’ have very similar effect to the ‘unit’ and ‘result-unit’
attributes for described above. ‘x-unit’ converts the unit of the centre
before lookup against the x-values. ‘y-axis’ is the unit of the y values
listed, which for the example above correspond to Alpha0.</p>
</section>
<section id="using-component-link">
<span id="id14"></span><h3><a class="toc-backref" href="#id43" role="doc-backlink">Using &lt;component-link&gt;</a><a class="headerlink" href="#using-component-link" title="Permalink to this heading">¶</a></h3>
<p>Allow &lt;parameter&gt;s to be linked to components without needing &lt;parameter&gt;s to be
defined inside, as sub-elements, of the components they belong to. The standard
approach for defining a parameter is</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;bank&quot;</span> <span class="na">name=</span><span class="s">&quot;bank_90degnew&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;test&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;50.0&quot;</span> <span class="nt">/&gt;</span> <span class="nt">&lt;/parameter&gt;</span>
<span class="nt">&lt;/component&gt;</span>
</pre></div>
</div>
<p>where a parameter ‘test’ is defined to belong to the component with the
name ‘bank_90degnew’. However, alternatively the parameter can be
defined using the notation in the an example below. Note that if more
than one component e.g. have the name ‘bank_90degnew’ then the
specified parameters are applied to all such components.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;bank&quot;</span> <span class="na">name=</span><span class="s">&quot;bank_90degnew&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;component-link</span> <span class="na">name=</span><span class="s">&quot;bank_90degnew&quot;</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;test&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;50.0&quot;</span> <span class="nt">/&gt;</span> <span class="nt">&lt;/parameter&gt;</span>
<span class="nt">&lt;/component-link&gt;</span>
</pre></div>
</div>
<p>&lt;component-link&gt; is the only way parameters can be defined in a <strong>parameter file</strong> used
by the <a class="reference internal" href="../algorithms/LoadParameterFile-v1.html#algm-loadparameterfile"><span class="std std-ref">LoadParameterFile</span></a> algorithm.</p>
<p>If there are several components with name ‘bank_90degnew’ but you want
specified paramentes to apply to only one of them, then you can specify
the name by a path name.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component-link</span> <span class="na">name=</span><span class="s">&quot;HRPD/leftside/bank_90degnew&quot;</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;test&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;50.0&quot;</span> <span class="nt">/&gt;</span> <span class="nt">&lt;/parameter&gt;</span>
<span class="nt">&lt;/component-link&gt;</span>
</pre></div>
</div>
<p>The path name need not be complete provided it specifies a unique
component. Here we drop the instrument name HRPD.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component-link</span> <span class="na">name=</span><span class="s">&quot;leftside/bank_90degnew&quot;</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;test&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;50.0&quot;</span> <span class="nt">/&gt;</span> <span class="nt">&lt;/parameter&gt;</span>
<span class="nt">&lt;/component-link&gt;</span>
</pre></div>
</div>
</section>
<section id="using-combine-components-into-one-shape">
<span id="id15"></span><h3><a class="toc-backref" href="#id44" role="doc-backlink">Using &lt;combine-components-into-one-shape&gt;</a><a class="headerlink" href="#using-combine-components-into-one-shape" title="Permalink to this heading">¶</a></h3>
<p>The standard way of making up geometric shapes as a collection of parts
is described here:
<a class="reference internal" href="HowToDefineGeometricShape.html#howtodefinegeometricshape"><span class="std std-ref">HowToDefineGeometricShape</span></a>. However, &lt;combine-components-into-one-shape&gt;
offers in some circumstances a more convenient way of defining more
complicated shapes, as for example is the case for the ISIS POLARIS
instrument. This tag combining components into one shape as demonstrated
below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;adjusted cuboid&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;adjusted cuboid&quot;</span> <span class="na">is=</span><span class="s">&quot;detector&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;combine-components-into-one-shape</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;cuboid1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">name=</span><span class="s">&quot;A&quot;</span><span class="nt">/&gt;</span>
    <span class="cm">&lt;!-- &quot;A&quot; translated by y=10 and rotated around x-axis by 90 degrees --&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">name=</span><span class="s">&quot;B&quot;</span> <span class="na">y=</span><span class="s">&quot;10&quot;</span> <span class="na">rot=</span><span class="s">&quot;90&quot;</span> <span class="na">axis-x=</span><span class="s">&quot;1&quot;</span> <span class="na">axis-y=</span><span class="s">&quot;0&quot;</span> <span class="na">axis-z=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/component&gt;</span>
  <span class="nt">&lt;algebra</span> <span class="na">val=</span><span class="s">&quot;A : B&quot;</span> <span class="nt">/&gt;</span>

  <span class="cm">&lt;!-- this bounding box is used for this combined into one shape--&gt;</span>
  <span class="nt">&lt;bounding-box&gt;</span>
    <span class="nt">&lt;x-min</span> <span class="na">val=</span><span class="s">&quot;-0.5&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;x-max</span> <span class="na">val=</span><span class="s">&quot;0.5&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;y-min</span> <span class="na">val=</span><span class="s">&quot;-5.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;y-max</span> <span class="na">val=</span><span class="s">&quot;10.5&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;z-min</span> <span class="na">val=</span><span class="s">&quot;-5.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;z-max</span> <span class="na">val=</span><span class="s">&quot;5.0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/bounding-box&gt;</span>

<span class="nt">&lt;/type&gt;</span>

<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;cuboid1&quot;</span> <span class="na">is=</span><span class="s">&quot;detector&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;cuboid</span> <span class="na">id=</span><span class="s">&quot;bob&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;left-front-bottom-point</span> <span class="na">x=</span><span class="s">&quot;0.5&quot;</span> <span class="na">y=</span><span class="s">&quot;-5.0&quot;</span> <span class="na">z=</span><span class="s">&quot;-0.5&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;left-front-top-point</span>  <span class="na">x=</span><span class="s">&quot;0.5&quot;</span> <span class="na">y=</span><span class="s">&quot;-5.0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.5&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;left-back-bottom-point</span>  <span class="na">x=</span><span class="s">&quot;-0.5&quot;</span> <span class="na">y=</span><span class="s">&quot;-5.0&quot;</span> <span class="na">z=</span><span class="s">&quot;-0.5&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;right-front-bottom-point</span>  <span class="na">x=</span><span class="s">&quot;0.5&quot;</span> <span class="na">y=</span><span class="s">&quot;5.0&quot;</span> <span class="na">z=</span><span class="s">&quot;-0.5&quot;</span>  <span class="nt">/&gt;</span>
  <span class="nt">&lt;/cuboid&gt;</span>

  <span class="cm">&lt;!-- this bounding box is not used in the combined shape --&gt;</span>
  <span class="cm">&lt;!-- Note you would not normally need to add a bounding box</span>
<span class="cm">       for a single cuboid shape. The reason for adding one</span>
<span class="cm">       here is just to illustrate that a bounding added here</span>
<span class="cm">       will not be used in created a combined shape as in</span>
<span class="cm">       &quot;adjusted cuboid&quot; above --&gt;</span>
  <span class="nt">&lt;bounding-box&gt;</span>
    <span class="nt">&lt;x-min</span> <span class="na">val=</span><span class="s">&quot;-0.5&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;x-max</span> <span class="na">val=</span><span class="s">&quot;0.5&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;y-min</span> <span class="na">val=</span><span class="s">&quot;-5.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;y-max</span> <span class="na">val=</span><span class="s">&quot;5.0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;z-min</span> <span class="na">val=</span><span class="s">&quot;-0.5&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;z-max</span> <span class="na">val=</span><span class="s">&quot;0.5&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/bounding-box&gt;</span>
<span class="nt">&lt;/type&gt;</span>
</pre></div>
</div>
<p>which combines two components “A” and “B” into one shape. The resulting
shape is shape is shown here:</p>
<figure class="align-default" id="id23">
<img alt="CombineIntoOneShapeExample.png" src="../_images/CombineIntoOneShapeExample.png" />
<figcaption>
<p><span class="caption-text">CombineIntoOneShapeExample.png</span><a class="headerlink" href="#id23" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Note for this to work, a unique name for each component must be provided
and these names must be used in the algebra string (here “A : B”, see
<a class="reference internal" href="HowToDefineGeometricShape.html#howtodefinegeometricshape"><span class="std std-ref">HowToDefineGeometricShape</span></a>). Further a
bounding-box may optionally be added to the to the type.
Note the above geometric shape can alternatively be defined with the XML
(Mantid behind the scene translates the above XML to the XML below
before proceeding):</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;adjusted cuboid&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;location</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;adjusted cuboid&quot;</span> <span class="na">is=</span><span class="s">&quot;detector&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;cuboid</span> <span class="na">id=</span><span class="s">&quot;A&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;left-front-bottom-point</span> <span class="na">x=</span><span class="s">&quot;0.5&quot;</span> <span class="na">y=</span><span class="s">&quot;-5.0&quot;</span> <span class="na">z=</span><span class="s">&quot;-0.5&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;left-front-top-point</span>  <span class="na">x=</span><span class="s">&quot;0.5&quot;</span> <span class="na">y=</span><span class="s">&quot;-5.0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.5&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;left-back-bottom-point</span>  <span class="na">x=</span><span class="s">&quot;-0.5&quot;</span> <span class="na">y=</span><span class="s">&quot;-5.0&quot;</span> <span class="na">z=</span><span class="s">&quot;-0.5&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;right-front-bottom-point</span>  <span class="na">x=</span><span class="s">&quot;0.5&quot;</span> <span class="na">y=</span><span class="s">&quot;5.0&quot;</span> <span class="na">z=</span><span class="s">&quot;-0.5&quot;</span>  <span class="nt">/&gt;</span>
  <span class="nt">&lt;/cuboid&gt;</span>
  <span class="cm">&lt;!-- cuboid &quot;A&quot; translated along y by 10 and rotated around x by 90 degrees --&gt;</span>
  <span class="nt">&lt;cuboid</span> <span class="na">id=</span><span class="s">&quot;B&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;left-front-bottom-point</span> <span class="na">x=</span><span class="s">&quot;0.5&quot;</span> <span class="na">y=</span><span class="s">&quot;10.5&quot;</span> <span class="na">z=</span><span class="s">&quot;-5.0&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;left-front-top-point</span>  <span class="na">x=</span><span class="s">&quot;0.5&quot;</span> <span class="na">y=</span><span class="s">&quot;9.5&quot;</span> <span class="na">z=</span><span class="s">&quot;-5.0&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;left-back-bottom-point</span>  <span class="na">x=</span><span class="s">&quot;-0.5&quot;</span> <span class="na">y=</span><span class="s">&quot;9.5&quot;</span> <span class="na">z=</span><span class="s">&quot;-5.0&quot;</span>  <span class="nt">/&gt;</span>
    <span class="nt">&lt;right-front-bottom-point</span>  <span class="na">x=</span><span class="s">&quot;0.5&quot;</span> <span class="na">y=</span><span class="s">&quot;10.5&quot;</span> <span class="na">z=</span><span class="s">&quot;5.0&quot;</span>  <span class="nt">/&gt;</span>
  <span class="nt">&lt;/cuboid&gt;</span>
  <span class="nt">&lt;algebra</span> <span class="na">val=</span><span class="s">&quot;A : B&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/type&gt;</span>
</pre></div>
</div>
<p>&lt;combine-components-into-one-shape&gt; for now works only for combining cuboids. Please do not hesitate to
contact the Mantid team if you would like to extend this.</p>
<p>This applies when defining any geometric shape, but perhaps something which a user
has to be in particular aware of when defining more complicated geometry shapes, for
example, using the &lt;combine-components-into-one-shape&gt; tag: the coordinate system in
which a shape is defined can be chosen arbitrary, and the origin of this coordinate
system is the position returned when a user asked for its position. It is therefore
highly recommended that when a user define a detector geometric shape, this could be
simple cuboid, that it is defined with the origin at the centre of the front of the
detector. For detector shapes build up of for example multiple cuboids the origin
should be chosen perhaps for the center of the front face of the ‘middle’ cuboid.
When Mantid as for the position of such a shape it will be with reference to
coordinate system origin of the shape. However, sometimes it may simply be
inconvenient to build up a geometry shape with an coordinate system as explained above.
For this case, and for now only when using &lt;combine-components-into-one-shape&gt; it
possible to get around this by using the element &lt;translate-rotate-combined-shape-to&gt;,
which takes the same attributes as a &lt;location&gt; element. The effect of this element
is basically to redefine the shape coordinate system origin (in fact also rotate it
if requested).</p>
</section>
<section id="using-defaults">
<span id="id16"></span><h3><a class="toc-backref" href="#id45" role="doc-backlink">Using &lt;defaults&gt;</a><a class="headerlink" href="#using-defaults" title="Permalink to this heading">¶</a></h3>
<p>Used for setting various defaults.</p>
<section id="components-are-facing">
<span id="id17"></span><h4>&lt;components-are-facing&gt;<a class="headerlink" href="#components-are-facing" title="Permalink to this heading">¶</a></h4>
<p>Used to make the xy-plane of the geometric shape of any component by
default face a given location. For example</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;components-are-facing</span> <span class="na">x=</span><span class="s">&quot;0.0&quot;</span> <span class="na">y=</span><span class="s">&quot;0.0&quot;</span> <span class="na">z=</span><span class="s">&quot;0.0&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>If this element is not specified the default is to <em>not</em> attempt to
apply facing.</p>
</section>
<section id="offsets">
<span id="id18"></span><h4>&lt;offsets&gt;<a class="headerlink" href="#offsets" title="Permalink to this heading">¶</a></h4>
<p>Originally introduced to handle detector position coordinates as defined
by the Ariel software.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;offsets</span> <span class="na">spherical=</span><span class="s">&quot;delta&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>When this is set all components which have coordinates specified using
spherical coordinates (i.e. using the r, t, p attributes, see
description of &lt;location&gt;) are then treated as offsets to the spherical position
of the parent, i.e. the value given for <span class="math notranslate nohighlight">\(r\)</span> are added to the
parent’s <span class="math notranslate nohighlight">\(r\)</span> to give the total radial coordinate, and the same for
<span class="math notranslate nohighlight">\(\theta\)</span> and <span class="math notranslate nohighlight">\(\phi\)</span>. Note using this option breaks the
symmetry that the &lt;location&gt; element of a child component equals the position of
this component relative to its parent component.</p>
</section>
<section id="reference-frame">
<span id="id19"></span><h4>&lt;reference-frame&gt;<a class="headerlink" href="#reference-frame" title="Permalink to this heading">¶</a></h4>
<p>Reference frame in which instrument is described. The author/reader of
an IDF can chose the reference coordinate system in which the instrument
is described. The default reference system is the one shown below.
The direction here means the direction of the beam if it was not
modified by any mirrors etc.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;reference-frame&gt;</span>
  <span class="cm">&lt;!-- The z-axis is set parallel to and in the direction of the beam. the</span>
<span class="cm">       y-axis points up and the coordinate system is right handed. --&gt;</span>
  <span class="nt">&lt;along-beam</span> <span class="na">axis=</span><span class="s">&quot;z&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;pointing-up</span> <span class="na">axis=</span><span class="s">&quot;y&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;handedness</span> <span class="na">val=</span><span class="s">&quot;right&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/reference-frame&gt;</span>
</pre></div>
</div>
<p>This reference frame is e.g. used when a signed theta detector values
are calculated where it is needed to know which direction is defined as
up. By default, the axis defining the sign of the scattering angle is the one pointing up.
Optionally this can be customized by inserting the following line into the reference-frame node:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;theta-sign</span> <span class="na">axis=</span><span class="s">&quot;x&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>In this case, negative x will correspond to negative theta.
Note that both the pointing-up and theta-sign axes cannot be the same as the along-beam axis.</p>
</section>
<section id="default-view">
<span id="id20"></span><h4>&lt;default-view&gt;<a class="headerlink" href="#default-view" title="Permalink to this heading">¶</a></h4>
<p>This tag is used to control how the instrument first appears in the
<a class="reference internal" href="../workbench/instrumentviewer.html#instrumentviewer"><span class="std std-ref">Instrument View</span></a>. Attribute <code class="docutils literal notranslate"><span class="pre">view</span></code>
defines the type of the view that opens by default. It can have the
following values: “3D”, “cylindrical_x”, “cylindrical_y”,
“cylindrical_z”, “spherical_x”, “spherical_y”, “spherical_z”. If the
attribute is omitted value “3D” is assumed. Opening the 3D view on
start-up is also conditioned on the value of the
<code class="docutils literal notranslate"><span class="pre">MantidOptions.InstrumentView.UseOpenGL</span></code> property in the <a class="reference internal" href="PropertiesFile.html#properties-file"><span class="std std-ref">Properties
File</span></a>. If set to “Off” this property prevents the
Instrument View to start in 3D mode and “cylindrical_y” is used
instead. The user can change to 3D later.</p>
<p>Another attribute, <code class="docutils literal notranslate"><span class="pre">axis-view</span></code> governs on which axis the instrument is
initially viewed from in 3D and can be set equal to one of “Z-”, “Z+”,
“X-”, etc. If “Z-” were selected then the view point would be on the
z-axis on the negative of the origin looking in the +z direction.</p>
</section>
<section id="angle-unit-radian">
<span id="id21"></span><h4>&lt;angle unit=”radian”&gt;<a class="headerlink" href="#angle-unit-radian" title="Permalink to this heading">¶</a></h4>
<p>If</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;angle</span> <span class="na">unit=</span><span class="s">&quot;radian&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>is set then all angles specified in &lt;location&gt; elements and &lt;parameter&gt;’s with names
“rotx”, “roty”, “rotz”, “t-position” and “p-position” are assumed to in radians. The
default is to assume all angles are specified in degrees.</p>
</section>
<section id="other-defaults">
<h4>Other defaults<a class="headerlink" href="#other-defaults" title="Permalink to this heading">¶</a></h4>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;length</span> <span class="na">unit=</span><span class="s">&quot;meter&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>This default, for now, does not do anything, but is the default unit for
length used by Mantid. If it would be useful for you to specify user
defined units do not hesitate to <a class="reference external" href="mailto:mantid-help&#37;&#52;&#48;mantidproject&#46;org">request
this</a>.</p>
</section>
</section>
</section>
<section id="parameter-files">
<h2><a class="toc-backref" href="#id46" role="doc-backlink">Parameter Files</a><a class="headerlink" href="#parameter-files" title="Permalink to this heading">¶</a></h2>
<p>To prevent an IDF file from getting too long and complicated,
information not related to the geometry of the instrument may be put
into a separate file, whose content is automatically included into the
IDF file.</p>
<p>For more information see the <a class="reference internal" href="InstrumentParameterFile.html#instrumentparameterfile"><span class="std std-ref">parameter file
page</span></a>.</p>
</section>
<section id="deprecated-features">
<h2><a class="toc-backref" href="#id47" role="doc-backlink">Deprecated Features</a><a class="headerlink" href="#deprecated-features" title="Permalink to this heading">¶</a></h2>
<p>The following features are now deprecated and should no longer be used.</p>
<p><em>mark-as=”monitor”</em></p>
<p>The following notation to mark a detector as a
monitor is now deprecated:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;monitor&quot;</span> <span class="na">idlist=</span><span class="s">&quot;monitor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;3.25800&quot;</span> <span class="na">t=</span><span class="s">&quot;180.0&quot;</span> <span class="na">p=</span><span class="s">&quot;0.0&quot;</span> <span class="na">mark-as=</span><span class="s">&quot;monitor&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;monitor&quot;</span> <span class="na">is=</span><span class="s">&quot;detector&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;idlist</span> <span class="na">idname=</span><span class="s">&quot;monitor&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;id</span> <span class="na">val=</span><span class="s">&quot;11&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/idlist&gt;</span>
</pre></div>
</div>
<p>The above XML should be replaced with</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component</span> <span class="na">type=</span><span class="s">&quot;monitor&quot;</span> <span class="na">idlist=</span><span class="s">&quot;monitor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;location</span> <span class="na">r=</span><span class="s">&quot;3.25800&quot;</span> <span class="na">t=</span><span class="s">&quot;180.0&quot;</span> <span class="na">p=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/component&gt;</span>

<span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">&quot;monitor&quot;</span> <span class="na">is=</span><span class="s">&quot;monitor&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;idlist</span> <span class="na">idname=</span><span class="s">&quot;monitor&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;id</span> <span class="na">val=</span><span class="s">&quot;11&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/idlist&gt;</span>
</pre></div>
</div>
<p><strong>Category</strong>: <a class="reference external" href="../api/python/mantid/api/categories/Concepts.html">Concepts</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="InstrumentDataService.html" title="Previous Chapter: Instrument Data Service"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Instrument Da...</span>
    </a>
  </li>
  <li>
    <a href="InstrumentParameterFile.html" title="Next Chapter: Instrument Parameter File"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Instrument Pa... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>