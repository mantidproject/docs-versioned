<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>DetectorEfficiencyCorUser v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DetectorEfficiencyVariation v1" href="DetectorEfficiencyVariation-v1.html" />
    <link rel="prev" title="DetectorEfficiencyCor v1" href="DetectorEfficiencyCor-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.7</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">DetectorEfficiencyCorUser v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="detectorefficiencycoruser-v1">
<span id="algm-detectorefficiencycoruser"></span><span id="algm-detectorefficiencycoruser-v1"></span><h1>DetectorEfficiencyCorUser v1<a class="headerlink" href="#detectorefficiencycoruser-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id2">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ImageNotFound.png"><img alt="../_images/ImageNotFound.png" class="screenshot" src="../_images/ImageNotFound.png" style="width: 200px;" /></a>
<figcaption>
<p><span class="caption-text">Enable screenshots using DOCS_SCREENSHOTS in CMake</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id3">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id4">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id5">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id6">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id7">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id8">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Corrects for detector efficiency. The correction factor is calculated using an instrument specific formula as a function of the final neutron energy E_f=E_i-E. Note that the formula is implemented only for a limited number of TOF instruments.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="DetectorEfficiencyCor-v1.html#algm-detectorefficiencycor"><span class="std std-ref">DetectorEfficiencyCor</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The workspace to correct for detector efficiency</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The name of the workspace in which to store the result.</p></td>
</tr>
<tr class="row-even"><td><p>IncidentEnergy</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The energy of neutrons leaving the source.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>This algorithm will correct detector efficiency according to the ILL INX
program for time-of-flight data reduction.</p>
<p>A formula named “formula_eff” must be defined in the instrument
parameters file and linked to all detectors in the input workspace. Different
components can have different formulas. The formula for each detector is
searched recursively. Thus, there can be, for example, a global formula for the
entire instrument and a specific formula for a bank or tube overriding the
global one.</p>
<p>The input workspace must be in DeltaE units.</p>
<p>The output data will be corrected as:</p>
<p><span class="math notranslate nohighlight">\(y = \frac{y}{eff}\)</span></p>
<p>where <span class="math notranslate nohighlight">\(eff\)</span> is</p>
<p><span class="math notranslate nohighlight">\(eff = \frac{f(E_{i} - \Delta E)}{f(E_i)}\)</span></p>
<p>The function <span class="math notranslate nohighlight">\(f\)</span> is defined as “formula_eff” in the IDF. To date
this has been implemented at the ILL for ILL IN4, IN5 and IN6, and at
the MLZ for TOFTOF.</p>
<p>Unlike <a class="reference internal" href="DetectorEfficiencyCor-v1.html#algm-detectorefficiencycor"><span class="std std-ref">DetectorEfficiencyCor v1</span></a> algorithm, which uses tabulated formula
accounting for neutron adsorption efficiency dependence on neutron energy,
the formula used by this algorithm
is provided by instrument scientist and is adjusted for the instrument,
accounting for a number of additional instrument specific factors.</p>
<p>As example, for <a class="reference external" href="http://www.mlz-garching.de/toftof">TOFTOF</a> instrument, the energy-dependent intensity
loss factor accounts also for absorption of neutrons by the Ar gas in the flight chamber, Al windows
of sample environment etc.
The formula used by DetectorEfficiencyCorUser algorithm is derived for TOFTOF in Ref. <a class="footnote-reference brackets" href="#unruh" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>,
and is set up in the TOFTOF instrument parameters file.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p><strong>Example - A sample correction</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># a sample workspace with a sample instrument</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">()</span>
<span class="c1"># convert to Wavelength</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">ConvertUnits</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="s2">&quot;DeltaE&quot;</span><span class="p">,</span><span class="n">EMode</span><span class="o">=</span><span class="s2">&quot;Direct&quot;</span><span class="p">,</span><span class="n">EFixed</span><span class="o">=</span><span class="mf">3.27</span><span class="p">)</span>

<span class="n">correction_formula</span> <span class="o">=</span> <span class="s2">&quot;exp(-0.0565/sqrt(e))*(1.0-exp(-3.284/sqrt(e)))&quot;</span>
<span class="n">SetInstrumentParameter</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">ParameterName</span><span class="o">=</span><span class="s2">&quot;formula_eff&quot;</span><span class="p">,</span><span class="n">Value</span><span class="o">=</span><span class="n">correction_formula</span><span class="p">)</span>


<span class="c1"># Now we are ready to run the correction</span>
<span class="n">wsCorrected</span> <span class="o">=</span> <span class="n">DetectorEfficiencyCorUser</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The correction for the data by the user defined function.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;In this case: &quot;</span> <span class="o">+</span> <span class="n">correction_formula</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">wsCorrected</span><span class="o">.</span><span class="n">blocksize</span><span class="p">(),</span><span class="mi">10</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The correct value in bin </span><span class="si">{}</span><span class="s2"> is </span><span class="si">{:.2f}</span><span class="s2"> compared to </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">wsCorrected</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span><span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The correction for the data by the user defined function.
In this case: exp(-0.0565/sqrt(e))*(1.0-exp(-3.284/sqrt(e)))
The correct value in bin 0 is 4.30 compared to 0.30
The correct value in bin 10 is 0.52 compared to 0.30
The correct value in bin 20 is 0.35 compared to 0.30
The correct value in bin 30 is 0.30 compared to 0.30
</pre></div>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="unruh" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>T. Unruh, J. Neuhaus, W. Petry,
<em>The high-resolution time-of-flight spectrometer TOFTOF</em>,
Nuclear Instruments and Methods in Physics Research Section A, <strong>580</strong> (2007), 1414-1422.
<a class="reference external" href="https://doi.org/10.1016/j.nima.2007.07.015">doi:101016/jnima200707015</a></p>
</aside>
</aside>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/CorrectionFunctions/EfficiencyCorrections.html">CorrectionFunctions\EfficiencyCorrections</a> | <a class="reference external" href="categories/Inelastic/Corrections.html">Inelastic\Corrections</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/291276d1b3f92d519f399310a3ef5f5d4a7c3d7f/Framework/Algorithms/inc/MantidAlgorithms/DetectorEfficiencyCorUser.h">DetectorEfficiencyCorUser.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/291276d1b3f92d519f399310a3ef5f5d4a7c3d7f/Framework/Algorithms/src/DetectorEfficiencyCorUser.cpp">DetectorEfficiencyCorUser.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DetectorEfficiencyCor-v1.html" title="Previous Chapter: DetectorEfficiencyCor v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DetectorEffic...</span>
    </a>
  </li>
  <li>
    <a href="DetectorEfficiencyVariation-v1.html" title="Next Chapter: DetectorEfficiencyVariation v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DetectorEffic... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>