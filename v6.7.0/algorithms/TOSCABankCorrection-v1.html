<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>TOSCABankCorrection v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TestWorkspaceGroupProperty v1" href="TestWorkspaceGroupProperty-v1.html" />
    <link rel="prev" title="TOFTOFMergeRuns v1" href="TOFTOFMergeRuns-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.7</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">TOSCABankCorrection v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="toscabankcorrection-v1">
<span id="algm-toscabankcorrection"></span><span id="algm-toscabankcorrection-v1"></span><h1>TOSCABankCorrection v1<a class="headerlink" href="#toscabankcorrection-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ImageNotFound.png"><img alt="../_images/ImageNotFound.png" class="screenshot" src="../_images/ImageNotFound.png" style="width: 200px;" /></a>
<figcaption>
<p><span class="caption-text">Enable screenshots using DOCS_SCREENSHOTS in CMake</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id3">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#workflow" id="id6">Workflow</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id7">Usage</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Corrects TOSCA reductions where the peaks across banks are not in alignment.</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Input reduced workspace</p></td>
</tr>
<tr class="row-odd"><td><p>SearchRange</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>200,2000</p></td>
<td><p>Range over which to find peaks</p></td>
</tr>
<tr class="row-even"><td><p>PeakPosition</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Specify a particular peak to use</p></td>
</tr>
<tr class="row-odd"><td><p>ClosePeakTolerance</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>20</p></td>
<td><p>Tolerance under which peaks are considered to be the same</p></td>
</tr>
<tr class="row-even"><td><p>PeakFunction</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Lorentzian</p></td>
<td><p>Type of peak to search for. Allowed values: [‘Lorentzian’, ‘Gaussian’]</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Output corrected workspace</p></td>
</tr>
<tr class="row-even"><td><p>TargetPeakCentre</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>X position between the centres of the two selected peaks</p></td>
</tr>
<tr class="row-odd"><td><p>ScaleFactor1</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>Scale factor for the first bank (histogram 0)</p></td>
</tr>
<tr class="row-even"><td><p>ScaleFactor2</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>Scale factor for the second bank (histogram 1)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>This algorithm attempts to automatically correct TOSCA data in which the
position of the sample has been moved and has affected the alignment of features
on the spectra from forward and backscattering detector banks.</p>
<p>The input workspace should be an energy transfer reduction, for the default
values of SearchRange and ClosePeakTolerance the X axis is assumed to be in
cm-1, however the X axis is not restricted to this unit.</p>
<p>The algorithm works by finding peaks of a given shape (using the <a class="reference internal" href="FindPeaks-v1.html#algm-findpeaks"><span class="std std-ref">FindPeaks</span></a>) on both the forward and backscattering banks, either
selecting a peak in a given position or selecting the peak with the highest X
value and attempting to match them to what is believed to be the same feature on
the other bank.</p>
<p>A scale factor is then calculated for each bank that will align at least the
selected peak and in doing so will also align the majority of misaligned peaks
across the two banks.</p>
<p>The sacling factor is calculated as follows:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}X_{centre} = \frac{X_{forward peak} + X_{back peak}}{2}\\SF_{forward} = \frac{X_{centre}}{X_{forward peak}}\\SF_{back} = \frac{X_{centre}}{X_{back peak}}\end{aligned}\end{align} \]</div>
<p>The corrected spectra are then rebinned to the input workspace (using
<a class="reference internal" href="RebinToWorkspace-v1.html#algm-rebintoworkspace"><span class="std std-ref">RebinToWorkspace</span></a>) to preserve the X range and to
maintain bin alignment.</p>
<p>The sum spectra (containing both forward and back scattering detectors) is then
recalculated by averaging the intensities of the two corrected spectra, this
compensates for the broader peaks seen on the original sum spectra due to the
misalignment of the peaks.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This algorithm is only intended to provide an approximation of what the
measured spectra would look like if the sample was in the expected sample
position.</p>
</div>
</section>
<section id="workflow">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Workflow</a><a class="headerlink" href="#workflow" title="Permalink to this heading">¶</a></h2>
<figure class="align-default" id="id2">
<img alt="../_images/ImageNotFound.png" src="../_images/ImageNotFound.png" />
<figcaption>
<p><span class="caption-text">diagram generation was disabled</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p><strong>Example - Automatic peak selection.</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">original_reduction</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;TSC14007_graphite002_red.nxs&#39;</span><span class="p">)</span>

<span class="n">corrected_reduction</span><span class="p">,</span> <span class="n">peak_position</span><span class="p">,</span> <span class="n">scale_factor_1</span><span class="p">,</span> <span class="n">scale_factor_2</span> <span class="o">=</span> \
  <span class="n">TOSCABankCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">original_reduction</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Target peak centre: %.f&#39;</span> <span class="o">%</span> <span class="n">peak_position</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Target peak centre: 1080
</pre></div>
</div>
<p><strong>Example - Manual peak selection.</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">original_reduction</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;TSC14007_graphite002_red.nxs&#39;</span><span class="p">)</span>

<span class="n">corrected_reduction</span><span class="p">,</span> <span class="n">peak_position</span><span class="p">,</span> <span class="n">scale_factor_1</span><span class="p">,</span> <span class="n">scale_factor_2</span> <span class="o">=</span> \
  <span class="n">TOSCABankCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">original_reduction</span><span class="p">,</span>
                      <span class="n">PeakPosition</span><span class="o">=</span><span class="s1">&#39;715&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Target peak centre: %.f&#39;</span> <span class="o">%</span> <span class="n">peak_position</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Target peak centre: 714
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Inelastic/Corrections.html">Inelastic\Corrections</a> | <a class="reference external" href="categories/CorrectionFunctions/SpecialCorrections.html">CorrectionFunctions\SpecialCorrections</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="TOFTOFMergeRuns-v1.html" title="Previous Chapter: TOFTOFMergeRuns v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; TOFTOFMergeRuns v1</span>
    </a>
  </li>
  <li>
    <a href="TestWorkspaceGroupProperty-v1.html" title="Next Chapter: TestWorkspaceGroupProperty v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">TestWorkspace... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>