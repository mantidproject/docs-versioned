<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>PoldiAnalyseResiduals v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PoldiAutoCorrelation v5" href="PoldiAutoCorrelation-v5.html" />
    <link rel="prev" title="PolarizationEfficiencyCor v1" href="PolarizationEfficiencyCor-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.7</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">PoldiAnalyseResiduals v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="poldianalyseresiduals-v1">
<span id="algm-poldianalyseresiduals"></span><span id="algm-poldianalyseresiduals-v1"></span><h1>PoldiAnalyseResiduals v1<a class="headerlink" href="#poldianalyseresiduals-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ImageNotFound.png"><img alt="../_images/ImageNotFound.png" class="screenshot" src="../_images/ImageNotFound.png" style="width: 200px;" /></a>
<figcaption>
<p><span class="caption-text">Enable screenshots using DOCS_SCREENSHOTS in CMake</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id5">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id6">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Analysis of residuals after fitting POLDI 2D-spectra.</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MeasuredCountData</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace2D.html#workspace2d"><span class="std std-ref">Workspace2D</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Input workspace containing the measured data.</p></td>
</tr>
<tr class="row-odd"><td><p>FittedCountData</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace2D.html#workspace2d"><span class="std std-ref">Workspace2D</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Input workspace containing the fitted data.</p></td>
</tr>
<tr class="row-even"><td><p>LambdaMin</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1.1</p></td>
<td><p>Minimum wavelength to be considered.</p></td>
</tr>
<tr class="row-odd"><td><p>LambdaMax</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>5</p></td>
<td><p>Maximum wavelength to be considered.</p></td>
</tr>
<tr class="row-even"><td><p>MaxIterations</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Maximum number of iterations. Default 0 does not limit number of iterations.</p></td>
</tr>
<tr class="row-odd"><td><p>MaxRelativeChange</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Relative change in counts (in percent) that should be reached.</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace2D.html#workspace2d"><span class="std std-ref">Workspace2D</span></a></p></td>
<td></td>
<td><p>Workspace containing the residual correlation spectrum.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>After fitting a model to POLDI 2D-data the residuals have to be analysed in order to determine whether the data are described by the model. Since this is very hard to see in the two dimensional residual data, the analysis involves a procedure that is very similar to the correlation method implemented in <a class="reference internal" href="PoldiAutoCorrelation-v5.html#algm-poldiautocorrelation"><span class="std std-ref">PoldiAutoCorrelation v5</span></a>. The method is slightly different because the residual at a given point may be either positive or negative.</p>
<p>The algorithm iteratively calculates the correlation spectrum of the residual data, distributes the correlation counts over the 2D residual data and normalizes the residuals so that their sum is equal to zero. The correlation spectra of all steps are accumulated and returned as output. In the spectrum it’s for example possible to spot additional peaks, which may have been hidden in by larger peaks in a first data analysis.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p>The following example shows how to calculate the residuals following a fit performed with <a class="reference internal" href="PoldiFitPeaks2D-v1.html#algm-poldifitpeaks2d"><span class="std std-ref">PoldiFitPeaks2D v1</span></a> on Silicon data that had been collected for a calibration measurement.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data from file, load instrument and truncate data to correct size</span>
<span class="n">data_Si_raw</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s2">&quot;Poldi2013Silicon.nxs&quot;</span><span class="p">)</span>
<span class="n">LoadInstrument</span><span class="p">(</span><span class="n">data_Si_raw</span><span class="p">,</span> <span class="n">InstrumentName</span><span class="o">=</span><span class="s2">&quot;POLDI&quot;</span><span class="p">,</span> <span class="n">RewriteSpectraMap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_Si</span> <span class="o">=</span> <span class="n">PoldiTruncateData</span><span class="p">(</span><span class="n">data_Si_raw</span><span class="p">)</span>

<span class="c1"># Perform correlation method, find and refine peaks in correlation spectrum</span>
<span class="n">correlation_Si</span> <span class="o">=</span> <span class="n">PoldiAutoCorrelation</span><span class="p">(</span><span class="n">data_Si</span><span class="p">)</span>
<span class="n">peaks_Si_raw</span> <span class="o">=</span> <span class="n">PoldiPeakSearch</span><span class="p">(</span><span class="n">correlation_Si</span><span class="p">)</span>

<span class="c1"># Only use the 11 strongest peaks</span>
<span class="n">DeleteTableRows</span><span class="p">(</span><span class="n">TableWorkspace</span><span class="o">=</span><span class="n">peaks_Si_raw</span><span class="p">,</span> <span class="n">Rows</span><span class="o">=</span><span class="s2">&quot;11-20&quot;</span><span class="p">)</span>

<span class="n">peaks_Si_1D</span> <span class="o">=</span> <span class="n">PoldiFitPeaks1D</span><span class="p">(</span><span class="n">correlation_Si</span><span class="p">,</span> <span class="n">FwhmMultiples</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">PoldiPeakTable</span><span class="o">=</span><span class="s2">&quot;peaks_Si_raw&quot;</span><span class="p">,</span>

                                <span class="n">FitPlotsWorkspace</span> <span class="o">=</span> <span class="s2">&quot;fit_plots_Si&quot;</span><span class="p">,</span>
                                <span class="n">Version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Fit peaks to original 2D data</span>
<span class="n">fit_result_Si_2D</span> <span class="o">=</span> <span class="n">PoldiFitPeaks2D</span><span class="p">(</span><span class="n">data_Si</span><span class="p">,</span>
                                <span class="n">PoldiPeakWorkspace</span><span class="o">=</span><span class="s2">&quot;peaks_Si_1D&quot;</span><span class="p">,</span> <span class="n">MaximumIterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                <span class="n">RefinedPoldiPeakWorkspace</span><span class="o">=</span><span class="s2">&quot;peaks_Si_2D&quot;</span><span class="p">,</span>
                                <span class="n">Calculated1DSpectrum</span><span class="o">=</span><span class="s2">&quot;fit_result_Si_1D&quot;</span><span class="p">)</span>

<span class="c1"># Calculate residuals</span>
<span class="n">residuals_Si</span> <span class="o">=</span> <span class="n">PoldiAnalyseResiduals</span><span class="p">(</span><span class="n">MeasuredCountData</span><span class="o">=</span><span class="n">data_Si</span><span class="p">,</span> <span class="n">FittedCountData</span><span class="o">=</span><span class="s2">&quot;fit_result_Si_2D&quot;</span><span class="p">,</span> <span class="n">MaxIterations</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">residual_data</span> <span class="o">=</span> <span class="n">residuals_Si</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Residuals are in the range: [ </span><span class="si">{:.2f}</span><span class="s2"> ,  </span><span class="si">{:.2f}</span><span class="s2"> ]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">residual_data</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">residual_data</span><span class="p">),</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>The output contains the range in which residuals are found:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Residuals are in the range: [ -2361.45 ,  2651.65 ]
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/SINQ/Poldi.html">SINQ\Poldi</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/291276d1b3f92d519f399310a3ef5f5d4a7c3d7f/Framework/SINQ/inc/MantidSINQ/PoldiAnalyseResiduals.h">PoldiAnalyseResiduals.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/291276d1b3f92d519f399310a3ef5f5d4a7c3d7f/Framework/SINQ/src/PoldiAnalyseResiduals.cpp">PoldiAnalyseResiduals.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="PolarizationEfficiencyCor-v1.html" title="Previous Chapter: PolarizationEfficiencyCor v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; PolarizationE...</span>
    </a>
  </li>
  <li>
    <a href="PoldiAutoCorrelation-v5.html" title="Next Chapter: PoldiAutoCorrelation v5"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">PoldiAutoCorr... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>