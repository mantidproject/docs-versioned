<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>AbsorptionCorrection v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="AccumulateMD v1" href="AccumulateMD-v1.html" />
    <link rel="prev" title="Abins2D v1" href="Abins2D-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.7</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">AbsorptionCorrection v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="absorptioncorrection-v1">
<span id="algm-absorptioncorrection"></span><span id="algm-absorptioncorrection-v1"></span><h1>AbsorptionCorrection v1<a class="headerlink" href="#absorptioncorrection-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ImageNotFound.png"><img alt="../_images/ImageNotFound.png" class="screenshot" src="../_images/ImageNotFound.png" style="width: 200px;" /></a>
<figcaption>
<p><span class="caption-text">Enable screenshots using DOCS_SCREENSHOTS in CMake</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#choosing-an-absorption-correction-algorithm" id="id6">Choosing an absorption correction algorithm</a></p>
<ul>
<li><p><a class="reference internal" href="#assumptions" id="id7">Assumptions</a></p></li>
<li><p><a class="reference internal" href="#restrictions-on-the-input-workspace" id="id8">Restrictions on the input workspace</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#usage" id="id9">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id10">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Calculates an approximation of the attenuation due to absorption and single scattering in a generic sample shape. The sample shape can be defined by, e.g., the CreateSampleShape algorithm.
Note that if your sample is of cuboid or cylinder geometry, you will get a more accurate result from the FlatPlateAbsorption or CylinderAbsorption algorithms respectively.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="SetSampleMaterial-v1.html#algm-setsamplematerial"><span class="std std-ref">SetSampleMaterial</span></a>, <a class="reference internal" href="CreateSampleShape-v1.html#algm-createsampleshape"><span class="std std-ref">CreateSampleShape</span></a>, <a class="reference internal" href="DefineGaugeVolume-v1.html#algm-definegaugevolume"><span class="std std-ref">DefineGaugeVolume</span></a>, <a class="reference internal" href="CylinderAbsorption-v1.html#algm-cylinderabsorption"><span class="std std-ref">CylinderAbsorption</span></a>, <a class="reference internal" href="FlatPlateAbsorption-v1.html#algm-flatplateabsorption"><span class="std std-ref">FlatPlateAbsorption</span></a>, <a class="reference internal" href="AnnularRingAbsorption-v1.html#algm-annularringabsorption"><span class="std std-ref">AnnularRingAbsorption</span></a>, <a class="reference internal" href="CuboidGaugeVolumeAbsorption-v1.html#algm-cuboidgaugevolumeabsorption"><span class="std std-ref">CuboidGaugeVolumeAbsorption</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The X values for the input workspace must be in units of wavelength</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Output workspace name</p></td>
</tr>
<tr class="row-even"><td><p>ScatterFrom</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Sample</p></td>
<td><p>The component to calculate the absorption for (default: Sample). Allowed values: [‘Sample’, ‘Container’, ‘Environment’]</p></td>
</tr>
<tr class="row-odd"><td><p>AttenuationXSection</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The ABSORPTION cross-section, at 1.8 Angstroms, for the sample material in barns. Column 8 of a table generated from <a class="reference external" href="http://www.ncnr.nist.gov/resources/n-lengths/">http://www.ncnr.nist.gov/resources/n-lengths/</a>.</p></td>
</tr>
<tr class="row-even"><td><p>ScatteringXSection</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The (coherent + incoherent) scattering cross-section for the sample material in barns. Column 7 of a table generated from <a class="reference external" href="http://www.ncnr.nist.gov/resources/n-lengths/">http://www.ncnr.nist.gov/resources/n-lengths/</a>.</p></td>
</tr>
<tr class="row-odd"><td><p>SampleNumberDensity</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The number density of the sample in number of atoms per cubic angstrom if not set with SetSampleMaterial</p></td>
</tr>
<tr class="row-even"><td><p>NumberOfWavelengthPoints</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The number of wavelength points for which the numerical integral is calculated (default: all points)</p></td>
</tr>
<tr class="row-odd"><td><p>ExpMethod</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Normal</p></td>
<td><p>Select the method to use to calculate exponentials, normal or a fast approximation (default: Normal). Allowed values: [‘Normal’, ‘FastApprox’]</p></td>
</tr>
<tr class="row-even"><td><p>EMode</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Elastic</p></td>
<td><p>The energy mode (default: elastic). Allowed values: [‘Elastic’, ‘Direct’, ‘Indirect’]</p></td>
</tr>
<tr class="row-odd"><td><p>EFixed</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>The value of the initial or final energy, as appropriate, in meV. Will be taken from the instrument definition file, if available.</p></td>
</tr>
<tr class="row-even"><td><p>ElementSize</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>The size of one side of an integration element cube in mm</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>This algorithm uses a numerical integration method to calculate
attenuation factors resulting from absorption and single scattering in a
sample with the material properties given. Factors are calculated for
each spectrum (i.e. detector position) and wavelength point, as defined
by the input workspace. The sample is first bounded by a cuboid, which
is divided up into small cubes. The cubes whose centres lie within the
sample make up the set of integration elements (so you have a kind of
‘Lego’ model of the sample) and path lengths through the sample are
calculated for the centre-point of each element, and a numerical
integration is carried out using these path lengths over the volume
elements.</p>
<p>The output workspace will contain the attenuation factors. To apply
the correction you must divide your data set by the resulting factors.</p>
<p>Note that the duration of this algorithm is strongly dependent on the
element size chosen, and that too small an element size can cause the
algorithm to fail because of insufficient memory.</p>
<p>Note that The number density of the sample is in
<span class="math notranslate nohighlight">\(\mathrm{\AA}^{-3}\)</span></p>
</section>
<section id="choosing-an-absorption-correction-algorithm">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Choosing an absorption correction algorithm</a><a class="headerlink" href="#choosing-an-absorption-correction-algorithm" title="Permalink to this heading">¶</a></h2>
<p>This flow chart is given as a way of selecting the most appropriate of
the absorption correction algorithms. It also shows the algorithms that
must be run first in each case. Note that this does not cover the
following absorption correction algorithms:
<a class="reference internal" href="MonteCarloAbsorption-v1.html#algm-montecarloabsorption"><span class="std std-ref">MonteCarloAbsorption v1</span></a> (correction factors for
a generic sample using a Monte Carlo instead of a numerical integration
method),
<a class="reference internal" href="CarpenterSampleCorrection-v1.html#algm-carpentersamplecorrection"><span class="std std-ref">CarpenterSampleCorrection v1</span></a>
&amp; <a class="reference internal" href="AnvredCorrection-v1.html#algm-anvredcorrection"><span class="std std-ref">AnvredCorrection v1</span></a> (corrections in a spherical
sample, using a method imported from ISAW). Also, HRPD users can use the
<a class="reference internal" href="HRPDSlabCanAbsorption-v1.html#algm-hrpdslabcanabsorption"><span class="std std-ref">HRPDSlabCanAbsorption v1</span></a> to add rudimentary
calculations of the effects of the sample holder. <img alt="AbsorptionFlow.png" src="../_images/AbsorptionFlow.png" /></p>
<section id="assumptions">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Assumptions</a><a class="headerlink" href="#assumptions" title="Permalink to this heading">¶</a></h3>
<p>This algorithm assumes that the (parallel) beam illuminates the entire
sample <strong>unless</strong> a ‘gauge volume’ has been defined using the
<a class="reference internal" href="DefineGaugeVolume-v1.html#algm-definegaugevolume"><span class="std std-ref">DefineGaugeVolume v1</span></a> algorithm (or by otherwise
adding a valid XML string <a class="reference internal" href="../concepts/HowToDefineGeometricShape.html#howtodefinegeometricshape"><span class="std std-ref">defining a
shape</span></a> to a <a class="reference internal" href="../concepts/Run.html#run"><span class="std std-ref">Run</span></a> property called
“GaugeVolume”). In this latter case only scattering within this volume
(and the sample) is integrated, because this is all the detector can
‘see’. The full sample is still used for the neutron paths. (<strong>N.B.</strong> If
your gauge volume is of axis-aligned cuboid shape and fully enclosed by
the sample then you will get a more accurate result from the
<a class="reference internal" href="CuboidGaugeVolumeAbsorption-v1.html#algm-cuboidgaugevolumeabsorption"><span class="std std-ref">CuboidGaugeVolumeAbsorption v1</span></a>
algorithm.)</p>
</section>
<section id="restrictions-on-the-input-workspace">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Restrictions on the input workspace</a><a class="headerlink" href="#restrictions-on-the-input-workspace" title="Permalink to this heading">¶</a></h3>
<p>The input workspace must have units of wavelength. The
<a class="reference internal" href="../concepts/Instrument.html#instrument"><span class="std std-ref">instrument</span></a> associated with the workspace must be fully
defined because detector, source &amp; sample position are needed.</p>
</section>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p><strong>Example: A simple spherical sample</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#setup the sample shape</span>
<span class="n">sphere</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;&lt;sphere id=&quot;sample-sphere&quot;&gt;</span>
<span class="s1">&lt;centre x=&quot;0&quot; y=&quot;0&quot; z=&quot;0&quot;/&gt;</span>
<span class="s1">&lt;radius val=&quot;0.1&quot; /&gt;</span>
<span class="s1">&lt;/sphere&gt;&#39;&#39;&#39;</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="s2">&quot;Histogram&quot;</span><span class="p">,</span><span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">ConvertUnits</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">Rebin</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">Params</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">CreateSampleShape</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">sphere</span><span class="p">)</span>
<span class="n">SetSampleMaterial</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">ChemicalFormula</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">)</span>

<span class="c1">#restrict the number of wavelength points to speed up the example</span>
<span class="n">wsOut</span> <span class="o">=</span> <span class="n">AbsorptionCorrection</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">NumberOfWavelengthPoints</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ElementSize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">wsCorrected</span> <span class="o">=</span> <span class="n">ws</span> <span class="o">/</span> <span class="n">wsOut</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The created workspace has one entry for each spectra: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wsOut</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original y values:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Corrected y values:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wsCorrected</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The created workspace has one entry for each spectra: 1
Original y values:  [  5.68751434   5.68751434  15.68751434   5.68751434   5.68751434
   1.56242829]
Corrected y values:  [   818.39955533   2377.16206099  14230.46290595   9497.08390031
  15787.69382575   5780.15301643]
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/CorrectionFunctions/AbsorptionCorrections.html">CorrectionFunctions\AbsorptionCorrections</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/291276d1b3f92d519f399310a3ef5f5d4a7c3d7f/Framework/Algorithms/inc/MantidAlgorithms/AnyShapeAbsorption.h">AnyShapeAbsorption.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/291276d1b3f92d519f399310a3ef5f5d4a7c3d7f/Framework/Algorithms/src/AnyShapeAbsorption.cpp">AnyShapeAbsorption.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="Abins2D-v1.html" title="Previous Chapter: Abins2D v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Abins2D v1</span>
    </a>
  </li>
  <li>
    <a href="AccumulateMD-v1.html" title="Next Chapter: AccumulateMD v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">AccumulateMD v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>