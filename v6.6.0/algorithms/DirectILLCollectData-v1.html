<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>DirectILLCollectData v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DirectILLDiagnostics v1" href="DirectILLDiagnostics-v1.html" />
    <link rel="prev" title="DirectILLAutoProcess v1" href="DirectILLAutoProcess-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.6</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">DirectILLCollectData v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="directillcollectdata-v1">
<span id="algm-directillcollectdata"></span><span id="algm-directillcollectdata-v1"></span><h1>DirectILLCollectData v1<a class="headerlink" href="#directillcollectdata-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/DirectILLCollectData-v1_dlg.png"><img alt="../_images/DirectILLCollectData-v1_dlg.png" class="screenshot" src="../_images/DirectILLCollectData-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>DirectILLCollectData</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p>
<ul>
<li><p><a class="reference internal" href="#input-data" id="id6">Input data</a></p></li>
<li><p><a class="reference internal" href="#basic-reduction-steps" id="id7">Basic reduction steps</a></p>
<ul>
<li><p><a class="reference internal" href="#normalisation-to-monitor" id="id8">Normalisation to monitor</a></p></li>
<li><p><a class="reference internal" href="#normalisation-to-time" id="id9">Normalisation to time</a></p></li>
<li><p><a class="reference internal" href="#flat-background-subtraction" id="id10">Flat background subtraction</a></p></li>
<li><p><a class="reference internal" href="#elastic-peak-positions-epp" id="id11">Elastic peak positions (EPP)</a></p></li>
<li><p><a class="reference internal" href="#incident-energy" id="id12">Incident energy</a></p></li>
<li><p><a class="reference internal" href="#tof-axis-adjustment" id="id13">TOF axis adjustment</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#optional-inputs-and-outputs" id="id14">Optional inputs and outputs</a></p>
<ul>
<li><p><a class="reference internal" href="#raw-output-workspace" id="id15">Raw output workspace</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#ill-s-instrument-specific-defaults" id="id16">ILL’s instrument specific defaults</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id17">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id18">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>An initial step of the reduction workflow for the direct geometry TOF spectrometers at ILL.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="DirectILLReduction-v1.html#algm-directillreduction"><span class="std std-ref">DirectILLReduction</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Run</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td></td>
<td><p>An input run number (or a list thereof) or a filename. Allowed values: [‘nxs’]</p></td>
</tr>
<tr class="row-odd"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>Input workspace if no run is given.</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A flux normalized and background subtracted workspace.</p></td>
</tr>
<tr class="row-odd"><td><p>Cleanup</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Cleanup ON</p></td>
<td><p>What to do with intermediate workspaces. Allowed values: [‘Cleanup ON’, ‘Cleanup OFF’]</p></td>
</tr>
<tr class="row-even"><td><p>SubalgorithmLogging</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Logging OFF</p></td>
<td><p>Enable or disable subalgorithms to print in the logs. Allowed values: [‘Logging OFF’, ‘Logging ON’]</p></td>
</tr>
<tr class="row-odd"><td><p>EPPCreationMethod</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>EPP Method AUTO</p></td>
<td><p>Method to create the EPP table for detectors (monitor is awlays fitted). Allowed values: [‘EPP Method AUTO’, ‘Fit EPP’, ‘Calculate EPP’]</p></td>
</tr>
<tr class="row-even"><td><p>SigmaForCalculatedEPP</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Nominal sigma for the EPP table when EPPCreationMethod is set to Calculate EPP (default: 10 times the first bin width).</p></td>
</tr>
<tr class="row-odd"><td><p>ElasticChannel</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Elastic Channel AUTO</p></td>
<td><p>How to acquire the nominal elastic channel. Allowed values: [‘Elastic Channel AUTO’, ‘Default Elastic Channel’, ‘Fit Elastic Channel’]</p></td>
</tr>
<tr class="row-even"><td><p>ElasticChannelWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>A single value workspace containing the nominal elastic channel index(can be floating point). Overrides ElasticChannel.</p></td>
</tr>
<tr class="row-odd"><td><p>Monitor</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Index of the incident monitor, if not specified in instrument parameters.</p></td>
</tr>
<tr class="row-even"><td><p>IncidentEnergyCalibration</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Energy Calibration AUTO</p></td>
<td><p>Control the incident energy calibration. Allowed values: [‘Energy Calibration AUTO’, ‘Energy Calibration ON’, ‘Energy Calibration OFF’]</p></td>
</tr>
<tr class="row-odd"><td><p>IncidentEnergyWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>A single-valued workspace holding a previously determined incident energy.</p></td>
</tr>
<tr class="row-even"><td><p>FlatBkg</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Flat Bkg AUTO</p></td>
<td><p>Control flat background subtraction. Allowed values: [‘Flat Bkg AUTO’, ‘Flat Bkg ON’, ‘Flat Bkg OFF’]</p></td>
</tr>
<tr class="row-odd"><td><p>FlatBkgScaling</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Flat background multiplication factor.</p></td>
</tr>
<tr class="row-even"><td><p>FlatBkgAveragingWindow</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>30</p></td>
<td><p>Running average window width (in bins) for flat background.</p></td>
</tr>
<tr class="row-odd"><td><p>FlatBkgWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>Workspace with previously determined flat background data.</p></td>
</tr>
<tr class="row-even"><td><p>GroupDetHorizontallyBy</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Step to use when grouping detectors horizontally (between tubes) to increase the statistics for flat background calculation.</p></td>
</tr>
<tr class="row-odd"><td><p>GroupDetVerticallyBy</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Step to use when grouping detectors vertically (inside the same tube) to increase the statistics for flat background calculation.</p></td>
</tr>
<tr class="row-even"><td><p>Normalisation</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Normalisation Monitor</p></td>
<td><p>Normalisation method. Allowed values: [‘Normalisation Monitor’, ‘Normalisation Time’, ‘Normalisation OFF’]</p></td>
</tr>
<tr class="row-odd"><td><p>MonitorPeakWidthInSigmas</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>7</p></td>
<td><p>Width of the monitor peak in multiples  of ‘Sigma’ in monitor’s EPP table.</p></td>
</tr>
<tr class="row-even"><td><p>OutputRawWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td></td>
<td><p>Non-normalized and non-background subtracted output workspace for DirectILLDiagnostics.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputElasticChannelWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td></td>
<td><p>Output workspace for elastic channel index.</p></td>
</tr>
<tr class="row-even"><td><p>OutputEPPWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Output workspace for elastic peak positions.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputIncidentEnergyWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td></td>
<td><p>Output workspace for calibrated incident energy.</p></td>
</tr>
<tr class="row-even"><td><p>OutputFlatBkgWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td></td>
<td><p>Output workspace for flat background.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>An initial step of the reduction workflow for the direct geometry TOF spectrometers at ILL. It reads and merges NeXus files, normalizes data to monitor, subtracts a flat background, and adjusts the TOF scale to conform to Mantid standards. More information on how this algorithm interacts with the rest of the ILL’s TOF reduction suite can be found <a class="reference internal" href="../techniques/DirectILL.html#directill"><span class="std std-ref">here</span></a>. The workflow of this algorithm is shown in the diagram below:</p>
<img alt="../_images/DirectILLCollectData-v1_wkflw.svg" src="../_images/DirectILLCollectData-v1_wkflw.svg" /><section id="input-data">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Input data</a><a class="headerlink" href="#input-data" title="Permalink to this heading">¶</a></h3>
<p>Either <em>Run</em> or <em>InputWorkspace</em> has to be specified. <em>Run</em> can take multiple run numbers. In this case the files will be merged using the <a class="reference internal" href="LoadAndMerge-v1.html#algm-loadandmerge"><span class="std std-ref">LoadAndMerge</span></a> algorithm. For example, <code class="docutils literal notranslate"><span class="pre">'/data/0100-0103+0200-0202'</span></code> would merge runs 100, 101, 102, 103, 200, 201 and 202 from directory <code class="docutils literal notranslate"><span class="pre">/data/</span></code>.</p>
</section>
<section id="basic-reduction-steps">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Basic reduction steps</a><a class="headerlink" href="#basic-reduction-steps" title="Permalink to this heading">¶</a></h3>
<p>Some basic reduction steps are done to the input data.</p>
<ol class="arabic simple">
<li><p>Separate monitor and detector spectra to different workspaces.</p></li>
<li><p>Optionally normalise the detector specta to monitor counts or acquisition time.</p></li>
<li><p>Subtract time-independent background from the detector spectra.</p></li>
<li><p>Optionally find the elastic peak positions.</p></li>
<li><p>Optionally calibrate the incident energy.</p></li>
<li><p>Adjust the TOF axis so that the elastic time-of-flight corresponds to the L1+L2 distances.</p></li>
<li><p>Find elastic peak positions again, if <em>OutputEPPWorkspace</em> is requested.</p></li>
</ol>
<p>More detailed description of some of these steps is given below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The initial time-of-flight axis of ILL’s spectrometers has an arbitrary starting point. Therefore, the TOF values in the intermediate workspaces do not correspond to any physical flight distances until they are corrected at step 6.</p>
</div>
<section id="normalisation-to-monitor">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">Normalisation to monitor</a><a class="headerlink" href="#normalisation-to-monitor" title="Permalink to this heading">¶</a></h4>
<p>If <em>Normalisation</em> is set to <code class="docutils literal notranslate"><span class="pre">'Normalisation</span> <span class="pre">Monitor'</span></code>, the data is divided by the monitor counts. The monitor spectrum is specified by the ‘default-incident-monitor-spectrum’ instrument parameter or, if not present, by the <em>Monitor</em> property. A flat background is subtracted from the spectrum as described below except no background scaling is applied.  The monitor peak is found using <a class="reference internal" href="FindEPP-v2.html#algm-findepp"><span class="std std-ref">FindEPP</span></a>. If this fails, the entire monitor range is integrated. Otherwise the spectrum is integrated over a range <span class="math notranslate nohighlight">\(\pm\)</span> <em>MonitorPeakWidthInSigmas</em> <span class="math notranslate nohighlight">\(\cdot \sigma\)</span> around the position of the monitor peak.</p>
<p>Afterwards, the intensities are multiplied by a factor defined by the ‘scaling_after_monitor_normalisation’ entry in instrument parameters, if present.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the sample log entry <code class="docutils literal notranslate"><span class="pre">monitor.monsum</span></code> (<code class="docutils literal notranslate"><span class="pre">monitor1.monsum</span></code> on IN6) is less than 100, monitor normalisation will be disabled and the data normalised to time.</p>
</div>
</section>
<section id="normalisation-to-time">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">Normalisation to time</a><a class="headerlink" href="#normalisation-to-time" title="Permalink to this heading">¶</a></h4>
<p>When <em>Normalisation</em> is set to <code class="docutils literal notranslate"><span class="pre">'Normalisation</span> <span class="pre">Time'</span></code>, the data is divided by the duration of the experiment, in seconds. By default, the <cite>duration</cite> sample log is used except for ILL’s IN4 instrument where the <cite>actual_time</cite> log is used instead.</p>
</section>
<section id="flat-background-subtraction">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">Flat background subtraction</a><a class="headerlink" href="#flat-background-subtraction" title="Permalink to this heading">¶</a></h4>
<p>A flat time-independent background for subtraction can be given by <em>FlatBkgWorkspace</em>. If this input property is not specified, flat background will be calculated from the detector spectra by <a class="reference internal" href="CalculateFlatBackground-v1.html#algm-calculateflatbackground"><span class="std std-ref">CalculateFlatBackground</span></a> using the <code class="docutils literal notranslate"><span class="pre">Moving</span> <span class="pre">Average</span></code> mode. The <em>FlatBkgAveragingWindow</em> property is passed directly to <a class="reference internal" href="CalculateFlatBackground-v1.html#algm-calculateflatbackground"><span class="std std-ref">CalculateFlatBackground</span></a> as <em>AveragingWindowWidth</em>.</p>
<p>Before subtraction, the background workspace is multiplied by <em>FlatBkgScaling</em>.</p>
<p>The background used for the subtraction can be retrieved using the <em>OutputFlatBkgWorkspace</em> property. This property holds either the same workspace as <em>FlatBkgWorkspace</em>, or a workspace created by <a class="reference internal" href="CalculateFlatBackground-v1.html#algm-calculateflatbackground"><span class="std std-ref">CalculateFlatBackground</span></a>. Note that no <em>FlatBkgScaling</em> is applied to this workspace.</p>
</section>
<section id="elastic-peak-positions-epp">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">Elastic peak positions (EPP)</a><a class="headerlink" href="#elastic-peak-positions-epp" title="Permalink to this heading">¶</a></h4>
<p>Information on the elastic peaks (position, peak width) is needed for incident energy calibration, as well as for the <a class="reference internal" href="DirectILLDiagnostics-v1.html#algm-directilldiagnostics"><span class="std std-ref">DirectILLDiagnostics</span></a> and <a class="reference internal" href="DirectILLIntegrateVanadium-v1.html#algm-directillintegratevanadium"><span class="std std-ref">DirectILLIntegrateVanadium</span></a> algorithms. This data comes in the form of an EPP workspace which is a TableWorkspace containing columns specified by the <a class="reference internal" href="FindEPP-v2.html#algm-findepp"><span class="std std-ref">FindEPP</span></a> algorithm.</p>
<p>If an EPP table is needed, the algorithm either fits the elastic peaks using <a class="reference internal" href="FindEPP-v2.html#algm-findepp"><span class="std std-ref">FindEPP</span></a>, or calculates their nominal positions using <a class="reference internal" href="CreateEPP-v1.html#algm-createepp"><span class="std std-ref">CreateEPP</span></a>. This behavior can be controlled by the <em>EPPCreationMode</em> property. The default (<code class="docutils literal notranslate"><span class="pre">'EPP</span> <span class="pre">Method</span> <span class="pre">AUTO'</span></code>) is to calculate the positions for the IN5 and PANTHER instruments, and to fit for any other instrument.</p>
<p>In the calculation case, a nominal peak width can be given using the <em>Sigma</em> property. The peak width is needed for some integration operations. If <em>Sigma</em> is not specified, ten times the first bin width in the workspace will be used.</p>
</section>
<section id="incident-energy">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">Incident energy</a><a class="headerlink" href="#incident-energy" title="Permalink to this heading">¶</a></h4>
<p>The incident energy and the nominal TOF channel are needed to adjust the TOF axis to conform to the standard Mantid notation.</p>
<p>The incident energy written in the data files of IN4 and IN6 and accessible via the <cite>Ei</cite> sample log may be inaccurate. To ensure a correct value is used for the TOF axis adjustment, the value can be calibrated using <a class="reference internal" href="GetEiMonDet-v3.html#algm-geteimondet"><span class="std std-ref">GetEiMonDet</span></a>. The operation is controlled by <em>IncidentEnergyCalibration</em>. Elastic peak positions are needed for the calculation which can be supplied by <em>EPPWorkspace</em>, otherwise <a class="reference internal" href="FindEPP-v2.html#algm-findepp"><span class="std std-ref">FindEPP</span></a> is used.</p>
<p>The calibrated energy can be retrieved as a single-value workspace using the <em>OutputIncidentEnergyWorkspace</em> property. This workspace can be passed to further calls to <a class="reference internal" href="#algm-directillcollectdata"><span class="std std-ref">DirectILLCollectData</span></a> to force a common <cite>Ei</cite> and thus a common TOF axis between the datasets. This is needed for, e.g., empty container subtraction.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Incident energy calibration will be disabled if the sample log entry <code class="docutils literal notranslate"><span class="pre">monitor.monsum</span></code> (<code class="docutils literal notranslate"><span class="pre">monitor1.monsum</span></code> on IN6) is less than 100.</p>
</div>
</section>
<section id="tof-axis-adjustment">
<h4><a class="toc-backref" href="#id13" role="doc-backlink">TOF axis adjustment</a><a class="headerlink" href="#tof-axis-adjustment" title="Permalink to this heading">¶</a></h4>
<p>The TOF axis is adjusted such that the nominal elastic channel corresponds to the L1 + L2 distance. For this, incident energy and elastic channel number are needed. The energy is read from the <code class="docutils literal notranslate"><span class="pre">Ei</span></code> sample log while the elastic channel from <cite>Detector.elasticpeak</cite>. Alternatively, the elastic channel can be determined by fitting, as done with IN5 and PANTHER. Whether to use the sample logs or fitting is determined by the <em>ElasticChannel</em> property. The channel can be given also directly as a single valued workspace in <em>ElasticChannelWorkspace</em>.</p>
</section>
</section>
<section id="optional-inputs-and-outputs">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Optional inputs and outputs</a><a class="headerlink" href="#optional-inputs-and-outputs" title="Permalink to this heading">¶</a></h3>
<p>The algorithm has some optional input and output workspaces. Their purpose is to extract some common information from a single data set and use it as input for other algorithms or data sets. An example would be backgrounds extracted from a low temperature measurement which can be used when reducing data taken at higher temperatures.</p>
<p>Some optional input and output workspaces come in pairs. If the input workspace is specified, it will be used in the reduction and returned as the corresponding output workspace. If the input workspace is not specified, the needed information is calculated from the current data, and returned in the output workspace.</p>
<ul class="simple">
<li><p><em>IncidentEnergyWorkspace</em> — <em>OutputIncidentEnergyWorkspace</em>: single-valued workspace containing calibrated incident energy, used for incident energy calibration.</p></li>
<li><p><em>FlatBkgWorkspace</em> — <em>OutputFlatBkgWorkspace</em>: a MatrixWorkspace containing the flat backgrounds. Used for flat background subtraction. Note that <em>FlatBkgScaling</em> is not applied to <em>OutputFlatBkgWorkspace</em>.</p></li>
<li><p><em>ElasticChannelWorkspace</em> — <em>OutputElasticChannelWorkspace</em>: a single-valued workspace containing the index of the nominal elastic channel (can be a floating-point number). Used for the TOF axis adjustment.</p></li>
</ul>
<section id="raw-output-workspace">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Raw output workspace</a><a class="headerlink" href="#raw-output-workspace" title="Permalink to this heading">¶</a></h4>
<p>The <em>OutputRawWorkspace</em> property provides an access to a ‘raw’ data workspace in the sense that no normalisation or background subtraction is applied to this workspace. The raw workspace is useful as an input workspace for the <a class="reference internal" href="DirectILLDiagnostics-v1.html#algm-directilldiagnostics"><span class="std std-ref">DirectILLDiagnostics</span></a> algorithm.</p>
</section>
</section>
</section>
<section id="ill-s-instrument-specific-defaults">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">ILL’s instrument specific defaults</a><a class="headerlink" href="#ill-s-instrument-specific-defaults" title="Permalink to this heading">¶</a></h2>
<p>The following settings are used when the <code class="docutils literal notranslate"><span class="pre">AUTO</span></code> keyword is encountered:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>IN4</p></th>
<th class="head"><p>IN5</p></th>
<th class="head"><p>IN6</p></th>
<th class="head"><p>PANTHER</p></th>
<th class="head"><p>SHARP</p></th>
<th class="head"><p>Others</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>EPPCreationMethod</p></td>
<td><p>Fit EPP</p></td>
<td><p>Calculate EPP</p></td>
<td><p>Fit EPP</p></td>
<td><p>Calculate EPP</p></td>
<td><p>Fit EPP</p></td>
<td><p>Fit EPP</p></td>
</tr>
<tr class="row-odd"><td><p>ElasticChannel</p></td>
<td><p>Fit Elastic Channel</p></td>
<td><p>Fit Elastic Channel</p></td>
<td><p>Fit Elastic Channel</p></td>
<td><p>Fit Elastic Channel</p></td>
<td><p>Fit Elastic Channel</p></td>
<td><p>Default Elastic Channel</p></td>
</tr>
<tr class="row-even"><td><p>IncidentEnergyCalibration</p></td>
<td><p>Energy Calibration ON</p></td>
<td><p>Energy Calibration OFF</p></td>
<td><p>Energy Calibration ON</p></td>
<td><p>Energy Calibration OFF</p></td>
<td><p>Energy Calibration ON</p></td>
<td><p>Energy Calibration ON</p></td>
</tr>
<tr class="row-odd"><td><p>FlatBkg</p></td>
<td><p>Flat Bkg ON</p></td>
<td><p>Flat Bkg OFF</p></td>
<td><p>Flat Bkg ON</p></td>
<td><p>Flat Bkg OFF</p></td>
<td><p>Flat Bkg ON</p></td>
<td><p>Flat Bkg ON</p></td>
</tr>
</tbody>
</table>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id17" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p>For usage of this algorithm as part of the direct geometry data reduction, check the examples <a class="reference internal" href="../techniques/DirectILL.html#directill"><span class="std std-ref">here</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - Usage as an advanced loader</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># It is recommended to use DirectILLCollectData over the basic Load</span>
<span class="n">preprocessed</span> <span class="o">=</span> <span class="n">DirectILLCollectData</span><span class="p">(</span><span class="s1">&#39;ILL/IN4/087294+087295.nxs&#39;</span><span class="p">)</span>
<span class="c1"># Compare to simply loading the data</span>
<span class="n">raw</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;ILL/IN4/087294+087295.nxs&#39;</span><span class="p">,</span> <span class="n">ConvertToTOF</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># The workspace loaded by &#39;Load&#39; includes monitor data which</span>
<span class="c1"># makes 2D plotting difficult</span>
<span class="n">nRaw</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of histograms in &#39;raw&#39;: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">())</span>
    <span class="o">+</span> <span class="s2">&quot;, and in &#39;preprocessed&#39;: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">preprocessed</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
<span class="c1"># Notably, DirectILLCollectData sets the workspace up such that conversion</span>
<span class="c1"># from TOF to wavelength produces the correct values</span>
<span class="n">preprocessed_wl</span> <span class="o">=</span> <span class="n">ConvertUnits</span><span class="p">(</span><span class="n">preprocessed</span><span class="p">,</span> <span class="s1">&#39;Wavelength&#39;</span><span class="p">)</span>
<span class="n">raw_wl</span> <span class="o">=</span> <span class="n">ConvertUnits</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="s1">&#39;Wavelength&#39;</span><span class="p">)</span>
<span class="c1"># Elastic peak is around channel 150</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelength from sample logs: </span><span class="si">{:.3}</span><span class="s1">A&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;wavelength&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;raw&#39; wavelength at channel 150: </span><span class="si">{:.3}</span><span class="s2">A (incorrect!)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">raw_wl</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">149</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;preprocessed&#39; wavelength at channel 150: </span><span class="si">{:.3}</span><span class="s2">A&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">preprocessed_wl</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">149</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Number of histograms in &#39;raw&#39;: 397, and in &#39;preprocessed&#39;: 396
Wavelength from sample logs: 3.06A
&#39;raw&#39; wavelength at channel 150: 1.64A (incorrect!)
&#39;preprocessed&#39; wavelength at channel 150: 3.04A
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/ILL/Direct.html">ILL\Direct</a> | <a class="reference external" href="categories/Inelastic/Reduction.html">Inelastic\Reduction</a> | <a class="reference external" href="categories/Workflow/Inelastic.html">Workflow\Inelastic</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/54a39e0a58206de8c1730bb3d0bdf337c05a00a9/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/DirectILLCollectData.py">DirectILLCollectData.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DirectILLAutoProcess-v1.html" title="Previous Chapter: DirectILLAutoProcess v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DirectILLAuto...</span>
    </a>
  </li>
  <li>
    <a href="DirectILLDiagnostics-v1.html" title="Next Chapter: DirectILLDiagnostics v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DirectILLDiag... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>