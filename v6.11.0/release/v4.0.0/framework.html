<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Framework Changes</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <script src="../../_static/documentation_options.js?v=06de18c4"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Indirect Inelastic Changes" href="indirect_inelastic.html" />
    <link rel="prev" title="Direct Inelastic Changes" href="direct_inelastic.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.11</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="../index.html" >Release Notes</a> &#187;</li>
          
            <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Mantid 4.0.0 Release Notes</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">Framework Changes</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="framework-changes">
<h1>Framework Changes<a class="headerlink" href="#framework-changes" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#logging" id="id2">Logging</a></p></li>
<li><p><a class="reference internal" href="#nexus-geometry-loading" id="id3">Nexus Geometry Loading</a></p></li>
<li><p><a class="reference internal" href="#instruments" id="id4">Instruments</a></p></li>
<li><p><a class="reference internal" href="#archive-searching" id="id5">Archive Searching</a></p>
<ul>
<li><p><a class="reference internal" href="#sns-oncat" id="id6">SNS / ONCat</a></p></li>
<li><p><a class="reference internal" href="#isis-icat" id="id7">ISIS / ICat</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#algorithms" id="id8">Algorithms</a></p>
<ul>
<li><p><a class="reference internal" href="#new-algorithms" id="id9">New Algorithms</a></p></li>
<li><p><a class="reference internal" href="#improvements" id="id10">Improvements</a></p></li>
<li><p><a class="reference internal" href="#bugfixes" id="id11">Bugfixes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#python" id="id12">Python</a></p>
<ul>
<li><p><a class="reference internal" href="#new" id="id13">New</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id14">Improvements</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="logging">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Logging</a><a class="headerlink" href="#logging" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>We have changed the logging in Mantid to stop writing the high level version of the log to a file.  This had been causing numerous problems including inconsistent behaviour with multiple instances of Mantid, performance problems when logging at detailed levels, and excessive network usage in some scenarios.  This does not change the rest of the logging that you see in the message display in Mantidplot or the console window. A warning message will appear if configuration for the removed components of logging is found.</p></li>
<li><p>Associated with this we have also simplified the python methods used to control logging.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The two methods</span>
<span class="n">ConfigService</span><span class="o">.</span><span class="n">SetConsoleLogLevel</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">ConfigService</span><span class="o">.</span><span class="n">SetFileLogLevel</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Have been replaced by</span>
<span class="n">ConfigService</span><span class="o">.</span><span class="n">SetLogLevel</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Increased the log level from information to notice when creating an instrument geometry.</p></li>
</ul>
</section>
<section id="nexus-geometry-loading">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Nexus Geometry Loading</a><a class="headerlink" href="#nexus-geometry-loading" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../../algorithms/LoadEmptyInstrument-v1.html#algm-loademptyinstrument"><span class="std std-ref">LoadEmptyInstrument</span></a> will now load instrument geometry from hdf5 <a class="reference external" href="https://www.nexusformat.org/">NeXus</a> format files. Files consistent with the standard following the introduction of <a class="reference external" href="http://download.nexusformat.org/sphinx/classes/base_classes/NXoff_geometry.html">NXoff_geometry</a> and <a class="reference external" href="http://download.nexusformat.org/sphinx/classes/base_classes/NXcylindrical_geometry.html">NXcylindrical_geometry</a> will be used to build the entire in-memory instrument geometry within Mantid. This IDF-free route is primarily envisioned for the ESS. While dependent on the instrument, we are overall seeing significant improvements in instrument load times over loading from equivalent IDF based implementations. <a class="reference internal" href="../../algorithms/LoadInstrument-v1.html#algm-loadinstrument"><span class="std std-ref">LoadInstrument</span></a> also supports the nexus geometry format in the same was as LoadEmptyInstrument.</p></li>
<li><p>The changes above have also been incorporated directly into <a class="reference internal" href="../../algorithms/LoadEventNexus-v1.html#algm-loadeventnexus"><span class="std std-ref">LoadEventNexus</span></a>, so it is possible to store data and geometry together for the first time in a NeXus compliant format for Mantid. These changes have made it possible to load experimental ESS event data files directly into Mantid.</p></li>
</ul>
</section>
<section id="instruments">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Instruments</a><a class="headerlink" href="#instruments" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>New helper function <cite>ExperimentInfo.getResourceFilenames</cite> returns a list of instrument definition files and/or parameter files in accordance to a query time stamp.</p></li>
<li><p>A bug has been fixed that caused each workspace to hold a separate copy of the instrument. In the case of large instruments such as WISH this added 200MB to each workspace, even in the case of a single spectrum workspace.</p></li>
</ul>
</section>
<section id="archive-searching">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Archive Searching</a><a class="headerlink" href="#archive-searching" title="Link to this heading">¶</a></h2>
<section id="sns-oncat">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">SNS / ONCat</a><a class="headerlink" href="#sns-oncat" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>SNS file searching has been moved to <a class="reference external" href="https://oncat.ornl.gov/">ONCAT</a>. Due to auto-updating of the <code class="docutils literal notranslate"><span class="pre">Facilities.xml</span></code>, this was done by directing <code class="docutils literal notranslate"><span class="pre">SNSDataSearch</span></code> and <code class="docutils literal notranslate"><span class="pre">ORNLDataSearch</span></code> to both use ONCAT.</p></li>
<li><p>For HFIR instruments that write out raw files with run numbers, we have enabled functionality that allows for the searching of file locations by making calls to ONCat.  To use this, make sure that the “Search Data Archive” option is checked in your “Manage User Directories” settings.  The <code class="docutils literal notranslate"><span class="pre">FileFinder</span></code> and algorithms such as <a class="reference internal" href="../../algorithms/Load-v1.html#algm-load"><span class="std std-ref">Load</span></a>  will then accept inputs such as “<code class="docutils literal notranslate"><span class="pre">HB2C_143210</span></code>”.</p></li>
</ul>
</section>
<section id="isis-icat">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">ISIS / ICat</a><a class="headerlink" href="#isis-icat" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>The path returned by ICat starting <code class="docutils literal notranslate"><span class="pre">\\isis\inst$</span></code> is now overridden by the fully-qualified path starting <code class="docutils literal notranslate"><span class="pre">\\isis.cclrc.ac.uk\inst$</span></code> on Windows machines. This makes accessing the archive more reliable over the VPN.</p></li>
<li><p>On Linux and Mac machines, it is overridden by a path starting <code class="docutils literal notranslate"><span class="pre">/archive</span></code>.</p></li>
<li><p>On all machines, you can override this locally by setting <code class="docutils literal notranslate"><span class="pre">icatDownload.mountPoint=&lt;my_path&gt;</span></code> in your <code class="docutils literal notranslate"><span class="pre">Mantid.user.properties</span></code> file.</p></li>
</ul>
</section>
</section>
<section id="algorithms">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Algorithms</a><a class="headerlink" href="#algorithms" title="Link to this heading">¶</a></h2>
<section id="new-algorithms">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">New Algorithms</a><a class="headerlink" href="#new-algorithms" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../../algorithms/DeadTimeCorrection-v1.html#algm-deadtimecorrection"><span class="std std-ref">DeadTimeCorrection</span></a> will correct for the detector dead time.</p></li>
<li><p><a class="reference internal" href="../../algorithms/CalculateDynamicRange-v1.html#algm-calculatedynamicrange"><span class="std std-ref">CalculateDynamicRange</span></a> will calculate the Q range of a SANS workspace.</p></li>
<li><p><a class="reference internal" href="../../algorithms/MatchSpectra-v1.html#algm-matchspectra"><span class="std std-ref">MatchSpectra</span></a> is an algorithm that calculates factors to match all spectra to a reference spectrum.</p></li>
<li><p><a class="reference internal" href="../../algorithms/MaskBinsIf-v1.html#algm-maskbinsif"><span class="std std-ref">MaskBinsIf</span></a> is an algorithm to mask bins according to criteria specified as a muparser expression.</p></li>
<li><p><a class="reference internal" href="../../algorithms/MaskNonOverlappingBins-v1.html#algm-masknonoverlappingbins"><span class="std std-ref">MaskNonOverlappingBins</span></a> masks the bins that do not overlap with another workspace.</p></li>
<li><p><a class="reference internal" href="../../algorithms/LoadSampleEnvironment-v1.html#algm-loadsampleenvironment"><span class="std std-ref">LoadSampleEnvironment</span></a> loads or adds to a sample environment from a .stl file, as well as allowing setting the material of the environment to load.</p></li>
<li><p><a class="reference internal" href="../../algorithms/ParallaxCorrection-v1.html#algm-parallaxcorrection"><span class="std std-ref">ParallaxCorrection</span></a> will perform a geometric correction for the so-called parallax effect in tube based SANS detectors.</p></li>
<li><p><a class="reference internal" href="../../algorithms/CalculateEfficiencyCorrection-v1.html#algm-calculateefficiencycorrection"><span class="std std-ref">CalculateEfficiencyCorrection</span></a> will calculate a detection efficiency correction with multiple and flexible inputs for calculation.</p></li>
<li><p><a class="reference internal" href="../../algorithms/LinkedUBs-v1.html#algm-linkedubs"><span class="std std-ref">LinkedUBs</span></a> is an algorithm that ensures continuity of indexing across single crystal runs, as well as indirectly performing a U matrix correction for mis-centered samples or cases where there is error in the gonio angles. Results in a separate UB for each run when used on a whole dataset.</p></li>
<li><p><a class="reference internal" href="../../algorithms/CopyDataRange-v1.html#algm-copydatarange"><span class="std std-ref">CopyDataRange</span></a> will replace a block of data in a destination workspace with a continuous block of data from an input workspace.</p></li>
<li><p><a class="reference internal" href="../../algorithms/CalculateFlux-v1.html#algm-calculateflux"><span class="std std-ref">CalculateFlux</span></a> computes the incident flux wavelength profile using an empty beam SANS measurement.</p></li>
</ul>
</section>
<section id="improvements">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Improvements</a><a class="headerlink" href="#improvements" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../../algorithms/CompressEvents-v1.html#algm-compressevents"><span class="std std-ref">CompressEvents</span></a> now correctly sets the weighted events x-value (i.e. time-of-flight)</p></li>
<li><p><a class="reference internal" href="../../algorithms/AppendSpectra-v1.html#algm-appendspectra"><span class="std std-ref">AppendSpectra</span></a> can append now multiple times the same event workspace.</p></li>
<li><p><a class="reference internal" href="../../algorithms/ConjoinXRuns-v1.html#algm-conjoinxruns"><span class="std std-ref">ConjoinXRuns</span></a> can merge sample logs according to the parameter file independently from <a class="reference internal" href="../../algorithms/MergeRuns-v1.html#algm-mergeruns"><span class="std std-ref">MergeRuns</span></a>. All parameter names must have the prefix <code class="docutils literal notranslate"><span class="pre">conjoin_</span></code> appended by the corresponding default parameter names (which are used by <a class="reference internal" href="../../algorithms/MergeRuns-v1.html#algm-mergeruns"><span class="std std-ref">MergeRuns</span></a>).</p></li>
<li><p><a class="reference internal" href="../../algorithms/CropToComponent-v1.html#algm-croptocomponent"><span class="std std-ref">CropToComponent</span></a> now supports scanning workspaces.</p></li>
<li><p><a class="reference internal" href="../../algorithms/SumOverlappingTubes-v1.html#algm-sumoverlappingtubes"><span class="std std-ref">SumOverlappingTubes</span></a> will produce histogram data, and will not split the counts between bins by default.</p></li>
<li><p><a class="reference internal" href="../../algorithms/SumSpectra-v1.html#algm-sumspectra"><span class="std std-ref">SumSpectra</span></a> has an additional option, <code class="docutils literal notranslate"><span class="pre">MultiplyBySpectra</span></code>, which controls whether or not the output spectra are multiplied by the number of bins. This property should be set to <code class="docutils literal notranslate"><span class="pre">False</span></code> for summing spectra as PDFgetN does.</p></li>
<li><p><a class="reference internal" href="../../algorithms/StartLiveData-v1.html#algm-startlivedata"><span class="std std-ref">Live Data</span></a> for events with <code class="docutils literal notranslate"><span class="pre">PreserveEvents=True</span></code> now produces workspaces that have bin boundaries which encompass the total x-range (TOF) for all events across all spectra if the data was not binned during the process step.</p></li>
<li><p><a class="reference internal" href="../../algorithms/RebinToWorkspace-v1.html#algm-rebintoworkspace"><span class="std std-ref">RebinToWorkspace</span></a> now checks if the <code class="docutils literal notranslate"><span class="pre">WorkspaceToRebin</span></code> and <code class="docutils literal notranslate"><span class="pre">WorkspaceToMatch</span></code> already have the same binning. Added support for ragged workspaces.</p></li>
<li><p><a class="reference internal" href="../../algorithms/GroupWorkspaces-v1.html#algm-groupworkspaces"><span class="std std-ref">GroupWorkspaces</span></a> supports glob patterns for matching workspaces in the ADS.</p></li>
<li><p><a class="reference internal" href="../../algorithms/LoadSampleShape-v1.html#algm-loadsampleshape-v1"><span class="std std-ref">LoadSampleShape</span></a> now supports loading from binary .stl files.</p></li>
<li><p><a class="reference internal" href="../../algorithms/MaskDetectorsIf-v1.html#algm-maskdetectorsif"><span class="std std-ref">MaskDetectorsIf</span></a> now supports masking a workspace in addition to writing the masking information to a calfile.</p></li>
<li><p><a class="reference internal" href="../../algorithms/ApplyDetectorScanEffCorr-v1.html#algm-applydetectorscaneffcorr"><span class="std std-ref">ApplyDetectorScanEffCorr</span></a> will correctly propagate the masked bins in the calibration map to the output workspace.</p></li>
<li><p><a class="reference internal" href="../../algorithms/LoadNexusLogs-v1.html#algm-loadnexuslogs-v1"><span class="std std-ref">LoadNexusLogs</span></a> now will load files that have 1D arrays for each time value in the logs, but will not load this data.</p></li>
<li><p><a class="reference internal" href="../../algorithms/GroupDetectors-v2.html#algm-groupdetectors"><span class="std std-ref">GroupDetectors</span></a> now takes masked bins correctly into account when processing histogram workspaces.</p></li>
<li><p><a class="reference internal" href="../../algorithms/SaveNexusProcessed-v1.html#algm-savenexusprocessed"><span class="std std-ref">SaveNexusProcessed</span></a> and <a class="reference internal" href="../../algorithms/LoadNexusProcessed-v2.html#algm-loadnexusprocessed"><span class="std std-ref">LoadNexusProcessed</span></a> can now save and load a <code class="docutils literal notranslate"><span class="pre">MaskWorkspace</span></code>.</p></li>
<li><p><a class="reference internal" href="../../algorithms/ConvertToMD-v1.html#algm-converttomd"><span class="std std-ref">ConvertToMD</span></a> now has <cite>ConverterType = {Default, Indexed}</cite> setting: <cite>Default</cite> keeps the old
(see <a class="reference internal" href="../../algorithms/ConvertToMD-v1.html#algm-converttomd"><span class="std std-ref">ConvertToMD</span></a> Notes).</p></li>
<li><p><a class="reference internal" href="../../algorithms/FitPeaks-v1.html#algm-fitpeaks"><span class="std std-ref">FitPeaks</span></a> can output parameters’ uncertainty (fitting error) in an optional workspace.</p></li>
<li><p><a class="reference internal" href="../../algorithms/SaveNXcanSAS-v1.html#algm-savenxcansas"><span class="std std-ref">SaveNXcanSAS</span></a> now has <cite>uncertainties</cite> parameter as well as <cite>uncertainty</cite>. They point to the same data. Having both tags makes output compatible with various interpretations of the standards.</p></li>
<li><p>The documentation in <a class="reference internal" href="../../concepts/EventFiltering.html#eventfiltering"><span class="std std-ref">Event Filtering</span></a> and <a class="reference internal" href="../../algorithms/FilterEvents-v1.html#algm-filterevents"><span class="std std-ref">FilterEvents</span></a> have been extensively rewritten to aid in understanding what the code does.</p></li>
<li><p>All of the numerical integration based absorption corrections which use <a class="reference internal" href="../../algorithms/AbsorptionCorrection-v1.html#algm-absorptioncorrection"><span class="std std-ref">AbsorptionCorrection</span></a> will generate an exception when they fail to generate a gauge volume. Previously, they would silently generate a correction workspace that was all not-a-number (<code class="docutils literal notranslate"><span class="pre">NAN</span></code>). If the sample shape is a cylinder it will use the specialized code for rasterizing it.</p></li>
<li><p><a class="reference internal" href="../../algorithms/CylinderAbsorption-v1.html#algm-cylinderabsorption"><span class="std std-ref">CylinderAbsorption</span></a> now will check the workspace’s sample object for geometry.</p></li>
<li><p>Various clarifications and additional links in the geometry and material documentation pages.</p></li>
<li><p><a class="reference internal" href="../../algorithms/SetSample-v1.html#algm-setsample"><span class="std std-ref">SetSample</span></a> and <a class="reference internal" href="../../algorithms/SetSampleMaterial-v1.html#algm-setsamplematerial"><span class="std std-ref">SetSampleMaterial</span></a> now accept materials without <code class="docutils literal notranslate"><span class="pre">ChemicalFormula</span></code> or <code class="docutils literal notranslate"><span class="pre">AtomicNumber</span></code>. In this case, all cross sections and <code class="docutils literal notranslate"><span class="pre">SampleNumberDensity</span></code> have to be given.</p></li>
<li><p><a class="reference internal" href="../../algorithms/SetSampleMaterial-v1.html#algm-setsamplematerial"><span class="std std-ref">SetSampleMaterial</span></a> and <a class="reference internal" href="../../algorithms/LoadSampleEnvironment-v1.html#algm-loadsampleenvironment"><span class="std std-ref">LoadSampleEnvironment</span></a> accept number densities as formula units per cubic Ångström in addition to atoms per cubic Ångström.</p></li>
<li><p><a class="reference internal" href="../../algorithms/LoadEventNexus-v1.html#algm-loadeventnexus"><span class="std std-ref">LoadEventNexus</span></a> experimental option <cite>LoadType</cite> = <cite>{Default, Multiprocess}</cite> is added, <cite>Multiprocess</cite> should work faster for big files and it is experimental, available only in Linux.</p></li>
<li><p>The history generated from a call to <a class="reference internal" href="../../algorithms/SetSample-v1.html#algm-setsample"><span class="std std-ref">SetSample</span></a> can now be re-executed without error.</p></li>
<li><p><a class="reference internal" href="../../algorithms/MonteCarloAbsorption-v1.html#algm-montecarloabsorption"><span class="std std-ref">MonteCarloAbsorption</span></a> no more fails with ‘Unable to generate point in object’ errors if the sample shape is cuboid, cylinder, or sphere.</p></li>
<li><p>Changes in <a class="reference internal" href="../../algorithms/Q1DWeighted-v1.html#algm-q1dweighted"><span class="std std-ref">Q1DWeighted</span></a>:</p>
<ul>
<li><p>Significant speedup for TOF mode due to reorganization of the code.</p></li>
<li><p>An option for asymmetric wedges for an anisotropic scatterer</p></li>
<li><p>The bins masked in the input will be discarded from the calculation</p></li>
<li><p>An option to account for the nominal gravity drop</p></li>
</ul>
</li>
</ul>
</section>
<section id="bugfixes">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Bugfixes</a><a class="headerlink" href="#bugfixes" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../../algorithms/SaveGDA-v1.html#algm-savegda"><span class="std std-ref">SaveGDA</span></a> Now takes a parameter of OutputFilename instead of Filename to better match with similar algorithms.</p></li>
<li><p>Bugfix in <a class="reference internal" href="../../algorithms/ConvertToMatrixWorkspace-v1.html#algm-converttomatrixworkspace"><span class="std std-ref">ConvertToMatrixWorkspace</span></a> with <code class="docutils literal notranslate"><span class="pre">Workspace2D</span></code> as the <code class="docutils literal notranslate"><span class="pre">InputWorkspace</span></code> not being cloned to the <code class="docutils literal notranslate"><span class="pre">OutputWorkspace</span></code>. Added support for ragged workspaces.</p></li>
<li><p><a class="reference internal" href="../../algorithms/SolidAngle-v1.html#algm-solidangle-v1"><span class="std std-ref">SolidAngle</span></a> Now properly accounts for a given StartWorkspaceIndex.</p></li>
<li><p><a class="reference internal" href="../../algorithms/FilterEvents-v1.html#algm-filterevents-v1"><span class="std std-ref">FilterEvents</span></a> output workspaces now contain the goniometer.</p></li>
<li><p>Fixed an issue where a workspace’s history wouldn’t update for some algorithms.</p></li>
<li><p>Fixed a <code class="docutils literal notranslate"><span class="pre">std::bad_cast</span></code> error in <a class="reference internal" href="../../algorithms/LoadLiveData-v1.html#algm-loadlivedata"><span class="std std-ref">LoadLiveData v1</span></a> when the data size changes.</p></li>
<li><p><a class="reference internal" href="../../algorithms/Fit-v1.html#algm-fit"><span class="std std-ref">Fit</span></a> now applies the ties in correct order independently on the order they are set. If any circular dependencies are found Fit will give an error.</p></li>
<li><p>Fixed a rare bug in <a class="reference internal" href="../../algorithms/MaskDetectors-v1.html#algm-maskdetectors"><span class="std std-ref">MaskDetectors</span></a> where a workspace could become invalidated in Python if it was a <code class="docutils literal notranslate"><span class="pre">MaskWorkspace</span></code>.</p></li>
<li><p>Fixed a crash in <a class="reference internal" href="../../algorithms/MaskDetectors-v1.html#algm-maskdetectors"><span class="std std-ref">MaskDetectors</span></a> when a non-existent component was given in <code class="docutils literal notranslate"><span class="pre">ComponentList</span></code>.</p></li>
<li><p>The output workspace now keeps the units of the input workspace for all sample log entries of algorithms <a class="reference internal" href="../../algorithms/MergeRuns-v1.html#algm-mergeruns"><span class="std std-ref">MergeRuns</span></a> and <a class="reference internal" href="../../algorithms/ConjoinXRuns-v1.html#algm-conjoinxruns"><span class="std std-ref">ConjoinXRuns</span></a>.</p></li>
<li><p>History for algorithms that took groups sometimes would get incorrect history causing history to be incomplete, so now full group history is saved for all items belonging to the group.</p></li>
<li><p>Fixed a bug in <a class="reference internal" href="../../algorithms/SetGoniometer-v1.html#algm-setgoniometer"><span class="std std-ref">SetGoniometer</span></a> where it would use the mean log value rather than the time series average value for goniometer angles.</p></li>
<li><p>Fixed a bug in <a class="reference internal" href="../../algorithms/AlignAndFocusPowderFromFiles-v1.html#algm-alignandfocuspowderfromfiles"><span class="std std-ref">AlignAndFocusPowderFromFiles</span></a> for using the passed on CompressTolerance and CompressWallClockTolerance in the child <a class="reference internal" href="../../algorithms/CompressEvents-v1.html#algm-compressevents"><span class="std std-ref">CompressEvents</span></a> algorithm instead of just in the child <a class="reference internal" href="../../algorithms/AlignAndFocusPowder-v1.html#algm-alignandfocuspowder"><span class="std std-ref">AlignAndFocusPowder</span></a> algorithm.</p></li>
<li><p><a class="reference internal" href="../../algorithms/ConvertToMD-v1.html#algm-converttomd"><span class="std std-ref">ConvertToMD</span></a> now uses the time-average value for logs when using them as <code class="docutils literal notranslate"><span class="pre">OtherDimensions</span></code>.</p></li>
<li><p>The input validator is fixed in <a class="reference internal" href="../../algorithms/MostLikelyMean-v1.html#algm-mostlikelymean"><span class="std std-ref">MostLikelyMean</span></a> avoiding a segmentation fault.</p></li>
<li><p>The inputs of the algorithm <a class="reference internal" href="../../algorithms/MergeLogs-v1.html#algm-mergelogs"><span class="std std-ref">MergeLogs</span></a> are improved and a segmentation fault will not happen, if logs are not time series. The merging is now compliant with Mantid wide time series merging for example when adding workspaces.</p></li>
<li><p>Fixed a bug in <a class="reference internal" href="../../algorithms/AlignAndFocusPowder-v1.html#algm-alignandfocuspowder"><span class="std std-ref">AlignAndFocusPowder</span></a> where a histogram input workspace did not clone propertly to the output workspace and properly masking a grouping workspace passed to <a class="reference internal" href="../../algorithms/DiffractionFocussing-v2.html#algm-diffractionfocussing"><span class="std std-ref">DiffractionFocussing</span></a>. Also adds initial unit tests for <a class="reference internal" href="../../algorithms/AlignAndFocusPowder-v1.html#algm-alignandfocuspowder"><span class="std std-ref">AlignAndFocusPowder</span></a>.</p></li>
<li><p>Fixed a bug in <a class="reference internal" href="../../algorithms/ExtractSpectra-v1.html#algm-extractspectra"><span class="std std-ref">ExtractSpectra</span></a> which was causing a wrong last value in the output’s vertical axis if the axis type was <code class="docutils literal notranslate"><span class="pre">BinEdgeAxis</span></code>.</p></li>
<li><p>Fixed an issue in <a class="reference internal" href="../../algorithms/Rebin2D-v1.html#algm-rebin2d"><span class="std std-ref">Rebin2D</span></a> where <cite>NaN</cite> values would result if there were zero-area bins in the input workspace.</p></li>
<li><p>Fixed the <cite>CheckSample</cite> option of algorithm <a class="reference internal" href="../../algorithms/CompareWorkspaces-v1.html#algm-compareworkspaces"><span class="std std-ref">CompareWorkspaces</span></a>: it crashed Mantid when comparing the run’s sample logs. The algorithm’s debug logging will now tell explicitly about the first entry which caused the log mismatch.</p></li>
<li><p>Fixed a bug in <a class="reference internal" href="../../algorithms/MayersSampleCorrection-v1.html#algm-mayerssamplecorrection"><span class="std std-ref">MayersSampleCorrection</span></a> when using the multiple scattering correction.</p></li>
<li><p>Fixed a bug in <a class="reference internal" href="../../algorithms/IntegrateMDHistoWorkspace-v1.html#algm-integratemdhistoworkspace"><span class="std std-ref">IntegrateMDHistoWorkspace</span></a> in some cases where NaN’s are present outside the integration range.</p></li>
<li><p><a class="reference internal" href="../../algorithms/SaveNexusProcessed-v1.html#algm-savenexusprocessed"><span class="std std-ref">SaveNexusProcessed</span></a> and <a class="reference internal" href="../../algorithms/LoadNexusProcessed-v2.html#algm-loadnexusprocessed"><span class="std std-ref">LoadNexusProcessed</span></a> now save and load an empty sample name correctly. Note, that files saved before this change will still load with an empty sample name replaced by a space as before.</p></li>
<li><p>Fixed a bug in <a class="reference internal" href="../../fitting/fitfunctions/IkedaCarpenterPV.html#func-ikedacarpenterpv"><span class="std std-ref">IkedaCarpenterPV</span></a> where a sign in zv was different from <a class="reference external" href="http://www.ccp14.ac.uk/ccp/web-mirrors/plotr/Tutorials&amp;Documents/TOF_FullProf.pdf">FullProf NPROF=13</a>.</p></li>
<li><p><a class="reference internal" href="../../algorithms/SaveNexusProcessed-v1.html#algm-savenexusprocessed"><span class="std std-ref">SaveNexusProcessed</span></a> now save and load spectrum numbers even when histograms have no detectors.</p></li>
<li><p><a class="reference internal" href="../../algorithms/SavePlot1D-v1.html#algm-saveplot1d"><span class="std std-ref">SavePlot1D</span></a> has been updated to follow changes to the plotly api.</p></li>
<li><p><a class="reference internal" href="../../algorithms/LoadAndMerge-v1.html#algm-loadandmerge"><span class="std std-ref">LoadAndMerge</span></a> allows now international execution.</p></li>
</ul>
</section>
</section>
<section id="python">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Python</a><a class="headerlink" href="#python" title="Link to this heading">¶</a></h2>
<section id="new">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">New</a><a class="headerlink" href="#new" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>All python methods accepting basic strings now also accept unicode strings.</p></li>
<li><p>New python validator type: <a class="reference internal" href="../../api/python/mantid/geometry/OrientedLattice.html#mantid.geometry.OrientedLattice" title="mantid.geometry.OrientedLattice"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrientedLattice</span></code></a> checks whether a workspace has an oriented lattice object attached.</p></li>
<li><p>The windows python bundle now includes numpy=1.15.4, scipy=1.1.0, matplotlib=2.2.3, pip=18.1</p></li>
<li><p>We have been making major performance improvements to geometry access in Mantid over the last few releases. We are now exposing these features via Python to give our users direct access to the same benefits as part of their scripts. The newly exposed objects are now available via workspaces and include:</p>
<ul>
<li><p><a class="reference internal" href="../../api/python/mantid/geometry/ComponentInfo.html#mantid.geometry.ComponentInfo" title="mantid.geometry.ComponentInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">mantid.geometry.ComponentInfo</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/python/mantid/geometry/DetectorInfo.html#mantid.geometry.DetectorInfo" title="mantid.geometry.DetectorInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">mantid.geometry.DetectorInfo</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/python/mantid/api/SpectrumInfo.html#mantid.api.SpectrumInfo" title="mantid.api.SpectrumInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">mantid.api.SpectrumInfo</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="../../api/python/mantid/geometry/ComponentInfo.html#mantid.geometry.ComponentInfo" title="mantid.geometry.ComponentInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">mantid.geometry.ComponentInfo</span></code></a> is exposed to allow the user to access geometric information about the components which are part of a beamline. Iterator support is also provided via python.</p></li>
<li><p><a class="reference internal" href="../../api/python/mantid/geometry/DetectorInfo.html#mantid.geometry.DetectorInfo" title="mantid.geometry.DetectorInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">mantid.geometry.DetectorInfo</span></code></a> offers the user the ability to access geometric information about the detector(s) which are part of a beamline. <code class="docutils literal notranslate"><span class="pre">DetectorInfo</span></code> has also been given a python iterator.</p></li>
<li><p><a class="reference internal" href="../../api/python/mantid/api/SpectrumInfo.html#mantid.api.SpectrumInfo" title="mantid.api.SpectrumInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">mantid.api.SpectrumInfo</span></code></a> allows the user to access information about the spectra being used in a beamline. <code class="docutils literal notranslate"><span class="pre">SpectrumInfo</span></code> has also been given an iterator to allow users to write more Pythonic loops rather than normal index based loops. In addition to this <code class="docutils literal notranslate"><span class="pre">SpectrumDefinition</span></code> objects can also be accessed via a <a class="reference internal" href="../../api/python/mantid/api/SpectrumInfo.html#mantid.api.SpectrumInfo" title="mantid.api.SpectrumInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">mantid.api.SpectrumInfo</span></code></a> object. The <code class="docutils literal notranslate"><span class="pre">SpectrumDefinition</span></code> object can be used to obtain information about the spectrum to detector mapping and provides a definition of what a spectrum comprises, i.e. indices of all detectors that contribute to the data stored in the spectrum.</p></li>
<li><p>Added new <a class="reference internal" href="../../concepts/UnitFactory.html#unit-factory"><span class="std std-ref">unit</span></a> called <code class="docutils literal notranslate"><span class="pre">Temperature</span></code> which has units of Kelvin.</p></li>
<li><p>Importing <code class="docutils literal notranslate"><span class="pre">mantid</span></code> no longer initializes the <code class="docutils literal notranslate"><span class="pre">FrameworkManager</span></code>. This allows separate classes to be imported without requiring a long delay in waiting for the framework to start. Amongst other things this allows the application name to be set correctly:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mantid</span> <span class="kn">import</span> <span class="n">FrameworkManager</span><span class="p">,</span> <span class="n">UsageService</span>
<span class="n">UsageService</span><span class="o">.</span><span class="n">setApplicationName</span><span class="p">(</span><span class="s1">&#39;myapp&#39;</span><span class="p">)</span>
<span class="n">FrameworkManager</span><span class="o">.</span><span class="n">Instance</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">FileFinder.findRuns</span></code> now optionally accepts a list of file extensions to search, called <code class="docutils literal notranslate"><span class="pre">exts</span></code>, and a boolean flag <code class="docutils literal notranslate"><span class="pre">useExtsOnly</span></code>. If this flag is True, FileFinder will search for the passed in extensions ONLY. If it is False, it will search for passed in extensions and then facility extensions.</p></li>
</ul>
</section>
<section id="id1">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Improvements</a><a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../../fitting/fitfunctions/ChudleyElliot.html#func-chudleyelliot"><span class="std std-ref">ChudleyElliot</span></a> includes hbar in the definition.</p></li>
<li><p>The calculations for <a class="reference internal" href="../../api/python/mantid/kernel/Material.html#mantid.kernel.Material" title="mantid.kernel.Material"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mantid.kernel.Material</span></code></a> have been changed to match the equations in Sears, Varley F. “Neutron scattering lengths and cross sections.” Neutron News 3.3 (1992): 26-37</p></li>
<li><p><a class="reference internal" href="../../concepts/FitFunctionsInPython.html#fitfunctionsinpython"><span class="std std-ref">Functions</span></a> may now have their constraint penalties for fitting set in python using <code class="docutils literal notranslate"><span class="pre">function.setConstraintPenaltyFactor(&quot;parameterName&quot;,</span> <span class="pre">double)</span></code>.</p></li>
<li><p><a class="reference internal" href="../../api/python/mantid/kernel/Logger.html#mantid.kernel.Logger" title="mantid.kernel.Logger"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mantid.kernel.Logger</span></code></a> now handles unicode in python2.</p></li>
<li><p><a class="reference internal" href="../../api/python/mantid/api/ITableWorkspace.html#mantid.api.ITableWorkspace.columnTypes" title="mantid.api.ITableWorkspace.columnTypes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mantid.api.ITableWorkspace.columnTypes()</span></code></a> now returns human readable strings for non-primitive column types.</p></li>
<li><p>It is now possible to build custom materials with <a class="reference internal" href="../../api/python/mantid/kernel/MaterialBuilder.html#mantid.kernel.MaterialBuilder" title="mantid.kernel.MaterialBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">mantid.kernel.MaterialBuilder</span></code></a> without setting a formula or atomic number. In this case, all cross sections and number density have to be given.</p></li>
<li><p>Python plotting now handles <cite>twinx</cite> and <cite>twiny</cite> axes for workspaces.</p></li>
<li><p><a class="reference internal" href="../../api/python/mantid/kernel/MaterialBuilder.html#mantid.kernel.MaterialBuilder" title="mantid.kernel.MaterialBuilder"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mantid.kernel.MaterialBuilder</span></code></a> now supports number densities in formula units per cubic Ångström.</p></li>
<li><p>IPython on Windows has been upgraded to v5.8.0. This is the last version that supports Python 2.</p></li>
</ul>
<p><a class="reference internal" href="index.html#v4-0-0"><span class="std std-ref">Release 4.0.0</span></a></p>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="direct_inelastic.html" title="Previous Chapter: Direct Inelastic Changes"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Direct Inelas...</span>
    </a>
  </li>
  <li>
    <a href="indirect_inelastic.html" title="Next Chapter: Indirect Inelastic Changes"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Indirect Inel... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>