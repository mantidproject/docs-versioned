<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ParallaxCorrection v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=06de18c4"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pause v1" href="Pause-v1.html" />
    <link rel="prev" title="PaddingAndApodization v1" href="PaddingAndApodization-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.11</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">ParallaxCorrection v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="parallaxcorrection-v1">
<span id="algm-parallaxcorrection"></span><span id="algm-parallaxcorrection-v1"></span><h1>ParallaxCorrection v1<a class="headerlink" href="#parallaxcorrection-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id2">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id3">Description</a></p></li>
<li><p><a class="reference internal" href="#example-of-adding-parameters-in-the-ipf" id="id4">Example of adding parameters in the IPF</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id5">Usage</a></p></li>
<li><p><a class="reference internal" href="#example-of-correction" id="id6">Example of correction</a></p></li>
<li><p><a class="reference internal" href="#source" id="id7">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Performs parallax correction for tube based SANS instruments.</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>An input workspace.</p></td>
</tr>
<tr class="row-odd"><td><p>ComponentNames</p></td>
<td><p>Input</p></td>
<td><p>str list</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>List of instrument components to perform the corrections for.</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>An output workspace.</p></td>
</tr>
<tr class="row-odd"><td><p>AngleOffsets</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>0</p></td>
<td><p>The values of offset angles [degrees] to be subtracted from the scattering angle (per component).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This algorithm performs a geometrical correction for the so-called parallax effect in tube based SANS instruments.</p>
<p>The correction formula must be specified in the <a class="reference internal" href="../concepts/InstrumentParameterFile.html#instrumentparameterfile"><span class="std std-ref">IPF</span></a> as follows:</p>
<ul class="simple">
<li><p>A string parameter named <strong>direction</strong> must hold <strong>x</strong> or <strong>y</strong> which is the direction of the tubes in the detector.</p></li>
<li><p>A string parameter named <strong>parallax</strong> must hold the <a class="reference external" href="http://beltoforion.de/article.php?a=muparser">muparser</a> expression, where <strong>t</strong> is reserved for the parallax angle:</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(t = \arctan(\frac{x}{z})\)</span> if direction is <strong>y</strong>, and <span class="math notranslate nohighlight">\(t = \arctan(\frac{y}{z})\)</span> if direction is <strong>x</strong>.</p>
<p><span class="math notranslate nohighlight">\(x, y, z\)</span> are the coordinates of the detector pixel in the system where sample is at <span class="math notranslate nohighlight">\(0,0,0\)</span> and <span class="math notranslate nohighlight">\(z\)</span> is the beam axis.
<span class="math notranslate nohighlight">\(t \in (0,\frac{\pi}{2})\)</span> in radians.</p>
<p>The correction will be calculated for each pixel and the input data will be divided by the correction and stored in the output.</p>
<p>The instrument parameters must be defined for detector components and without loss of generality, different components can have different formulae.</p>
<p>At least one component name must be given as input.</p>
</section>
<section id="example-of-adding-parameters-in-the-ipf">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Example of adding parameters in the IPF</a><a class="headerlink" href="#example-of-adding-parameters-in-the-ipf" title="Link to this heading">¶</a></h2>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;component-link</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;some_bank&quot;</span><span class="nt">&gt;</span>

<span class="w">  </span><span class="nt">&lt;parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;parallax&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Normally, the function would be increasing with t --&gt;</span>
<span class="w">    </span><span class="nt">&lt;value</span><span class="w"> </span><span class="na">val=</span><span class="s">&quot;1 + 0.01 * t&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/parameter&gt;</span>

<span class="w">  </span><span class="nt">&lt;parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;direction&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;value</span><span class="w"> </span><span class="na">val=</span><span class="s">&quot;x&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/parameter&gt;</span>

<span class="nt">&lt;/component-link&gt;</span>
</pre></div>
</div>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - ParallaxCorrection</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">XMin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">XMax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">BinWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s2">&quot;One Peak&quot;</span><span class="p">,</span> <span class="n">XUnit</span><span class="o">=</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">)</span>
<span class="n">SetInstrumentParameter</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">ParameterName</span><span class="o">=</span><span class="s2">&quot;direction&quot;</span><span class="p">,</span> <span class="n">ComponentName</span><span class="o">=</span><span class="s2">&quot;bank1&quot;</span><span class="p">,</span> <span class="n">ParameterType</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="n">Value</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">SetInstrumentParameter</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">ParameterName</span><span class="o">=</span><span class="s2">&quot;parallax&quot;</span><span class="p">,</span> <span class="n">ComponentName</span><span class="o">=</span><span class="s2">&quot;bank1&quot;</span><span class="p">,</span> <span class="n">ParameterType</span><span class="o">=</span><span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="n">Value</span><span class="o">=</span><span class="s2">&quot;1+0.1*t&quot;</span><span class="p">)</span>
<span class="n">ParallaxCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">ComponentNames</span><span class="o">=</span><span class="s2">&quot;bank1&quot;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">)</span>
<span class="n">Divide</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;corr&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The correction is </span><span class="si">{0:.4f}</span><span class="s2"> for the spectrum </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s2">&quot;corr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">1000</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The correction is 1.0016 for the spectrum 1000
</pre></div>
</div>
</section>
<section id="example-of-correction">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Example of correction</a><a class="headerlink" href="#example-of-correction" title="Link to this heading">¶</a></h2>
<p>Below is an example of the corrections for the instrument D22. The tubes are vertical, the magnitude depends only on the horizontal coordinate.
The correction increases with increasing angle from the beam, reaching about 10% for the outmost tube for detector distance of 1.5 meters.</p>
<figure class="align-default">
<img alt="../_images/parallax.png" src="../_images/parallax.png" />
</figure>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/SANS.html">SANS</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c66b9d75d3432a3fcde604fac070fd25fe61daf8/Framework/Algorithms/inc/MantidAlgorithms/ParallaxCorrection.h">ParallaxCorrection.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c66b9d75d3432a3fcde604fac070fd25fe61daf8/Framework/Algorithms/src/ParallaxCorrection.cpp">ParallaxCorrection.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="PaddingAndApodization-v1.html" title="Previous Chapter: PaddingAndApodization v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; PaddingAndApo...</span>
    </a>
  </li>
  <li>
    <a href="Pause-v1.html" title="Next Chapter: Pause v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Pause v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>