<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>CalculateEfficiencyCorrection v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=06de18c4"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CalculateFlatBackground v1" href="CalculateFlatBackground-v1.html" />
    <link rel="prev" title="CalculateEfficiency v2" href="CalculateEfficiency-v2.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.11</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">CalculateEfficiencyCorrection v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="calculateefficiencycorrection-v1">
<span id="algm-calculateefficiencycorrection"></span><span id="algm-calculateefficiencycorrection-v1"></span><h1>CalculateEfficiencyCorrection v1<a class="headerlink" href="#calculateefficiencycorrection-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id12">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id13">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id14">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id15">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id16">Usage</a></p></li>
<li><p><a class="reference internal" href="#references" id="id17">References</a></p></li>
<li><p><a class="reference internal" href="#source" id="id18">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Calculate an efficiency correction using various inputs. Can be used to determine                 an incident spectrum after correcting a measured spectrum from beam monitors                 or vanadium measurements.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="He3TubeEfficiency-v1.html#algm-he3tubeefficiency"><span class="std std-ref">He3TubeEfficiency</span></a>, <a class="reference internal" href="CalculateSampleTransmission-v1.html#algm-calculatesampletransmission"><span class="std std-ref">CalculateSampleTransmission</span></a>, <a class="reference internal" href="DetectorEfficiencyCor-v1.html#algm-detectorefficiencycor"><span class="std std-ref">DetectorEfficiencyCor</span></a>, <a class="reference internal" href="DetectorEfficiencyCorUser-v1.html#algm-detectorefficiencycoruser"><span class="std std-ref">DetectorEfficiencyCorUser</span></a>, <a class="reference internal" href="CalculateEfficiency-v2.html#algm-calculateefficiency"><span class="std std-ref">CalculateEfficiency</span></a>, <a class="reference internal" href="ComputeCalibrationCoefVan-v1.html#algm-computecalibrationcoefvan"><span class="std std-ref">ComputeCalibrationCoefVan</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>Input workspace with wavelength range to calculate for the correction.</p></td>
</tr>
<tr class="row-odd"><td><p>WavelengthRange</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Wavelength range to calculate efficiency for.</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Output workspace for the efficiency correction.                  This can be applied by multiplying the OutputWorkspace                  to the workspace that requires the correction.</p></td>
</tr>
<tr class="row-odd"><td><p>ChemicalFormula</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>None</p></td>
<td><p>Sample chemical formula used to determine cross-section term.</p></td>
</tr>
<tr class="row-even"><td><p>DensityType</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Mass Density</p></td>
<td><p>Use of Mass density (g/cm^3) or Number density (atoms/Angstrom^3). Allowed values: [‘Mass Density’, ‘Number Density’]</p></td>
</tr>
<tr class="row-odd"><td><p>Density</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Mass density (g/cm^3) or Number density (atoms/Angstrom^3).</p></td>
</tr>
<tr class="row-even"><td><p>Thickness</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Sample thickness (cm).</p></td>
</tr>
<tr class="row-odd"><td><p>MeasuredEfficiency</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Directly input the efficiency measured at MeasuredEfficiencyWavelength.                  This is used to determine a Density*Thickness term.</p></td>
</tr>
<tr class="row-even"><td><p>MeasuredEfficiencyWavelength</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1.7982</p></td>
<td><p>The wavelength at which the MeasuredEfficiency was measured.</p></td>
</tr>
<tr class="row-odd"><td><p>Alpha</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Directly input the alpha term in exponential to multiply by the wavelength.                  XSectionType has no effect if this is used.</p></td>
</tr>
<tr class="row-even"><td><p>XSectionType</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>AttenuationXSection</p></td>
<td><p>Use either the absorption  or total cross section in exponential term.                    The absorption cross section is for monitor-type corrections and                    the total cross section is for transmission-type corrections. Allowed values: [‘AttenuationXSection’, ‘TotalXSection’]</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This algorithm calculates the detection efficiency correction, <span class="math notranslate nohighlight">\(\epsilon\)</span>, defined by:</p>
<div class="math notranslate nohighlight" id="equation-efficiency">
<span class="eqno">(1)<a class="headerlink" href="#equation-efficiency" title="Link to this equation">¶</a></span>\[\begin{split}\epsilon &amp;= 1-e^{-\rho T \sigma (\lambda)} \\
         &amp;= 1-e^{-\rho_{A} \sigma (\lambda)} \\
         &amp;= 1-e^{-\alpha \lambda}\end{split}\]</div>
<p>and output correction is given as:</p>
<div class="math notranslate nohighlight" id="equation-efficiency-correction">
<span class="eqno">(2)<a class="headerlink" href="#equation-efficiency-correction" title="Link to this equation">¶</a></span>\[\frac{1}{\epsilon} = \frac{1}{1-e^{-\alpha \lambda}}\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\rho\)</span> is the number density in atoms/<span class="math notranslate nohighlight">\(\AA^3\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(T\)</span> is a sample thickness given in cm</p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda_{ref}\)</span> = 1.7982 <span class="math notranslate nohighlight">\(\AA\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\sigma (\lambda)\)</span> is the wavelength-dependent cross-section which is either:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\sigma (\lambda) = \sigma_a (\lambda_{ref}) \left( \frac{\lambda}{\lambda_{ref}} \right)\)</span> for <code class="docutils literal notranslate"><span class="pre">XSectionType</span></code> == <code class="docutils literal notranslate"><span class="pre">AttenuationXSection</span></code> where <span class="math notranslate nohighlight">\(\sigma_a\)</span> is the absorption cross-section in units of barns</p></li>
<li><p>or <span class="math notranslate nohighlight">\(\sigma (\lambda) = \sigma_s + \sigma_a (\lambda_{ref}) \left( \frac{\lambda}{\lambda_{ref}} \right)\)</span> for <code class="docutils literal notranslate"><span class="pre">XSectionType</span></code> == <code class="docutils literal notranslate"><span class="pre">TotalXSection</span></code> where <span class="math notranslate nohighlight">\(\sigma_s\)</span> is the total scattering cross-section in units of barns</p></li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(\rho_{A}\)</span> is the area density (<span class="math notranslate nohighlight">\(\rho_{A}=\rho * T\)</span>) in units of atoms*cm/<span class="math notranslate nohighlight">\(\AA^3\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha = \rho_{A} \cdot \frac{\sigma (\lambda_{ref})}{\lambda_{ref}} = \rho \cdot T \cdot \frac{\sigma (\lambda_{ref})}{\lambda_{ref}}\)</span> in units of 1/<span class="math notranslate nohighlight">\(\AA\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda\)</span> is in units of <span class="math notranslate nohighlight">\(\AA\)</span>.</p></li>
</ul>
<p>NOTE: <span class="math notranslate nohighlight">\(1 \AA^2 = 10^{8}\)</span> barns and <span class="math notranslate nohighlight">\(1 \AA = 10^{-8}\)</span> cm.</p>
<dl class="simple">
<dt>The optional inputs into the algorithm are to input either:</dt><dd><ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">Alpha</span></code> parameter</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Density</span></code> and <code class="docutils literal notranslate"><span class="pre">ChemicalFormula</span></code> to calculate the <span class="math notranslate nohighlight">\(\sigma(\lambda_{ref})\)</span> term.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">MeasuredEfficiency</span></code>, an optional <code class="docutils literal notranslate"><span class="pre">MeasuredEfficiencyWavelength</span></code>, and <code class="docutils literal notranslate"><span class="pre">ChemicalFormula</span></code> to calculate the <span class="math notranslate nohighlight">\(\sigma(\lambda_{ref})\)</span> term.</p></li>
</ol>
</dd>
</dl>
<p>The <code class="docutils literal notranslate"><span class="pre">MeasuredEfficiency</span></code> is the <span class="math notranslate nohighlight">\(\epsilon\)</span> term measured at a specific wavelength, <span class="math notranslate nohighlight">\(\lambda_{\epsilon}\)</span>, which is specified by <code class="docutils literal notranslate"><span class="pre">MeasuredEfficiencyWavelength</span></code>. This helps
if the efficiency has been directly measured experimentally at a given wavelength. This will calculate the
<span class="math notranslate nohighlight">\(\rho * T\)</span> term, where it will be either:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\rho * T = - \ln(1-\epsilon) \frac{1}{ \frac{\lambda_{\epsilon} \sigma (\lambda_{ref})}{\lambda_{ref}}}\)</span> for <code class="docutils literal notranslate"><span class="pre">XSectionType</span></code> == <code class="docutils literal notranslate"><span class="pre">AttenuationXSection</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\rho * T = - \ln(1-\epsilon) \frac{1}{ \sigma_s + \frac{\lambda_{\epsilon} \sigma (\lambda_{ref})}{\lambda_{ref}}}\)</span> for <code class="docutils literal notranslate"><span class="pre">XSectionType</span></code> == <code class="docutils literal notranslate"><span class="pre">TotalXSection</span></code></p></li>
</ul>
<p>For the <code class="docutils literal notranslate"><span class="pre">XSectionType</span></code>, if the efficiency correction is applied to a beam monitor to determine the incident spectrum, then the <code class="docutils literal notranslate"><span class="pre">AttenuationXSection</span></code> option should be used. This is due to the fact that scatter events do not lead to neutrons that will be in the incident beam. If the efficiency correction is to be used similar to a transmission measurement for an actual sample measurement, such as in <a class="reference internal" href="CalculateSampleTransmission-v1.html#algm-calculatesampletransmission-v1"><span class="std std-ref">CalculateSampleTransmission v1</span></a>, then the <code class="docutils literal notranslate"><span class="pre">TotalXSection</span></code> should be used to include both types of events.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - Basics of running CalculateEfficiencyCorrection with Alpha.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an exponentially decaying function in wavelength to simulate measured sample</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">WorkspaceType</span><span class="o">=</span><span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s2">&quot;User Defined&quot;</span><span class="p">,</span>
                                   <span class="n">UserDefinedFunction</span><span class="o">=</span><span class="s2">&quot;name=ExpDecay, Height=100, Lifetime=4&quot;</span><span class="p">,</span>
                                   <span class="n">Xmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">Xmax</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">BinWidth</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">XUnit</span><span class="o">=</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">,</span>
                                   <span class="n">NumEvents</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Calculate the efficiency correction</span>
<span class="n">corr_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">Alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">corr_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">WavelengthRange</span><span class="o">=</span><span class="s2">&quot;0.2,0.01,4.0&quot;</span><span class="p">,</span> <span class="n">Alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Apply the efficiency correction to the measured spectrum</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">ConvertToPointData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">)</span>
<span class="n">output_wksp</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp</span><span class="p">)</span>
<span class="n">output_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp_with_wave_range</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Correction workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corr_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output workspace using WavelengthRange: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp_with_wave_range</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
</pre></div>
</div>
<p>Ouptut:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Input workspace: [40. 40. 40. 40. 40.]
Correction workspace: [10.26463773  9.81128219  9.39826191  9.02042771  8.67347109]
Output workspace: [410.58550929 392.45128759 375.93047648 360.81710849 346.93884349]
Output workspace using WavelengthRange: [410.58550929 392.45128759 375.93047648 360.81710849 346.93884349]
</pre></div>
</div>
<p><strong>Example - Basics of running CalculateEfficiencyCorrection with Density and ChemicalFormula.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an exponentially decaying function in wavelength to simulate measured sample</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">WorkspaceType</span><span class="o">=</span><span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s2">&quot;User Defined&quot;</span><span class="p">,</span>
                                   <span class="n">UserDefinedFunction</span><span class="o">=</span><span class="s2">&quot;name=ExpDecay, Height=100, Lifetime=4&quot;</span><span class="p">,</span>
                                   <span class="n">Xmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">Xmax</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">BinWidth</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">XUnit</span><span class="o">=</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">,</span>
                                   <span class="n">NumEvents</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Calculate the efficiency correction</span>
<span class="n">corr_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span>
                                          <span class="n">Density</span><span class="o">=</span><span class="mf">6.11</span><span class="p">,</span>
                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">)</span>
<span class="n">corr_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">WavelengthRange</span><span class="o">=</span><span class="s2">&quot;0.2,0.01,4.0&quot;</span><span class="p">,</span>
                                                          <span class="n">Density</span><span class="o">=</span><span class="mf">6.11</span><span class="p">,</span>
                                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">)</span>

<span class="c1"># Apply the efficiency correction to the measured spectrum</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">ConvertToPointData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">)</span>
<span class="n">output_wksp</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp</span><span class="p">)</span>
<span class="n">output_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp_with_wave_range</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Correction workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corr_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output workspace using WavelengthRange: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp_with_wave_range</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
</pre></div>
</div>
<p>Ouptut:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Input workspace: [40. 40. 40. 40. 40.]
Correction workspace: [24.40910309 23.29738394 22.28449939 21.35783225 20.50682528]
Output workspace: [976.3641235  931.8953577  891.37997557 854.31328983 820.2730111 ]
Output workspace using WavelengthRange: [976.3641235  931.8953577  891.37997557 854.31328983 820.2730111 ]
</pre></div>
</div>
<p><strong>Example - Basics of running CalculateEfficiencyCorrection with MeasuredEfficiency and ChemicalFormula.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an exponentially decaying function in wavelength to simulate measured sample</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">WorkspaceType</span><span class="o">=</span><span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s2">&quot;User Defined&quot;</span><span class="p">,</span>
                                   <span class="n">UserDefinedFunction</span><span class="o">=</span><span class="s2">&quot;name=ExpDecay, Height=100, Lifetime=4&quot;</span><span class="p">,</span>
                                   <span class="n">Xmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">Xmax</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">BinWidth</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">XUnit</span><span class="o">=</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">,</span>
                                   <span class="n">NumEvents</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Calculate the efficiency correction</span>
<span class="n">corr_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span>
                                          <span class="n">MeasuredEfficiency</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s2">&quot;(He3)&quot;</span><span class="p">)</span>

<span class="n">corr_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">WavelengthRange</span><span class="o">=</span><span class="s2">&quot;0.2,0.01,4.0&quot;</span><span class="p">,</span>
                                                          <span class="n">MeasuredEfficiency</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
                                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s2">&quot;(He3)&quot;</span><span class="p">)</span>


<span class="c1"># Apply the efficiency correction to the measured spectrum</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">ConvertToPointData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">)</span>
<span class="n">output_wksp</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp</span><span class="p">)</span>
<span class="n">output_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp_with_wave_range</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Correction workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corr_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output workspace using WavelengthRange: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp_with_wave_range</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
</pre></div>
</div>
<p>Ouptut:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Input workspace: [40. 40. 40. 40. 40.]
Correction workspace: [873.27762699 832.68332786 795.69741128 761.85923269 730.78335476]
Output workspace: [34931.10507965 33307.33311431 31827.89645133 30474.36930745
 29231.33419051]
Output workspace using WavelengthRange: [34931.10507965 33307.33311431 31827.89645133 30474.36930745
 29231.33419051]
</pre></div>
</div>
<p><strong>Example - Basics of running CalculateEfficiencyCorrection with MeasuredEfficiency and ChemicalFormula using the total cross section.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an exponentially decaying function in wavelength to simulate measured sample</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">WorkspaceType</span><span class="o">=</span><span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s2">&quot;User Defined&quot;</span><span class="p">,</span>
                                   <span class="n">UserDefinedFunction</span><span class="o">=</span><span class="s2">&quot;name=ExpDecay, Height=100, Lifetime=4&quot;</span><span class="p">,</span>
                                   <span class="n">Xmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">Xmax</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">BinWidth</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">XUnit</span><span class="o">=</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">,</span>
                                   <span class="n">NumEvents</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Calculate the efficiency correction</span>
<span class="n">corr_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span>
                                          <span class="n">MeasuredEfficiency</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s2">&quot;(He3)&quot;</span><span class="p">,</span>
                                          <span class="n">XSectionType</span><span class="o">=</span><span class="s2">&quot;TotalXSection&quot;</span><span class="p">)</span>

<span class="n">corr_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">WavelengthRange</span><span class="o">=</span><span class="s2">&quot;0.2,0.01,4.0&quot;</span><span class="p">,</span>
                                                          <span class="n">MeasuredEfficiency</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
                                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s2">&quot;(He3)&quot;</span><span class="p">,</span>
                                                          <span class="n">XSectionType</span><span class="o">=</span><span class="s2">&quot;TotalXSection&quot;</span><span class="p">)</span>


<span class="c1"># Apply the efficiency correction to the measured spectrum</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">ConvertToPointData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">)</span>
<span class="n">output_wksp</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp</span><span class="p">)</span>
<span class="n">output_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp_with_wave_range</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Correction workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corr_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Output workspace using WavelengthRange: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp_with_wave_range</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
</pre></div>
</div>
<p>Ouptut:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Input workspace: [40. 40. 40. 40. 40.]
Correction workspace: [865.7208838  825.85320701 789.49774383 756.20995361 725.61727932]
Output workspace: [34628.83535201 33034.12828025 31579.90975329 30248.39814428
 29024.69117275]
Output workspace using WavelengthRange: [34628.83535201 33034.12828025 31579.90975329 30248.39814428
 29024.69117275]
</pre></div>
</div>
<p>The transmission of a sample can be measured as <span class="math notranslate nohighlight">\(e^{-\rho T \sigma_t (\lambda)}\)</span> where <span class="math notranslate nohighlight">\(\sigma_t (\lambda) = \sigma_s + \sigma_a (\lambda)\)</span> is the total cross-section. This can be calculatd directly by the <a class="reference internal" href="CalculateSampleTransmission-v1.html#algm-calculatesampletransmission-v1"><span class="std std-ref">CalculateSampleTransmission v1</span></a> algorithm. Yet, we can also back out the transmission with the <code class="docutils literal notranslate"><span class="pre">CalculateEfficiencyCorrection</span></code> algorithm. The example below shows how:</p>
<p><strong>Example - Transmission using the CalculateEfficiencyCorrection and CalculateSampleTransmission comparison.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">CalculateSampleTransmission</span><span class="p">(</span><span class="n">WavelengthRange</span><span class="o">=</span><span class="s1">&#39;2.0, 0.1, 10.0&#39;</span><span class="p">,</span>
                                 <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s1">&#39;H2-O&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transmission: </span><span class="si">{}</span><span class="s1"> ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]))</span>

<span class="n">corr_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">WavelengthRange</span><span class="o">=</span><span class="s2">&quot;2.0, 0.1, 10.0&quot;</span><span class="p">,</span>
                                          <span class="n">Density</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                          <span class="n">Thickness</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s2">&quot;H2-O&quot;</span><span class="p">,</span>
                                          <span class="n">XSectionType</span><span class="o">=</span><span class="s2">&quot;TotalXSection&quot;</span><span class="p">)</span>
<span class="n">dataX</span> <span class="o">=</span> <span class="n">corr_wksp</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">dataY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corr_wksp</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
<span class="n">ones</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">dataX</span><span class="p">,</span> <span class="n">dataY</span><span class="p">,</span> <span class="n">UnitX</span><span class="o">=</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">)</span>
<span class="n">efficiency</span> <span class="o">=</span> <span class="n">Divide</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">ones</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp</span><span class="p">)</span> <span class="c1"># 1 + -1 * transmission</span>
<span class="n">negative_trans</span> <span class="o">=</span> <span class="n">Minus</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">efficiency</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">ones</span><span class="p">)</span> <span class="c1"># -1 * transmission</span>
<span class="n">transmission</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWOrkspace</span><span class="o">=</span><span class="n">negative_trans</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=-</span><span class="mf">1.</span><span class="o">*</span><span class="n">ones</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transmission using efficiency correction: </span><span class="si">{}</span><span class="s1"> ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">transmission</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Transmission: [0.94506317 0.94505148 0.94503979] ...
Transmission using efficiency correction: [0.9450632  0.94505151 0.94503982] ...
</pre></div>
</div>
<p>The discrepancies are due to the differenc in <span class="math notranslate nohighlight">\(\lambda_{ref}\)</span> = 1.7982 <span class="math notranslate nohighlight">\(\AA\)</span> in <code class="docutils literal notranslate"><span class="pre">CalculateEfficiencyCorrection</span></code>, consistent with <a class="reference external" href="https://github.com/mantidproject/mantid/blob/32ed0b2cbbe4fbfb230570d5a53032f6101743de/Framework/Kernel/src/NeutronAtom.cpp#L23">ReferenceLambda</a> where <a class="reference internal" href="CalculateSampleTransmission-v1.html#algm-calculatesampletransmission-v1"><span class="std std-ref">CalculateSampleTransmission v1</span></a>  uses <span class="math notranslate nohighlight">\(\lambda_{ref}\)</span> = 1.798 <span class="math notranslate nohighlight">\(\AA\)</span>.</p>
<p><strong>Example - Running CalculateEfficiencyCorrection for incident spectrum.</strong></p>
<p>To model the incident spectrum of polyethylene moderators, the following function is used to
join the exponential decay of the epithermal flux  to the Maxwellian distribution of the thermal flux <a class="footnote-reference brackets" href="#id8" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>:</p>
<div class="math notranslate nohighlight" id="equation-incident-spectrum">
<span class="eqno">(3)<a class="headerlink" href="#equation-incident-spectrum" title="Link to this equation">¶</a></span>\[\phi(\lambda) = \phi_{max} \frac{\lambda_T^4}{\lambda^5} \mathrm{e}^{-(\lambda_T / \lambda)^2} + \phi_{epi} \frac{\Delta(\lambda_T / \lambda)}{\lambda^{1+2\alpha}}\]</div>
<p>To determine this incident spectrum experimentally, one must make a measurement either via using a sample measurement such as vanadium <a class="footnote-reference brackets" href="#id8" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> or using beam monitors. <a class="footnote-reference brackets" href="#id9" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#id10" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> In either case, an efficiency correction must be applied to the measured spectrum to obtain the actual incident spectrum. This incident spectrum is a crucial part of calculating Placzek recoil sample corrections. <a class="footnote-reference brackets" href="#id11" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a></p>
<p>From Eq. <a class="reference internal" href="#equation-incident-spectrum">(3)</a>, the parameters vary based on the moderator material. For a polyethlyene moderator at a temperature of 300K, the following parameters have been used to accurately model the incident spectrum. <a class="footnote-reference brackets" href="#id8" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> The parameter labels, variables used in the following code example, and values for the parameters are given in the table below:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Variables</p></th>
<th class="head"><p>Polyethlyene 300K (ambient)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\phi_{max}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">phiMax</span></code></p></td>
<td><p>6324</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\phi_{epi}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">phiEpi</span></code></p></td>
<td><p>786</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\alpha\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code></p></td>
<td><p>0.099</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\lambda_1\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">lambda1</span></code></p></td>
<td><p>0.67143</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\lambda_2\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">lambda2</span></code></p></td>
<td><p>0.06075</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\lambda_T\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">lambdaT</span></code></p></td>
<td><p>1.58 <span class="math notranslate nohighlight">\(\AA\)</span></p></td>
</tr>
</tbody>
</table>
<p>To first back out the measured spectrum of Milder et al. <a class="footnote-reference brackets" href="#id8" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, the incident spectrum for polyethylene at 300K using Eq. <a class="reference internal" href="#equation-incident-spectrum">(3)</a> is obtained, then the efficiency correction is calculated, and then the incident spectrum is divided by this correction to back out what was originally measured. Then, the correction is applied by multiplying it by the measured spectrum to get back to the corrected incident spectrum to demonstrate how this is regularly apply this to a measured spectrum:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the workspace to hold the already corrected incident spectrum</span>
<span class="n">incident_wksp_name</span> <span class="o">=</span> <span class="s1">&#39;incident_spectrum_wksp&#39;</span>
<span class="n">binning</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">4.0</span><span class="p">)</span>
<span class="n">incident_wksp</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">incident_wksp_name</span><span class="p">,</span>
                                <span class="n">NSpec</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">DataX</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DataY</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">UnitX</span><span class="o">=</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">,</span>
                                <span class="n">VerticalAxisUnit</span><span class="o">=</span><span class="s1">&#39;Text&#39;</span><span class="p">,</span>
                                <span class="n">VerticalAxisValues</span><span class="o">=</span><span class="s1">&#39;IncidentSpectrum&#39;</span><span class="p">)</span>
<span class="n">incident_wksp</span> <span class="o">=</span> <span class="n">Rebin</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">incident_wksp</span><span class="p">,</span> <span class="n">Params</span><span class="o">=</span><span class="n">binning</span><span class="p">)</span>
<span class="n">incident_wksp</span> <span class="o">=</span> <span class="n">ConvertToPointData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">incident_wksp</span><span class="p">)</span>

<span class="c1"># Spectrum function given in Milder et al. Eq (5)</span>
<span class="k">def</span> <span class="nf">incidentSpectrum</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">phiMax</span><span class="p">,</span> <span class="n">phiEpi</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">lambda1</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="n">lamdaT</span><span class="p">):</span>
    <span class="n">deltaTerm</span> <span class="o">=</span>  <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">wavelengths</span> <span class="o">-</span> <span class="n">lambda1</span><span class="p">)</span> <span class="o">/</span> <span class="n">lambda2</span><span class="p">))</span>
    <span class="n">term1</span> <span class="o">=</span> <span class="n">phiMax</span> <span class="o">*</span> <span class="p">(</span><span class="n">lambdaT</span><span class="o">**</span><span class="mf">4.</span> <span class="o">/</span> <span class="n">wavelengths</span><span class="o">**</span><span class="mf">5.</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">lambdaT</span> <span class="o">/</span> <span class="n">wavelengths</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="n">phiEpi</span> <span class="o">*</span> <span class="n">deltaTerm</span> <span class="o">/</span> <span class="p">(</span><span class="n">wavelengths</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span>

<span class="c1"># Variables for polyethlyene moderator at 300K</span>
<span class="n">phiMax</span>  <span class="o">=</span> <span class="mi">6324</span>
<span class="n">phiEpi</span>  <span class="o">=</span> <span class="mi">786</span>
<span class="n">alpha</span>   <span class="o">=</span> <span class="mf">0.099</span>
<span class="n">lambda1</span> <span class="o">=</span> <span class="mf">0.67143</span>
<span class="n">lambda2</span> <span class="o">=</span> <span class="mf">0.06075</span>
<span class="n">lambdaT</span> <span class="o">=</span> <span class="mf">1.58</span>

<span class="c1"># Add the incident spectrum to the workspace</span>
<span class="n">corrected_spectrum</span> <span class="o">=</span> <span class="n">incidentSpectrum</span><span class="p">(</span><span class="n">incident_wksp</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                                      <span class="n">phiMax</span><span class="p">,</span> <span class="n">phiEpi</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span>
                                      <span class="n">lambda1</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="n">lambdaT</span><span class="p">)</span>
<span class="n">incident_wksp</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">corrected_spectrum</span><span class="p">)</span>

<span class="c1"># Calculate the efficiency correction for Alpha=0.693 and back calculate measured spectrum</span>
<span class="n">eff_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">incident_wksp</span><span class="p">,</span> <span class="n">Alpha</span><span class="o">=</span><span class="mf">0.693</span><span class="p">)</span>
<span class="n">measured_wksp</span> <span class="o">=</span> <span class="n">Divide</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">incident_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">eff_wksp</span><span class="p">)</span>

<span class="c1"># Re-applying the correction to the measured data (how to normally use it)</span>
<span class="n">eff2_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">measured_wksp</span><span class="p">,</span> <span class="n">Alpha</span><span class="o">=</span><span class="mf">0.693</span><span class="p">)</span>
<span class="n">recorrected_wksp</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">measured_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">eff2_wksp</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Measured incident spectrum: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">measured_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Corrected incident spectrum: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">incident_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Re-corrected incident spectrum: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recorrected_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Measured incident spectrum: [694.61415533 685.71520053 677.21326605 669.0696332  661.25022644]
Corrected incident spectrum: [5244.9385468  4953.63834159 4690.60136547 4451.98728342 4234.6092648 ]
Re-corrected incident spectrum: [5244.9385468  4953.63834159 4690.60136547 4451.98728342 4234.6092648 ]
</pre></div>
</div>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id17" role="doc-backlink">References</a><a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id8" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id2">2</a>,<a role="doc-backlink" href="#id6">3</a>,<a role="doc-backlink" href="#id7">4</a>)</span>
<ol class="upperalpha simple" start="4">
<li><ol class="upperalpha simple" start="6">
<li><ol class="upperalpha simple" start="18">
<li><p>Mildner, B. C. Boland, R. N. Sinclair, C. G. Windsor, L. J. Bunce, and J. H. Clarke (1977) <em>A Cooled Polyethylene Moderator on a Pulsed Neutron Source</em>, Nuclear Instruments and Methods 152 437-446 <a class="reference external" href="https://doi.org/10.1016/0029-554X(78)90043-5">doi: 10.1016/0029-554X(78)90043-5</a></p></li>
</ol>
</li>
</ol>
</li>
</ol>
</aside>
<aside class="footnote brackets" id="id9" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<ol class="upperalpha simple" start="10">
<li><ol class="upperalpha simple" start="16">
<li><p>Hodges, J. D. Jorgensen, S. Short, D. N. Argyiou, and J. W. Richardson, Jr.  <em>Incident Spectrum Determination for Time-of-Flight Neutron Powder Diffraction Data Analysis</em> ICANS 14th Meeting of the International Collaboration on Advanced Neutron Sources 813-822 <a class="reference external" href="http://www.neutronresearch.com/parch/1998/01/199801008130.pdf">link to paper</a></p></li>
</ol>
</li>
</ol>
</aside>
<aside class="footnote brackets" id="id10" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">3</a><span class="fn-bracket">]</span></span>
<ol class="upperalpha simple" start="6">
<li><p>Issa, A. Khaplanov, R. Hall-Wilton, I. Llamas, M. Dalseth Ricktor, S. R. Brattheim, and H. Perrey (2017) <em>Characterization of Thermal Neutron Beam Monitors</em> Physical Review Accelerators and Beams 20 092801 <a class="reference external" href="https://doi.org/10.1103/PhysRevAccelBeams.20.092801">doi: 10.1103/PhysRevAccelBeams.20.092801</a></p></li>
</ol>
</aside>
<aside class="footnote brackets" id="id11" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">4</a><span class="fn-bracket">]</span></span>
<ol class="upperalpha simple" start="23">
<li><ol class="upperalpha simple" start="19">
<li><p>Howells (1983) <em>On the Choice of Moderator for Liquids Diffractometer on a Pulsed Neutron Source</em>, Nuclear Instruments and Methods in Physics Research 223 141-146 <a class="reference external" href="https://doi.org/10.1016/0167-5087(84)90256-4">doi: 10.1016/0167-5087(84)90256-4</a></p></li>
</ol>
</li>
</ol>
</aside>
</aside>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/CorrectionFunctions/EfficiencyCorrections.html">CorrectionFunctions\EfficiencyCorrections</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c66b9d75d3432a3fcde604fac070fd25fe61daf8/Framework/PythonInterface/plugins/algorithms/CalculateEfficiencyCorrection.py">CalculateEfficiencyCorrection.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CalculateEfficiency-v2.html" title="Previous Chapter: CalculateEfficiency v2"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; CalculateEffi...</span>
    </a>
  </li>
  <li>
    <a href="CalculateFlatBackground-v1.html" title="Next Chapter: CalculateFlatBackground v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">CalculateFlat... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>