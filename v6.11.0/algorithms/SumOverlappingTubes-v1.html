<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SumOverlappingTubes v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=06de18c4"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SumRowColumn v1" href="SumRowColumn-v1.html" />
    <link rel="prev" title="SumNeighbours v1" href="SumNeighbours-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.11</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">SumOverlappingTubes v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="sumoverlappingtubes-v1">
<span id="algm-sumoverlappingtubes"></span><span id="algm-sumoverlappingtubes-v1"></span><h1>SumOverlappingTubes v1<a class="headerlink" href="#sumoverlappingtubes-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p>
<ul>
<li><p><a class="reference internal" href="#general-behavior" id="id6">General Behavior</a></p>
<ul>
<li><p><a class="reference internal" href="#dtubes-option" id="id7">2DTubes Option</a></p></li>
<li><p><a class="reference internal" href="#d-option" id="id8">2D Option</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id9">1D Option</a></p></li>
<li><p><a class="reference internal" href="#instrument-parameters" id="id10">Instrument Parameters</a></p></li>
<li><p><a class="reference internal" href="#splitcounts" id="id11">SplitCounts</a></p></li>
<li><p><a class="reference internal" href="#cropnegativescatteringangles" id="id12">CropNegativeScatteringAngles</a></p></li>
<li><p><a class="reference internal" href="#scatteringanglebinning" id="id13">ScatteringAngleBinning</a></p></li>
<li><p><a class="reference internal" href="#outputworkspace" id="id14">OutputWorkspace</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#usage" id="id15">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id16">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Takes workspaces containing an instrument with PSD and tubes, and converts to a workspace with counts as a function of height and scattering angle. Detector scans with overlapping tubes are supported.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="SumSpectra-v1.html#algm-sumspectra"><span class="std std-ref">SumSpectra</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspaces</p></td>
<td><p>Input</p></td>
<td><p>str list</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The names of the input workspaces as a list. You may also group workspaces using the GUI or [[GroupWorkspaces]], and specify the name of the group instead.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Name of the output workspace.</p></td>
</tr>
<tr class="row-even"><td><p>OutputType</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>2D</p></td>
<td><p>Whether to have the output in raw 2D, with no Debye-Scherrer cone correction, 2D or 1D. Allowed values: [‘2DTubes’, ‘2D’, ‘1D’]</p></td>
</tr>
<tr class="row-odd"><td><p>ScatteringAngleBinning</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>0.05</p></td>
<td><p>A comma separated list of the first scattering angle, the scattering angle step size and the final scattering angle. Optionally this can also be a single number, which is the angle step size. In this case, the boundary of binning will be determined by minimum and maximum scattering angle present in the workspaces.</p></td>
</tr>
<tr class="row-even"><td><p>CropNegativeScatteringAngles</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If true the negative scattering angles are cropped (ignored).</p></td>
</tr>
<tr class="row-odd"><td><p>HeightAxis</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td></td>
<td><p>A comma separated list of the first y value, the y value step size and the final y value. This can also be a single number, which is the y value step size. In this case, the boundary of binning will be determined by minimum and maximum y values present in the workspaces. This can also be two numbers to give the range desired.</p></td>
</tr>
<tr class="row-even"><td><p>Normalise</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>If true normalise to the number of entries added for a particular scattering angle.</p></td>
</tr>
<tr class="row-odd"><td><p>MirrorScatteringAngles</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>A flag to mirror the signed 2thetas.</p></td>
</tr>
<tr class="row-even"><td><p>SplitCounts</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>A flag to split the counts between adjacent bins</p></td>
</tr>
<tr class="row-odd"><td><p>ScatteringAngleTolerance</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>The relative tolerance for the scattering angles before the counts are split.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This algorithm takes an input workspace, a group workspace or a selection of workspaces, with a PSD tube instrument, and converts the workspace to a one or two-dimensional workspace of counts as a function of height and scattering angle. There are options to either see the data as it is, or apply a correction to straighten the Debye-Scherrer cones.</p>
<p>This algorithm is written for the geometry of D2B, where the detector tubes have the same radial distance from the sample, and rotate around the sample in the horizontal plane during a detector scan. This algorithm could be generalised to support other instrument geometries in the future.</p>
<section id="general-behavior">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">General Behavior</a><a class="headerlink" href="#general-behavior" title="Link to this heading">¶</a></h3>
<p>For the output workspace a grid is made, the x-axis is the scattering angle and the y-axis is vertical distance from the centre of the tube (referred to as the tube height). Counts from the input workspaces are then put onto this grid. Where one of the entries in the scattering angle is between two angles the count are split between the two, unless the ScatteringAngleTolerance option is set.</p>
<p>If the Normalise option is set then the counts for each point in the OutputWorkspace are divided by the number of contributing points to that pixel. The scaling goes as</p>
<div class="math notranslate nohighlight">
\[C_{scaled, i} = \frac{C_i}{N_{i}}\]</div>
<p>where <span class="math notranslate nohighlight">\(C_{scaled, i}\)</span> is the scaled counts, <span class="math notranslate nohighlight">\(C_i\)</span> the raw counts, and <span class="math notranslate nohighlight">\(N_{i}\)</span> is the number of tube pixels contributing to the point being scaled. Note that pixels counting zero do enter the normalisation, however the masked pixels do not.</p>
<section id="dtubes-option">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">2DTubes Option</a><a class="headerlink" href="#dtubes-option" title="Link to this heading">¶</a></h4>
<p>In this case the x-axis, the scattering angle, is the scattering angle of the tube centre. The height is the pixel height in the tube.</p>
</section>
<section id="d-option">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">2D Option</a><a class="headerlink" href="#d-option" title="Link to this heading">¶</a></h4>
<p>In this case the x-axis is the true scattering angle of a pixel, so the Debye-Scherrer cones are effectively straightened. The x-axis is strictly positive in this case, the negative angles from the 2D case are put in the same bins as the equivalent positive angles. The height is the pixel height in the tube as for the 2D Option.</p>
</section>
<section id="id1">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">1D Option</a><a class="headerlink" href="#id1" title="Link to this heading">¶</a></h4>
<p>This is the same as the 2D option, with a single bin in the y-axis.</p>
</section>
<section id="instrument-parameters">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">Instrument Parameters</a><a class="headerlink" href="#instrument-parameters" title="Link to this heading">¶</a></h4>
<p>If the instrument parameter <code class="docutils literal notranslate"><span class="pre">mirror_detector_angles</span></code> is set to true, then output scattering angles are effectively multiplied by <span class="math notranslate nohighlight">\(-1\)</span>. This is used for D2B where the instrument is mirrored compared with other Powder Diffraction instruments at the ILL.</p>
</section>
<section id="splitcounts">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">SplitCounts</a><a class="headerlink" href="#splitcounts" title="Link to this heading">¶</a></h4>
<p>The counts are split between bins, if the difference between two angles is larger than the scattering angle step multiplied by the <code class="docutils literal notranslate"><span class="pre">ScatteringAngleTolerance</span></code>.
By default there is no splitting.</p>
</section>
<section id="cropnegativescatteringangles">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">CropNegativeScatteringAngles</a><a class="headerlink" href="#cropnegativescatteringangles" title="Link to this heading">¶</a></h4>
<p>When cropping is requested the bins that are fully on the negative side, will be dropped. However if there is a bin with one edge negative, the other positive, this bin will be preserved.</p>
</section>
<section id="scatteringanglebinning">
<h4><a class="toc-backref" href="#id13" role="doc-backlink">ScatteringAngleBinning</a><a class="headerlink" href="#scatteringanglebinning" title="Link to this heading">¶</a></h4>
<p>This can be a comma separated list of start, step, end. Alternatively, if single number is given, it will be taken as the step.
The start and end will be computed from the input workspaces, such that the first bin center is the minimum, and the last bin center is the maximum scattering angle in the equatorial plane in the list of input workspaces.</p>
</section>
<section id="outputworkspace">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">OutputWorkspace</a><a class="headerlink" href="#outputworkspace" title="Link to this heading">¶</a></h4>
<p>Output is a histogram workspace containing the summed/averaged counts.</p>
</section>
</section>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - an example of running SumOverlappingTubes in the 2DTubes case.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws_508093</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;ILL/D2B/508093.nxs&#39;</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">SumOverlappingTubes</span><span class="p">(</span><span class="n">InputWorkspaces</span><span class="o">=</span><span class="n">ws_508093</span><span class="p">,</span> <span class="n">OutputType</span><span class="o">=</span><span class="s1">&#39;2DTubes&#39;</span><span class="p">,</span> <span class="n">MirrorScatteringAngles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X Size: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">blocksize</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;, Y Size: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>X Size: 3200, Y Size: 128
</pre></div>
</div>
<p><strong>Example - an example of running SumOverlappingTubes in the 1D case.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws_508093</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;ILL/D2B/508093.nxs&#39;</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">SumOverlappingTubes</span><span class="p">(</span><span class="n">InputWorkspaces</span><span class="o">=</span><span class="n">ws_508093</span><span class="p">,</span> <span class="n">OutputType</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span><span class="p">,</span> <span class="n">CropNegativeScatteringAngles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">HeightAxis</span><span class="o">=</span><span class="s1">&#39;-0.05,0.05&#39;</span><span class="p">,</span> <span class="n">MirrorScatteringAngles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X Size: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">blocksize</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;, Y Size: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>X Size: 2975, Y Size: 1
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/ILL/Diffraction.html">ILL\Diffraction</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c66b9d75d3432a3fcde604fac070fd25fe61daf8/Framework/Algorithms/inc/MantidAlgorithms/SumOverlappingTubes.h">SumOverlappingTubes.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c66b9d75d3432a3fcde604fac070fd25fe61daf8/Framework/Algorithms/src/SumOverlappingTubes.cpp">SumOverlappingTubes.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="SumNeighbours-v1.html" title="Previous Chapter: SumNeighbours v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; SumNeighbours v1</span>
    </a>
  </li>
  <li>
    <a href="SumRowColumn-v1.html" title="Next Chapter: SumRowColumn v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SumRowColumn v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>