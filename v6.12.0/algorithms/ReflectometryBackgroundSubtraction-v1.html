<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ReflectometryBackgroundSubtraction v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=94a1c62f"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ReflectometryBeamStatistics v1" href="ReflectometryBeamStatistics-v1.html" />
    <link rel="prev" title="RefinePowderInstrumentParameters v3" href="RefinePowderInstrumentParameters-v3.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">ReflectometryBackgroundSubtraction v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="reflectometrybackgroundsubtraction-v1">
<span id="algm-reflectometrybackgroundsubtraction"></span><span id="algm-reflectometrybackgroundsubtraction-v1"></span><h1>ReflectometryBackgroundSubtraction v1<a class="headerlink" href="#reflectometrybackgroundsubtraction-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id2">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id3">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id4">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id5">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Calculates and subtracts the background from a given workspace.</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>An input workspace.</p></td>
</tr>
<tr class="row-odd"><td><p>InputWorkspaceIndexType</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>The type of indices in the optional index set; For optimal performance WorkspaceIndex should be preferred;. Allowed values: [‘WorkspaceIndex’, ‘SpectrumNumber’]</p></td>
</tr>
<tr class="row-even"><td><p>ProcessingInstructions</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td></td>
<td><p>An optional set of spectra containing the background. If not set all spectra will be processed. The indices in this list can be workspace indices or spectrum numbers, depending on the selection made for the index type; Indices are entered as a comma-separated list of values, and/or ranges.</p></td>
</tr>
<tr class="row-odd"><td><p>BackgroundCalculationMethod</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>PerDetectorAverage</p></td>
<td><p>The type of background reduction to perform. Allowed values: [‘PerDetectorAverage’, ‘Polynomial’, ‘AveragePixelFit’]</p></td>
</tr>
<tr class="row-even"><td><p>DegreeOfPolynomial</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Degree of the fitted polynomial.</p></td>
</tr>
<tr class="row-odd"><td><p>CostFunction</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Least squares</p></td>
<td><p>The cost function to be passed to the Fit algorithm. Allowed values: [‘Least squares’, ‘Unweighted least squares’]</p></td>
</tr>
<tr class="row-even"><td><p>PeakRange</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td></td>
<td><p>A set of spectra defining the reflectivity peak. If not set all spectra will be processed. The indices in this list can be workspace indices or spectrum numbers, depending on the InputWorkspaceIndexType</p></td>
</tr>
<tr class="row-odd"><td><p>SumPeak</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If True, the resulting peak will be summed</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>The output workspace containing the InputWorkspace with the background removed.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This algorithm calculates and subtracts the background from a given workspace using the spectrum ranges in <code class="docutils literal notranslate"><span class="pre">ProcessingInstructions</span></code>. If no spectrum ranges are given the whole input workspace is used.</p>
<p>The background can be calculated using three methods. <strong>PerDetectorAverage</strong> which groups the background spectrum together and divides it by the total number of spectra.
This is done using <a class="reference internal" href="GroupDetectors-v2.html#algm-groupdetectors"><span class="std std-ref">GroupDetectors v2</span></a>. This is then subtracted from the input workspace. <strong>Polynomial</strong> uses <a class="reference internal" href="Transpose-v1.html#algm-transpose"><span class="std std-ref">Transpose v1</span></a> so the spectrum numbers
are in the X (horizontal) axis and TOF channels are the vertical axis. Then the background is calculated by fitting a polynomial of the given degree to each TOF using the background spectra given
in <code class="docutils literal notranslate"><span class="pre">InputWorkspaceIndexSet</span></code>. This is done using <a class="reference internal" href="CalculatePolynomialBackground-v1.html#algm-calculatepolynomialbackground"><span class="std std-ref">CalculatePolynomialBackground v1</span></a>. The minimizer used is ‘Levenberg-Marquardt’ and the value of CostFunction is passed to <a class="reference internal" href="CalculatePolynomialBackground-v1.html#algm-calculatepolynomialbackground"><span class="std std-ref">CalculatePolynomialBackground v1</span></a> as-is.
The default option for the CostFunction is ‘Least squares’ which uses the histogram errors as weights. This might not be desirable, e.g. when there are bins with zero counts and zero errors.
An ‘Unweighted least squares’ option is available to deal with such cases. Once this has been done the workspace is then transposed again and subtracted from the input workspace.
<strong>AveragePixelFit</strong> uses <a class="reference internal" href="RefRoi-v1.html#algm-refroi"><span class="std std-ref">RefRoi v1</span></a> to sum the background region on either side of the peak and finding average of these regions. Then the average is subtracted from
the sum of the whole region of interest of the detector. It takes the background range from the <code class="docutils literal notranslate"><span class="pre">ProcessingInstructions</span></code> and the <code class="docutils literal notranslate"><span class="pre">PeakRange</span></code> which is the range of pixels containing the peak.
Note when using the average pixel fit method the background must only be one region either side of the peak. If any more regions are given the background will be taken as all the spectra between the highest and lowest spectra entered excluding the peak.
This is done using <a class="reference internal" href="LRSubtractAverageBackground-v1.html#algm-lrsubtractaveragebackground"><span class="std std-ref">LRSubtractAverageBackground v1</span></a>.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - Subtracting background using Per detector average:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>

<span class="n">dataX</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">background</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">peak</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">dataY</span> <span class="o">=</span> <span class="n">background</span> <span class="o">+</span> <span class="n">peak</span> <span class="o">+</span> <span class="n">background</span>
<span class="c1">#workspace has a background of 2 and a peak of 5 in the 2nd index</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">dataX</span><span class="p">,</span> <span class="n">dataY</span><span class="p">,</span> <span class="n">NSpec</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">ws_bkg_subtr</span> <span class="o">=</span> <span class="n">ReflectometryBackgroundSubtraction</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">ProcessingInstructions</span> <span class="o">=</span> <span class="s2">&quot;0,1,3,4&quot;</span><span class="p">,</span> <span class="n">BackgroundCalculationMethod</span> <span class="o">=</span> <span class="s2">&quot;PerDetectorAverage&quot;</span><span class="p">)</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peak height with background: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">ws_bkg_subtr</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Background subtracted peak height: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Peak height with background: 5.0
Background subtracted peak height: 3.0
</pre></div>
</div>
<p><strong>Example - Subtracting background using Polynomial:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>

<span class="c1">#create a workspace with a polynomial background of degree 2 and a peak of 5 in the 5th spectra</span>
<span class="n">dataX</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">polynomial</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">peak</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">dataY</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">polynomial</span><span class="p">,</span> <span class="n">peak</span><span class="p">)]</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">dataX</span><span class="p">,</span> <span class="n">dataY</span><span class="p">,</span> <span class="n">NSpec</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>

<span class="n">ws_bkg_subtr</span> <span class="o">=</span> <span class="n">ReflectometryBackgroundSubtraction</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">InputWorkspaceIndexType</span><span class="o">=</span><span class="s1">&#39;SpectrumNumber&#39;</span><span class="p">,</span> <span class="n">ProcessingInstructions</span> <span class="o">=</span> <span class="s2">&quot;1-4,6-9&quot;</span><span class="p">,</span> <span class="n">BackgroundCalculationMethod</span> <span class="o">=</span> <span class="s2">&quot;Polynomial&quot;</span><span class="p">,</span> <span class="n">DegreeOfPolynomial</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">4</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peak height with background: </span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">ws_bkg_subtr</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">4</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Background subtracted peak height: </span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Peak height with background: 22.0
Background subtracted peak height: 5.0
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Reflectometry.html">Reflectometry</a> | <a class="reference external" href="categories/Reflectometry/ISIS.html">Reflectometry\ISIS</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/a8f64cccc781eac9892433e956bab7104ebf1213/Framework/Reflectometry/inc/MantidReflectometry/ReflectometryBackgroundSubtraction.h">ReflectometryBackgroundSubtraction.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/a8f64cccc781eac9892433e956bab7104ebf1213/Framework/Reflectometry/src/ReflectometryBackgroundSubtraction.cpp">ReflectometryBackgroundSubtraction.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="RefinePowderInstrumentParameters-v3.html" title="Previous Chapter: RefinePowderInstrumentParameters v3"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; RefinePowderI...</span>
    </a>
  </li>
  <li>
    <a href="ReflectometryBeamStatistics-v1.html" title="Next Chapter: ReflectometryBeamStatistics v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Reflectometry... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>