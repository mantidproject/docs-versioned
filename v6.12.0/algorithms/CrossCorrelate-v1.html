<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>CrossCorrelate v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=94a1c62f"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CrystalFieldEnergies v1" href="CrystalFieldEnergies-v1.html" />
    <link rel="prev" title="CropWorkspaceRagged v1" href="CropWorkspaceRagged-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">CrossCorrelate v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="crosscorrelate-v1">
<span id="algm-crosscorrelate"></span><span id="algm-crosscorrelate-v1"></span><h1>CrossCorrelate v1<a class="headerlink" href="#crosscorrelate-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id2">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p>
<ul>
<li><p><a class="reference internal" href="#comments-for-creating-useful-cross-correlation-output" id="id5">Comments for creating useful cross-correlation output</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#usage" id="id6">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id7">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Cross-correlates a range of spectra against one reference spectra in the same workspace.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="GetDetectorOffsets-v1.html#algm-getdetectoroffsets"><span class="std std-ref">GetDetectorOffsets</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A 2D workspace with X values of d-spacing</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The name of the output workspace</p></td>
</tr>
<tr class="row-even"><td><p>ReferenceSpectra</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>The Workspace Index of the spectra to correlate all other spectra against.</p></td>
</tr>
<tr class="row-odd"><td><p>WorkspaceIndexMin</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>The workspace index of the first member of the range of spectra to cross-correlate against.</p></td>
</tr>
<tr class="row-even"><td><p>WorkspaceIndexMax</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>The workspace index of the last member of the range of spectra to cross-correlate against.</p></td>
</tr>
<tr class="row-odd"><td><p>WorkspaceIndexList</p></td>
<td><p>Input</p></td>
<td><p>unsigned int list</p></td>
<td></td>
<td><p>A comma-separated list of individual workspace indices of spectra to cross-correlate against.</p></td>
</tr>
<tr class="row-even"><td><p>XMin</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>The starting point of the region to be cross correlated.</p></td>
</tr>
<tr class="row-odd"><td><p>XMax</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>The ending point of the region to be cross correlated.</p></td>
</tr>
<tr class="row-even"><td><p>MaxDSpaceShift</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Optional float for maximum shift to calculate (in d-spacing)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>Compute the cross correlation function for a range of spectra with respect to a reference spectrum.</p>
<p>This is used in powder diffraction experiments when trying to estimate the offset (in number of bin indices) of one spectrum with respect to another one, where the x-axis units share a common crystallographic unit (such as d-spacing or momentum transfer).
The input spectra need to be in d-spacing and then interpolated on the X-axis of the reference before calculating the cross correlation in bin index.
In principle, momentum transfer will work, but this is not currently supported.
The cross correlation function is computed as:</p>
<div class="math notranslate nohighlight">
\[c_{fg}(r) = \frac{1}{\sigma_f \sigma_g} \int_{XMin}^{XMax} (f(x) - \mu_f) (g(x+r)-\mu_g) dx\]</div>
<p>where <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(r\)</span> are bin indices.
<span class="math notranslate nohighlight">\(r\)</span> being either half of the number of points in the requested range, <code class="docutils literal notranslate"><span class="pre">XMin</span></code> to <code class="docutils literal notranslate"><span class="pre">XMax</span></code>, of the reference spectrum, or up to the number of bins corresponding to <cite>MaxDSpaceShift</cite>, whichever is smaller.
<span class="math notranslate nohighlight">\(f(x)\)</span> is the reference spectrum, with <span class="math notranslate nohighlight">\(\mu_f\)</span> and <span class="math notranslate nohighlight">\(\sigma_f\)</span> being the mean and variance respectively.
Similarly, <span class="math notranslate nohighlight">\(g(x)\)</span> is the reference spectrum, with <span class="math notranslate nohighlight">\(\mu_g\)</span> and <span class="math notranslate nohighlight">\(\sigma_g\)</span> being the mean and variance respectively.
All functions are evaluated as a function of bin number rather than x-value.</p>
<p>More details can be found
<a class="reference external" href="http://en.wikipedia.org/wiki/Cross-correlation">here.</a></p>
<section id="comments-for-creating-useful-cross-correlation-output">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Comments for creating useful cross-correlation output</a><a class="headerlink" href="#comments-for-creating-useful-cross-correlation-output" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Supply input data with relatively high signal to noise ratio.
When this is not met, the resulting cross-correlation generally have issues having offsets determined from them by <a class="reference internal" href="GetDetectorOffsets-v1.html#algm-getdetectoroffsets"><span class="std std-ref">GetDetectorOffsets v1</span></a>.</p></li>
<li><p>Take note of input binning structure before using <a class="reference internal" href="GetDetectorOffsets-v1.html#algm-getdetectoroffsets"><span class="std std-ref">GetDetectorOffsets v1</span></a> and <a class="reference internal" href="ConvertDiffCal-v1.html#algm-convertdiffcal"><span class="std std-ref">ConvertDiffCal v1</span></a>.
The different binning modes (linear or logorithmic) correspond to different behavior in the follow-on algorithms.</p></li>
<li><p>Cross-correlating linear binning generally uses <code class="docutils literal notranslate"><span class="pre">OffsetMode=&quot;Relative&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">OffsetMode=&quot;Absolute&quot;</span></code> and requires a narrow range of integration around a single Bragg peak with known reference d-spacing.</p></li>
<li><p>Use a large range for <code class="docutils literal notranslate"><span class="pre">XMin</span></code> to <code class="docutils literal notranslate"><span class="pre">XMax</span></code>.
This will promote calibrations that take a larger range of the data into account rather than a single diffraction peak.
However, it only works for logorithmic binning which will use <code class="docutils literal notranslate"><span class="pre">OffsetMode=&quot;Signed&quot;</span></code> in <a class="reference internal" href="GetDetectorOffsets-v1.html#algm-getdetectoroffsets"><span class="std std-ref">GetDetectorOffsets v1</span></a>.</p></li>
<li><p>With wide range of integration, use the <code class="docutils literal notranslate"><span class="pre">MaxDSpaceShift</span></code> to limit the value of <span class="math notranslate nohighlight">\(r\)</span>.
Not only will this speed up the calculation, but the output spectra will only include where the spectra are similar to the reference and not have spurious peaks or background.
<strong>NOTE:</strong> <cite>MaxDSpaceShift</cite> must be greater than  approximately double the maximum Bragg peak full-width of the input data to ensure that the cross correlation contains a complete peak.</p></li>
</ul>
</section>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - Crosscorrelate 2 spectra</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Create a workspace with 2 spectra with five bins of width 0.5</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">XUnit</span><span class="o">=</span><span class="s1">&#39;dSpacing&#39;</span><span class="p">,</span> <span class="n">XMax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">BinWidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">ScaleX</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;ws&#39;</span><span class="p">,</span> <span class="n">Factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">Operation</span><span class="o">=</span><span class="s1">&#39;Add&#39;</span><span class="p">,</span> <span class="n">IndexMin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">IndexMax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Run algorithm  CrossCorrelate</span>
<span class="n">OutputWorkspace</span> <span class="o">=</span> <span class="n">CrossCorrelate</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;ws&#39;</span><span class="p">,</span> <span class="n">WorkspaceIndexMax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">XMin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">XMax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Show workspaces</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AutoCorrelation </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OutputWorkspace</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CrossCorrelation </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OutputWorkspace</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>AutoCorrelation [-0.01890212  1.         -0.01890212]
CrossCorrelation [-0.68136257  0.16838401  0.45685055]
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Arithmetic.html">Arithmetic</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/a8f64cccc781eac9892433e956bab7104ebf1213/Framework/Algorithms/inc/MantidAlgorithms/CrossCorrelate.h">CrossCorrelate.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/a8f64cccc781eac9892433e956bab7104ebf1213/Framework/Algorithms/src/CrossCorrelate.cpp">CrossCorrelate.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CropWorkspaceRagged-v1.html" title="Previous Chapter: CropWorkspaceRagged v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; CropWorkspace...</span>
    </a>
  </li>
  <li>
    <a href="CrystalFieldEnergies-v1.html" title="Next Chapter: CrystalFieldEnergies v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">CrystalFieldE... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>