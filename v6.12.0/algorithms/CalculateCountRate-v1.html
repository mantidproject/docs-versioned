<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>CalculateCountRate v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=94a1c62f"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CalculateCoverageDGS v1" href="CalculateCoverageDGS-v1.html" />
    <link rel="prev" title="CalculateCostFunction v1" href="CalculateCostFunction-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">CalculateCountRate v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="calculatecountrate-v1">
<span id="algm-calculatecountrate"></span><span id="algm-calculatecountrate-v1"></span><h1>CalculateCountRate v1<a class="headerlink" href="#calculatecountrate-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id2">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id5">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id6">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Calculates instrument count rate as the function of the experiment time and adds CountRate log to the source workspace.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="ChangePulsetime-v1.html#algm-changepulsetime"><span class="std std-ref">ChangePulsetime</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Workspace</p></td>
<td><p>InOut</p></td>
<td><p><a class="reference internal" href="../concepts/EventWorkspace.html#eventworkspace"><span class="std std-ref">EventWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Name of the event workspace to calculate counting rate for.</p></td>
</tr>
<tr class="row-odd"><td><p>XMin</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Minimal value of X-range for the rate calculations. If left to default, Workspace X-axis minimal value is used.</p></td>
</tr>
<tr class="row-even"><td><p>XMax</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Maximal value of X-range for the rate calculations. If left to default, Workspace X-axis maximal value is used.</p></td>
</tr>
<tr class="row-odd"><td><p>RangeUnits</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Energy</p></td>
<td><p>The units from Mantid Unit factory for calculating the counting rate and XMin-XMax ranges are in. If the X-axis of the input workspace is not expressedin these units, unit conversion will be performed, so the workspace should contain all necessary information for this conversion. E.g. if <em>RangeUnits</em> is <em>EnergyTransfer</em>, Ei log containing incident energy value should be attached to the input workspace. See ConvertUnits algorithm for the details. Allowed values: [‘AtomicDistance’, ‘Degrees’, ‘DeltaE’, ‘DeltaE_inFrequency’, ‘DeltaE_inWavenumber’, ‘dSpacing’, ‘dSpacingPerpendicular’, ‘Empty’, ‘Energy’, ‘Energy_inWavenumber’, ‘Label’, ‘Momentum’, ‘MomentumTransfer’, ‘Phi’, ‘QSquared’, ‘SpinEchoLength’, ‘SpinEchoTime’, ‘Temperature’, ‘Time’, ‘TOF’, ‘Wavelength’]</p></td>
</tr>
<tr class="row-even"><td><p>EMode</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Elastic</p></td>
<td><p>The energy mode for ‘RangeUnits’ conversion mode (default: elastic). Allowed values: [‘Elastic’, ‘Direct’, ‘Indirect’]</p></td>
</tr>
<tr class="row-odd"><td><p>NormalizeTheRate</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Usually you want to normalize counting rate to some rate related to the source beam intensity. Change this to ‘false’ if appropriate time series log is broken || not attached to the input workspace.</p></td>
</tr>
<tr class="row-even"><td><p>UseLogDerivative</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If the normalization log contains cumulative counting, derivative of this log is necessary to get correct normalization values.</p></td>
</tr>
<tr class="row-odd"><td><p>NormalizationLogName</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>proton_charge</p></td>
<td><p>The name of the log, used in the counting rate normalization.</p></td>
</tr>
<tr class="row-even"><td><p>CountRateLogName</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>block_count_rate</p></td>
<td><p>The name of the processed time series log with instrument count rate to be added to the source workspace</p></td>
</tr>
<tr class="row-odd"><td><p>UseNormLogGranularity</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>If true, the count rate log will have the normalization log accuracy; If false, the ‘NumTimeSteps’ in the visualization workspace below will be used for the target log granularity too.</p></td>
</tr>
<tr class="row-even"><td><p>VisualizationWs</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>Optional name to build 2D matrix workspace for spurion visualization. If name is provided, a 2D workspace with this name will be created containing data to visualize counting rate as function of time in the ranges XMin-XMax</p></td>
</tr>
<tr class="row-odd"><td><p>NumTimeSteps</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>200</p></td>
<td><p>Number of time steps (time accuracy) the visualization workspace has. Also number of steps in ‘CountRateLogName’ log if ‘UseNormLogGranularity’ is set to false. Should be bigger than 3</p></td>
</tr>
<tr class="row-even"><td><p>XResolution</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>100</p></td>
<td><p>Number of steps (accuracy) of the visualization workspace has along X-axis.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>The algorithm works with event workspaces produced by instruments operating in event mode and calculates the rate at which an instrument counts
neutrons as function of the experiment time.
Then it adds the time series log containing this rate, with the name, defined by
<strong>CountRateLogName</strong> property to the source workspace.</p>
<p>Additionally it can also calculate 2D matrix workspace, which contains count rate as function of
experiment time and neutrons time of flight or energy or other neutron property related to the time of flight in the range <strong>XMin-XMax</strong>
in the units defined by <strong>RangeUnits</strong> property.</p>
<p>In normal circumstances the instrument count rate does not change. Unfortunately, Data Acquisition Electronics sometimes randomly generates spurious signals,
appearing randomly at some moments of the experiment time. Such signals distort real physical image, obtained in experiment and should be removed.</p>
<p>The picture below gives example of counting rate log, calculated by the algorithm together with image of the visualization workspace,
which shows the spurious signal as function of experiment time and neutron energy.</p>
<img alt="../_images/SpurionReal.png" src="../_images/SpurionReal.png" />
<p>The calculated log above can be used as input for <a class="reference internal" href="FilterByLogValue-v1.html#algm-filterbylogvalue"><span class="std std-ref">FilterByLogValue v1</span></a> algorithm to filter events recorded around 200sec of experiment time to
remove spurious signal at 2.9mEv.</p>
<p>The algorithm can also be used to evaluate changes of sample reflectivity as function of some slow changing experiment’s
parameter e.g. temperature, magnetic field or pressure.</p>
<p><strong>NOTE:</strong> Normally one wants to divide the count rate by a value, proportional to incident neutron flux to avoid count rate dependency from changing incident beam intensity.
Usually algorithm just divides the neutron counts by <em>proton_charge</em> log values, normally recorded per frame basis.
If this log is not available, other logs can be used to estimate incident beam intensity.
Visualization workspace is usually calculated with much more coarse time step than the count_rate log, so the normalization used in visualization workspace
is just the sum of all values of the log used for normalization falling within the visualization time step.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - Calculate Count Rate</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s2">&quot;LogTest&quot;</span> <span class="ow">in</span> <span class="n">mtd</span><span class="p">:</span>
    <span class="n">DeleteWorkspace</span><span class="p">(</span><span class="s2">&quot;LogTest&quot;</span><span class="p">)</span>
<span class="c1"># Create sample workspace with events</span>
<span class="n">LogTest</span><span class="o">=</span><span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">WorkspaceType</span><span class="o">=</span><span class="s1">&#39;Event&#39;</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s1">&#39;Flat background&#39;</span><span class="p">)</span>
<span class="n">log_name</span> <span class="o">=</span> <span class="s1">&#39;block_count_rate&#39;</span><span class="p">;</span>

<span class="c1"># no rate log found:</span>
<span class="n">rez</span> <span class="o">=</span> <span class="n">CheckForSampleLogs</span><span class="p">(</span><span class="n">LogTest</span><span class="p">,</span><span class="n">log_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initially, </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rez</span><span class="p">))</span>

<span class="c1"># calculate number of events in the workspace</span>
<span class="n">CalculateCountRate</span><span class="p">(</span><span class="n">LogTest</span><span class="p">,</span><span class="n">CountRateLogName</span><span class="o">=</span> <span class="n">log_name</span><span class="p">)</span>

<span class="n">rez</span> <span class="o">=</span> <span class="n">CheckForSampleLogs</span><span class="p">(</span><span class="n">LogTest</span><span class="p">,</span><span class="n">log_name</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rez</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The Algorithm produced log: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log_name</span><span class="p">))</span>
     <span class="n">log</span> <span class="o">=</span> <span class="n">LogTest</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">getLogData</span><span class="p">(</span><span class="n">log_name</span><span class="p">)</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;log </span><span class="si">{0}</span><span class="s2"> contains </span><span class="si">{1}</span><span class="s2"> entries&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log_name</span><span class="p">,</span> <span class="n">log</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;log starts at </span><span class="si">{0}</span><span class="s2"> and records value: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">firstTime</span><span class="p">(),</span> <span class="n">log</span><span class="o">.</span><span class="n">firstValue</span><span class="p">()))</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;log ends   at </span><span class="si">{0}</span><span class="s2"> and records value: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">lastTime</span><span class="p">(),</span> <span class="n">log</span><span class="o">.</span><span class="n">lastValue</span><span class="p">()))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rez</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> Initially, Property block_count_rate not found
 The Algorithm produced log: block_count_rate
 log block_count_rate contains 200 entries
 log starts at 2010-01-01T00:00:09... and records value: ...
 log ends   at 2010-01-01T00:59:50... and records value: ...
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Inelastic/Utility.html">Inelastic\Utility</a> | <a class="reference external" href="categories/Diagnostics.html">Diagnostics</a> | <a class="reference external" href="categories/Events/EventFiltering.html">Events\EventFiltering</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/a8f64cccc781eac9892433e956bab7104ebf1213/Framework/Algorithms/inc/MantidAlgorithms/CalculateCountRate.h">CalculateCountRate.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/a8f64cccc781eac9892433e956bab7104ebf1213/Framework/Algorithms/src/CalculateCountRate.cpp">CalculateCountRate.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CalculateCostFunction-v1.html" title="Previous Chapter: CalculateCostFunction v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; CalculateCost...</span>
    </a>
  </li>
  <li>
    <a href="CalculateCoverageDGS-v1.html" title="Next Chapter: CalculateCoverageDGS v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">CalculateCove... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>