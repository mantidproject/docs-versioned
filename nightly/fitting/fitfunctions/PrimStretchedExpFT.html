<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>PrimStretchedExpFT</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ProductFunction" href="ProductFunction.html" />
    <link rel="prev" title="PowerLaw" href="PowerLaw.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Fit Functions</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">PrimStretchedExpFT</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="primstretchedexpft">
<span id="func-primstretchedexpft"></span><h1>PrimStretchedExpFT<a class="headerlink" href="#primstretchedexpft" title="Permalink to this heading">¶</a></h1>
<section id="properties-fitting-parameters">
<span id="index-0"></span><h2>Properties (fitting parameters)<a class="headerlink" href="#properties-fitting-parameters" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Height</p></td>
<td><p>0.1</p></td>
<td><p>Intensity at the origin</p></td>
</tr>
<tr class="row-odd"><td><p>Tau</p></td>
<td><p>100.0</p></td>
<td><p>Relaxation time</p></td>
</tr>
<tr class="row-even"><td><p>Beta</p></td>
<td><p>1.0</p></td>
<td><p>Stretching exponent</p></td>
</tr>
<tr class="row-odd"><td><p>Centre</p></td>
<td><p>0.0</p></td>
<td><p>Centre of the peak</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>Provides the Fourier Transform of the Symmetrized Stretched Exponential Function integrated over
each energy bin.</p>
<div class="math notranslate nohighlight">
\[S(Q,E) = \int_{E-\delta E}^{E+\delta E} dE' StretchedExpFT(E', Centre, Tau, Beta)\]</div>
<p>with <span class="math notranslate nohighlight">\(StretchedExpFT\)</span> is fit function <a class="reference internal" href="StretchedExpFT.html#func-stretchedexpft"><span class="std std-ref">StretchedExpFT</span></a>.
Quantity <span class="math notranslate nohighlight">\(\delta E\)</span> is evaluated at run time. If we request to evaluate this
function over a set of energy values <span class="math notranslate nohighlight">\(E_0,..,E_N\)</span>,
then <span class="math notranslate nohighlight">\(2\delta E = \frac{E_N-E_0}{N}\)</span></p>
<p>In the picture below we evaluated function StretcheExpFT at the center of bins of width
<span class="math notranslate nohighlight">\(0.4 \mu eV\)</span> (label &lt;i&gt;center_evaluated&lt;/i&gt;). However, one should compare the integral
of ​the model within each bin against experimental QENS data, because the data is a histogram.
Nevertheless, we usually compare the value that the model takes at the center of each bin instead
of the integral. This approximation is acceptable when the model does not change much
within each bin. This is specially true at high energies when StretcheExpFT is very smooth.
Sometimes this center-of-the-bin evaluation is wrong, like in the central bin [-0.2, 0.2]ueV.
The integral of <span class="math notranslate nohighlight">\(StretchedExpFT\)</span> in this bin is the red dot, and the value of
<span class="math notranslate nohighlight">\(StretchedExpFT\)</span> at the center of the bin is the black dot at the top. Very different!
This situation is likely to arise for samples with a relaxation rate <span class="math notranslate nohighlight">\(h/Tau \ll \delta E\)</span>.
Finally, the blue line is the evaluation of <span class="math notranslate nohighlight">\(PrimStretchedExpFT\)</span> at each bin center, which
by design amounts to the integral of <span class="math notranslate nohighlight">\(StretchedExpFT\)</span> within each bin. This curve
coincides with the red dot for the central bin, as expected. Also, it agrees with the
center-of-bin evaluation of <span class="math notranslate nohighlight">\(StretchedExpFT\)</span> at high energies, when the center-of-the-bin
approximation is acceptable.</p>
<figure class="align-default">
<img alt="Comparison of Pseudo-Voigt function with Gaussian and Lorentzian profiles." src="../../_images/PrimStretchedExpFT_fig1.png" />
</figure>
</section>
<section id="usage">
<span id="primstretchedexpft-usage"></span><h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p><strong>Example - Fit to a QENS signal:</strong></p>
<p>The QENS signal is modeled by the convolution of a resolution function
with elastic and PrimStretchedExpFT components.
Noise is modeled by a linear background:</p>
<p><span class="math notranslate nohighlight">\(S(Q,E) = R(Q,E) \otimes (\alpha \delta(E) + PrimStretchedExpFT(Q,E)) + (a+bE)\)</span></p>
<p>Obtaining an initial guess close to the optimal fit is critical. For this model,
it is recommended to follow these steps:
- In the Fit Function window of a plot MantidWorkbench, construct the model.
- Tie parameter <span class="math notranslate nohighlight">\(Height\)</span> of PrimStretchedExpFT to zero, then carry out the Fit. This will result in optimized elastic line and background.
- Untie parameter <span class="math notranslate nohighlight">\(Height\)</span> of PrimStretchedExpFT and tie parameter <span class="math notranslate nohighlight">\(Beta\)</span> to 1.0, then carry out the fit. This will result in optimized model using an exponential.
- Release the tie on Beta  and redo the fit.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load resolution function and scattered signal</span>
<span class="n">resolution</span> <span class="o">=</span> <span class="n">LoadNexus</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s2">&quot;resolution_14955.nxs&quot;</span><span class="p">)</span>
<span class="n">qens_data</span> <span class="o">=</span> <span class="n">LoadNexus</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s2">&quot;qens_data_14955.nxs&quot;</span><span class="p">)</span>

<span class="c1"># This function_string is obtained by constructing the model</span>
<span class="c1"># with the Fit Function window of a plot in MantidWorkbench, then</span>
<span class="c1"># Setup--&gt; Manage Setup --&gt; Copy to Clipboard</span>
<span class="n">function_string</span>  <span class="o">=</span> <span class="s2">&quot;(composite=Convolution,FixResolution=true,NumDeriv=true;&quot;</span>
<span class="n">function_string</span> <span class="o">+=</span> <span class="s2">&quot;name=TabulatedFunction,Workspace=resolution,WorkspaceIndex=0,Scaling=1,Shift=0,XScaling=1;&quot;</span>
<span class="n">function_string</span> <span class="o">+=</span> <span class="s2">&quot;(name=DeltaFunction,Height=1,Centre=0;&quot;</span>
<span class="n">function_string</span> <span class="o">+=</span> <span class="s2">&quot;name=PrimStretchedExpFT,Height=1.0,Tau=100,Beta=0.98,Centre=0));&quot;</span>
<span class="n">function_string</span> <span class="o">+=</span> <span class="s2">&quot;name=LinearBackground,A0=0,A1=0&quot;</span>

<span class="c1"># Carry out the fit. Produces workspaces  fit_results_Parameters,</span>
<span class="c1">#  fit_results_Workspace, and fit_results_NormalisedCovarianceMatrix.</span>
<span class="n">Fit</span><span class="p">(</span><span class="n">Function</span><span class="o">=</span><span class="n">function_string</span><span class="p">,</span>
   <span class="n">InputWorkspace</span><span class="o">=</span><span class="s2">&quot;qens_data&quot;</span><span class="p">,</span>
   <span class="n">WorkspaceIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
   <span class="n">StartX</span><span class="o">=-</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">EndX</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
   <span class="n">CreateOutput</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
   <span class="n">Output</span><span class="o">=</span><span class="s2">&quot;fit_results&quot;</span><span class="p">)</span>

<span class="c1"># Collect and print parameters for PrimStrechtedExpFT</span>
<span class="n">parameters_of_interest</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Tau&quot;</span><span class="p">,</span> <span class="s2">&quot;Beta&quot;</span><span class="p">)</span>
<span class="n">values_found</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s2">&quot;fit_results_Parameters&quot;</span><span class="p">]</span>  <span class="c1"># Workspace containing optimized parameters</span>
<span class="k">for</span> <span class="n">row_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
   <span class="n">full_parameter_name</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">row_index</span><span class="p">)[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span>
   <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">parameters_of_interest</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">full_parameter_name</span><span class="p">:</span>
         <span class="n">values_found</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">row_index</span><span class="p">)[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>
         <span class="k">break</span>
<span class="k">if</span> <span class="n">values_found</span><span class="p">[</span><span class="s2">&quot;Beta&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.63</span> <span class="ow">and</span> <span class="n">values_found</span><span class="p">[</span><span class="s2">&quot;Beta&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.71</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Beta found within [0.63, 0.71]&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">values_found</span><span class="p">[</span><span class="s2">&quot;Tau&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">54.0</span> <span class="ow">and</span> <span class="n">values_found</span><span class="p">[</span><span class="s2">&quot;Tau&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">60.0</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Tau found within [54.0, 60.0]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Beta found within [0.63, 0.71]
Tau found within [54.0, 60.0]
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/FitFunctions.html">FitFunctions</a> | <a class="reference external" href="categories/QuasiElastic.html">QuasiElastic</a></p>
</section>
<section id="source">
<h2>Source<a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/ec825fbd8c2d754b56329d9056e8016ac6d7b10a/Framework/PythonInterface/plugins/functions/PrimStretchedExpFT.py">PrimStretchedExpFT.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="PowerLaw.html" title="Previous Chapter: PowerLaw"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; PowerLaw</span>
    </a>
  </li>
  <li>
    <a href="ProductFunction.html" title="Next Chapter: ProductFunction"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">ProductFunction &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>