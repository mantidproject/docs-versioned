<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>IndirectILLReductionQENS v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="IndirectQuickRun v1" href="IndirectQuickRun-v1.html" />
    <link rel="prev" title="IndirectILLReductionFWS v1" href="IndirectILLReductionFWS-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">IndirectILLReductionQENS v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="indirectillreductionqens-v1">
<span id="algm-indirectillreductionqens"></span><span id="algm-indirectillreductionqens-v1"></span><h1>IndirectILLReductionQENS v1<a class="headerlink" href="#indirectillreductionqens-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/IndirectILLReductionQENS-v1_dlg.png"><img alt="../_images/IndirectILLReductionQENS-v1_dlg.png" class="screenshot" src="../_images/IndirectILLReductionQENS-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>IndirectILLReductionQENS</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p>
<ul>
<li><p><a class="reference internal" href="#multiple-file-reduction" id="id6">Multiple File Reduction</a></p></li>
<li><p><a class="reference internal" href="#unmirror-options" id="id7">Unmirror Options</a></p></li>
<li><p><a class="reference internal" href="#vanadium-calibration" id="id8">Vanadium Calibration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#output" id="id9">Output</a></p></li>
<li><p><a class="reference internal" href="#workflow" id="id10">Workflow</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id11">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id12">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Performs quasi-elastic neutron scattering (QENS) multiple file reduction for ILL indirect geometry data, instrument IN16B.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="IndirectILLReductionFWS-v1.html#algm-indirectillreductionfws"><span class="std std-ref">IndirectILLReductionFWS</span></a>, <a class="reference internal" href="IndirectILLEnergyTransfer-v1.html#algm-indirectillenergytransfer"><span class="std std-ref">IndirectILLEnergyTransfer</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Run</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Run number(s) of sample run(s). Allowed values: [‘nxs’]</p></td>
</tr>
<tr class="row-odd"><td><p>BackgroundRun</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td></td>
<td><p>Run number(s) of background (empty can) run(s). Allowed values: [‘nxs’]</p></td>
</tr>
<tr class="row-even"><td><p>CalibrationRun</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td></td>
<td><p>Run number(s) of vanadium calibration run(s). Allowed values: [‘nxs’]</p></td>
</tr>
<tr class="row-odd"><td><p>CalibrationBackgroundRun</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td></td>
<td><p>Run number(s) of background (empty can) run(s) for vanadium run. Allowed values: [‘nxs’]</p></td>
</tr>
<tr class="row-even"><td><p>AlignmentRun</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td></td>
<td><p>Run number(s) of vanadium run(s) used for peak alignment for UnmirrorOption=[5, 7]. Allowed values: [‘nxs’]</p></td>
</tr>
<tr class="row-odd"><td><p>SumRuns</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Whether to sum all the input runs.</p></td>
</tr>
<tr class="row-even"><td><p>CropDeadMonitorChannels</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Whether or not to exclude the first and last few channels with 0 monitor count in the energy transfer formula.</p></td>
</tr>
<tr class="row-odd"><td><p>UnmirrorOption</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>6</p></td>
<td><p>Unmirroring options :  0 no unmirroring 1 sum of left and right 2 left 3 right 4 shift right according to left and sum 5 like 4, but use alignment run for peak positions 6 center both left and right at zero and sum 7 like 6, but use alignment run for peak positions</p></td>
</tr>
<tr class="row-even"><td><p>BackgroundScalingFactor</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Scaling factor for background subtraction</p></td>
</tr>
<tr class="row-odd"><td><p>CalibrationBackgroundScalingFactor</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Scaling factor for background subtraction for vanadium calibration</p></td>
</tr>
<tr class="row-even"><td><p>CalibrationPeakRange</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>-0.003,0.003</p></td>
<td><p>Peak range for integration over calibration file peak (in mev)</p></td>
</tr>
<tr class="row-odd"><td><p>MapFile</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Filename of the detector grouping map file to use.  By default all the pixels will be summed per each tube.  Use .map or .xml file (see GroupDetectors documentation) only if different range is needed for each tube. Allowed values: [‘map’, ‘xml’]</p></td>
</tr>
<tr class="row-even"><td><p>ManualPSDIntegrationRange</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>1,128</p></td>
<td><p>Integration range of vertical pixels in each PSD tube.  By default all the pixels will be summed per each tube.  Use this option if the same range (other than default) is needed for all the tubes.</p></td>
</tr>
<tr class="row-odd"><td><p>Analyser</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>silicon</p></td>
<td><p>Analyser crystal. Allowed values: [‘silicon’]</p></td>
</tr>
<tr class="row-even"><td><p>Reflection</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>111</p></td>
<td><p>Analyser reflection. Allowed values: [‘111’, ‘311’]</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p>WorkspaceGroup</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Group name for the reduced workspace(s).</p></td>
</tr>
<tr class="row-even"><td><p>SpectrumAxis</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>SpectrumNumber</p></td>
<td><p>The spectrum axis conversion target. Allowed values: [‘SpectrumNumber’, ‘2Theta’, ‘Q’, ‘Q2’]</p></td>
</tr>
<tr class="row-odd"><td><p>DiscardSingleDetectors</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Whether to discard the spectra of single detectors.</p></td>
</tr>
<tr class="row-even"><td><p>GroupDetectors</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Group the pixels using the range, tube-by-tube (default) or in a custom way;  it is not recommended to group the detectors at this stage,  in order to get absorption corrections right,  however the default value is True for backwards compatibility.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>Performs a multiple-file QENS (Quasi-Elastic Neutron Scattering) data reduction for indirect geometry <strong>ILL</strong> instrument <strong>IN16B</strong>.
It uses internally the <a class="reference internal" href="IndirectILLEnergyTransfer-v1.html#algm-indirectillenergytransfer"><span class="std std-ref">IndirectILLEnergyTransfer</span></a> algorithm.</p>
<section id="multiple-file-reduction">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Multiple File Reduction</a><a class="headerlink" href="#multiple-file-reduction" title="Permalink to this heading">¶</a></h3>
<p>The algorithm is capable of running over multiple files.  Run property
needs to be specified following the syntax in <a class="reference internal" href="../api/python/mantid/api/MultipleFileProperty.html#mantid.api.MultipleFileProperty" title="mantid.api.MultipleFileProperty"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MultipleFileProperty</span></code></a>.
When <code class="docutils literal notranslate"><span class="pre">SumRuns=True</span></code>, all the runs will be merged while loading.
Note, for <strong>Range</strong> and <strong>Stepped Range</strong>, <code class="docutils literal notranslate"><span class="pre">SumRuns</span></code> will be
ignored.  Use <strong>Added Range</strong> and <strong>Added Stepped Range</strong> instead (see
<a class="reference internal" href="../api/python/mantid/api/MultipleFileProperty.html#mantid.api.MultipleFileProperty" title="mantid.api.MultipleFileProperty"><code class="xref py py-obj docutils literal notranslate"><span class="pre">MultipleFileProperty</span></code></a>).  For <code class="docutils literal notranslate"><span class="pre">BackgroundRun</span></code>,
<code class="docutils literal notranslate"><span class="pre">CalibrationRun</span></code>, <code class="docutils literal notranslate"><span class="pre">CalibrationBackgroundRun</span></code> and <code class="docutils literal notranslate"><span class="pre">AlignmentRun</span></code> all the runs will be automatically summed.</p>
</section>
<section id="unmirror-options">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Unmirror Options</a><a class="headerlink" href="#unmirror-options" title="Permalink to this heading">¶</a></h3>
<p><strong>IN16B</strong> can record data with mirror sense, where the spectra for the acceleration and
deceleration phase of the Doppler drive are recorded separately, or without.
Technically this is defined in the <code class="docutils literal notranslate"><span class="pre">Doppler.mirror_sense</span></code> entry in the sample logs.
For the data without mirror sense (i.e. mirror_sense = 16) only three unmirror options are valid:</p>
<p>0: No x-axis shift. (Options 0-5 will fall back to 0).</p>
<p>6: Centering the peaks at the zero energy transfer.</p>
<p>7: Centering the peaks using the corresponding vanadium alignment run.</p>
<p>For the data with mirror sense (i.e. mirror_sense = 14) there are 8 options available:</p>
<p>0: Left and right wings are returned separately.</p>
<p>1: Left and right wings will summed.</p>
<p>2: Left wing will be returned.</p>
<p>3: Right wing will be returned.</p>
<p>4: Peaks in the right wing will be positioned at peak positions in the left wing, and then they will be summed.</p>
<p>5: Right wing will be shifted according with the offsets of the peak positions in left and right wings in vanadium alignment run.</p>
<p>6: Peaks in both, left and right wings will be centered at zero energy transfer and then they will be summed.</p>
<p>7: Left and right wings will be shifted according to offsets of peak positions of left and right wings in corresponding vanadium alignment run.</p>
<p>Options 5 and 7 require the <code class="docutils literal notranslate"><span class="pre">AlignmentRun</span></code> (vanadium) to determine the peak positions to align with.</p>
<p><a class="reference internal" href="MatchPeaks-v1.html#algm-matchpeaks"><span class="std std-ref">MatchPeaks</span></a> algorithm is invoked for aligning the peaks with different options.</p>
<p>Note, that both detector calibration and background subtraction are performed wing-by-wing, i.e. unmirroring is the very final step.</p>
</section>
<section id="vanadium-calibration">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Vanadium Calibration</a><a class="headerlink" href="#vanadium-calibration" title="Permalink to this heading">¶</a></h3>
<p>Integration range can be specified to integrate over spectra in <code class="docutils literal notranslate"><span class="pre">CalibrationRun</span></code>. Note, that before integration, the spectra will be
centered at 0-energy transfer (see Unmirror Option 6 above) for the calibration run.</p>
</section>
</section>
<section id="output">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Output</a><a class="headerlink" href="#output" title="Permalink to this heading">¶</a></h2>
<p>A <a class="reference internal" href="../concepts/WorkspaceGroup.html#workspacegroup"><span class="std std-ref">WorkspaceGroup</span></a> will be returned, containing workspaces for each individual (unsummed) run.</p>
</section>
<section id="workflow">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Workflow</a><a class="headerlink" href="#workflow" title="Permalink to this heading">¶</a></h2>
<img alt="../_images/IndirectILLReductionQENS-v1_wkflw.svg" src="../_images/IndirectILLReductionQENS-v1_wkflw.svg" /></section>
<section id="usage">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p><strong>Example - IndirectILLReduction : default options</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">IndirectILLReductionQENS</span><span class="p">(</span><span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN16B/136553:136555.nxs&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Result is a WorkspaceGroup, that contains </span><span class="si">{:d}</span><span class="s2"> workspaces&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getNumberOfEntries</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;the name of the first one is </span><span class="si">{}</span><span class="s2"> corresponding to run 136553&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;it has </span><span class="si">{:d}</span><span class="s2"> spectra and </span><span class="si">{:d}</span><span class="s2"> bins&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">(),</span><span class="n">ws</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">blocksize</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Result is a WorkspaceGroup, that contains 3 workspaces
the name of the first one is 136553_ws_red corresponding to run 136553
it has 18 spectra and 1024 bins
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Workflow/MIDAS.html">Workflow\MIDAS</a> | <a class="reference external" href="categories/Workflow/Inelastic.html">Workflow\Inelastic</a> | <a class="reference external" href="categories/Inelastic/Indirect.html">Inelastic\Indirect</a> | <a class="reference external" href="categories/Inelastic/Reduction.html">Inelastic\Reduction</a> | <a class="reference external" href="categories/ILL/Indirect.html">ILL\Indirect</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/IndirectILLReductionQENS.py">IndirectILLReductionQENS.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="IndirectILLReductionFWS-v1.html" title="Previous Chapter: IndirectILLReductionFWS v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; IndirectILLRe...</span>
    </a>
  </li>
  <li>
    <a href="IndirectQuickRun-v1.html" title="Next Chapter: IndirectQuickRun v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">IndirectQuickRun v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>