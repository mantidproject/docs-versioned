<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>CalculateEfficiency v2</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CalculateEfficiencyCorrection v1" href="CalculateEfficiencyCorrection-v1.html" />
    <link rel="prev" title="CalculateEfficiency v1" href="CalculateEfficiency-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">CalculateEfficiency v2</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="calculateefficiency-v2">
<span id="algm-calculateefficiency"></span><span id="algm-calculateefficiency-v2"></span><h1>CalculateEfficiency v2<a class="headerlink" href="#calculateefficiency-v2" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/CalculateEfficiency-v2_dlg.png"><img alt="../_images/CalculateEfficiency-v2_dlg.png" class="screenshot" src="../_images/CalculateEfficiency-v2_dlg.png" style="width: 403px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>CalculateEfficiency</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id5">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id6">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Calculates the detector efficiency for a SANS instrument.</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The workspace containing the flood data</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>The name of the workspace to be created as the output of the algorithm</p></td>
</tr>
<tr class="row-even"><td><p>MinThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Minimum threshold for a pixel to be considered</p></td>
</tr>
<tr class="row-odd"><td><p>MaxThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>2</p></td>
<td><p>Maximum threshold for a pixel to be considered</p></td>
</tr>
<tr class="row-even"><td><p>MergeGroup</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Whether to merge entries when WorkspaceGroup is specified as input.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>Compute the detector efficiency of SANS data. This algorithm is used by
SANS reduction.</p>
<p>The flood is a short for flood field. The flood field is collected from a
sample that scatters uniformly in angle to ensure that every pixel on the
detector has the potential to see the same number of neutrons.
Different materials are currently used at the beamlines to measure the flood
field.  At present, the standard samples used for measuring the flood field
are H2O in a 1 mm path length cell for GP-SANS and Bio-SANS, and a 1 mm sheet
of PMMA for EQ-SANS.</p>
<p>In case the input is a <a class="reference internal" href="../concepts/WorkspaceGroup.html#workspacegroup"><span class="std std-ref">WorkspaceGroup</span></a>, it is processed
entry-by-entry if the <cite>MergeGroup</cite> property is set to False. Otherwise, the input
group is going to be merged and counts will be averaged. In addition, counts
in spectra that are masked in one of the entries of the group but not the other
will be replaced with values from the entry that has this spectrum not masked.
This allows, for example, for removal of the holes in the efficiency map caused
by masking the beam stop, provided at least two measurements are done at different,
e.g. horizontal, offsets.</p>
<p>The relative detector sensitivity is computed the following way</p>
<p><span class="math notranslate nohighlight">\(S(x,y)=\frac{I_{flood}(x,y)}{1/N_{pixels}\sum_{i,j}I_{flood}(i,j)}\)</span></p>
<p>where <span class="math notranslate nohighlight">\(I_{flood}(x,y)\)</span> is the pixel count of the flood data in pixel (x,y).
If a minimum and/or maximum sensitivity is given, the pixels having an
sensitivity outside the given limits are set to <cite>-inf</cite> (In Mantid <cite>EMPTY_DBL</cite>).</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p><strong>Example - Compute the detector efficiency from a BioSANS data file:</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load your data file</span>
<span class="n">workspace</span> <span class="o">=</span> <span class="n">LoadSpice2D</span><span class="p">(</span><span class="s1">&#39;BioSANS_empty_cell.xml&#39;</span><span class="p">)</span>

<span class="c1"># Compute the detector sensitivity</span>
<span class="n">sensitivity</span> <span class="o">=</span> <span class="n">CalculateEfficiency</span><span class="p">(</span><span class="s1">&#39;workspace&#39;</span><span class="p">,</span> <span class="n">MinThreshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">MaxThreshold</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load your data file</span>
<span class="n">workspace_group</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;D22_mask_central.nxs,D22_mask_offset.nxs&#39;</span><span class="p">)</span>

<span class="c1"># Compute the detector sensitivity</span>
<span class="n">sensitivity</span> <span class="o">=</span> <span class="n">CalculateEfficiency</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;workspace_group&#39;</span><span class="p">,</span> <span class="n">MergeGroup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">MinThreshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">MaxThreshold</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/SANS.html">SANS</a> | <a class="reference external" href="categories/CorrectionFunctions/EfficiencyCorrections.html">CorrectionFunctions\EfficiencyCorrections</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/Algorithms/inc/MantidAlgorithms/CalculateEfficiency2.h">CalculateEfficiency2.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/Algorithms/src/CalculateEfficiency2.cpp">CalculateEfficiency2.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CalculateEfficiency-v1.html" title="Previous Chapter: CalculateEfficiency v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; CalculateEffi...</span>
    </a>
  </li>
  <li>
    <a href="CalculateEfficiencyCorrection-v1.html" title="Next Chapter: CalculateEfficiencyCorrection v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">CalculateEffi... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>