<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>CountReflections v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CreateCacheFilename v1" href="CreateCacheFilename-v1.html" />
    <link rel="prev" title="CorrectToFile v1" href="CorrectToFile-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">CountReflections v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="countreflections-v1">
<span id="algm-countreflections"></span><span id="algm-countreflections-v1"></span><h1>CountReflections v1<a class="headerlink" href="#countreflections-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/CountReflections-v1_dlg.png"><img alt="../_images/CountReflections-v1_dlg.png" class="screenshot" src="../_images/CountReflections-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>CountReflections</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id6">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id7">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Calculates statistics for a PeaksWorkspace based on symmetry and counting reflections.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="PredictPeaks-v1.html#algm-predictpeaks"><span class="std std-ref">PredictPeaks</span></a>, <a class="reference internal" href="SortHKL-v1.html#algm-sorthkl"><span class="std std-ref">SortHKL</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p>PeaksWorkspace</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A workspace with peaks to calculate statistics for. Sample with valid UB-matrix is required.</p></td>
</tr>
<tr class="row-odd"><td><p>LatticeCentering</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>P</p></td>
<td><p>Lattice centering of the cell. Allowed values: [‘P’, ‘C’, ‘A’, ‘B’, ‘I’, ‘F’, ‘Robv’, ‘Rrev’, ‘H’]</p></td>
</tr>
<tr class="row-even"><td><p>PointGroup</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>1</p></td>
<td><p>Point group symmetry for completeness and redundancy calculations. Allowed values: [‘-1’, ‘-3’, ‘-3 r’, ‘-31m’, ‘-3m’, ‘-3m r’, ‘-3m1’, ‘-4’, ‘-42m’, ‘-43m’, ‘-4m2’, ‘-6’, ‘-62m’, ‘-6m2’, ‘1’, ‘112’, ‘112/m’, ‘11m’, ‘2’, ‘2/m’, ‘222’, ‘23’, ‘2mm’, ‘3’, ‘3 r’, ‘312’, ‘31m’, ‘32’, ‘32 r’, ‘321’, ‘3m’, ‘3m r’, ‘3m1’, ‘4’, ‘4/m’, ‘4/mmm’, ‘422’, ‘432’, ‘4mm’, ‘6’, ‘6/m’, ‘6/mmm’, ‘622’, ‘6mm’, ‘m’, ‘m-3’, ‘m-3m’, ‘m2m’, ‘mm2’, ‘mmm’]</p></td>
</tr>
<tr class="row-odd"><td><p>MinDSpacing</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Minimum d-spacing for completeness calculation.</p></td>
</tr>
<tr class="row-even"><td><p>MaxDSpacing</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>100</p></td>
<td><p>Maximum d-spacing for completeness calculation.</p></td>
</tr>
<tr class="row-odd"><td><p>UniqueReflections</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>Number of unique reflections in data set.</p></td>
</tr>
<tr class="row-even"><td><p>Completeness</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>Completeness of the data set as a fraction between 0 and 1.</p></td>
</tr>
<tr class="row-odd"><td><p>Redundancy</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>Average redundancy in data set, depending on point group.</p></td>
</tr>
<tr class="row-even"><td><p>MultiplyObserved</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>Fraction of reflections with more than one observation.</p></td>
</tr>
<tr class="row-odd"><td><p>MissingReflectionsWorkspace</p></td>
<td><p>Output</p></td>
<td><p>PeaksWorkspace</p></td>
<td></td>
<td><p>Reflections in specified d-range that are missing in input workspace.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>This algorithm computes some crystallographic data set quality indicators that are based
on counting reflections according to their Miller indices HKL. Intensity information is not
required for these indicators, so that the algorithm can also be used with predicted data
(for example generated by <a class="reference internal" href="PredictPeaks-v1.html#algm-predictpeaks"><span class="std std-ref">PredictPeaks v1</span></a>).</p>
<p>According to the specified lattice centering and the resolution boundaries, a set of
theoretically measurable reflections is generated. How the reflections are mapped to
a set of <span class="math notranslate nohighlight">\(N_{theor.}\)</span> unique reflections depends on the supplied point group. Then the
<span class="math notranslate nohighlight">\(N_{observed}\)</span> actually observed peaks from the input workspace are assigned to their
respective unique reflection, yielding <span class="math notranslate nohighlight">\(N_{unique}\)</span> observed unique reflections.</p>
<p>From this assignment it is possible to calculate the following indicators:</p>
<blockquote>
<div><ul class="simple">
<li><p>Unique reflections: <span class="math notranslate nohighlight">\(N_{unique}\)</span></p></li>
<li><p>Completeness: <span class="math notranslate nohighlight">\(\frac{N_{unique}}{N_{theor.}}\)</span></p></li>
<li><p>Redundancy: <span class="math notranslate nohighlight">\(\frac{N_{observed}}{N_{unique}}\)</span></p></li>
<li><p>Multiply observed reflections: <span class="math notranslate nohighlight">\(\frac{N_{unique} | N^{hkl}_{observed} &gt; 1}{N_{unique}}\)</span></p></li>
</ul>
</div></blockquote>
<p>Furthermore, the algorithm optionally produces a list of missing reflections. In this list,
each missing unique reflection is expanded to all symmetry equivalents according to the point
group. For example, if the reflection family <span class="math notranslate nohighlight">\(\{001\}\)</span> was missing
with point group <span class="math notranslate nohighlight">\(\bar{1}\)</span>, the list would contain <span class="math notranslate nohighlight">\((001)\)</span> and <span class="math notranslate nohighlight">\((00\bar{1})\)</span>.</p>
<p>The reason for expanding the unique reflections is to make the list more useful as an input
to <a class="reference internal" href="PredictPeaks-v1.html#algm-predictpeaks"><span class="std std-ref">PredictPeaks v1</span></a> again.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This algorithm has some overlap with <a class="reference internal" href="SortHKL-v1.html#algm-sorthkl"><span class="std std-ref">SortHKL v1</span></a>, which computes some of the indicators this
algorithm calculates, but in addition also evaluates intensity information. SortHKL only works with
peaks that carry intensity data while this algorithm also works without intensities.</p>
</div>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p>The usage example uses the same data as the usage test in <a class="reference internal" href="SortHKL-v1.html#algm-sorthkl"><span class="std std-ref">SortHKL v1</span></a>, but produces slightly different
data, because some intensities in the input file are 0, so these reflections are ignored by <a class="reference internal" href="SortHKL-v1.html#algm-sorthkl"><span class="std std-ref">SortHKL v1</span></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load example peak data and find cell</span>
<span class="n">peaks</span> <span class="o">=</span> <span class="n">LoadIsawPeaks</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Peaks5637.integrate&#39;</span><span class="p">)</span>

<span class="n">FindUBUsingFFT</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">MinD</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">MaxD</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">Tolerance</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">SelectCellWithForm</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">FormNumber</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">Apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Tolerance</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">OptimizeLatticeForCellType</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">CellType</span><span class="o">=</span><span class="s1">&#39;Hexagonal&#39;</span><span class="p">,</span> <span class="n">Apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Tolerance</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="c1"># Run the SortHKL algorithm</span>
<span class="n">unique</span><span class="p">,</span> <span class="n">completeness</span><span class="p">,</span> <span class="n">redundancy</span><span class="p">,</span> <span class="n">multiple</span> <span class="o">=</span> <span class="n">CountReflections</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">PointGroup</span><span class="o">=</span><span class="s1">&#39;-3m1&#39;</span><span class="p">,</span>
                                                              <span class="n">LatticeCentering</span><span class="o">=</span><span class="s1">&#39;Robv&#39;</span><span class="p">,</span> <span class="n">MinDSpacing</span><span class="o">=</span><span class="mf">0.205</span><span class="p">,</span>
                                                              <span class="n">MaxDSpacing</span><span class="o">=</span><span class="mf">2.08</span><span class="p">,</span> <span class="n">MissingReflectionsWorkspace</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data set statistics:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;             Peaks: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peaks</span><span class="o">.</span><span class="n">getNumberPeaks</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;            Unique: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unique</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;      Completeness: </span><span class="si">{0}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">completeness</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        Redundancy: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">redundancy</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Multiply observed: </span><span class="si">{0}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">multiple</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Data set statistics:
             Peaks: 434
            Unique: 358
      Completeness: 9.57%
        Redundancy: 1.21
 Multiply observed: 20.67%
</pre></div>
</div>
<p>The resulting completeness is slightly higher than in the SortHKL case, but for actual statistics it might be
better to remove the zero intensity peaks from the workspace prior to running the algorithm.</p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Crystal/Peaks.html">Crystal\Peaks</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/ec01dd0095c93d22fbc1c7a502ff628a4fee9a76/Framework/Crystal/inc/MantidCrystal/CountReflections.h">CountReflections.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/ec01dd0095c93d22fbc1c7a502ff628a4fee9a76/Framework/Crystal/src/CountReflections.cpp">CountReflections.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CorrectToFile-v1.html" title="Previous Chapter: CorrectToFile v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; CorrectToFile v1</span>
    </a>
  </li>
  <li>
    <a href="CreateCacheFilename-v1.html" title="Next Chapter: CreateCacheFilename v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">CreateCacheFi... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>