<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>ConvolutionFitSimultaneous v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ConvolveWorkspaces v1" href="ConvolveWorkspaces-v1.html" />
    <link rel="prev" title="ConvolutionFitSequential v1" href="ConvolutionFitSequential-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">ConvolutionFitSimultaneous v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="convolutionfitsimultaneous-v1">
<span id="algm-convolutionfitsimultaneous"></span><span id="algm-convolutionfitsimultaneous-v1"></span><h1>ConvolutionFitSimultaneous v1<a class="headerlink" href="#convolutionfitsimultaneous-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ConvolutionFitSimultaneous-v1_dlg.png"><img alt="../_images/ConvolutionFitSimultaneous-v1_dlg.png" class="screenshot" src="../_images/ConvolutionFitSimultaneous-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>ConvolutionFitSimultaneous</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#workflow" id="id6">Workflow</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id7">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id8">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Performs a simultaneous fit across convolution workspaces</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="QENSFitSimultaneous-v1.html#algm-qensfitsimultaneous"><span class="std std-ref">QENSFitSimultaneous</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Function</p></td>
<td><p>InOut</p></td>
<td><p>Function</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Parameters defining the fitting function and its initial values</p></td>
</tr>
<tr class="row-odd"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Name of the input Workspace</p></td>
</tr>
<tr class="row-even"><td><p>IgnoreInvalidData</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Flag to ignore infinities, NaNs and data with zero errors.</p></td>
</tr>
<tr class="row-odd"><td><p>DomainType</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Simple</p></td>
<td><p>The type of function domain to use: Simple, Sequential, or Parallel. Allowed values: [‘Simple’, ‘Sequential’, ‘Parallel’]</p></td>
</tr>
<tr class="row-even"><td><p>EvaluationType</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>CentrePoint</p></td>
<td><p>The way the function is evaluated on histogram data sets. If value is “CentrePoint” then function is evaluated at centre of each bin. If it is “Histogram” then function is integrated within the bin and the integrals returned. Allowed values: [‘CentrePoint’, ‘Histogram’]</p></td>
</tr>
<tr class="row-odd"><td><p>StepSizeMethod</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Default</p></td>
<td><p>The way the step size is calculated for numerical derivatives. See the section about step sizes in the Fit algorithm documentation to understand the difference between “Default” and “Sqrt epsilon”. Allowed values: [‘Default’, ‘Sqrt epsilon’]</p></td>
</tr>
<tr class="row-even"><td><p>PeakRadius</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>A value of the peak radius the peak functions should use. A peak radius defines an interval on the x axis around the centre of the peak where its values are calculated. Values outside the interval are not calculated and assumed zeros.Numerically the radius is a whole number of peak widths (FWHM) that fit into the interval on each side from the centre. The default value of 0 means the whole x axis.</p></td>
</tr>
<tr class="row-odd"><td><p>Ties</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Math expressions defining ties between parameters of the fitting function.</p></td>
</tr>
<tr class="row-even"><td><p>Constraints</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>List of constraints</p></td>
</tr>
<tr class="row-odd"><td><p>MaxIterations</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>500</p></td>
<td><p>Stop after this number of iterations if a good fit is not found</p></td>
</tr>
<tr class="row-even"><td><p>Minimizer</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Levenberg-Marquardt</p></td>
<td><p>Minimizer to use for fitting. Allowed values: [‘BFGS’, ‘Conjugate gradient (Fletcher-Reeves imp.)’, ‘Conjugate gradient (Polak-Ribiere imp.)’, ‘Damped GaussNewton’, ‘FABADA’, ‘Levenberg-Marquardt’, ‘Levenberg-MarquardtMD’, ‘Simplex’, ‘SteepestDescent’, ‘Trust Region’]</p></td>
</tr>
<tr class="row-odd"><td><p>CalcErrors</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Set to true to calcuate errors when output isn’t created (default is false).</p></td>
</tr>
<tr class="row-even"><td><p>ExtractMembers</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If true, then each member of the fit will be extracted, into their own workspace. These workspaces will have a histogram for each spectrum (Q-value) and will be grouped.</p></td>
</tr>
<tr class="row-odd"><td><p>ConvolveMembers</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If true members of any Convolution are output convolved with corresponding resolution</p></td>
</tr>
<tr class="row-even"><td><p>OutputCompositeMembers</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If true and CreateOutput is true then the value of each member of a Composite Function is also output.</p></td>
</tr>
<tr class="row-odd"><td><p>ResultXAxisUnit</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>MomentumTransfer</p></td>
<td><p>The unit to assign to the X Axis of the result workspace, defaults to MomentumTransfer. Allowed values: [‘AtomicDistance’, ‘Degrees’, ‘DeltaE’, ‘DeltaE_inFrequency’, ‘DeltaE_inWavenumber’, ‘dSpacing’, ‘dSpacingPerpendicular’, ‘Empty’, ‘Energy’, ‘Energy_inWavenumber’, ‘Label’, ‘Momentum’, ‘MomentumTransfer’, ‘Phi’, ‘QSquared’, ‘SpinEchoLength’, ‘SpinEchoTime’, ‘Temperature’, ‘Time’, ‘TOF’, ‘Wavelength’, ‘’]</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p>WorkspaceGroup</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The output result workspace(s)</p></td>
</tr>
<tr class="row-odd"><td><p>OutputParameterWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>The output parameter workspace</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspaceGroup</p></td>
<td><p>Output</p></td>
<td><p>WorkspaceGroup</p></td>
<td></td>
<td><p>The output group workspace</p></td>
</tr>
<tr class="row-odd"><td><p>OutputFitStatus</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Flag to output fit status information, which consists of the fit OutputStatus and the OutputChiSquared</p></td>
</tr>
<tr class="row-even"><td><p>CostFunction</p></td>
<td><p>InOut</p></td>
<td><p>string</p></td>
<td><p>Least squares</p></td>
<td><p>The cost function to be used for the fit, default is Least squares. Allowed values: [‘Least squares’, ‘Poisson’, ‘Rwp’, ‘Unweighted least squares’]</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>Performs a simultaneous fit involving a convolution with a defined resolution. This algorithm is a special-case of
<a class="reference internal" href="QENSFitSimultaneous-v1.html#algm-qensfitsimultaneous"><span class="std std-ref">QENSFitSimultaneous</span></a>, which calculates the elastic incoherent scattering factor when
a delta function is provided in the fitting model.</p>
</section>
<section id="workflow">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Workflow</a><a class="headerlink" href="#workflow" title="Permalink to this heading">¶</a></h2>
<img alt="../_images/QENSFitSimultaneous-v1_wkflw.svg" src="../_images/QENSFitSimultaneous-v1_wkflw.svg" /></section>
<section id="usage">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p><strong>Example - ConvolutionFitSimultaneous</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load sample and resolution files</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;irs26176_graphite002_red.nxs&#39;</span><span class="p">)</span>
<span class="n">resolution</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;irs26173_graphite002_red.nxs&#39;</span><span class="p">)</span>

<span class="c1"># Set up algorithm parameters</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">LinearBackground</span><span class="p">(</span><span class="n">A0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">A1</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">peak_function</span> <span class="o">=</span> <span class="n">Lorentzian</span><span class="p">(</span><span class="n">Amplitude</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">PeakCentre</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">FWHM</span><span class="o">=</span><span class="mf">0.0175</span><span class="p">)</span>
<span class="n">resolution_function</span> <span class="o">=</span> <span class="n">Resolution</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="n">resolution</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="n">WorkspaceIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CompositeFunction</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="n">Convolution</span><span class="p">(</span><span class="n">peak_function</span><span class="p">,</span> <span class="n">resolution_function</span><span class="p">))</span>
<span class="n">multi_function</span> <span class="o">=</span> <span class="n">MultiDomainFunction</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="n">startX</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.547608</span>
<span class="n">endX</span> <span class="o">=</span> <span class="mf">0.543217</span>
<span class="n">specMin</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">specMax</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">convolve</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Convolve the fitted model components with the resolution</span>
<span class="n">minimizer</span> <span class="o">=</span> <span class="s2">&quot;Levenberg-Marquardt&quot;</span>
<span class="n">maxIt</span> <span class="o">=</span> <span class="mi">500</span>

<span class="c1"># Run algorithm (fit spectra 1 and 2)</span>
<span class="n">result</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">fit_group</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">chi2</span> <span class="o">=</span> <span class="n">ConvolutionFitSimultaneous</span><span class="p">(</span><span class="n">Function</span><span class="o">=</span><span class="n">multi_function</span><span class="p">,</span>
                                                                     <span class="n">InputWorkspace</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
                                                                     <span class="n">WorkspaceIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                     <span class="n">InputWorkspace_1</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
                                                                     <span class="n">WorkspaceIndex_1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                                     <span class="n">StartX</span><span class="o">=</span><span class="n">startX</span><span class="p">,</span> <span class="n">EndX</span><span class="o">=</span><span class="n">endX</span><span class="p">,</span>
                                                                     <span class="n">StartX_1</span><span class="o">=</span><span class="n">startX</span><span class="p">,</span> <span class="n">EndX_1</span><span class="o">=</span><span class="n">endX</span><span class="p">,</span>
                                                                     <span class="n">ConvolveMembers</span><span class="o">=</span><span class="n">convolve</span><span class="p">,</span>
                                                                     <span class="n">Minimizer</span><span class="o">=</span><span class="n">minimizer</span><span class="p">,</span>
                                                                     <span class="n">MaxIterations</span><span class="o">=</span><span class="n">maxIt</span><span class="p">,</span>
                                                                     <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;ConvFitResult&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Workflow/MIDAS.html">Workflow\MIDAS</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/CurveFitting/inc/MantidCurveFitting/Algorithms/ConvolutionFit.h">ConvolutionFit.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/CurveFitting/src/Algorithms/ConvolutionFit.cpp">ConvolutionFit.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="ConvolutionFitSequential-v1.html" title="Previous Chapter: ConvolutionFitSequential v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; ConvolutionFi...</span>
    </a>
  </li>
  <li>
    <a href="ConvolveWorkspaces-v1.html" title="Next Chapter: ConvolveWorkspaces v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">ConvolveWorkspaces v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>