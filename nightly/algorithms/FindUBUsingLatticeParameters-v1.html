<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>FindUBUsingLatticeParameters v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FindUBUsingMinMaxD v1" href="FindUBUsingMinMaxD-v1.html" />
    <link rel="prev" title="FindUBUsingIndexedPeaks v1" href="FindUBUsingIndexedPeaks-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">FindUBUsingLatticeParameters v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="findubusinglatticeparameters-v1">
<span id="algm-findubusinglatticeparameters"></span><span id="algm-findubusinglatticeparameters-v1"></span><h1>FindUBUsingLatticeParameters v1<a class="headerlink" href="#findubusinglatticeparameters-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/FindUBUsingLatticeParameters-v1_dlg.png"><img alt="../_images/FindUBUsingLatticeParameters-v1_dlg.png" class="screenshot" src="../_images/FindUBUsingLatticeParameters-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>FindUBUsingLatticeParameters</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id6">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id7">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Calculate the UB matrix from a peaks workspace, given lattice parameters.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="SetUB-v1.html#algm-setub"><span class="std std-ref">SetUB</span></a>, <a class="reference internal" href="FindUBUsingFFT-v1.html#algm-findubusingfft"><span class="std std-ref">FindUBUsingFFT</span></a>, <a class="reference internal" href="FindUBUsingIndexedPeaks-v1.html#algm-findubusingindexedpeaks"><span class="std std-ref">FindUBUsingIndexedPeaks</span></a>, <a class="reference internal" href="FindUBUsingMinMaxD-v1.html#algm-findubusingminmaxd"><span class="std std-ref">FindUBUsingMinMaxD</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PeaksWorkspace</p></td>
<td><p>InOut</p></td>
<td><p>IPeaksWorkspace</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Input Peaks Workspace</p></td>
</tr>
<tr class="row-odd"><td><p>a</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Lattice parameter a</p></td>
</tr>
<tr class="row-even"><td><p>b</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Lattice parameter b</p></td>
</tr>
<tr class="row-odd"><td><p>c</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Lattice parameter c</p></td>
</tr>
<tr class="row-even"><td><p>alpha</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Lattice parameter alpha</p></td>
</tr>
<tr class="row-odd"><td><p>beta</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Lattice parameter beta</p></td>
</tr>
<tr class="row-even"><td><p>gamma</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Lattice parameter gamma</p></td>
</tr>
<tr class="row-odd"><td><p>NumInitial</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>15</p></td>
<td><p>Number of Peaks to Use on First Pass(15)</p></td>
</tr>
<tr class="row-even"><td><p>Tolerance</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.15</p></td>
<td><p>Indexing Tolerance (0.15)</p></td>
</tr>
<tr class="row-odd"><td><p>FixParameters</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Do not optimise the UB after finding the orientation</p></td>
</tr>
<tr class="row-even"><td><p>Iterations</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Iterations to refine UB (1)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>Given a set of peaks, and given lattice parameters
(<span class="math notranslate nohighlight">\(a,b,c,alpha,beta,gamma\)</span>), this algorithm will find the
<a class="reference internal" href="../concepts/Lattice.html#lattice"><span class="std std-ref">UB matrix</span></a>, that best fits the data. The algorithm
searches over a large range of possible orientations for the orientation
for which the rotated B matrix best fits the data. The search for the
best orientation involves several steps.</p>
<p>During the first step, a reduced set of peaks typically at lower |Q|
are used, since it is easier to index peaks at low |Q|. Specifically,
if there are at least 5 peaks, the peaks are shifted to be centered at
the strongest peaks and then sorted in order of increasing distance from
the strongest peak. If there are fewer than 5 peaks the list is just
sorted in order of increasing |Q|. Only peaks from the initial portion
of this sorted list are used in the first step. The number of peaks from
this list to be used initially is specified by the user with the
parameter NumInitial. The search first finds a list of possible
orientations for which the <a class="reference internal" href="../concepts/Lattice.html#lattice"><span class="std std-ref">UB matrix</span></a> will index the maximum
number of peaks from the initial set of peaks to within the specified tolerance
on h,k,l values. Subsequently, only the <a class="reference internal" href="../concepts/Lattice.html#lattice"><span class="std std-ref">UB matrix</span></a> that indexes
that maximum number of peaks with the minimum distance between the calculated h,k,l
values and integers is kept and passed on to the second step.</p>
<p>During the second step, additional peaks are gradually added to the
initial list of peaks. Each time peaks are added to the list, the subset
of peaks from the new list that are indexed within the specified
tolerance on k,k,l are used in a least squares calculation to optimize
the <a class="reference internal" href="../concepts/Lattice.html#lattice"><span class="std std-ref">UB matrix</span></a> to best index those peaks. The process of
gradually adding more peaks from the sorted list and optimizing the UB based
on the peaks that are indexed, continues until all peaks have been added to
the list. Finally, one last optimization of the <a class="reference internal" href="../concepts/Lattice.html#lattice"><span class="std std-ref">UB matrix</span></a> is
carried out using the full list of peaks.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p><strong>Example:</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span><span class="o">=</span><span class="n">LoadIsawPeaks</span><span class="p">(</span><span class="s2">&quot;TOPAZ_3007.peaks&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After LoadIsawPeaks does the workspace have an orientedLattice: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">hasOrientedLattice</span><span class="p">()))</span>

<span class="n">FindUBUsingLatticeParameters</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mf">14.131</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mf">19.247</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mf">8.606</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="mf">105.071</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span><span class="n">NumInitial</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After FindUBUsingLatticeParameters does the workspace have an orientedLattice: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">hasOrientedLattice</span><span class="p">()))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">getOrientedLattice</span><span class="p">()</span><span class="o">.</span><span class="n">getUB</span><span class="p">())</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>After LoadIsawPeaks does the workspace have an orientedLattice: False
After FindUBUsingLatticeParameters does the workspace have an orientedLattice: True
[[ 0.04542062  0.04061954  0.01223576]
 [-0.00140377 -0.00318446 -0.11654506]
 [-0.05749773  0.03223779 -0.02737294]]
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Crystal/UBMatrix.html">Crystal\UBMatrix</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/Crystal/inc/MantidCrystal/FindUBUsingLatticeParameters.h">FindUBUsingLatticeParameters.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/Crystal/src/FindUBUsingLatticeParameters.cpp">FindUBUsingLatticeParameters.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="FindUBUsingIndexedPeaks-v1.html" title="Previous Chapter: FindUBUsingIndexedPeaks v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; FindUBUsingIn...</span>
    </a>
  </li>
  <li>
    <a href="FindUBUsingMinMaxD-v1.html" title="Next Chapter: FindUBUsingMinMaxD v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">FindUBUsingMinMaxD v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>