<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>GetEi v2</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GetEiMonDet v3" href="GetEiMonDet-v3.html" />
    <link rel="prev" title="GetEi v1" href="GetEi-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">GetEi v2</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="getei-v2">
<span id="algm-getei"></span><span id="algm-getei-v2"></span><h1>GetEi v2<a class="headerlink" href="#getei-v2" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/GetEi-v2_dlg.png"><img alt="../_images/GetEi-v2_dlg.png" class="screenshot" src="../_images/GetEi-v2_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>GetEi</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id6">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id7">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Calculates the kinetic energy of neutrons leaving the source based on the time it takes for them to travel between two monitors.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="GetAllEi-v1.html#algm-getallei"><span class="std std-ref">GetAllEi</span></a>, <a class="reference internal" href="GetEiMonDet-v3.html#algm-geteimondet"><span class="std std-ref">GetEiMonDet</span></a>, <a class="reference internal" href="GetEiT0atSNS-v1.html#algm-geteit0atsns"><span class="std std-ref">GetEiT0atSNS</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>InOut</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The X units of this workspace must be time of flight with times in microseconds</p></td>
</tr>
<tr class="row-odd"><td><p>Monitor1Spec</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The spectrum number of the output of the first monitor, e.g. MAPS 41474, MARI 2, MERLIN 69634.  If empty, it will be read from the instrument file.</p></td>
</tr>
<tr class="row-even"><td><p>Monitor2Spec</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The spectrum number of the output of the second monitor e.g. MAPS 41475, MARI 3, MERLIN 69638.  If empty, it will be read from the instrument file.</p></td>
</tr>
<tr class="row-odd"><td><p>EnergyEstimate</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>An approximate value for the typical incident energy, energy of neutrons leaving the source (meV)  Can be empty if there is a Sample Log called EnergyRequest. Otherwise it is mandatory.</p></td>
</tr>
<tr class="row-even"><td><p>FixEi</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If true, the incident energy will be set to the value of the  EnergyEstimate property.</p></td>
</tr>
<tr class="row-odd"><td><p>IncidentEnergy</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>The energy of neutron in meV, it is also printed to the Mantid’s log</p></td>
</tr>
<tr class="row-even"><td><p>FirstMonitorPeak</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>The time in <span class="math notranslate nohighlight">\(\rm{\mu s}\)</span> when the count rate of the first monitor, which defaults to the last monitor the beam hits before the sample, is greatest. It is the mean X value for the bin with the highest number of counts per second and is also writen to Mantid’s log.</p></td>
</tr>
<tr class="row-odd"><td><p>FirstMonitorIndex</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>The workspace index of the first monitor in the input workspace.</p></td>
</tr>
<tr class="row-even"><td><p>Tzero</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>PeakSearchRange</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.1</p></td>
<td><p>Specifies the relative TOF range where the algorithm tries to find the monitor peak. Search occurs within PEAK_TOF_Guess * (1 +/- PeakSearchRange) ranges. Defaults are almost always sufficient but decrease this value for very narrow peaks and increase for wide.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>Uses <span class="math notranslate nohighlight">\(E=\frac{1}{2}mv^2\)</span> to calculate the energy of neutrons leaving the
source. The velocity is calculated from the time it takes for the
neutron pulse to travel between the two monitors whose spectra were
specified. If no spectra are specified, the algorithm will use the
defaults for the instrument.</p>
<p>An initial energy guess is required for the algorithm to find the
correct peak. The analysis will be done on the highest peak that is
within 8% of the estimated TOF given by the estimate. If no initial
guess is given, the algorithm will try to get it from the workspace,
from a sample log variable called <em>EnergyRequest</em>.</p>
<p>Not all neutrons arrive at the monitors at the same time because their
kinetic energies, and therefore velocities, are all different. The time
of arrival of the neutron pulse is taken to be the mean of the two half
peak height locations. The half height points are found as follows:</p>
<ol class="arabic simple">
<li><p>the peak height is the largest number of counts above the background
in any bin in the window</p></li>
<li><p>the half height is half the above number</p></li>
<li><p>examine bins to the left of the bin with the highest number of counts
looking for a bin with less than half that number above background</p></li>
<li><p>interpolate between this point bin and the one immediately previous
to find the first half height location</p></li>
<li><p>repeat the steps 3 and 4 looking to the right of the highest point to
get the second half height point</p></li>
<li><p>the mean of the X-values of the two half height points is the TOF
arrival time of the neutrons</p></li>
</ol>
<p>The above process is illustrated on a peak is shown below in the image
below.</p>
<a class="reference internal image-reference" href="../_images/Monitorspect_getei.jpg"><img alt="Monitor Peak" class="align-center" src="../_images/Monitorspect_getei.jpg" style="width: 618px;" /></a>
<p>The distances between the monitors are read from the instrument
definition file. It is assumed that the source and the monitors all lie
on one line and that the monitors have the same delay time.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p><strong>Example: Fixing the Ei</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">bankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">binWidth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="p">(</span><span class="n">ei</span><span class="p">,</span> <span class="n">firstMonitorPeak</span><span class="p">,</span> <span class="n">FirstMonitorIndex</span><span class="p">,</span> <span class="n">tzero</span><span class="p">)</span> <span class="o">=</span> <span class="n">GetEi</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">Monitor1Spec</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Monitor2Spec</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">EnergyEstimate</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span><span class="n">FixEi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ei: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ei</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;firstMonitorPeak: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">firstMonitorPeak</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FirstMonitorIndex: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FirstMonitorIndex</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tzero: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tzero</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ei: 15.00
firstMonitorPeak: 8854.69
FirstMonitorIndex: 0
tzero: 0.00
</pre></div>
</div>
<p><strong>ISIS Example</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s2">&quot;MAR11001.raw&quot;</span><span class="p">)</span>
<span class="c1"># Workspace contains monitors</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">GetEi</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">EnergyEstimate</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="c1"># Output from algorithm is a tuple of the following values:</span>
<span class="c1"># (IncidentEnergy, FirstMonitorPeak, FirstMonitorIndex, TZero)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculated Incident Energy = </span><span class="si">{:.10f}</span><span class="s2"> meV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First Monitor Peak = </span><span class="si">{:.8f}</span><span class="s2"> microseconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Calculated Incident Energy = 12.9728953307 meV
First Monitor Peak = 6536.70777852 microseconds
</pre></div>
</div>
<p><strong>SNS Example</strong></p>
<p>CNCS and HYSPEC do not actually calculate the incident energy, but use the
<em>EnergyRequest</em> log value as the calculated incident energy. ARCS and SEQUOIA,
however, do perform the calculation for the incident energy. Also, SNS instruments
use the negative of the TZero output value in further calculations.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s2">&quot;CNCS_7860_event.nxs&quot;</span><span class="p">,</span> <span class="n">LoadMonitors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Need monitor workspace, as main workspace does not.</span>
<span class="c1"># Energy estimate not manditory for SNS instruments</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">GetEi</span><span class="p">(</span><span class="n">ws</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculated Incident Energy = </span><span class="si">{:.1f}</span><span class="s2"> meV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time Zero = </span><span class="si">{:.10f}</span><span class="s2"> microseconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="n">vals</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Calculated Incident Energy = 3.0 meV
Time Zero = -61.7708018029 microseconds
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Inelastic/Ei.html">Inelastic\Ei</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/Algorithms/inc/MantidAlgorithms/GetEi2.h">GetEi2.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/Algorithms/src/GetEi2.cpp">GetEi2.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="GetEi-v1.html" title="Previous Chapter: GetEi v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; GetEi v1</span>
    </a>
  </li>
  <li>
    <a href="GetEiMonDet-v3.html" title="Next Chapter: GetEiMonDet v3"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">GetEiMonDet v3 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>