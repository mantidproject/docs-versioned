<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>MultipleScatteringCorrection v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Multiply v1" href="Multiply-v1.html" />
    <link rel="prev" title="MoveInstrumentComponent v1" href="MoveInstrumentComponent-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">MultipleScatteringCorrection v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="multiplescatteringcorrection-v1">
<span id="algm-multiplescatteringcorrection"></span><span id="algm-multiplescatteringcorrection-v1"></span><h1>MultipleScatteringCorrection v1<a class="headerlink" href="#multiplescatteringcorrection-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/MultipleScatteringCorrection-v1_dlg.png"><img alt="../_images/MultipleScatteringCorrection-v1_dlg.png" class="screenshot" src="../_images/MultipleScatteringCorrection-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>MultipleScatteringCorrection</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#example" id="id6">Example</a></p></li>
<li><p><a class="reference internal" href="#source" id="id7">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Calculate Multiple Scattering Correction using numerical integration with the assumption ofelastic and isotropic scattering only.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="CalculateCarpenterSampleCorrection-v1.html#algm-calculatecarpentersamplecorrection"><span class="std std-ref">CalculateCarpenterSampleCorrection</span></a>, <a class="reference internal" href="CarpenterSampleCorrection-v1.html#algm-carpentersamplecorrection"><span class="std std-ref">CarpenterSampleCorrection</span></a>, <a class="reference internal" href="MayersSampleCorrection-v1.html#algm-mayerssamplecorrection"><span class="std std-ref">MayersSampleCorrection</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The X values for the input workspace must be in units of wavelength</p></td>
</tr>
<tr class="row-odd"><td><p>NumberOfWavelengthPoints</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The number of wavelength points for which the numerical integral is calculated (default: all points)</p></td>
</tr>
<tr class="row-even"><td><p>ElementSize</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>The size of one side of an integration element cube in mm</p></td>
</tr>
<tr class="row-odd"><td><p>ContainerElementSize</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The size of one side of an integration element cube in mm for container.Default to be the same as ElementSize.</p></td>
</tr>
<tr class="row-even"><td><p>Method</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>SampleOnly</p></td>
<td><p>Correction method, use either SampleOnly or SampleAndContainer. Allowed values: [‘SampleOnly’, ‘SampleAndContainer’]</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p>WorkspaceGroup</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Output workspace name. A Workspace2D containing the correction matrix that can be directly applied to the corresponding Event workspace for multiple scattering correction.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>This algorithm uses numerical integration to approximate the sample correction factor for multiple scattering events
using the formula detailed in the concept page of Absorption and Multiple Scattering Corrections.</p>
<p>Here is a quick recap of the physical model used in the numerical integration.
The scattered neutron can bounce into another atom before leaving the sample when the sample is sufficiently thick, leading to
a double scattering event.</p>
<figure class="align-default">
<img alt="MultipleScatteringVolume.png" src="../_images/MultipleScatteringVolume.png" />
</figure>
<p>With the assumption of elastic and isotropic scattering as well as the approximation where we assume the intensity ratio
between incoming and outgoing neutron are a fixed value, the multiple scattering intensity can be expressed as</p>
<div class="math notranslate nohighlight" id="equation-im-final">
<span class="eqno">(1)<a class="headerlink" href="#equation-im-final" title="Permalink to this equation">¶</a></span>\[I_{m} = I_{total} \frac{\rho \sigma_{s} A_{2}}{4 \pi A_{1}}\]</div>
<p>where <span class="math notranslate nohighlight">\(I_{total}\)</span> is the measured intensity, <span class="math notranslate nohighlight">\(\rho\)</span> is the effective number density, and <span class="math notranslate nohighlight">\(\sigma_{s}\)</span> is the
total scattering cross section.
The term <span class="math notranslate nohighlight">\(A_{1}\)</span> is a function of wavelength, and can be defined as</p>
<div class="math notranslate nohighlight" id="equation-a1-final">
<span class="eqno">(2)<a class="headerlink" href="#equation-a1-final" title="Permalink to this equation">¶</a></span>\[A_{1}(\lambda) = \int_V exp[-\mu(\lambda)(l_1 + l_2)] dV\]</div>
<p>where <span class="math notranslate nohighlight">\(\mu\)</span> is the sample absorption coefficient (a function of wavelength), <span class="math notranslate nohighlight">\(l_1\)</span> is the distance from source to
scattering volume one, and <span class="math notranslate nohighlight">\(l_2\)</span> is the distance from volume two to the detector.
Similarly, <span class="math notranslate nohighlight">\(A_{2}\)</span> can be defined as</p>
<div class="math notranslate nohighlight" id="equation-a2-final">
<span class="eqno">(3)<a class="headerlink" href="#equation-a2-final" title="Permalink to this equation">¶</a></span>\[A_2(\lambda) = \int_V\int_V\frac{exp[-\mu(\lambda)(l_1 + l_{12} + l_2)]}{l_{12}^2}dVdV\]</div>
<p>where <span class="math notranslate nohighlight">\(l_{12}\)</span> is the distance between volume one and volume two.</p>
<p>This algorithm uses a rasterizer internally to compute all the distances and angles, therefore it is crucial to have the instrument
and sample geometry properly defined within the input workspace.
Also, both <span class="math notranslate nohighlight">\(l_1\)</span> and <span class="math notranslate nohighlight">\(l_{12}\)</span> are pre-computed and cached as 1D vector, which tends to occupy a significant amount of
memory when the selected element size is below the standard 1 mm.
Some operating system will stop Mantid from claiming/reserving the memory, leading to a memory allocation error at the starting
stage.
This is a known limitation and we are actively searching for a solution.</p>
<p>By default, the algorithm uses the <code class="docutils literal notranslate"><span class="pre">SampleOnly</span></code> method where it ignores container’s contribution as well as its interaction with sample.
When <code class="docutils literal notranslate"><span class="pre">SampleAndContainer</span></code> is selected, the algorithm will compute the distance within sample and container separately.
Consequently, the term <span class="math notranslate nohighlight">\(A_{1}\)</span> now becomes</p>
<div class="math notranslate nohighlight" id="equation-a1-final-sampleandcontainer">
<span class="eqno">(4)<a class="headerlink" href="#equation-a1-final-sampleandcontainer" title="Permalink to this equation">¶</a></span>\[A_{1}(\lambda) = \int \rho \sigma \exp[ -\mu^\text{s} (l_\text{S1}^\text{s} + l_\text{1D}^\text{s}) -\mu^\text{c} (l_\text{S1}^\text{c} + l_\text{1D}^\text{c})] dV\]</div>
<p>where <span class="math notranslate nohighlight">\(\mu^\text{s}\)</span> denotes the sample absorption coefficient and <span class="math notranslate nohighlight">\(\mu^\text{c}\)</span> denotes the container absorption coefficient.
Notice that the number density <span class="math notranslate nohighlight">\(\rho\)</span> as well as the scattering cross section <span class="math notranslate nohighlight">\(\sigma\)</span> are inside the integral now.
This is because the material of the sample is often different from the material of the container, therefore we need to consider the material
while performing the integration, which is different from when working with a single material component.</p>
<p>Similarly, the term <span class="math notranslate nohighlight">\(A_{2}\)</span> is now</p>
<div class="math notranslate nohighlight" id="equation-a2-final-sampleandcontainer">
<span class="eqno">(5)<a class="headerlink" href="#equation-a2-final-sampleandcontainer" title="Permalink to this equation">¶</a></span>\[A_2(\lambda) = \int \rho_1 \sigma_1
        \int \rho_2 \sigma_2
             \dfrac{ \exp\left[
                      -\mu^\text{s}( l_\text{S1}^\text{s}
                                   + l_\text{12}^\text{s}
                                   + l_\text{2D}^\text{s})
                      -\mu^\text{c}( l_\text{S1}^\text{c}
                                   + l_\text{12}^\text{c}
                                   + l_\text{2D}^\text{c})
                     \right]
                  }{l_\text{12}^2}
        dV_2
    dV_1\]</div>
<p>where the distance within different material (sample and container) are summed independently.</p>
</section>
<section id="example">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Example</a><a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h2>
<p>The following Python script generate a synthetic data set (instrument and sample) to show case the interface</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_sample_workspace</span><span class="p">():</span>
    <span class="c1"># Create a fake workspace with TOF data</span>
    <span class="n">sample_ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">Function</span><span class="o">=</span><span class="s1">&#39;Powder Diffraction&#39;</span><span class="p">,</span>
                                    <span class="n">NumBanks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                    <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">XUnit</span><span class="o">=</span><span class="s1">&#39;TOF&#39;</span><span class="p">,</span>
                                    <span class="n">XMin</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                    <span class="n">XMax</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
    <span class="c1"># fake instrument</span>
    <span class="n">EditInstrumentGeometry</span><span class="p">(</span><span class="n">sample_ws</span><span class="p">,</span>
                        <span class="n">PrimaryFlightPath</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                        <span class="n">SpectrumIDs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                        <span class="n">L2</span><span class="o">=</span><span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span>
                        <span class="n">Polar</span><span class="o">=</span><span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">170.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">],</span>
                        <span class="n">Azimuthal</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">],</span>
                        <span class="n">DetectorIDs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                        <span class="n">InstrumentName</span><span class="o">=</span><span class="s2">&quot;Instrument&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sample_ws</span>

<span class="k">def</span> <span class="nf">add_cylinder_sample_to_workspace</span><span class="p">(</span>
        <span class="n">ws</span><span class="p">,</span>
        <span class="n">material</span><span class="p">,</span>
        <span class="n">number_density</span><span class="p">,</span>
        <span class="n">mass_density</span><span class="p">,</span>
        <span class="n">center_bottom_base</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>  <span class="c1"># x,y,z of bottom base of cylinder</span>
        <span class="n">height</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># in meter</span>
        <span class="n">radius</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># in meter</span>
<span class="p">):</span>
    <span class="n">SetSample</span><span class="p">(</span>
        <span class="n">ws</span><span class="p">,</span>
        <span class="n">Geometry</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;Shape&quot;</span><span class="p">:</span> <span class="s2">&quot;Cylinder&quot;</span><span class="p">,</span>
            <span class="s2">&quot;centre-of-bottom-base&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">center_bottom_base</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">center_bottom_base</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">center_bottom_base</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">},</span>
            <span class="s2">&quot;Height&quot;</span><span class="p">:</span> <span class="n">height</span><span class="p">,</span>
            <span class="s2">&quot;Radius&quot;</span><span class="p">:</span> <span class="n">radius</span><span class="p">,</span>
            <span class="s2">&quot;Axis&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ChemicalFormula&quot;</span><span class="p">:</span> <span class="n">material</span><span class="p">,</span>
            <span class="s2">&quot;SampleNumberDensity&quot;</span><span class="p">:</span> <span class="n">number_density</span><span class="p">,</span>
            <span class="s2">&quot;SampleMassDensity&quot;</span><span class="p">:</span> <span class="n">mass_density</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">ws</span>

<span class="c1"># use Mutliple scattering correction</span>
<span class="k">def</span> <span class="nf">correction_multiple_scattering</span><span class="p">(</span><span class="n">sample_ws</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">):</span>
    <span class="n">ConvertUnits</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">sample_ws</span><span class="p">,</span>
                <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">sample_ws</span><span class="p">,</span>
                <span class="n">Target</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span>
                <span class="n">EMode</span><span class="o">=</span><span class="s2">&quot;Elastic&quot;</span><span class="p">)</span>
    <span class="n">rst</span> <span class="o">=</span> <span class="n">MultipleScatteringCorrection</span><span class="p">(</span><span class="n">sample_ws</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rst</span>

<span class="c1"># start</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">make_sample_workspace</span><span class="p">()</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">add_cylinder_sample_to_workspace</span><span class="p">(</span>
    <span class="n">ws</span><span class="p">,</span>
    <span class="s2">&quot;V&quot;</span><span class="p">,</span>
    <span class="mf">0.07261</span><span class="p">,</span>
    <span class="mf">6.11</span><span class="p">,</span>
    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0284</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="mf">0.00295</span><span class="p">,</span>
    <span class="mf">0.0568</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ms_multi</span> <span class="o">=</span> <span class="n">correction_multiple_scattering</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
</pre></div>
</div>
<p>The following code generates a synthetic data set with instrument, sample and container.
Notice that the output workspace group now contains <code class="docutils literal notranslate"><span class="pre">_containerOnly</span></code> and <code class="docutils literal notranslate"><span class="pre">_sampleAndContainer</span></code> workspaces.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a fake workspace with TOF data</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">Function</span><span class="o">=</span><span class="s1">&#39;Powder Diffraction&#39;</span><span class="p">,</span>
                            <span class="n">NumBanks</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                            <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">XUnit</span><span class="o">=</span><span class="s1">&#39;TOF&#39;</span><span class="p">,</span>
                            <span class="n">XMin</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                            <span class="n">XMax</span><span class="o">=</span><span class="mi">1500</span><span class="p">,)</span>
<span class="c1"># Fake instrument</span>
<span class="n">EditInstrumentGeometry</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span>
                        <span class="n">PrimaryFlightPath</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                        <span class="n">SpectrumIDs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">L2</span><span class="o">=</span><span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span>
                        <span class="n">Polar</span><span class="o">=</span><span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">],</span>
                        <span class="n">Azimuthal</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">],</span>
                        <span class="n">DetectorIDs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">InstrumentName</span><span class="o">=</span><span class="s2">&quot;Instrument&quot;</span><span class="p">)</span>
<span class="c1"># set sample and container</span>
<span class="n">SetSample</span><span class="p">(</span>
        <span class="n">ws</span><span class="p">,</span>
        <span class="n">Geometry</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;Shape&quot;</span><span class="p">:</span> <span class="s2">&quot;Cylinder&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Center&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="s2">&quot;Height&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;Radius&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ChemicalFormula&quot;</span><span class="p">:</span> <span class="s2">&quot;La-(B11)5.94-(B10)0.06&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SampleNumberDensity&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">ContainerMaterial</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ChemicalFormula&quot;</span><span class="p">:</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SampleNumberDensity&quot;</span><span class="p">:</span> <span class="mf">0.0721</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">ContainerGeometry</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Shape&quot;</span><span class="p">:</span> <span class="s2">&quot;HollowCylinder&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Height&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;InnerRadius&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="s2">&quot;OuterRadius&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
            <span class="s2">&quot;Center&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span>
<span class="c1"># to wavelength</span>
<span class="n">ConvertUnits</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
                <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
                <span class="n">Target</span><span class="o">=</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">,</span>
                <span class="n">EMode</span><span class="o">=</span><span class="s2">&quot;Elastic&quot;</span><span class="p">)</span>
<span class="c1"># Run the multiple scattering correction</span>
<span class="n">rst</span> <span class="o">=</span> <span class="n">MultipleScatteringCorrection</span><span class="p">(</span>
    <span class="n">InputWorkspace</span> <span class="o">=</span> <span class="n">ws</span><span class="p">,</span>
    <span class="n">Method</span><span class="o">=</span><span class="s2">&quot;SampleAndContainer&quot;</span><span class="p">,</span>
    <span class="n">ElementSize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># mm</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The following code demonstrates a workaround to deal with thin container walls where a separate
element size for container is needed.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ----------------------- #</span>
<span class="c1"># make an empty workspace #</span>
<span class="c1"># ----------------------- #</span>
<span class="c1"># Create a fake workspace with TOF data</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">Function</span><span class="o">=</span><span class="s1">&#39;Powder Diffraction&#39;</span><span class="p">,</span>
                            <span class="n">NumBanks</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                            <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">XUnit</span><span class="o">=</span><span class="s1">&#39;TOF&#39;</span><span class="p">,</span>
                            <span class="n">XMin</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                            <span class="n">XMax</span><span class="o">=</span><span class="mi">10000</span><span class="p">,)</span>
<span class="c1"># Fake instrument</span>
<span class="n">EditInstrumentGeometry</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span>
                        <span class="n">PrimaryFlightPath</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                        <span class="n">SpectrumIDs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">L2</span><span class="o">=</span><span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span>
                        <span class="n">Polar</span><span class="o">=</span><span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">],</span>
                        <span class="n">Azimuthal</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">],</span>
                        <span class="n">DetectorIDs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">InstrumentName</span><span class="o">=</span><span class="s2">&quot;Instrument&quot;</span><span class="p">)</span>
<span class="c1"># set sample and container</span>
<span class="n">SetSample</span><span class="p">(</span>
        <span class="n">ws</span><span class="p">,</span>
        <span class="n">Geometry</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;Shape&quot;</span><span class="p">:</span> <span class="s2">&quot;Cylinder&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Center&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="s2">&quot;Height&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># cm</span>
            <span class="s2">&quot;Radius&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>  <span class="c1"># cm</span>
        <span class="p">},</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ChemicalFormula&quot;</span><span class="p">:</span> <span class="s2">&quot;La-(B11)5.94-(B10)0.06&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SampleNumberDensity&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">ContainerMaterial</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ChemicalFormula&quot;</span><span class="p">:</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SampleNumberDensity&quot;</span><span class="p">:</span> <span class="mf">0.0721</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">ContainerGeometry</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Shape&quot;</span><span class="p">:</span> <span class="s2">&quot;HollowCylinder&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Height&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># cm</span>
            <span class="s2">&quot;InnerRadius&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>  <span class="c1"># cm</span>
            <span class="s2">&quot;OuterRadius&quot;</span><span class="p">:</span> <span class="mf">0.35</span><span class="p">,</span>  <span class="c1"># cm</span>
            <span class="s2">&quot;Center&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span>
<span class="c1"># to wavelength</span>
<span class="n">ConvertUnits</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
                <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
                <span class="n">Target</span><span class="o">=</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">,</span>
                <span class="n">EMode</span><span class="o">=</span><span class="s2">&quot;Elastic&quot;</span><span class="p">)</span>
<span class="c1"># call</span>
<span class="n">MultipleScatteringCorrection</span><span class="p">(</span>
    <span class="n">InputWorkspace</span> <span class="o">=</span> <span class="n">ws</span><span class="p">,</span>
    <span class="n">Method</span><span class="o">=</span><span class="s2">&quot;SampleAndContainer&quot;</span><span class="p">,</span>
    <span class="n">ElementSize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">ContainerElementSize</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;rst&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/CorrectionFunctions.html">CorrectionFunctions</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/Algorithms/inc/MantidAlgorithms/MultipleScatteringCorrection.h">MultipleScatteringCorrection.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/Algorithms/src/MultipleScatteringCorrection.cpp">MultipleScatteringCorrection.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="MoveInstrumentComponent-v1.html" title="Previous Chapter: MoveInstrumentComponent v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; MoveInstrumen...</span>
    </a>
  </li>
  <li>
    <a href="Multiply-v1.html" title="Next Chapter: Multiply v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Multiply v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>