<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>DiffractionFocussing v2</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DirectILLApplySelfShielding v1" href="DirectILLApplySelfShielding-v1.html" />
    <link rel="prev" title="DiffractionFocussing v1" href="DiffractionFocussing-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">DiffractionFocussing v2</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="diffractionfocussing-v2">
<span id="algm-diffractionfocussing"></span><span id="algm-diffractionfocussing-v2"></span><h1>DiffractionFocussing v2<a class="headerlink" href="#diffractionfocussing-v2" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/DiffractionFocussing-v2_dlg.png"><img alt="../_images/DiffractionFocussing-v2_dlg.png" class="screenshot" src="../_images/DiffractionFocussing-v2_dlg.png" style="width: 382px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>DiffractionFocussing</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p>
<ul>
<li><p><a class="reference internal" href="#for-eventworkspaces" id="id6">For EventWorkspaces</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#usage" id="id7">Usage</a></p></li>
<li><p><a class="reference internal" href="#previous-versions" id="id8">Previous Versions</a></p>
<ul>
<li><p><a class="reference internal" href="#version-1" id="id9">Version 1</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#source" id="id10">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Algorithm to focus powder diffraction data into a number of histograms according to a grouping scheme defined in a CalFile.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="AlignDetectors-v1.html#algm-aligndetectors"><span class="std std-ref">AlignDetectors</span></a>, <a class="reference internal" href="AlignAndFocusPowder-v1.html#algm-alignandfocuspowder"><span class="std std-ref">AlignAndFocusPowder</span></a>, <a class="reference internal" href="LoadCalFile-v1.html#algm-loadcalfile"><span class="std std-ref">LoadCalFile</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A 2D workspace with X values of d-spacing, Q or TOF (TOF support deprecated on 29/04/21)</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The result of diffraction focussing of InputWorkspace</p></td>
</tr>
<tr class="row-even"><td><p>GroupingFileName</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Optional: The name of the CalFile with grouping data. Allowed extensions: [‘.cal’]</p></td>
</tr>
<tr class="row-odd"><td><p>GroupingWorkspace</p></td>
<td><p>Input</p></td>
<td><p>GroupingWorkspace</p></td>
<td></td>
<td><p>Optional: GroupingWorkspace to use instead of a grouping file.</p></td>
</tr>
<tr class="row-even"><td><p>PreserveEvents</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Keep the output workspace as an EventWorkspace, if the input has events (default). If false, then the workspace gets converted to a Workspace2D histogram.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p><img alt="Example of RAW GEM data focused across the 5 detector banks" src="../_images/GEM_Focused.png" /> Given an
InputWorkspace and a Grouping filename, the algorithm performs the
following:</p>
<ol class="arabic simple">
<li><p>The calibration file is read and a map of corresponding udet-group is
created.</p></li>
<li><p>The algorithm determines the X boundaries for each group as the upper
and lower limits of all contributing detectors. It then calculates
a logarithmic step that preserves the number of bins in the initial workspace.
It assumes that the entire data set uses logarithmic binning in the process
(i.e. it does not check for constant width binning).</p></li>
<li><p>All histograms are read and rebinned to the new grid for their group.</p></li>
<li><p>A new workspace with N histograms is created.</p></li>
</ol>
<p>Within the <a class="reference internal" href="../concepts/calibration/CalFile.html#calfile"><span class="std std-ref">CalFile</span></a> any detectors with the ‘select’ flag
can be set to zero or with a group number of 0 or -ve groups are not
included in the analysis.</p>
<p>Since the new X boundaries depend on the group and not the entire
workspace, this focusing algorithm does not create overestimated X
ranges for multi-group instruments. However it is important to remember
that this means that this algorithm outputs a <a class="reference internal" href="../concepts/Ragged_Workspace.html#ragged-workspace"><span class="std std-ref">ragged workspace</span></a>.
Some 2D and 3D plots will not display the data correctly.</p>
<p>The DiffractionFocussing algorithm uses GroupDetectors algorithm to
combine data from several spectra according to GroupingFileName file
which is a <a class="reference internal" href="../concepts/calibration/CalFile.html#calfile"><span class="std std-ref">CalFile</span></a>.</p>
<section id="for-eventworkspaces">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">For EventWorkspaces</a><a class="headerlink" href="#for-eventworkspaces" title="Permalink to this heading">¶</a></h3>
<p>The algorithm can be used with an <a class="reference internal" href="../concepts/EventWorkspace.html#eventworkspace"><span class="std std-ref">EventWorkspace</span></a>
input, and will create an EventWorkspace output if a different workspace
is specified.</p>
<p>The main difference vs. using a Workspace2D is that the event lists from
all the incoming pixels are simply appended in the grouped spectra; this
means that you can rebin the resulting spectra to finer bins with no
loss of data. In fact, it is unnecessary to bin your incoming data at
all; binning can be performed as the very last step.</p>
</section>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - Diffraction focussing of HRPD data:</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load HRP dataset</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s2">&quot;HRP39180.RAW&quot;</span><span class="p">)</span>

<span class="c1"># specify groupping file, here using CalFile format</span>
<span class="n">cal_file</span> <span class="o">=</span> <span class="s2">&quot;hrpd_new_072_01_corr.cal&quot;</span>

<span class="c1"># For HRPD data, perform a unit conversion TOF-&gt;d-spacing, taking into account detector position offsets</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">AlignDetectors</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;ws&#39;</span><span class="p">,</span><span class="n">CalibrationFile</span><span class="o">=</span><span class="n">cal_file</span><span class="p">)</span>
<span class="c1"># Focus the data</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">DiffractionFocussing</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;ws&#39;</span><span class="p">,</span><span class="n">GroupingFileName</span><span class="o">=</span><span class="n">cal_file</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The 51st y-value is: </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The 51st y-value is: 900.148
</pre></div>
</div>
<p><strong>Example - Demonstrating option PreserveEvents:</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create event workspace with one bank of 4 detectors</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">WorkspaceType</span><span class="o">=</span><span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="n">XUnit</span><span class="o">=</span><span class="s2">&quot;dSpacing&quot;</span><span class="p">,</span> <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># focus data in 4 spectra to 2 spectra according to .cal file and don&#39;t perserve events</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">DiffractionFocussing</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;ws&#39;</span><span class="p">,</span> <span class="n">GroupingFileName</span><span class="o">=</span><span class="s2">&quot;4detector_cal_example_file.cal&quot;</span> \
     <span class="p">,</span> <span class="n">PreserveEvents</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of focussed spectra: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;What type is the workspace after focussing: &quot;</span> <span class="o">+</span> <span class="n">ws</span><span class="o">.</span><span class="n">id</span><span class="p">())</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Number of focussed spectra: 2
What type is the workspace after focussing: Workspace2D
</pre></div>
</div>
</section>
<section id="previous-versions">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Previous Versions</a><a class="headerlink" href="#previous-versions" title="Permalink to this heading">¶</a></h2>
<section id="version-1">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Version 1</a><a class="headerlink" href="#version-1" title="Permalink to this heading">¶</a></h3>
<p>Version 1 did not support the use of workspaces to carry grouping
workspaces and only worked with CalFiles.</p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Diffraction/Focussing.html">Diffraction\Focussing</a></p>
</section>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/d01b3431ef42c8e811acf3df5a3cc0503656d488/Framework/Algorithms/inc/MantidAlgorithms/DiffractionFocussing2.h">DiffractionFocussing2.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/d01b3431ef42c8e811acf3df5a3cc0503656d488/Framework/Algorithms/src/DiffractionFocussing2.cpp">DiffractionFocussing2.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DiffractionFocussing-v1.html" title="Previous Chapter: DiffractionFocussing v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DiffractionFo...</span>
    </a>
  </li>
  <li>
    <a href="DirectILLApplySelfShielding-v1.html" title="Next Chapter: DirectILLApplySelfShielding v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DirectILLAppl... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>