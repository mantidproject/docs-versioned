<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Integration v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="InterpolatingRebin v1" href="InterpolatingRebin-v1.html" />
    <link rel="prev" title="IntegratePeaksUsingClusters v1" href="IntegratePeaksUsingClusters-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">Integration v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="integration-v1">
<span id="algm-integration"></span><span id="algm-integration-v1"></span><h1>Integration v1<a class="headerlink" href="#integration-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/Integration-v1_dlg.png"><img alt="../_images/Integration-v1_dlg.png" class="screenshot" src="../_images/Integration-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Integration</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p>
<ul>
<li><p><a class="reference internal" href="#optional-properties" id="id6">Optional properties</a></p></li>
<li><p><a class="reference internal" href="#eventworkspaces" id="id7">EventWorkspaces</a></p></li>
<li><p><a class="reference internal" href="#distribution-data" id="id8">Distribution Data</a></p></li>
<li><p><a class="reference internal" href="#fractional-rebinning" id="id9">Fractional Rebinning</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#usage" id="id10">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id11">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Integration takes a 2D workspace or an EventWorkspace as input and sums the data values. Optionally, the range summed can be restricted in either dimension.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="IntegrateByComponent-v1.html#algm-integratebycomponent"><span class="std std-ref">IntegrateByComponent</span></a>, <a class="reference internal" href="Rebin-v1.html#algm-rebin"><span class="std std-ref">Rebin</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The input workspace to integrate.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The output workspace with the results of the integration.</p></td>
</tr>
<tr class="row-even"><td><p>RangeLower</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The lower integration limit (an X value).</p></td>
</tr>
<tr class="row-odd"><td><p>RangeUpper</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The upper integration limit (an X value).</p></td>
</tr>
<tr class="row-even"><td><p>StartWorkspaceIndex</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Index of the first spectrum to integrate.</p></td>
</tr>
<tr class="row-odd"><td><p>EndWorkspaceIndex</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Index of the last spectrum to integrate.</p></td>
</tr>
<tr class="row-even"><td><p>IncludePartialBins</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If true then partial bins from the beginning and end of the input range are also included in the integration.</p></td>
</tr>
<tr class="row-odd"><td><p>RangeLowerList</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td></td>
<td><p>A list of lower integration limits (as X values).</p></td>
</tr>
<tr class="row-even"><td><p>RangeUpperList</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td></td>
<td><p>A list of upper integration limits (as X values).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>Integration sums up spectra in a <a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a> and outputs a
<a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a> that contains only 1 value per spectrum (i.e.
the sum). The associated errors are added in quadrature. The two X
values per spectrum are set to the limits of the range over which the
spectrum has been integrated. By default, the entire range is integrated
and all spectra are included.</p>
<section id="optional-properties">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Optional properties</a><a class="headerlink" href="#optional-properties" title="Permalink to this heading">¶</a></h3>
<p>If only a portion of the workspace should be integrated then the
optional parameters may be used to restrict the range.
<code class="docutils literal notranslate"><span class="pre">StartWorkspaceIndex</span></code> and <code class="docutils literal notranslate"><span class="pre">EndWorkspaceIndex</span></code> may be used to select a
contiguous range of spectra in the workspace (note that these parameters
refer to the workspace index value rather than spectrum numbers as taken
from the raw file). If only a certain range of each spectrum should be
summed then the <code class="docutils literal notranslate"><span class="pre">RangeLower</span></code> and <code class="docutils literal notranslate"><span class="pre">RangeUpper</span></code> properties, as well as their <code class="docutils literal notranslate"><span class="pre">-List</span></code>
versions should be used. <code class="docutils literal notranslate"><span class="pre">RangeLower</span></code> and <code class="docutils literal notranslate"><span class="pre">RangeUpper</span></code> are single values
limiting the summing range over all histograms. <code class="docutils literal notranslate"><span class="pre">RangeLowerList</span></code> and
<code class="docutils literal notranslate"><span class="pre">RangeUpperList</span></code> contain the ranges for each individual histogram. The
properties can be mixed: for instance, the histogram specific lower
integration limits can be given by <code class="docutils literal notranslate"><span class="pre">RangeLowerList</span></code> while all upper limits
can be set to the same value by <code class="docutils literal notranslate"><span class="pre">RangeUpper</span></code>. If both list and non-list versions
are given, then the range is chosen which gives stricter limits for each
histogram.</p>
<p>No rebinning takes place as part of this algorithm. If the integration limits given
do not coincide with a bin boundary then the behaviour depends on the <code class="docutils literal notranslate"><span class="pre">IncludePartialBins</span></code>
parameter. If <code class="docutils literal notranslate"><span class="pre">IncludePartialBins=True</span></code> then a contribution is calculated for any
bins that partially sit inside the integration limits. If <code class="docutils literal notranslate"><span class="pre">IncludePartialBins=False</span></code>
then the integration only includes bins that sit entirely within the integration limits.
If an integration limit is given that is beyond the X range covered by the spectrum then
the integration will proceed up to final bin boundary. The data that falls outside any
integration limits set will not contribute to the output workspace.</p>
</section>
<section id="eventworkspaces">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">EventWorkspaces</a><a class="headerlink" href="#eventworkspaces" title="Permalink to this heading">¶</a></h3>
<p>If an <a class="reference internal" href="../concepts/EventWorkspace.html#eventworkspace"><span class="std std-ref">EventWorkspace</span></a> is used as the input, the
output will be a <a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a>.
<a class="reference internal" href="Rebin-v1.html#algm-rebin"><span class="std std-ref">Rebin v1</span></a> is recommended if you want to keep the workspace as an
EventWorkspace.</p>
<p><strong>Integration for event workspaces refers to internal binning, provided by</strong>
<a class="reference internal" href="Rebin-v1.html#algm-rebin"><span class="std std-ref">Rebin v1</span></a> <strong>or load algorithm and may ignore limits, provided as algorithm
input.</strong>  For example, attempt to integrate loaded ISIS event workspace in the
range [18000,20000] yields workspace integrated in the range [0,200000],
assuming the data were collected in the time range [0,20000]. This happens because
the event data would have single histogram workspace bin in range [0,20000].
To obtain integral in the desired range, user have to <a class="reference internal" href="Rebin-v1.html#algm-rebin"><span class="std std-ref">Rebin v1</span></a> first,
and one of the binning intervals have to start from 18000 and another (or the same)
end at 20000.</p>
</section>
<section id="distribution-data">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Distribution Data</a><a class="headerlink" href="#distribution-data" title="Permalink to this heading">¶</a></h3>
<p>Mantid workspaces store their data internally in one of two formats: as <em>counts</em> or as
<em>frequencies</em> (counts divided by bin-width). When the <span class="math notranslate nohighlight">\(y\)</span> values are stored as
frequencies, the workspace is called a <em>distribution</em>.
The algorithms <a class="reference internal" href="ConvertToDistribution-v1.html#algm-converttodistribution"><span class="std std-ref">ConvertToDistribution</span></a> and
<a class="reference internal" href="ConvertFromDistribution-v1.html#algm-convertfromdistribution"><span class="std std-ref">ConvertFromDistribution</span></a> converts the internal
representation from counts to frequencies or vice versa.
The <code class="docutils literal notranslate"><span class="pre">Integration</span></code> algorithm will correctly deal with the data to give the total
<strong>counts</strong> as output. That is, if you integrate a distribution workspace directly or
convert it first to counts and then call <code class="docutils literal notranslate"><span class="pre">Integration</span></code> the output workspace will have
the same <span class="math notranslate nohighlight">\(y\)</span> values.</p>
<p>Note that the un-integrated axis (say the <span class="math notranslate nohighlight">\(x\)</span> axis) may still be binned,
in which case the result of integrating distribution vs non-distribution data will not be equivalent.
That is, integrating a distribution will create a new distribution where the internal <span class="math notranslate nohighlight">\(y\)</span>
values represent the summed counts per <span class="math notranslate nohighlight">\(x\)</span>-bin-width. Whereas,
integrating a non-distribution workspace will yield the same internal <span class="math notranslate nohighlight">\(y\)</span> values but
these now represent counts (not counts per <span class="math notranslate nohighlight">\(x\)</span>-bin-width).</p>
</section>
<section id="fractional-rebinning">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Fractional Rebinning</a><a class="headerlink" href="#fractional-rebinning" title="Permalink to this heading">¶</a></h3>
<p>Some algorithms, such as <a class="reference internal" href="SofQWNormalisedPolygon-v1.html#algm-sofqwnormalisedpolygon"><span class="std std-ref">SofQWNormalisedPolygon</span></a>
or <a class="reference internal" href="ConvertToReflectometryQ-v2.html#algm-converttoreflectometryq"><span class="std std-ref">ConvertToReflectometryQ</span></a>, create a special type of
<a class="reference internal" href="../concepts/Workspace2D.html#workspace2d"><span class="std std-ref">Workspace2D</span></a> called a <code class="docutils literal notranslate"><span class="pre">RebinnedOutput</span></code> workspace in which
each bin contains both a value and the fractional overlap area of the this bin over
that of the original data. There is more discussion of this in the
<a class="reference internal" href="SofQWNormalisedPolygon-v1.html#algm-sofqwnormalisedpolygon"><span class="std std-ref">SofQWNormalisedPolygon</span></a> documentation.</p>
<p>This algorithm calculates the integrated counts per spectra of a <code class="docutils literal notranslate"><span class="pre">RebinnedOutput</span></code>
workspace as follows:</p>
<div class="math notranslate nohighlight">
\[I = \left. \sum_i Y_i F_i \middle/ \left(\frac{1}{n} \sum_i F_i \right) \right.\]</div>
<p>where <span class="math notranslate nohighlight">\(Y_i\)</span> and <span class="math notranslate nohighlight">\(F_i\)</span> are the values and fractions for the <span class="math notranslate nohighlight">\(i^{\mathrm{th}}\)</span>
bin and the sum runs from <code class="docutils literal notranslate"><span class="pre">RangeLower</span></code> to <code class="docutils literal notranslate"><span class="pre">RangeUpper</span></code>. <span class="math notranslate nohighlight">\(n\)</span> is the number
of bins (or fractional bins if <code class="docutils literal notranslate"><span class="pre">IncludePartialBins=True</span></code>) in the range which is not <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.
The <span class="math notranslate nohighlight">\(1/n\)</span> factor is needed so that the integral is correctly normalised compared to
the case when there is no fractional bins, where all <span class="math notranslate nohighlight">\(F_i = 1\)</span>.</p>
</section>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p><strong>Example - Integration over limited number of histograms:</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a workspace filled with a constant value = 1.0</span>
<span class="n">ws</span><span class="o">=</span><span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="s1">&#39;Histogram&#39;</span><span class="p">,</span><span class="s1">&#39;Flat background&#39;</span><span class="p">)</span>
<span class="c1"># Integrate 10 spectra over all X values</span>
<span class="n">intg</span><span class="o">=</span><span class="n">Integration</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">StartWorkspaceIndex</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">EndWorkspaceIndex</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Check the result</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The result workspace has </span><span class="si">{0}</span><span class="s1"> spectra&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intg</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Integral of spectrum 11 is </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intg</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Integral of spectrum 12 is </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intg</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Integral of spectrum 13 is </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intg</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Integration range is [ </span><span class="si">{0}</span><span class="s1">, </span><span class="si">{1}</span><span class="s1"> ]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intg</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">intg</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The result workspace has 10 spectra
Integral of spectrum 11 is 100.0
Integral of spectrum 12 is 100.0
Integral of spectrum 13 is 100.0
Integration range is [ 0.0, 20000.0 ]
</pre></div>
</div>
<p><strong>Example - Total peak intensity:</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mantid.kernel</span> <span class="kn">import</span> <span class="n">DeltaEModeType</span><span class="p">,</span> <span class="n">UnitConversion</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span>
    <span class="n">Function</span><span class="o">=</span><span class="s1">&#39;Flat background&#39;</span><span class="p">,</span>
    <span class="n">XMin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">XMax</span><span class="o">=</span><span class="mi">12000</span><span class="p">,</span>
    <span class="n">BinWidth</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">nHisto</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()</span>

<span class="c1"># Add elastic peaks to &#39;ws&#39;. They will be at different TOFs</span>
<span class="c1"># since the detector banks will be 5 and 10 metres from the sample.</span>

<span class="c1"># First, a helper function for the peak shape</span>
<span class="k">def</span> <span class="nf">peak</span><span class="p">(</span><span class="n">shift</span><span class="p">,</span> <span class="n">xs</span><span class="p">):</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="p">(</span><span class="n">xs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">xs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mf">2.0</span>  <span class="c1"># Convert to bin centres.</span>
    <span class="k">return</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">xs</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1200</span><span class="p">)</span>

<span class="c1"># Now, generate the elastic peaks.</span>
<span class="n">Ei</span> <span class="o">=</span> <span class="mf">23.0</span>  <span class="c1"># Incident energy, meV</span>
<span class="n">L1</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># Source-sample distance, m</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span><span class="o">.</span><span class="n">getSample</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nHisto</span><span class="p">):</span>
    <span class="n">detector</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">getDetector</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">L2</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">getDistance</span><span class="p">(</span><span class="n">detector</span><span class="p">)</span>
    <span class="n">tof</span> <span class="o">=</span> <span class="n">UnitConversion</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;TOF&#39;</span><span class="p">,</span> <span class="n">Ei</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">DeltaEModeType</span><span class="o">.</span><span class="n">Direct</span><span class="p">,</span> <span class="n">Ei</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">dataY</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">+=</span> <span class="n">peak</span><span class="p">(</span><span class="n">tof</span><span class="p">,</span> <span class="n">ws</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="c1"># Fit Gaussians to the workspace.</span>
<span class="c1"># Fit results will be put into a table workspace &#39;epps&#39;.</span>
<span class="n">epps</span> <span class="o">=</span> <span class="n">FindEPP</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>

<span class="c1"># Integrate the peaks over +/- 3*sigma</span>
<span class="n">lowerLimits</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nHisto</span><span class="p">)</span>
<span class="n">upperLimits</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nHisto</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nHisto</span><span class="p">):</span>
    <span class="n">peakCentre</span> <span class="o">=</span> <span class="n">epps</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="s1">&#39;PeakCentre&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">epps</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="s1">&#39;Sigma&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">lowerLimits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">peakCentre</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">sigma</span>
    <span class="n">upperLimits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">peakCentre</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">sigma</span>

<span class="n">totalIntensity</span> <span class="o">=</span> <span class="n">Integration</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">RangeLowerList</span><span class="o">=</span><span class="n">lowerLimits</span><span class="p">,</span>
    <span class="n">RangeUpperList</span><span class="o">=</span><span class="n">upperLimits</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Intensity of the first peak: </span><span class="si">{:.5}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">totalIntensity</span><span class="o">.</span><span class="n">dataY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Intensity of the last peak: </span><span class="si">{:.5}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">totalIntensity</span><span class="o">.</span><span class="n">dataY</span><span class="p">(</span><span class="n">nHisto</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Intensity of the first peak: 159.99
Intensity of the last peak: 164.5
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Arithmetic.html">Arithmetic</a> | <a class="reference external" href="categories/Transforms/Rebin.html">Transforms\Rebin</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/Algorithms/inc/MantidAlgorithms/Integration.h">Integration.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/Algorithms/src/Integration.cpp">Integration.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="IntegratePeaksUsingClusters-v1.html" title="Previous Chapter: IntegratePeaksUsingClusters v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; IntegratePeak...</span>
    </a>
  </li>
  <li>
    <a href="InterpolatingRebin-v1.html" title="Next Chapter: InterpolatingRebin v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">InterpolatingRebin v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>