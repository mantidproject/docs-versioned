<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Q1DWeighted v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="QENSFitSequential v1" href="QENSFitSequential-v1.html" />
    <link rel="prev" title="Q1D v2" href="Q1D-v2.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">Q1DWeighted v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="q1dweighted-v1">
<span id="algm-q1dweighted"></span><span id="algm-q1dweighted-v1"></span><h1>Q1DWeighted v1<a class="headerlink" href="#q1dweighted-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/Q1DWeighted-v1_dlg.png"><img alt="../_images/Q1DWeighted-v1_dlg.png" class="screenshot" src="../_images/Q1DWeighted-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Q1DWeighted</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#i-o" id="id6">I/O</a></p></li>
<li><p><a class="reference internal" href="#additional-options" id="id7">Additional options</a></p>
<ul>
<li><p><a class="reference internal" href="#npixeldivision" id="id8">NPixelDivision</a></p></li>
<li><p><a class="reference internal" href="#errorweighting" id="id9">ErrorWeighting</a></p></li>
<li><p><a class="reference internal" href="#wedges" id="id10">Wedges</a></p>
<ul>
<li><p><a class="reference internal" href="#defining-wedges" id="id11">Defining wedges</a></p></li>
<li><p><a class="reference internal" href="#drawing-sectors" id="id12">Drawing sectors</a></p></li>
<li><p><a class="reference internal" href="#symmetric" id="id13">Symmetric</a></p></li>
<li><p><a class="reference internal" href="#asymmetric" id="id14">Asymmetric</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#masked-bins" id="id15">Masked Bins</a></p></li>
<li><p><a class="reference internal" href="#accountforgravity" id="id16">AccountForGravity</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#source" id="id17">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Performs azimuthal averaging on a 2D SANS data to produce I(Q).</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="Q1D-v2.html#algm-q1d"><span class="std std-ref">Q1D</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Input workspace containing the SANS 2D data</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Workspace that will contain the I(Q) data</p></td>
</tr>
<tr class="row-even"><td><p>OutputBinning</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The new bin boundaries in the form: <span class="math notranslate nohighlight">\(x_1,\Delta x_1,x_2,\Delta x_2,\dots,x_n\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>NPixelDivision</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Number of sub-pixels used for each detector pixel in each direction.The total number of sub-pixels will be NPixelDivision*NPixelDivision.</p></td>
</tr>
<tr class="row-even"><td><p>NumberOfWedges</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>2</p></td>
<td><p>Number of wedges to calculate.</p></td>
</tr>
<tr class="row-odd"><td><p>WedgeAngle</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>30</p></td>
<td><p>Opening angle of the wedge, in degrees.</p></td>
</tr>
<tr class="row-even"><td><p>WedgeOffset</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Wedge offset relative to the horizontal axis, in degrees.</p></td>
</tr>
<tr class="row-odd"><td><p>WedgeWorkspace</p></td>
<td><p>Output</p></td>
<td><p>WorkspaceGroup</p></td>
<td></td>
<td><p>Name for the WorkspaceGroup containing the wedge I(q) distributions.</p></td>
</tr>
<tr class="row-even"><td><p>PixelSizeX</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>5.15</p></td>
<td><p>Pixel size in the X direction (mm).</p></td>
</tr>
<tr class="row-odd"><td><p>PixelSizeY</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>5.15</p></td>
<td><p>Pixel size in the Y direction (mm).</p></td>
</tr>
<tr class="row-even"><td><p>ErrorWeighting</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Choose whether each pixel contribution will be weighted by 1/error^2.</p></td>
</tr>
<tr class="row-odd"><td><p>AsymmetricWedges</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Choose to produce the results for asymmetric wedges.</p></td>
</tr>
<tr class="row-even"><td><p>AccountForGravity</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Take the nominal gravity drop into account.</p></td>
</tr>
<tr class="row-odd"><td><p>ShapeTable</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Table workspace containing the shapes (sectors only) drawn in the instrument viewer; if specified, the wedges properties defined above are not taken into account.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>Performs azimuthal averaging for a 2D SANS data set by going through
each wavelength bin of each detector pixel, determining its Q-value, and adding its amplitude
<span class="math notranslate nohighlight">\(I\)</span> to the appropriate Q bin. The algorithm works both for monochromatic and TOF SANS data.</p>
<p>Note that in TOF case, the algorithm performs averaging in 2 steps.
First, for each wavelength slice of the input it performs azimuthal averaging in radial rings.
This results in a stack of I(Q)s, one for each input wavelength.
As a second step, all the I(Q)s corresponding to different wavelengths are averaged again.
Note that for the TOF data, this is mathematically not equivalent to performing averaging with one step; that is averaging everything into a single I(Q) histogram.
The latter is done in <a class="reference internal" href="Q1D-v2.html#algm-q1d"><span class="std std-ref">Q1D</span></a> algorithm.
See the <a class="reference internal" href="Rebin-v1.html#algm-rebin"><span class="std std-ref">Rebin</span></a> documentation for details about choosing the <code class="docutils literal notranslate"><span class="pre">OutputBinning</span></code> parameter.</p>
<p>For monochromatic data, the algorithm considers each bin as belonging to a different sample and/or kinetic frame.
Usage
—–</p>
<p>This algorithm is used as a part of the <a class="reference internal" href="HFIRSANSReduction-v1.html#algm-hfirsansreduction-v1"><span class="std std-ref">SANSReduction</span></a> and <a class="reference internal" href="SANSILLIntegration-v1.html#algm-sansillintegration"><span class="std std-ref">SANSILLIntegration</span></a>.
However, it can also be used directly, provided that the input data is already corrected for all the effects.</p>
</section>
<section id="i-o">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">I/O</a><a class="headerlink" href="#i-o" title="Permalink to this heading">¶</a></h2>
<p>The input to this algorithm must be a histogram with common wavelength bins for each pixel, or a monochromatic workspace with a different sample or kinetic frame in each bin.
In this case the workspace must not be in units of wavelength, but the wavelength must be present in the sample logs.
The output will be a distribution though.</p>
</section>
<section id="additional-options">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Additional options</a><a class="headerlink" href="#additional-options" title="Permalink to this heading">¶</a></h2>
<section id="npixeldivision">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">NPixelDivision</a><a class="headerlink" href="#npixeldivision" title="Permalink to this heading">¶</a></h3>
<p>For greater precision, each detector
pixel can be sub-divided in sub-pixels by setting the <code class="docutils literal notranslate"><span class="pre">NPixelDivision</span></code>
parameters. This will split each pixel to a grid of <code class="docutils literal notranslate"><span class="pre">NPixelDivision</span></code> * <code class="docutils literal notranslate"><span class="pre">NPixelDivision</span></code> pixels.
<code class="docutils literal notranslate"><span class="pre">PixelSizeX</span></code> and <code class="docutils literal notranslate"><span class="pre">PixelSizeY</span></code> inputs will be used only if pixels are to be split.</p>
</section>
<section id="errorweighting">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">ErrorWeighting</a><a class="headerlink" href="#errorweighting" title="Permalink to this heading">¶</a></h3>
<p>Each pixel has a weight of 1 by default, but the weight of
each pixel can be set to <span class="math notranslate nohighlight">\(1/\sigma^2 I\)</span> by setting the
<code class="docutils literal notranslate"><span class="pre">ErrorWeighting</span></code> parameter to True. This will effectively transmute the average to a weighted average, where the weight is inversely proportional to the absolute statistical uncertainty on the intensity.
This option will potentially produce very different results, so care must be taken when analysing the data with this option.
In the reduction workflows this option is deprecated.</p>
</section>
<section id="wedges">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Wedges</a><a class="headerlink" href="#wedges" title="Permalink to this heading">¶</a></h3>
<p>For anisotropic scatterer, the <em>I(Q)</em> can be calculated for different angular sectors (or wedges).</p>
<p>These sectors can be defined in two different ways : either by drawing them, or by defining them.
There are also two integration mode: symmetric wedges (default) or asymmetric wedges.</p>
<section id="defining-wedges">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">Defining wedges</a><a class="headerlink" href="#defining-wedges" title="Permalink to this heading">¶</a></h4>
<p>Wedges are defined by the <code class="docutils literal notranslate"><span class="pre">NumberOfWedges</span></code>, <code class="docutils literal notranslate"><span class="pre">WedgeAngle</span></code> and <code class="docutils literal notranslate"><span class="pre">WedgeOffset</span></code> parameters.
The trigonometrical circle is split in <code class="docutils literal notranslate"><span class="pre">NumberOfWedges</span></code> sectors, equally spaced, spanning a range of <code class="docutils literal notranslate"><span class="pre">WedgeAngle</span></code>.</p>
</section>
<section id="drawing-sectors">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">Drawing sectors</a><a class="headerlink" href="#drawing-sectors" title="Permalink to this heading">¶</a></h4>
<p>This option is still in active development, and might be subject to changes in later versions.
It is also possible to use the instrument viewer to draw the shape of the angular sector. Only sector shapes are currently supported,
and they must be drawn in the Full 3D, Z- projection, without any rotation (translation and zoom are supported). Please
note that in this projection, the X-axis points to the left. So when doing the wedges without the table (see above), they are ordered
clockwise, opening from the positive ray of the X-axis.
If running Q1DWeighted with drawn sectors as input, the output will be ordered similarly, regardless of the order in which they were drawn.
Once the shapes are drawn, they must be saved using the <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">shapes</span> <span class="pre">to</span> <span class="pre">table</span></code> button.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/Q1DWeightedShapeIntegration.png"><img alt="../_images/Q1DWeightedShapeIntegration.png" src="../_images/Q1DWeightedShapeIntegration.png" style="width: 1000px;" /></a>
</figure>
<p>Contrary to the wedges defined in the previous manner, the sectors don’t need to be regularly placed, centered or even symmetrical.</p>
<p>When running <code class="docutils literal notranslate"><span class="pre">Q1DWeighted</span></code>, the created table workspace - generally named <cite>MaskShapes</cite> - can be provided
as an argument to the <code class="docutils literal notranslate"><span class="pre">ShapeTable</span></code> field. The algorithm will then use the drawn shapes as wedges, and ignore <code class="docutils literal notranslate"><span class="pre">NumberOfWedges</span></code>,
<code class="docutils literal notranslate"><span class="pre">WedgeAngle</span></code> and <code class="docutils literal notranslate"><span class="pre">WedgeOffset</span></code> fields.</p>
</section>
<section id="symmetric">
<h4><a class="toc-backref" href="#id13" role="doc-backlink">Symmetric</a><a class="headerlink" href="#symmetric" title="Permalink to this heading">¶</a></h4>
<p>Symmetric or asymmetric integration is determined by the <cite>AsymmetricWedges</cite> flag.</p>
<p>The figure below illustrates an example for symmetric wedges. Each wedge in this case represents two back-to-back sectors.
The wedges output group will have two workspaces: one for the red region, one for the blue region.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/wedge_symm.png"><img alt="../_images/wedge_symm.png" src="../_images/wedge_symm.png" style="width: 600px;" /></a>
</figure>
<p>In the case of drawn sectors, when doing symmetric integration, symmetric shapes will be grouped together.
Taking the above example, the shape table will have 4 shapes in it, but the output will only have 2 workspaces, because the
red shapes and the blue shapes will be grouped.
If no corresponding symmetric is found for a shape, the algorithm will nonetheless integrate on the projected symmetric too,
so the result will be identical (though for clarity it is not advised to provide only one of the shapes).
Again, in the above example, the result will be identical whether only one or both of the red and blue shapes are provided,
because the algorithm will find the missing symmetric if needed.</p>
</section>
<section id="asymmetric">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">Asymmetric</a><a class="headerlink" href="#asymmetric" title="Permalink to this heading">¶</a></h4>
<p>An example for asymmetric wedges is shown below. The output will have four workspaces, one per each sector of different color.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/wedge_asymm.png"><img alt="../_images/wedge_asymm.png" src="../_images/wedge_asymm.png" style="width: 600px;" /></a>
</figure>
</section>
</section>
<section id="masked-bins">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Masked Bins</a><a class="headerlink" href="#masked-bins" title="Permalink to this heading">¶</a></h3>
<p>Bins masked in the input workspace will not enter the calculation.</p>
</section>
<section id="accountforgravity">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">AccountForGravity</a><a class="headerlink" href="#accountforgravity" title="Permalink to this heading">¶</a></h3>
<p>If enabled, this will correct for the gravity effect by analytical calculation of the drop during the time-of-flight from sample to detector.</p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/SANS.html">SANS</a></p>
</section>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id17" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/8b6be077efd75a1eee39b81bc5971c6c51c44283/Framework/Algorithms/inc/MantidAlgorithms/Q1DWeighted.h">Q1DWeighted.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/8b6be077efd75a1eee39b81bc5971c6c51c44283/Framework/Algorithms/src/Q1DWeighted.cpp">Q1DWeighted.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="Q1D-v2.html" title="Previous Chapter: Q1D v2"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Q1D v2</span>
    </a>
  </li>
  <li>
    <a href="QENSFitSequential-v1.html" title="Next Chapter: QENSFitSequential v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">QENSFitSequential v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>