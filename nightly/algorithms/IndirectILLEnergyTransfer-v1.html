<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>IndirectILLEnergyTransfer v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="IndirectILLReductionDIFF v1" href="IndirectILLReductionDIFF-v1.html" />
    <link rel="prev" title="IndirectFlatPlateAbsorption v2" href="IndirectFlatPlateAbsorption-v2.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">IndirectILLEnergyTransfer v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="indirectillenergytransfer-v1">
<span id="algm-indirectillenergytransfer"></span><span id="algm-indirectillenergytransfer-v1"></span><h1>IndirectILLEnergyTransfer v1<a class="headerlink" href="#indirectillenergytransfer-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/IndirectILLEnergyTransfer-v1_dlg.png"><img alt="../_images/IndirectILLEnergyTransfer-v1_dlg.png" class="screenshot" src="../_images/IndirectILLEnergyTransfer-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>IndirectILLEnergyTransfer</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#workflow" id="id6">Workflow</a></p></li>
<li><p><a class="reference internal" href="#bats" id="id7">BATS</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id8">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id9">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Performs initial energy transfer reduction for ILL indirect geometry data, instrument IN16B.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="IndirectILLReductionQENS-v1.html#algm-indirectillreductionqens"><span class="std std-ref">IndirectILLReductionQENS</span></a>, <a class="reference internal" href="IndirectILLReductionFWS-v1.html#algm-indirectillreductionfws"><span class="std std-ref">IndirectILLReductionFWS</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Run</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>File path of run (s). Allowed values: [‘nxs’]</p></td>
</tr>
<tr class="row-odd"><td><p>MapFile</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Filename of the detector grouping map file to use.  By default all the pixels will be summed per each tube.  Use .map or .xml file (see GroupDetectors documentation) only if different range is needed for each tube. Allowed values: [‘map’, ‘xml’]</p></td>
</tr>
<tr class="row-even"><td><p>ManualPSDIntegrationRange</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>1,128</p></td>
<td><p>Integration range of vertical pixels in each PSD tube.  By default all the pixels will be summed per each tube.  Use this option if the same range (other than default) is needed for all the tubes.</p></td>
</tr>
<tr class="row-odd"><td><p>Analyser</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>silicon</p></td>
<td><p>Analyser crystal. Allowed values: [‘silicon’]</p></td>
</tr>
<tr class="row-even"><td><p>Reflection</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>111</p></td>
<td><p>Analyser reflection. Allowed values: [‘111’, ‘311’]</p></td>
</tr>
<tr class="row-odd"><td><p>CropDeadMonitorChannels</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Whether or not to exclude the first and last few channels with 0 monitor count in the energy transfer formula.</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p>WorkspaceGroup</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Group name for the reduced workspace(s).</p></td>
</tr>
<tr class="row-odd"><td><p>SpectrumAxis</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>SpectrumNumber</p></td>
<td><p>The spectrum axis conversion target. Allowed values: [‘SpectrumNumber’, ‘2Theta’, ‘Q’, ‘Q2’]</p></td>
</tr>
<tr class="row-even"><td><p>NormaliseTo</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Monitor</p></td>
<td><p>Choose to normalise to monitor. Allowed values: [‘Monitor’, ‘None’]</p></td>
</tr>
<tr class="row-odd"><td><p>MonitorCutoff</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.5</p></td>
<td><p>Choose the cutoff fraction wrt the maximum of the monitor counts.</p></td>
</tr>
<tr class="row-even"><td><p>InputElasticChannelWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td></td>
<td><p>The name of the input elastic channel workspace.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputElasticChannelWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td></td>
<td><p>The name of the output elastic channel workspace.</p></td>
</tr>
<tr class="row-even"><td><p>ElasticPeakFitting</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>FitAllPixelGroups</p></td>
<td><p>Choose the method for calibrating TOF axes. Allowed values: [‘FitAllPixelGroups’, ‘FitEquatorialOnly’]</p></td>
</tr>
<tr class="row-odd"><td><p>GroupPixelsBy</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>4</p></td>
<td><p>Choose how to group the pixels for elastic peak fitting; must be a power of 2.</p></td>
</tr>
<tr class="row-even"><td><p>SampleCoordinates</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>0,0,0</p></td>
<td><p>The sample coordinates X, Y, Z.</p></td>
</tr>
<tr class="row-odd"><td><p>PulseChopper</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Auto</p></td>
<td><p>Define the pulse chopper. Allowed values: [‘Auto’, ‘12’, ‘34’]</p></td>
</tr>
<tr class="row-even"><td><p>GroupDetectors</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Group the pixels using the range, tube-by-tube (default) or in a custom way;  it is not recommended to group the detectors at this stage,  in order to get absorption corrections right,  however the default value is True for backwards compatibility.</p></td>
</tr>
<tr class="row-odd"><td><p>DiscardSingleDetectors</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Whether to discard the spectra of single detectors.</p></td>
</tr>
<tr class="row-even"><td><p>DeleteMonitorWorkspace</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Whether to delete the monitor spectrum.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>This is a part of multi-algorithm reduction workflow for <strong>IN16B</strong> indirect geometry instrument at <strong>ILL</strong>.
It handles the first steps of the reduction chain, such as grouping of the detectors, normalizing to monitor dependent on the reduction type.
It performs transformation of the axes; x-axis from channel number to energy transfer, and optionally y-axis to scattering angle or elastic momentum transfer.
It handles <strong>automatically</strong> all four types of data (QENS, EFWS, IFWS, BATS) recorded with or without mirror sense.
Note, that following the standard, the <code class="docutils literal notranslate"><span class="pre">Unit</span></code> for energy transfer (<code class="docutils literal notranslate"><span class="pre">DeltaE</span></code>) will be milli-electron-volts (<code class="docutils literal notranslate"><span class="pre">mev</span></code>).
This algorithm is intended to handle only single file at a time, although if multiple files are given, they will be automatically summed at raw level, i.e. while loading.
In this case <code class="docutils literal notranslate"><span class="pre">MergeRuns</span></code> algorithm will be invoked, which will forbid the merges across different types of data
(e.g. different mirror senses, doppler energy or velocity profiles).
Note, that this algorithm is compatible with the data recorded from 03.2014 onwards
(i.e. where Doppler’s <code class="docutils literal notranslate"><span class="pre">mirror_sense</span></code>, <code class="docutils literal notranslate"><span class="pre">maximum_delta_energy</span></code> and <code class="docutils literal notranslate"><span class="pre">velocity_profile</span></code> entries are defined in <code class="docutils literal notranslate"><span class="pre">.nxs</span></code> files).
It returns a <a class="reference internal" href="../concepts/WorkspaceGroup.html#workspacegroup"><span class="std std-ref">WorkspaceGroup</span></a>, containing one (no mirror sense) or two workspaces (with mirror sense) for left and right wings respectively.
This algorithm is <strong>not</strong> intended to be used directly by the end users. Instead it is used as a child algorithm by <a class="reference internal" href="IndirectILLReductionQENS-v1.html#algm-indirectillreductionqens"><span class="std std-ref">IndirectILLReductionQENS</span></a>
and <a class="reference internal" href="IndirectILLReductionFWS-v1.html#algm-indirectillreductionfws"><span class="std std-ref">IndirectILLReductionFWS</span></a> for QENS and FWS type of reductions correspondingly.</p>
</section>
<section id="workflow">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Workflow</a><a class="headerlink" href="#workflow" title="Permalink to this heading">¶</a></h2>
<img alt="../_images/IndirectILLEnergyTransfer-v1_wkflw.svg" src="../_images/IndirectILLEnergyTransfer-v1_wkflw.svg" /></section>
<section id="bats">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">BATS</a><a class="headerlink" href="#bats" title="Permalink to this heading">¶</a></h2>
<p>This algorithm support also the Backscattering And Time-of-flight Spectrometer (BATS) mode of IN16B.
In this mode it will fit the elastic peak positions for each group of pixels, with grouping defined as a user input.
Elastic peak will be searched in the middle half of the TOF window.
Then each group of pixels will be calibrated to center the elastic peak at 0 energy transfer.
However in the output there will be no grouping of pixels by default.
The actual energy transfer range will be derived from the monitor window, taking the user defined cutoff value into account.
The frame offset of the monitor will be deduced automatically.
ElasticChannelWorkspace can be optionally output, which can be used as input for the measurements with inelastic offset, where there is no elastic peak in the recorded frame.
Values for single detectors will be computed similarly but separately, and they can be ignored if needed, using the <code class="docutils literal notranslate"><span class="pre">DiscardSingleDetectors</span></code> flag.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p><strong>Example - IndirectILLEnergyTransfer : QENS data without mirror sense</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">IndirectILLEnergyTransfer</span><span class="p">(</span><span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN16B/090661.nxs&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reduced workspace has </span><span class="si">{:d}</span><span class="s2"> wing&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getNumberOfEntries</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;which has </span><span class="si">{:d}</span><span class="s2"> spectra&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;and </span><span class="si">{:d}</span><span class="s2"> bins&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">blocksize</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Reduced workspace has 1 wing
which has 18 spectra
and 1024 bins
</pre></div>
</div>
<p><strong>Example - IndirectILLEnergyTransfer : QENS data with mirror sense</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">IndirectILLEnergyTransfer</span><span class="p">(</span><span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN16B/136553:136555.nxs&#39;</span><span class="p">,</span> <span class="n">CropDeadMonitorChannels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reduced workspace has </span><span class="si">{:d}</span><span class="s2"> wings&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getNumberOfEntries</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;which have </span><span class="si">{:d}</span><span class="s2"> spectra&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;and </span><span class="si">{:d}</span><span class="s2"> bins&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">blocksize</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Reduced workspace has 2 wings
which have 18 spectra
and 1017 bins
</pre></div>
</div>
<p><strong>Example - IndirectILLEnergyTransfer : BATS data</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">IndirectILLEnergyTransfer</span><span class="p">(</span><span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN16B/215962.nxs&#39;</span><span class="p">,</span> <span class="n">PulseChopper</span><span class="o">=</span><span class="s1">&#39;34&#39;</span><span class="p">,</span> <span class="n">GroupDetectors</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The output workspace has </span><span class="si">{:d}</span><span class="s2"> spectra&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;and </span><span class="si">{:d}</span><span class="s2"> bins&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">blocksize</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The output workspace has 2050 spectra
and 1121 bins
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Workflow/MIDAS.html">Workflow\MIDAS</a> | <a class="reference external" href="categories/Workflow/Inelastic.html">Workflow\Inelastic</a> | <a class="reference external" href="categories/Inelastic/Indirect.html">Inelastic\Indirect</a> | <a class="reference external" href="categories/Inelastic/Reduction.html">Inelastic\Reduction</a> | <a class="reference external" href="categories/ILL/Indirect.html">ILL\Indirect</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/IndirectILLEnergyTransfer.py">IndirectILLEnergyTransfer.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="IndirectFlatPlateAbsorption-v2.html" title="Previous Chapter: IndirectFlatPlateAbsorption v2"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; IndirectFlatP...</span>
    </a>
  </li>
  <li>
    <a href="IndirectILLReductionDIFF-v1.html" title="Next Chapter: IndirectILLReductionDIFF v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">IndirectILLRe... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>