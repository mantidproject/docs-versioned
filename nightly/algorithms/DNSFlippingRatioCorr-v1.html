<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>DNSFlippingRatioCorr v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DNSMergeRuns v1" href="DNSMergeRuns-v1.html" />
    <link rel="prev" title="DNSComputeDetEffCorrCoefs v1" href="DNSComputeDetEffCorrCoefs-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">DNSFlippingRatioCorr v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="dnsflippingratiocorr-v1">
<span id="algm-dnsflippingratiocorr"></span><span id="algm-dnsflippingratiocorr-v1"></span><h1>DNSFlippingRatioCorr v1<a class="headerlink" href="#dnsflippingratiocorr-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/DNSFlippingRatioCorr-v1_dlg.png"><img alt="../_images/DNSFlippingRatioCorr-v1_dlg.png" class="screenshot" src="../_images/DNSFlippingRatioCorr-v1_dlg.png" style="width: 300px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>DNSFlippingRatioCorr</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p>
<ul>
<li><p><a class="reference internal" href="#valid-input-workspaces" id="id6">Valid input workspaces</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#usage" id="id7">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id8">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Performs flipping ratio correction on a given dataset using the NiCr data.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="DNSComputeDetEffCorrCoefs-v1.html#algm-dnscomputedeteffcorrcoefs"><span class="std std-ref">DNSComputeDetEffCorrCoefs</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SFDataWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A workspace with spin-flip experimental data from sample.</p></td>
</tr>
<tr class="row-odd"><td><p>NSFDataWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A workspace with non spin-flip experimental data from sample.</p></td>
</tr>
<tr class="row-even"><td><p>SFNiCrWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A workspace with spin-flip NiCr data.</p></td>
</tr>
<tr class="row-odd"><td><p>NSFNiCrWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A workspace with non spin-flip NiCr data.</p></td>
</tr>
<tr class="row-even"><td><p>SFBkgrWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A workspace with spin-flip background for NiCr.</p></td>
</tr>
<tr class="row-odd"><td><p>NSFBkgrWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A workspace with non spin-flip background for NiCr.</p></td>
</tr>
<tr class="row-even"><td><p>SFOutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A workspace to save the corrected spin-flip data.</p></td>
</tr>
<tr class="row-odd"><td><p>NSFOutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A workspace to save the corrected non spin-flip data.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This algorithm is being developed for a specific instrument. It might get changed or even
removed without a notification, should instrument scientists decide to do so.</p>
</div>
<p>This algorithm applies flipping ratio correction to a given data workspaces. As a result, following workspaces will be created:</p>
<ul class="simple">
<li><p>output workspace with corrected spin-flip data. Sample logs will be copied from the data spin-flip workspace.</p></li>
<li><p>output workspace with corrected non-spin-flip data. Sample logs will be copied from the data non-spin-flip workspace.</p></li>
</ul>
<p>Flipping ratio correction is performed using the measurements of <span class="math notranslate nohighlight">\(Ni_{0.89}\,Cr_{0.11}\)</span> standard sample (hereafter NiCr). Background for NiCr must be also measured and provided to the algorithm as an input. Both, spin-flip anf non-spin-flip measurements are required. This algorithm performs the flipping ratio correction according to J. Appl. Cryst. 42, 69-84, 2009. Calculations are made in a following steps:</p>
<ol class="arabic">
<li><p>Subtract Background from NiCr:</p>
<p><span class="math notranslate nohighlight">\(N^{SF,\,NSF}_i = (N^{SF,\,NSF}_i)_{raw} - (B^{SF,\,NSF}_i)\)</span></p>
<p>The <a class="reference internal" href="Minus-v1.html#algm-minus"><span class="std std-ref">Minus v1</span></a> algorithm is used for this step. In the case of negative result, the error message will be produced and the algorithm terminates.</p>
</li>
<li><p>Calculate the correction coefficients:</p>
<p><span class="math notranslate nohighlight">\(k_i = \frac{N^{NSF}_i}{N^{SF}_i} - 1\)</span></p>
<p>The <a class="reference internal" href="Divide-v1.html#algm-divide"><span class="std std-ref">Divide v1</span></a> algorithm is used for this step.</p>
</li>
<li><p>Apply correction to the data:</p>
<p><span class="math notranslate nohighlight">\((I^{NSF}_i)_{corr} = I^{NSF}_i + \frac{1}{k_i}\cdot\left(I^{NSF}_i - I^{SF}_i\right)\)</span></p>
<p><span class="math notranslate nohighlight">\((I^{SF}_i)_{corr} = I^{SF}_i - \frac{1}{k_i}\cdot\left(I^{NSF}_i - I^{SF}_i\right)\)</span></p>
<p>where <span class="math notranslate nohighlight">\(I^{SF,\,NSF}_i\)</span> are the neutron counts in the <strong>SFDataWorkspace</strong> and <strong>NSFDataWorkspace</strong>, respectively.</p>
</li>
</ol>
<section id="valid-input-workspaces">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Valid input workspaces</a><a class="headerlink" href="#valid-input-workspaces" title="Permalink to this heading">¶</a></h3>
<p>The input workspaces have to have the following in order to be valid inputs for this algorithm.</p>
<ul class="simple">
<li><p>The same number of dimensions</p></li>
<li><p>The same number of spectra</p></li>
<li><p>The same number of bins</p></li>
<li><p>All given workspaces must have the same polarisation (algorithm checks for the ‘polarisation’ and ‘polarisation_comment’ sample logs)</p></li>
<li><p>All given workspaces must be normalized either to monitor counts or to experiment duration</p></li>
<li><p>All given workspaces must have the same kind of normalization (algorithm checks for ‘normalized’ sample log)</p></li>
<li><p>All given workspaces must have the appropriate flipper status (algorithm checks for ‘flipper’ sample log): spin-flip workspaces must have flipper ‘ON’ and non-spin-flip workspaces must have flipper ‘OFF’</p></li>
</ul>
<p>If any of these conditions is not fulfilled, the algorithm terminates.</p>
<p>For the physically meaningful correction it is also important that these workspaces have the same slits size, detector bank rotation angle and the neutron wavelength. If some of these parameters are different, algorithm produces warning. If these properties are not specified in the workspace sample logs, no comparison is performed.</p>
</section>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p><strong>Example - Apply flipping ratio correction to a Vanadium run:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">datapath</span> <span class="o">=</span> <span class="s2">&quot;/path/to/data/dns/rc36b_standard_dz&quot;</span>
<span class="n">coilcurrents</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s1">&#39;currents.txt&#39;</span><span class="p">)</span>

<span class="c1"># define input files.</span>
<span class="n">sf_vanafile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s1">&#39;dz29100525vana.d_dat&#39;</span><span class="p">)</span>
<span class="n">nsf_vanafile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s1">&#39;dz29100526vana.d_dat&#39;</span><span class="p">)</span>

<span class="n">sf_bkgrfile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s1">&#39;dz29100645leer.d_dat&#39;</span><span class="p">)</span>
<span class="n">nsf_bkgrfile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s1">&#39;dz29100646leer.d_dat&#39;</span><span class="p">)</span>

<span class="n">sf_nicrfile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s1">&#39;dz29100585nicr.d_dat&#39;</span><span class="p">)</span>
<span class="n">nsf_nicrfile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s1">&#39;dz29100586nicr.d_dat&#39;</span><span class="p">)</span>

<span class="c1"># load files to workspaces</span>
<span class="n">sf_vana</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">sf_vanafile</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">coilcurrents</span><span class="p">)</span>
<span class="n">nsf_vana</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">nsf_vanafile</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">coilcurrents</span><span class="p">)</span>

<span class="n">sf_nicr</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">sf_nicrfile</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">coilcurrents</span><span class="p">)</span>
<span class="n">nsf_nicr</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">nsf_nicrfile</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">coilcurrents</span><span class="p">)</span>

<span class="n">sf_bkgr</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">sf_bkgrfile</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">coilcurrents</span><span class="p">)</span>
<span class="n">nsf_bkgr</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">nsf_bkgrfile</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">coilcurrents</span><span class="p">)</span>

<span class="c1"># for a physically meaningful correction, we must subtract background from Vanadium</span>
<span class="c1"># this step is usually not required for other kinds of samples</span>
<span class="n">sf_vana_bg</span> <span class="o">=</span> <span class="n">sf_vana</span> <span class="o">-</span> <span class="n">sf_bkgr</span>
<span class="n">nsf_vana_bg</span> <span class="o">=</span> <span class="n">nsf_vana</span> <span class="o">-</span> <span class="n">nsf_bkgr</span>

<span class="c1"># apply correction</span>
<span class="n">DNSFlippingRatioCorr</span><span class="p">(</span><span class="n">sf_vana_bg</span><span class="p">,</span> <span class="n">nsf_vana_bg</span><span class="p">,</span> <span class="n">sf_nicr</span><span class="p">,</span> <span class="n">nsf_nicr</span><span class="p">,</span> <span class="n">sf_bkgr</span><span class="p">,</span> <span class="n">nsf_bkgr</span><span class="p">,</span>
                     <span class="n">SFOutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sf_corrected&#39;</span><span class="p">,</span> <span class="n">NSFOutputWorkspace</span><span class="o">=</span><span class="s1">&#39;nsf_corrected&#39;</span><span class="p">)</span>

<span class="c1"># retrieve output workspaces</span>
<span class="n">sf_corrected</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sf_corrected&#39;</span><span class="p">]</span>
<span class="n">nsf_corrected</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;nsf_corrected&#39;</span><span class="p">]</span>

<span class="c1"># calculate ratio of spin-flip to non-spin-flip</span>
<span class="n">vana_ratio</span> <span class="o">=</span> <span class="n">sf_corrected</span><span class="o">/</span><span class="n">nsf_corrected</span>

<span class="c1"># ratio must be around 2, print first 5 points of the data array</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">vana_ratio</span><span class="o">.</span><span class="n">extractY</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<blockquote>
<div><p>[[ 2.]
[ 2.]
[ 2.]
[ 2.]
[ 2.]]</p>
</div></blockquote>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Workflow/MLZ/DNS.html">Workflow\MLZ\DNS</a> | <a class="reference external" href="categories/CorrectionFunctions/SpecialCorrections.html">CorrectionFunctions\SpecialCorrections</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/PythonInterface/plugins/algorithms/DNSFlippingRatioCorr.py">DNSFlippingRatioCorr.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DNSComputeDetEffCorrCoefs-v1.html" title="Previous Chapter: DNSComputeDetEffCorrCoefs v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DNSComputeDet...</span>
    </a>
  </li>
  <li>
    <a href="DNSMergeRuns-v1.html" title="Next Chapter: DNSMergeRuns v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DNSMergeRuns v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>