<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>ConvertToMD v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ConvertToMDMinMaxGlobal v1" href="ConvertToMDMinMaxGlobal-v1.html" />
    <link rel="prev" title="ConvertToHistogram v1" href="ConvertToHistogram-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">ConvertToMD v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="converttomd-v1">
<span id="algm-converttomd"></span><span id="algm-converttomd-v1"></span><h1>ConvertToMD v1<a class="headerlink" href="#converttomd-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ConvertToMD-v1_dlg.png"><img alt="../_images/ConvertToMD-v1_dlg.png" class="screenshot" src="../_images/ConvertToMD-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>ConvertToMD</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#used-subalgorithms" id="id6">Used Subalgorithms</a></p></li>
<li><p><a class="reference internal" href="#notes" id="id7">Notes</a></p></li>
<li><p><a class="reference internal" href="#indexed-mode" id="id8">Indexed mode</a></p></li>
<li><p><a class="reference internal" href="#how-to-write-custom-converttomd-plugin" id="id9">How to write custom ConvertToMD plugin</a></p></li>
<li><p><a class="reference internal" href="#usage-examples" id="id10">Usage examples</a></p></li>
<li><p><a class="reference internal" href="#source" id="id11">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Create a MDEventWorkspace with selected dimensions, e.g. the reciprocal space of momentums (Qx, Qy, Qz) or momentums modules mod(Q), energy transfer dE if available and any other user specified log values which can be treated as dimensions.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="ConvertToDiffractionMDWorkspace-v3.html#algm-converttodiffractionmdworkspace"><span class="std std-ref">ConvertToDiffractionMDWorkspace</span></a>, <a class="reference internal" href="ConvertToMDMinMaxGlobal-v1.html#algm-converttomdminmaxglobal"><span class="std std-ref">ConvertToMDMinMaxGlobal</span></a>, <a class="reference internal" href="ConvertToMDMinMaxLocal-v1.html#algm-converttomdminmaxlocal"><span class="std std-ref">ConvertToMDMinMaxLocal</span></a>, <a class="reference internal" href="CreateMDWorkspace-v1.html#algm-createmdworkspace"><span class="std std-ref">CreateMDWorkspace</span></a>, <a class="reference internal" href="SetSpecialCoordinates-v1.html#algm-setspecialcoordinates"><span class="std std-ref">SetSpecialCoordinates</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>An input Matrix Workspace (2DMatrix or Event workspace)</p></td>
</tr>
<tr class="row-odd"><td><p>QDimensions</p></td>
<td><p>InOut</p></td>
<td><p>string</p></td>
<td><p>CopyToMD</p></td>
<td><p>String, describing available analysis modes, registered with MD Transformation factory.There are 3 modes currently available and described in details on <em>MD Transformation factory</em> page.The modes names are <strong>CopyToMD</strong>, <strong>|Q|</strong> and <strong>Q3D</strong>. Allowed values: [‘CopyToMD’, ‘Q3D’, ‘|Q|’]</p></td>
</tr>
<tr class="row-even"><td><p>dEAnalysisMode</p></td>
<td><p>InOut</p></td>
<td><p>string</p></td>
<td><p>Direct</p></td>
<td><p>You can analyze neutron energy transfer in <strong>Direct</strong>, <strong>Indirect</strong> or <strong>Elastic</strong> mode.The analysis mode has to correspond to experimental set up. Selecting inelastic mode increasesthe number of the target workspace dimensions by one. See <em>MD Transformation factory</em> for further details. Allowed values: [‘Elastic’, ‘Direct’, ‘Indirect’]</p></td>
</tr>
<tr class="row-odd"><td><p>Q3DFrames</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>AutoSelect</p></td>
<td><p>Selects Q-dimensions of the output workspace in <strong>Q3D</strong> case.  <strong>AutoSelect</strong>: Choose the target coordinate frame as the function of goniometer and UB matrix values set on the input workspace. <strong>Q (lab frame)</strong>: Wave-vector converted into the lab frame. <strong>Q (sample frame)</strong>: Wave-vector converted into the frame of the sample (taking out the goniometer rotation). <strong>HKL</strong>: Use the sample’s UB matrix to convert Wave-vector to crystal’s HKL indices.See <em>MD Transformation factory</em> <strong>(Q3D)</strong> for more details about this.  Allowed values: [‘Q_lab’, ‘Q_sample’, ‘HKL’, ‘AutoSelect’]</p></td>
</tr>
<tr class="row-even"><td><p>QConversionScales</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Q in A^-1</p></td>
<td><p>This property to normalize three momentums obtained in <strong>Q3D</strong> mode. See <em>MD Transformation factory</em> for description and available scaling modes. The value can be modified depending on the target coordinate system, defined by the property <strong>OutputDimensions</strong>.  Allowed values: [‘Q in A^-1’, ‘Q in lattice units’, ‘Orthogonal HKL’, ‘HKL’]</p></td>
</tr>
<tr class="row-odd"><td><p>OtherDimensions</p></td>
<td><p>Input</p></td>
<td><p>str list</p></td>
<td></td>
<td><p>List(comma separated) of additional to <strong>Q</strong> and <strong>DeltaE</strong> variables which form additional (orthogonal) to <strong>Q</strong> dimensions in the target workspace (e.g. Temperature or Magnetic field). These variables had to be logged during experiment and the names of these variables have to coincide with the log names for the records of these variables in the source workspace.</p></td>
</tr>
<tr class="row-even"><td><p>PreprocDetectorsWS</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>PreprocessedDetectorsWS</p></td>
<td><p>The name of the table workspace where the part of the detectors transformation into reciprocal space, calculated by <a class="reference internal" href="PreprocessDetectorsToMD-v1.html#algm-preprocessdetectorstomd"><span class="std std-ref">PreprocessDetectorsToMD v1</span></a> algorithm is stored. If the workspace is not found in analysis data service, <a class="reference internal" href="PreprocessDetectorsToMD-v1.html#algm-preprocessdetectorstomd"><span class="std std-ref">PreprocessDetectorsToMD v1</span></a> used to calculate it. If found, the algorithm uses existing workspace. The field is useful if one expects to analyze number of different experiments obtained on the same instrument… warning:: Dangerous if one uses number of workspaces with modified derived instrument one after another. <em>In this case this property has to be set to</em> <strong>“-”</strong> <em>sting (minus without quotes) or empty (possible from script only) to force the workspace recalculation each time the algorithm is invoked.</em></p></td>
</tr>
<tr class="row-odd"><td><p>UpdateMasks</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>if PreprocessDetectorWS is used to build the workspace with preprocessed detectors at first algorithm call,and the input workspaces instruments are different by just different masked detectors, setting this option to true forces <a class="reference internal" href="PreprocessDetectorsToMD-v1.html#algm-preprocessdetectorstomd"><span class="std std-ref">PreprocessDetectorsToMD v1</span></a>  update only the detectors masks for all subsequent calls to this algorithm… warning:: <em>This is temporary solution necessary until Mantid masks spectra by 0 rather then by NaN.</em></p></td>
</tr>
<tr class="row-even"><td><p>LorentzCorrection</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Correct the weights of events or signals and errors transformed into reciprocal space by multiplying them by the Lorentz multiplier:  <span class="math notranslate nohighlight">\(sin(\theta)^2/\lambda^4\)</span>. Currently works in Q3D Elastic case only and is ignored in any other case.</p></td>
</tr>
<tr class="row-odd"><td><p>IgnoreZeroSignals</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Enabling this property forces the algorithm to ignore bins with zero signal for an input matrix workspace. Input event workspaces are not affected. This violates the data normalization but may substantially accelerate calculations in situations when the normalization is not important (e.g. peak finding).</p></td>
</tr>
<tr class="row-even"><td><p>Uproj</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td></td>
<td><p>Defines the first projection vector of the target Q coordinate system in <strong>Q3D</strong> mode - Default (1,0,0)</p></td>
</tr>
<tr class="row-odd"><td><p>Vproj</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td></td>
<td><p>Defines the second projection vector of the target Q coordinate system in <strong>Q3D</strong> mode - Default (0,1,0).</p></td>
</tr>
<tr class="row-even"><td><p>Wproj</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td></td>
<td><p>Defines the third projection vector of the target Q coordinate system in <strong>Q3D</strong> mode. - Default (0,0,1)</p></td>
</tr>
<tr class="row-odd"><td><p>AbsMinQ</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Do not add events to MD workspace that are closer to the origin in QSample radius than this value. Needed for 3Dviews to remove noise.</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MDWorkspace.html#mdworkspace"><span class="std std-ref">MDEventWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Name of the output <em>MDEventWorkspace</em>.</p></td>
</tr>
<tr class="row-odd"><td><p>OverwriteExisting</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>By default  (“1”), existing Output Workspace will be replaced. Select false (“0”) if you want to add new events to the workspace, which already exist.  Choosing “0” can be very inefficient for file-based workspaces</p></td>
</tr>
<tr class="row-even"><td><p>MinValues</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td></td>
<td><p>It has to be N comma separated values, where N is the number of dimensions of the target workspace. Values smaller then specified here will not be added to workspace.  Number N is defined by properties 4,6 and 7 and described on <em>MD Transformation factory</em> page. See also <a class="reference internal" href="ConvertToMDMinMaxLocal-v1.html#algm-converttomdminmaxlocal"><span class="std std-ref">ConvertToMDMinMaxLocal v1</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>MaxValues</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td></td>
<td><p>A list of the same size and the same units as MinValues list. Values higher or equal to the specified by this list will be ignored</p></td>
</tr>
<tr class="row-even"><td><p>SplitInto</p></td>
<td><p>Input</p></td>
<td><p>int list</p></td>
<td><p>5</p></td>
<td><p>A comma separated list of into how many sub-grid elements each dimension should split; or just one to split into the same number for all dimensions. Default 5.</p></td>
</tr>
<tr class="row-odd"><td><p>SplitThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1000</p></td>
<td><p>How many events in a box before it should be split. Default 1000.</p></td>
</tr>
<tr class="row-even"><td><p>MaxRecursionDepth</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>20</p></td>
<td><p>How many levels of box splitting recursion are allowed. The smallest box will have each side length <span class="math notranslate nohighlight">\(l = (extents) / (SplitInto^{MaxRecursionDepth}).\)</span> Default 20.</p></td>
</tr>
<tr class="row-odd"><td><p>MinRecursionDepth</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Optional. If specified, then all the boxes will be split to this minimum recursion depth. 0 = no splitting, 1 = one level of splitting, etc.   Be careful using this since it can quickly create a huge number of <span class="math notranslate nohighlight">\(boxes = SplitInto^{MinRercursionDepth \times NumDimensions}\)</span>.   But setting this property equal to MaxRecursionDepth is necessary if one wants to generate multiple file based workspaces in order to merge them later.</p></td>
</tr>
<tr class="row-even"><td><p>TopLevelSplitting</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>This option causes a split of the top level, i.e. level0, of 50 for the first four dimensions.</p></td>
</tr>
<tr class="row-odd"><td><p>Filename</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>The name of the Nexus file to write, as a full or relative path. Only used if FileBackEnd is true. Allowed extensions: [‘.nxs’]</p></td>
</tr>
<tr class="row-even"><td><p>FileBackEnd</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If true, Filename must also be specified. The algorithm will create the specified file in addition to an output workspace. The workspace will load data from the file on demand in order to reduce memory use.</p></td>
</tr>
<tr class="row-odd"><td><p>ConverterType</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Default</p></td>
<td><p>[Default, Indexed], indexed is the experimental type that can speedup the conversion processfor the big files using the indexing. Allowed values: [‘Default’, ‘Indexed’]</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>The algorithm is used transform existing <a class="reference internal" href="../concepts/EventWorkspace.html#eventworkspace"><span class="std std-ref">Event</span></a>
or <a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">Matrix</span></a> workspace into
<a class="reference internal" href="../concepts/MDWorkspace.html#mdworkspace"><span class="std std-ref">Multidimensional workspace</span></a>.</p>
<p>If  the target workspace does not exist, the algorithm creates <a class="reference internal" href="../concepts/MDWorkspace.html#mdworkspace"><span class="std std-ref">MDEventWorkspace</span></a>
with selected dimensions, e.g. the reciprocal space of momentums <strong>(Qx, Qy, Qz)</strong> or momentums modules <strong>|Q|</strong>, energy transfer <strong>dE</strong> if available
and any other user specified log values which can be treated as dimensions. If the target workspace do exist,
the <strong>MD Events</strong> are added to this workspace.</p>
<p>Using the FileBackEnd and Filename properties the algorithm can produce a file-backed workspace.
Note that this will significantly increase the execution time of the algorithm.</p>
</section>
<section id="used-subalgorithms">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Used Subalgorithms</a><a class="headerlink" href="#used-subalgorithms" title="Permalink to this heading">¶</a></h2>
<p>The algorithm uses <a class="reference internal" href="../concepts/UnitFactory.html#unit-factory"><span class="std std-ref">Unit Factory</span></a> and existing unit
conversion procedures from the input Workspace <a class="reference internal" href="../concepts/UnitFactory.html#unit-factory"><span class="std std-ref">units</span></a>
to the <a class="reference internal" href="../concepts/UnitFactory.html#unit-factory"><span class="std std-ref">units</span></a> , necessary
for transformation into correspondent <strong>MD Event workspace</strong>. It also uses
<a class="reference internal" href="PreprocessDetectorsToMD-v1.html#algm-preprocessdetectorstomd"><span class="std std-ref">PreprocessDetectorsToMD v1</span></a> algorithm to help
with transformation to reciprocal space.</p>
<p>If min, max or both lists of values (properties 12 and 13) for the
algorithm are not specified,
<a class="reference internal" href="ConvertToMDMinMaxLocal-v1.html#algm-converttomdminmaxlocal"><span class="std std-ref">ConvertToMDMinMaxLocal v1</span></a> is used to estimate
missing min-max values. This algorithm is also used to calculate min-max
values if specified min-max values are deemed incorrect (e.g. less
values then dimensions or some min values are bigger then max values)</p>
<p><span class="math notranslate nohighlight">\(l = (extents) / (SplitInto^{MaxRecursionDepth}).\)</span></p>
</section>
<section id="notes">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Notes</a><a class="headerlink" href="#notes" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>For elastic analysis (<span class="math notranslate nohighlight">\(dEAnalysisMode=Elastic\)</span>) the target
<a class="reference internal" href="../concepts/UnitFactory.html#unit-factory"><span class="std std-ref">unit</span></a> is momentum <span class="math notranslate nohighlight">\(k\)</span>.</p></li>
<li><p>For no analysis (CopyToMD) mode, the units remain the one, previously
defined along the workspace’s axes.</p></li>
<li><p>When units of input Matrix 2D workspace (Histogram workspace) are not
Momentums for Elastic or EnergyTransfer for inelastic mode, the
algorithm uses internal unit conversion of input X-values based on
central average of a bin ranges. Namely, value
<span class="math notranslate nohighlight">\(X_c = 0.5*(X_i+X_{i+1})\)</span> is calculated and converted to
Momentum or EnergyTransfer correspondingly. This can give slightly
different result from the case, when input workspace has been
converted into correspondent units before converting to MDEvents.</p></li>
<li><p>Confusing message “Error in execution of algorithm ConvertToMD: emode
must be equal to 1 or 2 for energy transfer calculation” is generated
when one tries to process the results of inelastic scattering
experiment in elastic mode. This message is generated by units
conversion routine, which finds out that one of the workspace axis is
in <a class="reference internal" href="../concepts/UnitFactory.html#unit-factory"><span class="std std-ref">unit</span></a> of DeltaE. These units can not be directly
converted into momentum or energy, necessary for elastic mode. Select
Direct or Indirect mode and integrate over whole energy transfer
range to obtain MD workspace, which would correspond to an Elastic
mode.</p></li>
<li><p>A good guess on the limits can be obtained from the
<a class="reference internal" href="ConvertToMDMinMaxLocal-v1.html#algm-converttomdminmaxlocal"><span class="std std-ref">ConvertToMDMinMaxLocal v1</span></a> algorithm.</p></li>
</ol>
</section>
<section id="indexed-mode">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Indexed mode</a><a class="headerlink" href="#indexed-mode" title="Permalink to this heading">¶</a></h2>
<p>Setting the <cite>ConverterType</cite> parameter to <cite>Indexed</cite> uses an alternative intermediate data format within <cite>ConvertToMD</cite> which may give significant performance boosts in certain cases.</p>
<p>The performance benefit of this method is dependant on the number of events in the input dataset.
Once you have data files containing more than 100 million events and have at least 8 cores this method becomes worth enabling.
For large files (&gt;500 million events) performance scales well with the number of available CPU cores (i.e. using 32 cores will be notably faster than 8 cores).</p>
<p>Use of this method comes with the following restrictions:</p>
<ol class="arabic simple">
<li><p><cite>SplitInto</cite> should be the power of two (i.e. 2, 4, 8, 16, etc.)</p></li>
<li><p><cite>FileBackEnd</cite> and <cite>TopLevelSplitting</cite> are not applicable and should be disabled</p></li>
<li><p>Indexing adds a small numerical error to the event coordinates, the magnitude of this error is listed in the log (<cite>Error with using Morton indexes is</cite>)</p></li>
</ol>
</section>
<section id="how-to-write-custom-converttomd-plugin">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">How to write custom ConvertToMD plugin</a><a class="headerlink" href="#how-to-write-custom-converttomd-plugin" title="Permalink to this heading">¶</a></h2>
<p>This information intended for developers who have at least basic
knowledge of C++ and needs to write its own
plugin using <a class="reference external" href="https://developer.mantidproject.org/WritingCustomConvertToMDTransformation.html#writingcustomconverttomdtransformation" title="(in MantidProject vmaster)"><span>Writing a Custom ConvertToMD Transformation</span></a>.</p>
</section>
<section id="usage-examples">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Usage examples</a><a class="headerlink" href="#usage-examples" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p><strong>Example - Convert re-binned MARI 2D workspace to 3D MD workspace for further analysis/merging with data at different temperatures :</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load Operation (disabled in test code)</span>
<span class="c1"># Load(Filename=&#39;MAR11001.nxspe&#39;,OutputWorkspace=&#39;MAR11001&#39;)</span>
<span class="c1"># Simulates Load of the workspace above #################</span>
<span class="n">redWS</span> <span class="o">=</span> <span class="n">CreateSimulationWorkspace</span><span class="p">(</span><span class="n">Instrument</span><span class="o">=</span><span class="s1">&#39;MAR&#39;</span><span class="p">,</span><span class="n">BinParams</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">UnitX</span><span class="o">=</span><span class="s1">&#39;DeltaE&#39;</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;MAR11001&#39;</span><span class="p">)</span>
<span class="n">AddSampleLog</span><span class="p">(</span><span class="n">redWS</span><span class="p">,</span><span class="n">LogName</span><span class="o">=</span><span class="s1">&#39;Ei&#39;</span><span class="p">,</span><span class="n">LogText</span><span class="o">=</span><span class="s1">&#39;12.&#39;</span><span class="p">,</span><span class="n">LogType</span><span class="o">=</span><span class="s1">&#39;Number&#39;</span><span class="p">);</span>
<span class="c1"># Do fine rebinning, which accounts for poligon intersections</span>
<span class="n">SofQW3</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;MAR11001&#39;</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;MAR11001Qe2&#39;</span><span class="p">,</span><span class="n">QAxisBinning</span><span class="o">=</span><span class="s1">&#39;0,0.1,7&#39;</span><span class="p">,</span><span class="n">EMode</span><span class="o">=</span><span class="s1">&#39;Direct&#39;</span><span class="p">)</span>
<span class="n">AddSampleLog</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;MAR11001Qe2&#39;</span><span class="p">,</span><span class="n">LogName</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">LogText</span><span class="o">=</span><span class="s1">&#39;100.0&#39;</span><span class="p">,</span><span class="n">LogType</span><span class="o">=</span><span class="s1">&#39;Number Series&#39;</span><span class="p">)</span>
<span class="c1"># copy to new MD workspace</span>
<span class="n">ws</span><span class="o">=</span><span class="n">ConvertToMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;MAR11001Qe2&#39;</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;MD3&#39;</span><span class="p">,</span><span class="n">QDimensions</span><span class="o">=</span><span class="s1">&#39;CopyToMD&#39;</span><span class="p">,</span><span class="n">OtherDimensions</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span>\
<span class="n">MinValues</span><span class="o">=</span><span class="s1">&#39;-10,0,0&#39;</span><span class="p">,</span><span class="n">MaxValues</span><span class="o">=</span><span class="s1">&#39;10,6,500&#39;</span><span class="p">,</span><span class="n">SplitInto</span><span class="o">=</span><span class="s1">&#39;50,50,5&#39;</span><span class="p">)</span>


<span class="c1">#Output **MD3** workspace can be viewed in slice-viewer as 3D workspace with T-axis having single value.</span>
<span class="c1">#Visualize 3D data using slice viewer:</span>
<span class="c1">#plotSlice(ws)</span>

<span class="c1"># Look at sample results:</span>
<span class="c1"># A way to look at these results as a text:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resulting MD workspace has </span><span class="si">{0}</span><span class="s2"> events and </span><span class="si">{1}</span><span class="s2"> dimensions&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getNEvents</span><span class="p">(),</span><span class="n">ws</span><span class="o">.</span><span class="n">getNumDims</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Resulting MD workspace has 802 events and 3 dimensions
--------------------------------------------
</pre></div>
</div>
<p><strong>Example - Convert Set of Event Workspaces (Horace scan) to 4D MD workspace, direct mode:</strong></p>
<p>Meaningful results can be obtained on the basis of CNCS_7860_event.nxs file, available in Mantid
test folder. The script below simulates workspace loading but would produce meaningfill result if real experimental data
obtained in an experiment and stored in nxspe files are provided to it.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="c1"># set up target ws name and remove target workspace with the same name which can occasionally exist.</span>
<span class="c1"># list of MD files (workspaces) to combine into target MD workspace</span>
<span class="n">MD_FilesList</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>

<span class="c1"># define convetr to MD parameters</span>
<span class="n">pars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">();</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;InputWorkspace&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;QDimensions&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Q3D&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;dEAnalysisMode&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Direct&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;Q3DFrames&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;HKL&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;QConversionScales&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;HKL&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;PreprocDetectorsWS&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;preprDetMantid&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;MinValues&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;-3,-3,-3.,-50.0&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;MaxValues&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;3.,3.,3.,50.0&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;SplitInto&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">50</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;MaxRecursionDepth&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;MinRecursionDepth&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;OverwriteExisting&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>  <span class="c1"># Change this to false, if the files should/can be added in memory</span>
<span class="c1"># test script combines all contributed files in memory</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;OverwriteExisting&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>  <span class="c1"># Change this to false, if the files should/can be added in memory</span>
<span class="c1">#</span>
<span class="c1">#---&gt; Start loop over contributing files</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
     <span class="n">source_file</span> <span class="o">=</span> <span class="s1">&#39;MER19566_22.0meV_one2one125.nxspe&#39;</span><span class="p">;</span> <span class="c1"># redefine source files list as function of loop number</span>
     <span class="n">target</span>  <span class="o">=</span> <span class="s1">&#39;MDMAP_T1&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.nxs&#39;</span><span class="p">;</span>
     <span class="c1"># check if the file already been converted to MD and is there</span>
     <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target</span> <span class="p">)):</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Converting  </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">source_file</span><span class="p">))</span>
         <span class="c1">#current_ws=LoadNXSPE(Filename=source)</span>
         <span class="c1">#### For the sample script, simulate load operation above</span>
         <span class="n">current_ws</span> <span class="o">=</span> <span class="n">CreateSimulationWorkspace</span><span class="p">(</span><span class="n">Instrument</span><span class="o">=</span><span class="s1">&#39;MAR&#39;</span><span class="p">,</span><span class="n">BinParams</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">UnitX</span><span class="o">=</span><span class="s1">&#39;DeltaE&#39;</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">source_file</span><span class="p">)</span>
         <span class="n">AddSampleLog</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="n">current_ws</span><span class="p">,</span><span class="n">LogName</span><span class="o">=</span><span class="s1">&#39;Ei&#39;</span><span class="p">,</span><span class="n">LogText</span><span class="o">=</span><span class="s1">&#39;3.0&#39;</span><span class="p">,</span><span class="n">LogType</span><span class="o">=</span><span class="s1">&#39;Number&#39;</span><span class="p">)</span>

         <span class="c1">#### Add iformation which is not stored in the nxspe file</span>
         <span class="c1"># Add UB matrix (lattice and the beam direction)</span>
         <span class="n">SetUB</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="n">current_ws</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="s1">&#39;1.4165&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s1">&#39;1.4165&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;1.4165&#39;</span><span class="p">,</span><span class="n">u</span><span class="o">=</span><span class="s1">&#39;1,0,0&#39;</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="s1">&#39;0,1,0&#39;</span><span class="p">)</span>
         <span class="c1"># Add crystal rotation (assume rotation abgle Psi=5*n where n is file number. Define list of angles if this is not correct</span>
         <span class="n">AddSampleLog</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="n">current_ws</span><span class="p">,</span><span class="n">LogName</span><span class="o">=</span><span class="s1">&#39;Psi&#39;</span><span class="p">,</span><span class="n">LogText</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">LogType</span><span class="o">=</span><span class="s1">&#39;Number&#39;</span><span class="p">)</span>  <span class="c1"># --correct Psi value may be already in nxspe file. This operation is then unnecessary</span>
         <span class="c1"># set crystal rotation</span>
         <span class="n">SetGoniometer</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="n">current_ws</span><span class="p">,</span><span class="n">Axis0</span><span class="o">=</span><span class="s1">&#39;Psi,0,1,0,1&#39;</span><span class="p">)</span>

         <span class="c1"># Convert to MD</span>
         <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;InputWorkspace&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">current_ws</span><span class="p">;</span>
         <span class="n">md_ws</span><span class="o">=</span><span class="n">ConvertToMD</span><span class="p">(</span><span class="o">**</span><span class="n">pars</span><span class="p">)</span>

         <span class="c1"># save MD for further usage -- disabled in test script</span>
         <span class="c1">#SaveMD(md_ws,Filename=target);</span>
         <span class="c1">#DeleteWorkspace(md_ws);  # delete intermediate workspace to save memory</span>
         <span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">current_ws</span><span class="p">);</span>

     <span class="c1"># add the file name of the file to combine</span>
     <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">MD_FilesList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
         <span class="n">MD_FilesList</span> <span class="o">=</span> <span class="n">target</span><span class="p">;</span>
     <span class="k">else</span><span class="p">:</span>
         <span class="n">MD_FilesList</span><span class="o">=</span><span class="n">MD_FilesList</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="n">target</span><span class="p">;</span>
<span class="c1">#---&gt; End loop</span>

<span class="c1"># merge md files into file-based MD workspace</span>
<span class="c1">#md_ws = MergeMDFiles(MD_FilesList,OutputFilename=&#39;TestSQW_1.nxs&#39;,Parallel=&#39;0&#39;);</span>
<span class="c1"># plot results using sliceviewer</span>
<span class="c1">#plotSlice(md_ws)</span>
<span class="c1"># produce some test output</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resulting MD workspace contains </span><span class="si">{0}</span><span class="s2"> events and </span><span class="si">{1}</span><span class="s2"> dimensions&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">md_ws</span><span class="o">.</span><span class="n">getNEvents</span><span class="p">(),</span><span class="n">md_ws</span><span class="o">.</span><span class="n">getNumDims</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Converting  MER19566_22.0meV_one2one125.nxspe
Converting  MER19566_22.0meV_one2one125.nxspe
Converting  MER19566_22.0meV_one2one125.nxspe
Converting  MER19566_22.0meV_one2one125.nxspe
Converting  MER19566_22.0meV_one2one125.nxspe
Resulting MD workspace contains 27540 events and 4 dimensions
--------------------------------------------
</pre></div>
</div>
<p><strong>Example - Convert set of inelastic results obtained in Powder mode (direct) as function of temperature to a 3D workspace:</strong></p>
<p>This example produces 3-dimensional dataset, with a temperature axis.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up target ws name and remove target workspace with the same name which can occasionally exist.</span>
<span class="n">RezWS</span> <span class="o">=</span> <span class="s1">&#39;WS_3D&#39;</span>
<span class="k">try</span><span class="p">:</span>
     <span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">RezWS</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Target ws  </span><span class="si">{}</span><span class="s2">  not found in analysis data service</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RezWS</span><span class="p">))</span>

<span class="c1"># define convert to MD parameters</span>
<span class="n">pars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">();</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;InputWorkspace&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;QDimensions&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;|Q|&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;dEAnalysisMode&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Direct&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;OtherDimensions&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;T&#39;</span>  <span class="c1"># make temperature log to be a dimension</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;PreprocDetectorsWS&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;preprDetMantid&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;MinValues&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;0,-10,0&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;MaxValues&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;12,10,10&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;SplitInto&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;100,100,12&#39;</span>
<span class="n">pars</span><span class="p">[</span><span class="s1">&#39;OverwriteExisting&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>  <span class="c1"># contributed MD worskpaces are added in memory</span>

<span class="c1"># let&#39;s assume this is the temperature range obtained in experiments and</span>
<span class="c1"># each data file is obtained for particular temperature.</span>
<span class="n">T</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">3.5</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">6.0</span><span class="p">,</span><span class="mf">7.0</span><span class="p">,</span><span class="mf">8.0</span><span class="p">,</span><span class="mf">9.0</span><span class="p">,</span><span class="mf">9.5</span><span class="p">,</span><span class="mf">10.0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="mi">1</span><span class="p">):</span>
     <span class="c1"># source = sorurce_file_name[i];</span>
     <span class="c1">#current_ws=LoadNXSPE(Filename=source)</span>
     <span class="c1"># EMULATE LOAD OF DIFFERENT results obtained for different temperatures. ------&gt;</span>
     <span class="n">current_ws</span> <span class="o">=</span> <span class="n">CreateSimulationWorkspace</span><span class="p">(</span><span class="n">Instrument</span><span class="o">=</span><span class="s1">&#39;MAR&#39;</span><span class="p">,</span><span class="n">BinParams</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">UnitX</span><span class="o">=</span><span class="s1">&#39;DeltaE&#39;</span><span class="p">)</span>
     <span class="n">AddSampleLog</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="n">current_ws</span><span class="p">,</span><span class="n">LogName</span><span class="o">=</span><span class="s1">&#39;Ei&#39;</span><span class="p">,</span><span class="n">LogText</span><span class="o">=</span><span class="s1">&#39;3.0&#39;</span><span class="p">,</span><span class="n">LogType</span><span class="o">=</span><span class="s1">&#39;Number&#39;</span><span class="p">)</span>
     <span class="c1"># if the file does not have temperature log, add it here.</span>
     <span class="n">AddSampleLog</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="n">current_ws</span><span class="p">,</span><span class="n">LogName</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">LogText</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="n">LogType</span><span class="o">=</span><span class="s1">&#39;Number Series&#39;</span><span class="p">)</span>
     <span class="c1"># simulate changes in scattering with temperature</span>
     <span class="n">current_ws</span> <span class="o">=</span> <span class="n">current_ws</span><span class="o">*</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
     <span class="c1"># END EMULATION ---------------------------------------------------------------------</span>

     <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;InputWorkspace&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">current_ws</span><span class="p">;</span>
     <span class="n">md_ws</span><span class="o">=</span><span class="n">ConvertToMD</span><span class="p">(</span><span class="o">**</span><span class="n">pars</span><span class="p">)</span>
     <span class="c1"># delete source workspace from memory;</span>
     <span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">current_ws</span><span class="p">)</span>
 <span class="c1"># end loop</span>

<span class="c1"># produce some test output</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resulting MD workspace contains </span><span class="si">{0}</span><span class="s2"> events and </span><span class="si">{1}</span><span class="s2"> dimensions&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">md_ws</span><span class="o">.</span><span class="n">getNEvents</span><span class="p">(),</span><span class="n">md_ws</span><span class="o">.</span><span class="n">getNumDims</span><span class="p">()))</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Target ws  WS_3D  not found in analysis data service

Resulting MD workspace contains 605880 events and 3 dimensions
</pre></div>
</div>
<p><strong>Example - Convert to Q-space, indexed version:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">#.. testcode:: ExConvertToMD|Q|</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="c1"># load test workspace</span>
<span class="linenos"> 4</span><span class="n">TOPAZ_3132_event</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TOPAZ_3132_event.nxs&#39;</span><span class="p">,</span> <span class="n">ConverterType</span><span class="o">=</span><span class="s1">&#39;Indexed&#39;</span><span class="p">)</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="c1"># build peak workspace necessary for IntegrateEllipsoids algorithm to work</span>
<span class="linenos"> 7</span><span class="n">TOPAZ_3132_md</span> <span class="o">=</span> <span class="n">ConvertToMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">TOPAZ_3132_event</span><span class="p">,</span><span class="n">QDimensions</span><span class="o">=</span><span class="s1">&#39;Q3D&#39;</span><span class="p">,</span><span class="n">dEAnalysisMode</span><span class="o">=</span><span class="s1">&#39;Elastic&#39;</span><span class="p">,</span><span class="n">Q3DFrames</span><span class="o">=</span><span class="s1">&#39;Q_sample&#39;</span><span class="p">,</span><span class="n">LorentzCorrection</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>\
<span class="linenos"> 8</span><span class="n">MinValues</span><span class="o">=</span><span class="s1">&#39;-25,-25,-25&#39;</span><span class="p">,</span><span class="n">MaxValues</span><span class="o">=</span><span class="s1">&#39;25,25,25&#39;</span><span class="p">,</span><span class="n">SplitInto</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="n">SplitThreshold</span><span class="o">=</span><span class="s1">&#39;50&#39;</span><span class="p">,</span><span class="n">MaxRecursionDepth</span><span class="o">=</span><span class="s1">&#39;13&#39;</span><span class="p">,</span><span class="n">MinRecursionDepth</span><span class="o">=</span><span class="s1">&#39;7&#39;</span><span class="p">)</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="c1"># produce some test output</span>
<span class="linenos">11</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resulting MD workspace contains </span><span class="si">{0}</span><span class="s2"> events and </span><span class="si">{1}</span><span class="s2"> dimensions&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TOPAZ_3132_md</span><span class="o">.</span><span class="n">getNEvents</span><span class="p">(),</span><span class="n">TOPAZ_3132_md</span><span class="o">.</span><span class="n">getNumDims</span><span class="p">()))</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Resulting MD workspace contains 15329354 events and 3 dimensions
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/MDAlgorithms/Creation.html">MDAlgorithms\Creation</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/MDAlgorithms/inc/MantidMDAlgorithms/ConvertToMD.h">ConvertToMD.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/MDAlgorithms/src/ConvertToMD.cpp">ConvertToMD.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="ConvertToHistogram-v1.html" title="Previous Chapter: ConvertToHistogram v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; ConvertToHistogram v1</span>
    </a>
  </li>
  <li>
    <a href="ConvertToMDMinMaxGlobal-v1.html" title="Next Chapter: ConvertToMDMinMaxGlobal v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">ConvertToMDMi... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>