<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>ReflectometryILLAutoProcess v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ReflectometryILLConvertToQ v1" href="ReflectometryILLConvertToQ-v1.html" />
    <link rel="prev" title="ReflectometryBeamStatistics v1" href="ReflectometryBeamStatistics-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">ReflectometryILLAutoProcess v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="reflectometryillautoprocess-v1">
<span id="algm-reflectometryillautoprocess"></span><span id="algm-reflectometryillautoprocess-v1"></span><h1>ReflectometryILLAutoProcess v1<a class="headerlink" href="#reflectometryillautoprocess-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id3">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ReflectometryILLAutoProcess-v1_dlg.png"><img alt="../_images/ReflectometryILLAutoProcess-v1_dlg.png" class="screenshot" src="../_images/ReflectometryILLAutoProcess-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>ReflectometryILLAutoProcess</strong> dialog.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id4">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id5">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id6">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id7">Description</a></p></li>
<li><p><a class="reference internal" href="#input" id="id8">Input</a></p></li>
<li><p><a class="reference internal" href="#output" id="id9">Output</a></p></li>
<li><p><a class="reference internal" href="#bragg-angle" id="id10">Bragg Angle</a></p></li>
<li><p><a class="reference internal" href="#summation-type" id="id11">Summation Type</a></p></li>
<li><p><a class="reference internal" href="#options" id="id12">Options</a></p></li>
<li><p><a class="reference internal" href="#direct-beam-caching" id="id13">Direct Beam Caching</a></p></li>
<li><p><a class="reference internal" href="#gravity-correction" id="id14">Gravity correction</a></p></li>
<li><p><a class="reference internal" href="#workflow" id="id15">Workflow</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id16">Usage</a></p></li>
<li><p><a class="reference internal" href="#references" id="id17">References</a></p></li>
<li><p><a class="reference internal" href="#source" id="id18">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Performs reduction of ILL reflectometry data, instruments D17 and FIGARO.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="ReflectometryILLConvertToQ-v1.html#algm-reflectometryillconverttoq"><span class="std std-ref">ReflectometryILLConvertToQ</span></a>, <a class="reference internal" href="ReflectometryILLPolarizationCor-v1.html#algm-reflectometryillpolarizationcor"><span class="std std-ref">ReflectometryILLPolarizationCor</span></a>, <a class="reference internal" href="ReflectometryILLPreprocess-v1.html#algm-reflectometryillpreprocess"><span class="std std-ref">ReflectometryILLPreprocess</span></a>, <a class="reference internal" href="ReflectometryILLSumForeground-v1.html#algm-reflectometryillsumforeground"><span class="std std-ref">ReflectometryILLSumForeground</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PolarizationOption</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>NonPolarized</p></td>
<td><p>Indicate whether measurements are polarized. Allowed values: [‘NonPolarized’, ‘Polarized’]</p></td>
</tr>
<tr class="row-odd"><td><p>Run</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td></td>
<td><p>A list of reflected run numbers/files. Allowed values: [‘nxs’]</p></td>
</tr>
<tr class="row-even"><td><p>Run00</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td></td>
<td><p>A list of reflected run numbers/files for 00 (or 0). Allowed values: [‘nxs’]</p></td>
</tr>
<tr class="row-odd"><td><p>Run01</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td></td>
<td><p>A list of reflected run numbers/files for 01. Allowed values: [‘nxs’]</p></td>
</tr>
<tr class="row-even"><td><p>Run10</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td></td>
<td><p>A list of reflected run numbers/files for 10. Allowed values: [‘nxs’]</p></td>
</tr>
<tr class="row-odd"><td><p>Run11</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td></td>
<td><p>A list of reflected run numbers/files for 11 (or 1). Allowed values: [‘nxs’]</p></td>
</tr>
<tr class="row-even"><td><p>PolarizationEfficiencyFile</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>A file containing the polarization efficiency factors.</p></td>
</tr>
<tr class="row-odd"><td><p>DirectRun</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A list of direct run numbers/files. Allowed values: [‘nxs’]</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p>WorkspaceGroup</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The output workspace group.</p></td>
</tr>
<tr class="row-odd"><td><p>DirectFlatBackground</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Background Average</p></td>
<td><p>Flat background calculation method for background subtraction. Allowed values: [‘Background Average’, ‘Background Constant Fit’, ‘Background Linear Fit’, ‘Background OFF’]</p></td>
</tr>
<tr class="row-even"><td><p>ReflFlatBackground</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Background Average</p></td>
<td><p>Flat background calculation method for background subtraction. Allowed values: [‘Background Average’, ‘Background Constant Fit’, ‘Background Linear Fit’, ‘Background OFF’]</p></td>
</tr>
<tr class="row-odd"><td><p>SubalgorithmLogging</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Logging OFF</p></td>
<td><p>Enable or disable child algorithm logging. Allowed values: [‘Logging OFF’, ‘Logging ON’]</p></td>
</tr>
<tr class="row-even"><td><p>Cleanup</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Cleanup ON</p></td>
<td><p>Enable or disable intermediate workspace cleanup. Allowed values: [‘Cleanup ON’, ‘Cleanup OFF’]</p></td>
</tr>
<tr class="row-odd"><td><p>WaterWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>A (water) calibration workspace (unit TOF).</p></td>
</tr>
<tr class="row-even"><td><p>SlitNormalisation</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Slit Normalisation AUTO</p></td>
<td><p>Enable or disable slit normalisation. Allowed values: [‘Slit Normalisation AUTO’, ‘Slit Normalisation OFF’, ‘Slit Normalisation ON’]</p></td>
</tr>
<tr class="row-odd"><td><p>FluxNormalisation</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Normalise To Time</p></td>
<td><p>Neutron flux normalisation method. Allowed values: [‘Normalise To Time’, ‘Normalise To Monitor’, ‘Normalisation OFF’]</p></td>
</tr>
<tr class="row-even"><td><p>GlobalScaleFactor</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Scale factor.</p></td>
</tr>
<tr class="row-odd"><td><p>ManualScaleFactors</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td></td>
<td><p>An optional list of manual scale factors for stitching (number of angle configurations minus 1)</p></td>
</tr>
<tr class="row-even"><td><p>CacheDirectBeam</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Cache the processed direct beam in ADS for ready use with further reflected beams;saves important execution time, however assumes that the direct beam processing configuration must be invariant for different reflected beams.</p></td>
</tr>
<tr class="row-odd"><td><p>AngleOption</p></td>
<td><p>Input</p></td>
<td><p>str list</p></td>
<td><p>DetectorAngle</p></td>
<td><p>Angle option used for detector positioning</p></td>
</tr>
<tr class="row-even"><td><p>Theta</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>-1</p></td>
<td><p>A user-defined angle theta in degree</p></td>
</tr>
<tr class="row-odd"><td><p>SummationType</p></td>
<td><p>Input</p></td>
<td><p>str list</p></td>
<td><p>Incoherent</p></td>
<td><p>Type of summation to perform</p></td>
</tr>
<tr class="row-even"><td><p>WavelengthLowerBound</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>2</p></td>
<td><p>The lower wavelength bound (Angstrom)</p></td>
</tr>
<tr class="row-odd"><td><p>WavelengthUpperBound</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>30</p></td>
<td><p>The upper wavelength bound (Angstrom)</p></td>
</tr>
<tr class="row-even"><td><p>DeltaQFractionBinning</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>0.5</p></td>
<td><p>If set, group the output by steps of this fraction multiplied by Q resolution</p></td>
</tr>
<tr class="row-odd"><td><p>DirectLowAngleFrgHalfWidth</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>2</p></td>
<td><p>Number of foreground pixels at lower angles from the centre pixel.</p></td>
</tr>
<tr class="row-even"><td><p>DirectLowAngleBkgOffset</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>5</p></td>
<td><p>Distance of flat background region towards smaller detector angles from the foreground centre, in pixels</p></td>
</tr>
<tr class="row-odd"><td><p>DirectLowAngleBkgWidth</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>5</p></td>
<td><p>Width of flat background region towards smaller detector angles from the foreground centre, in pixels</p></td>
</tr>
<tr class="row-even"><td><p>DirectHighAngleFrgHalfWidth</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>2</p></td>
<td><p>Number of foreground pixels at higher angles from the centre pixel.</p></td>
</tr>
<tr class="row-odd"><td><p>DirectHighAngleBkgOffset</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>5</p></td>
<td><p>Distance of flat background region towards larger detector angles from the foreground centre, in pixels</p></td>
</tr>
<tr class="row-even"><td><p>DirectHighAngleBkgWidth</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>5</p></td>
<td><p>Width of flat background region towards larger detector angles from the foreground centre, in pixels</p></td>
</tr>
<tr class="row-odd"><td><p>DirectFitStartWorkspaceIndex</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>0</p></td>
<td><p>Start histogram index used for peak fitting</p></td>
</tr>
<tr class="row-even"><td><p>DirectFitEndWorkspaceIndex</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>255</p></td>
<td><p>Last histogram index used for peak fitting</p></td>
</tr>
<tr class="row-odd"><td><p>DirectFitWavelengthLowerBound</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>-1</p></td>
<td><p>Minimum x value (unit wavelength) used for peak fitting.</p></td>
</tr>
<tr class="row-even"><td><p>DirectFitWavelengthUpperBound</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>-1</p></td>
<td><p>Maximum x value (unit wavelength) used for peak fitting.</p></td>
</tr>
<tr class="row-odd"><td><p>ReflLowAngleFrgHalfWidth</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>2</p></td>
<td><p>Number of foreground pixels at lower angles from the centre pixel.</p></td>
</tr>
<tr class="row-even"><td><p>ReflLowAngleBkgOffset</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>5</p></td>
<td><p>Distance of flat background region towards smaller detector angles from the foreground centre, in pixels.</p></td>
</tr>
<tr class="row-odd"><td><p>ReflLowAngleBkgWidth</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>5</p></td>
<td><p>Width of flat background region towards smaller detector angles from the foreground centre, in pixels</p></td>
</tr>
<tr class="row-even"><td><p>ReflHighAngleFrgHalfWidth</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>2</p></td>
<td><p>Number of foreground pixels at higher angles from the centre pixel.</p></td>
</tr>
<tr class="row-odd"><td><p>ReflHighAngleBkgOffset</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>5</p></td>
<td><p>Distance of flat background region towards larger detector angles from the foreground centre, in pixels</p></td>
</tr>
<tr class="row-even"><td><p>ReflHighAngleBkgWidth</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>5</p></td>
<td><p>Width of flat background region towards larger detector angles from the foreground centre, in pixels.</p></td>
</tr>
<tr class="row-odd"><td><p>ReflFitStartWorkspaceIndex</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>0</p></td>
<td><p>Start histogram index used for peak fitting</p></td>
</tr>
<tr class="row-even"><td><p>ReflFitEndWorkspaceIndex</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td><p>255</p></td>
<td><p>Last histogram index used for peak fitting</p></td>
</tr>
<tr class="row-odd"><td><p>ReflFitWavelengthLowerBound</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>-1</p></td>
<td><p>Minimum x value (unit wavelength) used for peak fitting</p></td>
</tr>
<tr class="row-even"><td><p>ReflFitWavelengthUpperBound</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>-1</p></td>
<td><p>Maximum x value (unit wavelength) used for peak fitting</p></td>
</tr>
<tr class="row-odd"><td><p>SaveReductionParams</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Whether to save reduction parameters in an ASCII file.</p></td>
</tr>
<tr class="row-even"><td><p>CorrectGravity</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Whether to correct for gravity effects (FIGARO only).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>This algorithm executes the full data reduction for ILL reflectometers D17 and FIGARO in TOF mode (specular reflection) following <a class="footnote-reference brackets" href="#gutfreund" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
</section>
<section id="input">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Input</a><a class="headerlink" href="#input" title="Permalink to this heading">¶</a></h2>
<p>The mandatory inputs are comma separated list of nexus files for direct and reflected beam measurements.
<strong>,</strong> stands as the separator of different angle configurations.
<strong>+</strong> (sum) or <strong>-</strong> (range sum) operations can be used to sum different files at the same instrument configuration.
When summing the metadata (e.g. acquisition time) will also be summed, so that the subsequent normalisation is handled correctly.
There must be the same number of angle configurations both for direct and reflected beam inputs.</p>
</section>
<section id="output">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Output</a><a class="headerlink" href="#output" title="Permalink to this heading">¶</a></h2>
<p>The output is a workspace group that contains the calculated reflectivity curves as a function of the momentum transfer.
The output is point data and has the calculated Q resolution attributed to it.
There is a separate output for each angle configuration.
An automatically stitched result is also produced.
Stitch in this case just takes the union of all the initial points without merging or removal, only scaling can be applied.
The outputs can be readily saved by <a class="reference internal" href="SaveReflectometryAscii-v1.html#algm-savereflectometryascii"><span class="std std-ref">SaveReflectometryAscii</span></a> algorithm for further analysis.</p>
</section>
<section id="bragg-angle">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Bragg Angle</a><a class="headerlink" href="#bragg-angle" title="Permalink to this heading">¶</a></h2>
<p>If user specified <span class="math notranslate nohighlight">\(\theta\)</span> angles are provided, they will be used.
Otherwise <cite>SampleAngle</cite> or <cite>DetectorAngle</cite> (default) option is executed.</p>
</section>
<section id="summation-type">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Summation Type</a><a class="headerlink" href="#summation-type" title="Permalink to this heading">¶</a></h2>
<p>The default summation type is incoherent (sum along constant <span class="math notranslate nohighlight">\(\lambda\)</span>), where the reflectivity curve is calculated by dividing the summed foreground of the reflected beam by the summed foreground of the direct beam.
For coherent summing, first the reflected beam data is divided by the direct beam data in 2D, then the ratio is summed along the lines of the constant <span class="math notranslate nohighlight">\(Q_{z}\)</span>.</p>
</section>
<section id="options">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Options</a><a class="headerlink" href="#options" title="Permalink to this heading">¶</a></h2>
<p>Many options can be specified as a single value, which will be applied to all the angle configurations, or as a list of values.
In the case of the latter, the list must be of the same size, as many different angle configurations there are.</p>
</section>
<section id="direct-beam-caching">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Direct Beam Caching</a><a class="headerlink" href="#direct-beam-caching" title="Permalink to this heading">¶</a></h2>
<p>The processed direct beam runs can be cached in Analysis Data Service in order to save significant time when multiple samples correspond to the same direct beam with the same processing configurations.
The name for the cached direct beam runs are derived from the run numbers; it is the run number if there is only one numor, or the first run number if there are several numors summed.
Both the processed direct beam, and its summed foreground are cached.
Care must be taken when enabling the caching, since if the same direct beam must be used with different options (e.g. different wavelength ranges) for different reflected beams, the caching will result in an error in subsequent reduction steps due to incompatibility of the workspaces.
In such case the caching must be disabled, or one has to clean the cache manually by deleting the corresponding workspaces.</p>
</section>
<section id="gravity-correction">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Gravity correction</a><a class="headerlink" href="#gravity-correction" title="Permalink to this heading">¶</a></h2>
<p>Gravity correction is relevant for data reduction at FIGARO. Its execution is steered by a switch: <cite>CorrectGravity</cite>. The correction follows the algorithm described in Ref. <a class="footnote-reference brackets" href="#gutfreund" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, and the application to data is split in two separate steps. The first step corrects the wavelength axis of both direct and reflected beams, and takes place in <a class="reference internal" href="ReflectometryILLPreprocess-v1.html#algm-reflectometryillpreprocess"><span class="std std-ref">ReflectometryILLPreprocess</span></a>, where also the corrected by gravity reflection angle is calculated. The second and final step corrects the reflection angle, and is applied to data in <a class="reference internal" href="ReflectometryILLConvertToQ-v1.html#algm-reflectometryillconverttoq"><span class="std std-ref">ReflectometryILLConvertToQ</span></a>.</p>
</section>
<section id="workflow">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Workflow</a><a class="headerlink" href="#workflow" title="Permalink to this heading">¶</a></h2>
<img alt="../_images/ReflectometryILLAutoProcess-v1_wkflw.svg" src="../_images/ReflectometryILLAutoProcess-v1_wkflw.svg" /></section>
<section id="usage">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p><strong>Example - Single Angle</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">ReflectometryILLAutoProcess</span><span class="p">(</span>
 <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;317370&#39;</span><span class="p">,</span>
 <span class="n">DirectRun</span><span class="o">=</span><span class="s1">&#39;317369&#39;</span><span class="p">,</span>
 <span class="n">WavelengthLowerBound</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span>
 <span class="n">WavelengthUpperBound</span><span class="o">=</span><span class="mf">24.5</span><span class="p">,</span>
 <span class="n">DeltaQFractionBinning</span><span class="o">=</span><span class="mf">0.1</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The R(Q) workspace has </span><span class="si">{0}</span><span class="s1"> points&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">blocksize</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The R(Q) workspace has 672 points
</pre></div>
</div>
<p><strong>Example - Multiple Angles</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">ReflectometryILLAutoProcess</span><span class="p">(</span>
 <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;541853,541854&#39;</span><span class="p">,</span>
 <span class="n">DirectRun</span><span class="o">=</span><span class="s1">&#39;541838,541839&#39;</span><span class="p">,</span>
 <span class="n">WavelengthLowerBound</span><span class="o">=</span><span class="p">[</span><span class="mf">3.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">],</span>
 <span class="n">WavelengthUpperBound</span><span class="o">=</span><span class="p">[</span><span class="mf">25.</span><span class="p">,</span><span class="mf">22.</span><span class="p">],</span>
 <span class="n">GlobalScaleFactor</span><span class="o">=</span><span class="mf">0.13</span><span class="p">,</span>
 <span class="n">DeltaQFractionBinning</span><span class="o">=</span><span class="mf">0.5</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The R(Q) workspace at first angle has </span><span class="si">{0}</span><span class="s1"> points&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">blocksize</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The R(Q) workspace at second angle has </span><span class="si">{0}</span><span class="s1"> points&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">blocksize</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The R(Q) workspace at second angle has </span><span class="si">{0}</span><span class="s1"> points&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">blocksize</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The R(Q) workspace at first angle has 186 points
The R(Q) workspace at second angle has 94 points
The R(Q) workspace at second angle has 280 points
</pre></div>
</div>
<p><strong>Example - Full treatment with 3 angles and multiple numors summed</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mantid.simpleapi</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">config</span><span class="p">[</span><span class="s1">&#39;default.facility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ILL&#39;</span>
<span class="n">config</span><span class="p">[</span><span class="s1">&#39;default.instrument&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;D17&#39;</span>
<span class="n">config</span><span class="o">.</span><span class="n">appendDataSearchSubDir</span><span class="p">(</span><span class="s1">&#39;ILL/D17/&#39;</span><span class="p">)</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Thick_HR_5&#39;</span>
<span class="n">directBeams</span> <span class="o">=</span> <span class="s1">&#39;397812,397806,397808&#39;</span>
<span class="n">reflectedBeams</span> <span class="o">=</span> <span class="s1">&#39;397826+397827,397828,397829+397830+397831+397832&#39;</span>
<span class="n">foregroundWidth</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
<span class="n">wavelengthLower</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]</span>
<span class="n">wavelengthUpper</span> <span class="o">=</span> <span class="p">[</span><span class="mf">27.</span><span class="p">,</span> <span class="mf">25.</span><span class="p">,</span> <span class="mf">25.</span><span class="p">]</span>
<span class="n">angleOffset</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">angleWidth</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">ReflectometryILLAutoProcess</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="n">reflectedBeams</span><span class="p">,</span>
    <span class="n">DirectRun</span><span class="o">=</span><span class="n">directBeams</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
    <span class="n">SummationType</span><span class="o">=</span><span class="s1">&#39;Incoherent&#39;</span><span class="p">,</span>
    <span class="n">AngleOption</span><span class="o">=</span><span class="s1">&#39;SampleAngle&#39;</span><span class="p">,</span>
    <span class="n">DirectLowAngleFrgHalfWidth</span><span class="o">=</span><span class="n">foregroundWidth</span><span class="p">,</span>
    <span class="n">DirectHighAngleFrgHalfWidth</span><span class="o">=</span><span class="n">foregroundWidth</span><span class="p">,</span>
    <span class="n">DirectLowAngleBkgOffset</span><span class="o">=</span><span class="n">angleOffset</span><span class="p">,</span>
    <span class="n">DirectLowAngleBkgWidth</span><span class="o">=</span><span class="n">angleWidth</span><span class="p">,</span>
    <span class="n">DirectHighAngleBkgOffset</span><span class="o">=</span><span class="n">angleOffset</span><span class="p">,</span>
    <span class="n">DirectHighAngleBkgWidth</span><span class="o">=</span><span class="n">angleWidth</span><span class="p">,</span>
    <span class="n">ReflLowAngleFrgHalfWidth</span><span class="o">=</span><span class="n">foregroundWidth</span><span class="p">,</span>
    <span class="n">ReflHighAngleFrgHalfWidth</span><span class="o">=</span><span class="n">foregroundWidth</span><span class="p">,</span>
    <span class="n">ReflLowAngleBkgOffset</span><span class="o">=</span><span class="n">angleOffset</span><span class="p">,</span>
    <span class="n">ReflLowAngleBkgWidth</span><span class="o">=</span><span class="n">angleWidth</span><span class="p">,</span>
    <span class="n">ReflHighAngleBkgOffset</span><span class="o">=</span><span class="n">angleOffset</span><span class="p">,</span>
    <span class="n">ReflHighAngleBkgWidth</span><span class="o">=</span><span class="n">angleWidth</span><span class="p">,</span>
    <span class="n">WavelengthLowerBound</span><span class="o">=</span><span class="n">wavelengthLower</span><span class="p">,</span>
    <span class="n">WavelengthUpperBound</span><span class="o">=</span><span class="n">wavelengthUpper</span><span class="p">,</span>
    <span class="n">DeltaQFractionBinning</span><span class="o">=</span><span class="mf">0.5</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mantid</span> <span class="kn">import</span> <span class="n">plots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;classic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">18</span>
<span class="n">wsMantid</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;Thick_HR_5_stitched&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span><span class="s1">&#39;mantid&#39;</span><span class="p">})</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wsMantid</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;RoundRobin&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">wsMantid</span><span class="p">,</span><span class="s1">&#39;rs&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.000001</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Q [$\AA^{-1}$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id17" role="doc-backlink">References</a><a class="headerlink" href="#references" title="Permalink to this heading">¶</a></h2>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="gutfreund" role="note">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id2">2</a>)</span>
<p>P. Gutfreund, T. Saerbeck, M. A. Gonzalez, E. Pellegrini, M. Laver, C. Dewhurst, R. Cubitt,
<cite>Towards generalized data reduction on a chopper-based time-of-flight neutron reflectometer.</cite>
<a class="reference external" href="https://doi.org/10.1107/S160057671800448X">J. Appl. Cryst. (2018). 51, 606-615,</a></p>
</aside>
</aside>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/ILL/Reflectometry.html">ILL\Reflectometry</a> | <a class="reference external" href="categories/ILL/Auto.html">ILL\Auto</a> | <a class="reference external" href="categories/Workflow/Reflectometry.html">Workflow\Reflectometry</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/ReflectometryILLAutoProcess.py">ReflectometryILLAutoProcess.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="ReflectometryBeamStatistics-v1.html" title="Previous Chapter: ReflectometryBeamStatistics v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Reflectometry...</span>
    </a>
  </li>
  <li>
    <a href="ReflectometryILLConvertToQ-v1.html" title="Next Chapter: ReflectometryILLConvertToQ v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Reflectometry... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>