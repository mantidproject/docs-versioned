<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>MuonMaxent v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MuonPairingAsymmetry v1" href="MuonPairingAsymmetry-v1.html" />
    <link rel="prev" title="MuonGroupingCounts v1" href="MuonGroupingCounts-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">MuonMaxent v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="muonmaxent-v1">
<span id="algm-muonmaxent"></span><span id="algm-muonmaxent-v1"></span><h1>MuonMaxent v1<a class="headerlink" href="#muonmaxent-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/MuonMaxent-v1_dlg.png"><img alt="../_images/MuonMaxent-v1_dlg.png" class="screenshot" src="../_images/MuonMaxent-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>MuonMaxent</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id6">Usage</a></p>
<ul>
<li><p><a class="reference internal" href="#output" id="id7">Output</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#source" id="id8">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="PhaseQuad-v1.html#algm-phasequad"><span class="std std-ref">PhaseQuad</span></a>, <a class="reference internal" href="FFT-v1.html#algm-fft"><span class="std std-ref">FFT</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Raw muon workspace to process</p></td>
</tr>
<tr class="row-odd"><td><p>InputPhaseTable</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Phase table (initial guess)</p></td>
</tr>
<tr class="row-even"><td><p>InputDeadTimeTable</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Dead time table (initial)</p></td>
</tr>
<tr class="row-odd"><td><p>GroupTable</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Group Table</p></td>
</tr>
<tr class="row-even"><td><p>GroupWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td></td>
<td><p>Group Workspace</p></td>
</tr>
<tr class="row-odd"><td><p>FirstGoodTime</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.1</p></td>
<td><p>First good data time</p></td>
</tr>
<tr class="row-even"><td><p>LastGoodTime</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>33</p></td>
<td><p>Last good data time</p></td>
</tr>
<tr class="row-odd"><td><p>Npts</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Number of frequency points to fit (should be power of 2). Allowed values: [‘256’, ‘512’, ‘1024’, ‘2048’, ‘4096’, ‘8192’, ‘16384’, ‘32768’, ‘65536’, ‘131072’, ‘262144’, ‘524288’, ‘1048576’]</p></td>
</tr>
<tr class="row-even"><td><p>MaxField</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1000</p></td>
<td><p>Maximum field for spectrum</p></td>
</tr>
<tr class="row-odd"><td><p>FixPhases</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Fix phases to initial values</p></td>
</tr>
<tr class="row-even"><td><p>FitDeadTime</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Fit deadtimes</p></td>
</tr>
<tr class="row-odd"><td><p>DoublePulse</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Double pulse data</p></td>
</tr>
<tr class="row-even"><td><p>OuterIterations</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>10</p></td>
<td><p>Number of loops to optimise phase, amplitudes, backgrounds and dead times</p></td>
</tr>
<tr class="row-odd"><td><p>InnerIterations</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>10</p></td>
<td><p>Number of loops to optimise the spectrum</p></td>
</tr>
<tr class="row-even"><td><p>DefaultLevel</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.1</p></td>
<td><p>Default Level</p></td>
</tr>
<tr class="row-odd"><td><p>Factor</p></td>
<td><p>InOut</p></td>
<td><p>number</p></td>
<td><p>1.04</p></td>
<td><p>Used to control the value chi-squared converge to</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Output Spectrum (combined) versus field</p></td>
</tr>
<tr class="row-odd"><td><p>OutputPhaseTable</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Output phase table (optional)</p></td>
</tr>
<tr class="row-even"><td><p>OutputDeadTimeTable</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Output dead time table (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>ReconstructedSpectra</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td></td>
<td><p>Reconstructed time spectra (optional)</p></td>
</tr>
<tr class="row-even"><td><p>PhaseConvergenceTable</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td></td>
<td><p>Convergence of phases (optional)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>This algorithm calculates a single frequency spectrum from the time domain spectra recorded by multiple groups/detectors.</p>
<p>If a group contains zero counts (i.e. the detectors are dead) then they are excluded from the frequency calculation. In the outputs these groups record the phase and asymmetry as zero and <span class="math notranslate nohighlight">\(999\)</span> respectively.</p>
<p>The time domain data <span class="math notranslate nohighlight">\(D_k(t)\)</span>, where <span class="math notranslate nohighlight">\(t\)</span> is time and <span class="math notranslate nohighlight">\(k\)</span> is the spectrum number, has associated errors <span class="math notranslate nohighlight">\(E_k(t)\)</span>. If the number of points chosen is greater than the number of time domain data points then extra points are
added with infinite errors. The time domain data prior to <code class="code docutils literal notranslate"><span class="pre">FirstGoodTime</span></code> also have their errors set to infinity. The algorithm will produce the frequency spectra <span class="math notranslate nohighlight">\(f(\omega)\)</span> and this is assumed to be real and positive.
The upper limit of the frequency spectra is determined by <code class="code docutils literal notranslate"><span class="pre">MaxField</span></code>. The maximum frequency, <span class="math notranslate nohighlight">\(\omega_\mathrm{max}\)</span> can be less than the Nyquist limit <span class="math notranslate nohighlight">\(\frac{\pi}{\delta T}\)</span> if the instrumental frequency response function for
<span class="math notranslate nohighlight">\(\omega&gt;\omega_\mathrm{max}\)</span> is approximatley zero. The initial estimate of the frequency spectrum is flat.</p>
<p>The algorithm calculates an estimate of each time domain spectra, <span class="math notranslate nohighlight">\(g_k(t)\)</span> by the equation</p>
<div class="math notranslate nohighlight">
\[g_k(t)=(1+A_k \Re(\mathrm{IFFT}(f(\omega) R(\omega))\exp(-j\phi_k) ) ),\]</div>
<p>where <span class="math notranslate nohighlight">\(\Re(z)\)</span> is the real part of <span class="math notranslate nohighlight">\(z\)</span>, <span class="math notranslate nohighlight">\(\mathrm{IFFT}\)</span> is the inverse fast Fourier transform (as defined by <a class="reference external" href="https://docs.scipy.org/doc/numpy-1.12.0/reference/routines.fft.html#module-numpy.fft">numpy</a>), <span class="math notranslate nohighlight">\(\phi_k\)</span> is the phase and <span class="math notranslate nohighlight">\(A_k\)</span> is the asymmetry of the of the  <span class="math notranslate nohighlight">\(k^\mathrm{th}\)</span> spectrum.
The asymmetry is normalised such that <span class="math notranslate nohighlight">\(\sum_k A_k = 1\)</span>.
The instrumental frequency response function, <span class="math notranslate nohighlight">\(R(\omega)\)</span>, is  is in general complex (due to a
non-symmetric pulse shape) and is the same for all spectra. The values of the phases and asymmetries are fitted in the outer loop of the algorithm.</p>
<p>The <span class="math notranslate nohighlight">\(\chi^2\)</span> value is calculated via the equation</p>
<div class="math notranslate nohighlight">
\[\chi^2 = F\frac{\sum_{k,t} (D_k(t)-g_k(t))^2 }{E_k(t)^2},\]</div>
<p>where <span class="math notranslate nohighlight">\(F\)</span> is the <code class="code docutils literal notranslate"><span class="pre">Factor</span></code> and is of order 1.0 (but can be adjusted by the user at the start of the algorithm for a better fit).
The entropy is given by</p>
<div class="math notranslate nohighlight">
\[S = - \sum_\omega f(\omega) \log\left(\frac{f(\omega)}{A}\right),\]</div>
<p>where <span class="math notranslate nohighlight">\(A\)</span> is the <code class="code docutils literal notranslate"><span class="pre">DefaultLevel</span></code>; it is a parameter of the entropy function. It has a number of names in the literature, one of which
is default-value since the maximum entropy solution with no data is <span class="math notranslate nohighlight">\(f(\omega)=A\)</span> for all <span class="math notranslate nohighlight">\(\omega\)</span>. The algorithm maximises
<span class="math notranslate nohighlight">\(S-\chi^2\)</span> and it is seen from the definition of <code class="code docutils literal notranslate"><span class="pre">Factor</span></code> above that this algorithm property acts a Lagrange multiplier, i.e. controlling the value <span class="math notranslate nohighlight">\(\chi^2\)</span> converges to.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load data</span>
<span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s1">&#39;MUSR00022725.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;MUSR00022725&#39;</span><span class="p">)</span>
<span class="c1"># estimate phases</span>
<span class="n">CalMuonDetectorPhases</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;MUSR00022725&#39;</span><span class="p">,</span> <span class="n">FirstGoodData</span><span class="o">=</span><span class="mf">0.10000000000000001</span><span class="p">,</span> <span class="n">LastGoodData</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">DetectorTable</span><span class="o">=</span><span class="s1">&#39;phases&#39;</span><span class="p">,</span> <span class="n">DataFitted</span><span class="o">=</span><span class="s1">&#39;fitted&#39;</span><span class="p">,</span> <span class="n">ForwardSpectra</span><span class="o">=</span><span class="s1">&#39;9-16,57-64&#39;</span><span class="p">,</span> <span class="n">BackwardSpectra</span><span class="o">=</span><span class="s1">&#39;25-32,41-48&#39;</span><span class="p">)</span>
<span class="n">MuonMaxent</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;MUSR00022725&#39;</span><span class="p">,</span> <span class="n">InputPhaseTable</span><span class="o">=</span><span class="s1">&#39;phases&#39;</span><span class="p">,</span> <span class="n">Npts</span><span class="o">=</span><span class="s1">&#39;16384&#39;</span><span class="p">,</span> <span class="n">OuterIterations</span><span class="o">=</span><span class="s1">&#39;9&#39;</span><span class="p">,</span> <span class="n">InnerIterations</span><span class="o">=</span><span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="n">DefaultLevel</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">Factor</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="n">OutputPhaseTable</span><span class="o">=</span><span class="s1">&#39;phasesOut&#39;</span><span class="p">,</span> <span class="n">ReconstructedSpectra</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="c1"># get data</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">AnalysisDataService</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="s2">&quot;freq&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;frequency values </span><span class="si">{:.3f}</span><span class="s1"> </span><span class="si">{:.3f}</span><span class="s1"> </span><span class="si">{:.3f}</span><span class="s1"> </span><span class="si">{:.3f}</span><span class="s1"> </span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">5</span><span class="p">],</span> <span class="n">freq</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">690</span><span class="p">],</span><span class="n">freq</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">700</span><span class="p">],</span> <span class="n">freq</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">710</span><span class="p">],</span><span class="n">freq</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">900</span><span class="p">]))</span>
</pre></div>
</div>
<section id="output">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Output</a><a class="headerlink" href="#output" title="Permalink to this heading">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>frequency values 0.110 0.789 0.871 0.821 0.105
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Muon.html">Muon</a> | <a class="reference external" href="categories/Arithmetic/FFT.html">Arithmetic\FFT</a></p>
</section>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/aa570da6f199141cd8ad987bf9b9b9281a1b5e33/Framework/PythonInterface/plugins/algorithms/MuonMaxent.py">MuonMaxent.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="MuonGroupingCounts-v1.html" title="Previous Chapter: MuonGroupingCounts v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; MuonGroupingCounts v1</span>
    </a>
  </li>
  <li>
    <a href="MuonPairingAsymmetry-v1.html" title="Next Chapter: MuonPairingAsymmetry v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">MuonPairingAs... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>