<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>LoadSpiceXML2DDet v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="LoadSwans v1" href="LoadSwans-v1.html" />
    <link rel="prev" title="LoadSpiceAscii v1" href="LoadSpiceAscii-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">LoadSpiceXML2DDet v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="loadspicexml2ddet-v1">
<span id="algm-loadspicexml2ddet"></span><span id="algm-loadspicexml2ddet-v1"></span><h1>LoadSpiceXML2DDet v1<a class="headerlink" href="#loadspicexml2ddet-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/LoadSpiceXML2DDet-v1_dlg.png"><img alt="../_images/LoadSpiceXML2DDet-v1_dlg.png" class="screenshot" src="../_images/LoadSpiceXML2DDet-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>LoadSpiceXML2DDet</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p>
<ul>
<li><p><a class="reference internal" href="#format-of-spice-xml-data-file" id="id6">Format of SPICE XML data file</a></p>
<ul>
<li><p><a class="reference internal" href="#counts-of-2d-detector" id="id7">Counts of 2D detector</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#format-of-spice-binary-data-file" id="id8">Format of SPICE binary data file</a></p></li>
<li><p><a class="reference internal" href="#hb3a-instrument-facts" id="id9">HB3A instrument facts</a></p></li>
<li><p><a class="reference internal" href="#output-worskpaces" id="id10">Output Worskpaces</a></p>
<ul>
<li><p><a class="reference internal" href="#matrixworskpace-with-instrument-loaded" id="id11">MatrixWorskpace with instrument loaded</a></p></li>
<li><p><a class="reference internal" href="#matrixworkspace-without-instrument-loaded" id="id12">MatrixWorkspace without instrument loaded</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#workflow" id="id13">Workflow</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#usage" id="id14">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id15">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Load 2-dimensional detector data file in XML format from SPICE.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="LoadSpice2D-v1.html#algm-loadspice2d"><span class="std std-ref">LoadSpice2D</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Filename</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>XML file name for one scan including 2D detectors counts from SPICE. Allowed extensions: [‘.xml’, ‘.bin’]</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Name of output matrix workspace. Output workspace will be an X by Y Workspace2D if instrument is not loaded.</p></td>
</tr>
<tr class="row-even"><td><p>DetectorLogName</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Detector</p></td>
<td><p>Log name (i.e., XML node name) for detector counts in XML file.By default, the name is ‘Detector’</p></td>
</tr>
<tr class="row-odd"><td><p>DetectorGeometry</p></td>
<td><p>Input</p></td>
<td><p>unsigned int list</p></td>
<td></td>
<td><p>A size-2 unsigned integer array [X, Y] for detector geometry. Such that the detector contains X x Y pixels.If the input data is a binary file, input for DetectorGeometry will be overridden by detector geometry specified in the binary file</p></td>
</tr>
<tr class="row-even"><td><p>LoadInstrument</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Flag to load instrument to output workspace. HFIR’s HB3A will be loaded if InstrumentFileName is not specified.</p></td>
</tr>
<tr class="row-odd"><td><p>InstrumentFilename</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>The filename (including its full or relative path) of an instrument definition file. The file extension must either be .xml or .XML when specifying an instrument definition file. Note Filename or InstrumentName must be specified but not both. Allowed extensions: [‘.xml’]</p></td>
</tr>
<tr class="row-even"><td><p>SpiceTableWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Name of TableWorkspace loaded from SPICE scan file by LoadSpiceAscii.</p></td>
</tr>
<tr class="row-odd"><td><p>PtNumber</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Pt. value for the row to get sample log from.</p></td>
</tr>
<tr class="row-even"><td><p>UserSpecifiedWaveLength</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>User can specify the wave length of the instrument if it is drifted from the designed value.It happens often.</p></td>
</tr>
<tr class="row-odd"><td><p>ShiftedDetectorDistance</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Amount of shift of the distance between source and detector centre.It is used to apply instrument calibration.</p></td>
</tr>
<tr class="row-even"><td><p>DetectorCenterXShift</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>The amount of shift of detector center along X direction in the unit meter.</p></td>
</tr>
<tr class="row-odd"><td><p>DetectorCenterYShift</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>The amount of shift of detector center along Y direction in the unit meter.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>This algorithm is to import SPICE-generated XML file and binary file that
records data of one measurement by a (two-dimensional) Anger camera
and create a MatrixWorkspace to contain the detectors’ counts, monitor counts
and other sample log data.</p>
<section id="format-of-spice-xml-data-file">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Format of SPICE XML data file</a><a class="headerlink" href="#format-of-spice-xml-data-file" title="Permalink to this heading">¶</a></h3>
<p>The SPICE XML data file contains four sections under parent node <em>SPICErack</em>.
Each section contains child nodes for detailed information.</p>
<blockquote>
<div><ul class="simple">
<li><p>Header: instrument name, reactor power, experiment title and number, scan number and etc.</p></li>
<li><p>Motor_Position: positions of motor <em>m1</em>, <em>marc</em>, <em>2theta</em>, <em>chi</em>, <em>phi</em>, <em>omega</em> and etc.</p></li>
<li><p>Parameter_Positions: reading of sample environment devices, such as temperature at sample.</p></li>
<li><p>Counters: counting time, monitor counts, and <em>N x N</em> detectors’ counts,</p></li>
</ul>
</div></blockquote>
<section id="counts-of-2d-detector">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Counts of 2D detector</a><a class="headerlink" href="#counts-of-2d-detector" title="Permalink to this heading">¶</a></h4>
<p>Counts of an <span class="math notranslate nohighlight">\(n\times m\)</span> 2D detectors  are recorded in XML file as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>  <span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">...</span> <span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="n">X</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>  <span class="n">X</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="n">X</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">...</span> <span class="n">X</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
<p>And the (1,1) position is the bottom left corner of the Anger camera as seen from the sample position.</p>
</section>
</section>
<section id="format-of-spice-binary-data-file">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Format of SPICE binary data file</a><a class="headerlink" href="#format-of-spice-binary-data-file" title="Permalink to this heading">¶</a></h3>
<p>The SPICE binary data file contains 2 + N unsigned integers, where N is the number of detector pixels.</p>
<p>Here is the specification of the SPICE 2D detector binary file.</p>
<blockquote>
<div><p>int0: number of rows in 2D detector
int1: number of columns in 2D detector
int2: counts of pixel on the lower left corner facing to detector from sample
int3: counts of pixel just above the lower left corner
.
.
.
int(N+2): counts of pixel on the upper right corner</p>
</div></blockquote>
<p>Note: int0 x int1 must be equal to N.</p>
</section>
<section id="hb3a-instrument-facts">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">HB3A instrument facts</a><a class="headerlink" href="#hb3a-instrument-facts" title="Permalink to this heading">¶</a></h3>
<p>HB3A has 1 detector with <span class="math notranslate nohighlight">\(256 \times 256\)</span> pixels.</p>
<blockquote>
<div><ul class="simple">
<li><p>Pixel: width = <span class="math notranslate nohighlight">\(2 \times 9.921875e-05\)</span> m, height = <span class="math notranslate nohighlight">\(2 \times 9.921875e-05\)</span> m, depth = 0.0001 m.</p></li>
<li><p>Detector:</p></li>
</ul>
</div></blockquote>
</section>
<section id="output-worskpaces">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Output Worskpaces</a><a class="headerlink" href="#output-worskpaces" title="Permalink to this heading">¶</a></h3>
<p>The output from this algorithm is a MatrixWorskpaces.</p>
<section id="matrixworskpace-with-instrument-loaded">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">MatrixWorskpace with instrument loaded</a><a class="headerlink" href="#matrixworskpace-with-instrument-loaded" title="Permalink to this heading">¶</a></h4>
<p>For a 2D detector with <span class="math notranslate nohighlight">\(n\times m\)</span> pixels, the output MatrixWorkspace
will have <span class="math notranslate nohighlight">\(n \times m\)</span> spectrum.
Each spectrum has 1 data point corresponding to 1 detector’s count.</p>
<p>All experiment information, sample environment devices’ readings and monitor counts,
which are recorded in XML files,
are converted to the properties in output MatrixWorkspace’s sample log.</p>
</section>
<section id="matrixworkspace-without-instrument-loaded">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">MatrixWorkspace without instrument loaded</a><a class="headerlink" href="#matrixworkspace-without-instrument-loaded" title="Permalink to this heading">¶</a></h4>
<p>For a 2D detector with <span class="math notranslate nohighlight">\(n\times m\)</span> pixels, the output MatrixWorkspace
will have <span class="math notranslate nohighlight">\(n\)</span> spectrum, each of which has a vector of length equal to <span class="math notranslate nohighlight">\(m\)</span>.
It can be mapped to the raw data as <span class="math notranslate nohighlight">\(WS.readY(i)[j] = X(i+1,j+1)\)</span>.</p>
<p>All experiment information, sample environment devices’ readings and monitor counts,
which are recorded in XML files,
are converted to the properties in output MatrixWorkspace’s sample log.</p>
</section>
</section>
<section id="workflow">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Workflow</a><a class="headerlink" href="#workflow" title="Permalink to this heading">¶</a></h3>
<p>Algorithm <em>LoadSpiceXML2DDet</em> is one of a series of algorithms that are implemented to
reduced HFIR HB3A data collected from Anger camera.
It will be called next to <em>LoadSpiceAscii</em> to load the detector’s reading.</p>
</section>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p><strong>Example - load a HB3A SPICE .xml file without loading instrument:</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data by LoadSpiceXML2DDet()</span>
<span class="n">LoadSpiceXML2DDet</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s1">&#39;HB3A_exp355_scan0001_0522.xml&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;s0001_0522&#39;</span><span class="p">,</span> <span class="n">DetectorGeometry</span><span class="o">=</span><span class="s1">&#39;256,256&#39;</span><span class="p">,</span>
    <span class="n">LoadInstrument</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Access output workspace and print out some result</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s2">&quot;s0001_0522&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of spectrum = </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">136</span><span class="p">,</span> <span class="mi">140</span><span class="p">),</span> <span class="p">(</span><span class="mi">143</span><span class="p">,</span> <span class="mi">140</span><span class="p">)]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Y[</span><span class="si">{:&lt;3}</span><span class="s2">, </span><span class="si">{:&lt;3}</span><span class="s2">] = </span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="n">j</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Number of spectrum = 256.
Y[0  , 0  ] = 0.00000
Y[255, 255] = 0.00000
Y[136, 140] = 0.00000
Y[143, 140] = 1.00000
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/DataHandling/XML.html">DataHandling\XML</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/d01b3431ef42c8e811acf3df5a3cc0503656d488/Framework/DataHandling/inc/MantidDataHandling/LoadSpiceXML2DDet.h">LoadSpiceXML2DDet.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/d01b3431ef42c8e811acf3df5a3cc0503656d488/Framework/DataHandling/src/LoadSpiceXML2DDet.cpp">LoadSpiceXML2DDet.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="LoadSpiceAscii-v1.html" title="Previous Chapter: LoadSpiceAscii v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; LoadSpiceAscii v1</span>
    </a>
  </li>
  <li>
    <a href="LoadSwans-v1.html" title="Next Chapter: LoadSwans v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">LoadSwans v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>