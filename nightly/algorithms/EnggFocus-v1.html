<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>EnggFocus v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="EnggSaveGSASIIFitResultsToHDF5 v1" href="EnggSaveGSASIIFitResultsToHDF5-v1.html" />
    <link rel="prev" title="EnggFitTOFFromPeaks v1" href="EnggFitTOFFromPeaks-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">EnggFocus v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="enggfocus-v1">
<span id="algm-enggfocus"></span><span id="algm-enggfocus-v1"></span><h1>EnggFocus v1<a class="headerlink" href="#enggfocus-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/EnggFocus-v1_dlg.png"><img alt="../_images/EnggFocus-v1_dlg.png" class="screenshot" src="../_images/EnggFocus-v1_dlg.png" style="width: 349px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>EnggFocus</strong> dialog.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id6">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id7">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>This algorithm is deprecated as of May 2021, consider using DiffractionFocussing instead.Focuses a run by summing up all the spectra into a single one.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="AlignDetectors-v1.html#algm-aligndetectors"><span class="std std-ref">AlignDetectors</span></a>, <a class="reference internal" href="DiffractionFocussing-v2.html#algm-diffractionfocussing"><span class="std std-ref">DiffractionFocussing</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Workspace with the run to focus.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A workspace with focussed data</p></td>
</tr>
<tr class="row-even"><td><p>DetectorPositions</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Calibrated detector positions. If not specified, default ones are used.</p></td>
</tr>
<tr class="row-odd"><td><p>VanadiumWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>Workspace with the Vanadium (correction and calibration) run. Alternatively, when the Vanadium run has been already processed, the properties can be used</p></td>
</tr>
<tr class="row-even"><td><p>VanIntegrationWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Results of integrating the spectra of a Vanadium run, with one column (integration result) and one row per spectrum. This can be used in combination with OutVanadiumCurveFits from a previous execution and VanadiumWorkspace to provide pre-calculated values for Vanadium correction.</p></td>
</tr>
<tr class="row-odd"><td><p>VanCurvesWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>A workspace2D with the fitting workspaces corresponding to the instrument banks. This workspace has three spectra per bank, as produced by the algorithm Fit. This is meant to be used as an alternative input VanadiumWorkspace for testing and performance reasons. If not given, no workspace is generated.</p></td>
</tr>
<tr class="row-even"><td><p>Bank</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Which bank to focus: It can be specified as 1 or 2, or equivalently, North or South. See also SpectrumNumbers for a more flexible alternative to select specific detectors. Allowed values: [‘’, ‘North’, ‘South’, ‘Both: North, South’, ‘1’, ‘2’]</p></td>
</tr>
<tr class="row-odd"><td><p>SpectrumNumbers</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Sets the spectrum numbers for the detectors that should be considered in the focusing operation (all others will be ignored). This option cannot be used together with Bank, as they overlap. You can give multiple ranges, for example: “0-99”, or “0-9, 50-59, 100-109”.</p></td>
</tr>
<tr class="row-even"><td><p>NormaliseByCurrent</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Normalize the input data by applying the NormaliseByCurrent algorithm which use the log entry gd_proton_charge. If there is no proton charge the data are not normalised.</p></td>
</tr>
<tr class="row-odd"><td><p>MaskBinsXMins</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>0,19930,39960,59850,79930</p></td>
<td><p>List of minimum bin values to mask, separated by commas.</p></td>
</tr>
<tr class="row-even"><td><p>MaskBinsXMaxs</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>5300,20400,40450,62000,82670</p></td>
<td><p>List of maximum bin values to mask, separated by commas.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This algorithm is being developed for a specific instrument. It
might get changed or even removed without a notification, should
instrument scientists decide to do so.</p>
</div>
<p>Performs a Time-of-flight (TOF) to dSpacing conversion using
calibrated pixel positions, focuses the values in dSpacing (summing
them up into a single spectrum) and then converts them back to
TOF. The output workspace produced by this algorithm has one spectrum.
The algorithm also normalizes the spectra values by current or proton
charge, using <a class="reference internal" href="NormaliseByCurrent-v1.html#algm-normalisebycurrent"><span class="std std-ref">NormaliseByCurrent v1</span></a> so that the output
workspace is focused and normalized. In the focusing process, several
bins will be masked in the spectra as well. A list of minimum and
maximum TOF bin boundaries for the masking can be given. The default
values of this list is set for the ENGIN-X instrument.</p>
<p>If a table of detector positions is passed as an input property, the
detectors are calibrated before performing the conversions between TOF
and dSpacing. The table with individual detector or pixel positions
can be generated with <a class="reference internal" href="EnggCalibrateFull-v1.html#algm-enggcalibratefull"><span class="std std-ref">EnggCalibrateFull v1</span></a>.</p>
<p>In any case, before focusing the workspace, the spectra are corrected
by using data from a Vanadium run (passed in the VanadiumWorkspace
property). These corrections include two steps: detector sensitivity
correction and pixel-by-pixel correction on a per-bank basis. See also
<a class="reference internal" href="EnggCalibrateFull-v1.html#algm-enggcalibratefull"><span class="std std-ref">EnggCalibrateFull v1</span></a> where the same correction is applied.</p>
<p>The pixel-by-pixel Vanadium correction is based on curves fitted for
every bank. These curves can be obtained via the output property
OutVanadiumCurveFits. For every bank, the curve is fitted to the
summation of all the spectra of the bank, and then every spectra of
the bank is divided by the bank curve.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p><strong>Example - Simple focussing of an EnginX data file:</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the algorithm on an EnginX file</span>
<span class="n">data_ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;ENGINX00213855.nxs&#39;</span><span class="p">)</span>

<span class="c1"># Using precalculated Vanadium corrections. To calculate from scrach see EnggVanadiumCorrections</span>
<span class="n">van_integ_ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;ENGINX_precalculated_vanadium_run000236516_integration.nxs&#39;</span><span class="p">)</span>
<span class="n">van_curves_ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;ENGINX_precalculated_vanadium_run000236516_bank_curves.nxs&#39;</span><span class="p">)</span>

<span class="n">focussed_ws</span> <span class="o">=</span> <span class="n">EnggFocus</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">data_ws</span><span class="p">,</span>
                        <span class="n">VanIntegrationWorkspace</span><span class="o">=</span><span class="n">van_integ_ws</span><span class="p">,</span>
                        <span class="n">VanCurvesWorkspace</span><span class="o">=</span><span class="n">van_curves_ws</span><span class="p">,</span>
                        <span class="n">Bank</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>

<span class="c1"># Should have one spectrum only</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No. of spectra: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">focussed_ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>

<span class="c1"># Print a few arbitrary bins where higher intensities are expected</span>
<span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;For TOF of </span><span class="si">{0:.3f}</span><span class="s2"> normalized intensity is </span><span class="si">{1:.3f}</span><span class="s2">&quot;</span>
<span class="k">for</span> <span class="nb">bin</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3169</span><span class="p">,</span> <span class="mi">6037</span><span class="p">,</span> <span class="mi">7124</span><span class="p">]:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">focussed_ws</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="nb">bin</span><span class="p">],</span> <span class="n">focussed_ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="nb">bin</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>No. of spectra: 1
For TOF of 20165.642 normalized intensity is 1.769
For TOF of 33547.826 normalized intensity is 2.895
For TOF of 38619.804 normalized intensity is 5.181
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Diffraction/Engineering.html">Diffraction\Engineering</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/ec825fbd8c2d754b56329d9056e8016ac6d7b10a/Framework/PythonInterface/plugins/algorithms/EnggFocus.py">EnggFocus.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="EnggFitTOFFromPeaks-v1.html" title="Previous Chapter: EnggFitTOFFromPeaks v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; EnggFitTOFFro...</span>
    </a>
  </li>
  <li>
    <a href="EnggSaveGSASIIFitResultsToHDF5-v1.html" title="Next Chapter: EnggSaveGSASIIFitResultsToHDF5 v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">EnggSaveGSASI... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>