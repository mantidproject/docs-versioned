<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Crystal Field Examples</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data reduction for ILL’s direct geometry instruments" href="DirectILL.html" />
    <link rel="prev" title="Create Ikeda Carpenter Parameters GSAS" href="CreateIkedaCarpenterParametersGSAS.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Techniques</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">Crystal Field Examples</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="crystal-field-examples">
<span id="id1"></span><h1>Crystal Field Examples<a class="headerlink" href="#crystal-field-examples" title="Permalink to this heading">¶</a></h1>
<p>Mantid supports the calculation and fitting of inelastic neutron scattering (INS) measurements of transitions between crystal field (or crystalline electric field) energy levels. The scientific background is summarised in the <a class="reference internal" href="../concepts/CrystalField.html#crystal-field-theory"><span class="std std-ref">concept page</span></a> whilst the syntax of the Python commands used is described in the <a class="reference internal" href="../interfaces/direct/Crystal%20Field%20Python%20Interface.html#crystal-field-python-interface"><span class="std std-ref">interface page</span></a></p>
<p>This page contains specific worked examples. The data files can be found <a class="reference external" href="https://github.com/mducle/cf_examples/raw/master/cf_examples_data.zip">here</a>. Please download and unzip this into a folder which is on your Mantid path (set using the “Manage User Directories” menu item).</p>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#fitting-ins-spectrum" id="id2">Fitting INS spectrum</a></p></li>
<li><p><a class="reference internal" href="#fitting-with-resolution-function" id="id3">Fitting with resolution function</a></p></li>
<li><p><a class="reference internal" href="#fitting-magnetic-susceptibility" id="id4">Fitting magnetic susceptibility</a></p></li>
<li><p><a class="reference internal" href="#fitting-multiple-ins-spectra" id="id5">Fitting multiple INS spectra</a></p></li>
<li><p><a class="reference internal" href="#fixing-background-parameters" id="id6">Fixing Background Parameters</a></p></li>
<li><p><a class="reference internal" href="#tying-background-parameters" id="id7">Tying Background Parameters</a></p></li>
</ul>
</nav>
<section id="fitting-ins-spectrum">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Fitting INS spectrum</a><a class="headerlink" href="#fitting-ins-spectrum" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">CrystalField</span> <span class="kn">import</span> <span class="n">CrystalField</span><span class="p">,</span> <span class="n">CrystalFieldFit</span>

<span class="n">data_ws1</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;NdOs2Al10_5K35meV_Ecut_0to3ang_bp15V1.xye&#39;</span><span class="p">)</span>

<span class="c1"># Set up the crystal field model.</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">CrystalField</span><span class="p">(</span><span class="s1">&#39;Nd&#39;</span><span class="p">,</span> <span class="s1">&#39;C2v&#39;</span><span class="p">,</span> <span class="n">Temperature</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">FWHM</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">B20</span><span class="o">=</span><span class="mf">0.19</span><span class="p">,</span> <span class="n">B22</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">B40</span><span class="o">=-</span><span class="mf">0.0004</span><span class="p">,</span> <span class="n">B42</span><span class="o">=-</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">B44</span><span class="o">=-</span><span class="mf">0.012</span><span class="p">,</span> <span class="n">B60</span><span class="o">=</span><span class="mf">5.e-05</span><span class="p">,</span> <span class="n">B62</span><span class="o">=</span><span class="mf">0.00054</span><span class="p">,</span> <span class="n">B64</span><span class="o">=-</span><span class="mf">0.0006</span><span class="p">,</span> <span class="n">B66</span><span class="o">=</span><span class="mf">0.0008</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">PeakShape</span> <span class="o">=</span> <span class="s1">&#39;Lorentzian&#39;</span>
<span class="n">cf</span><span class="o">.</span><span class="n">IntensityScaling</span> <span class="o">=</span> <span class="mi">2</span>   <span class="c1"># Scale factor if data is not in absolute units (mbarn/sr/f.u./meV), will be fitted.</span>

<span class="c1"># Runs the fit</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">CrystalFieldFit</span><span class="p">(</span><span class="n">Model</span><span class="o">=</span><span class="n">cf</span><span class="p">,</span> <span class="n">InputWorkspace</span><span class="o">=</span><span class="n">data_ws1</span><span class="p">,</span><span class="n">MaxIterations</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">fit</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Plots the data and print fitted parameters</span>
<span class="n">plotSpectrum</span><span class="p">(</span><span class="s1">&#39;fit_Workspace&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">error_bars</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>

<span class="k">for</span> <span class="n">parnames</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;B20&#39;</span><span class="p">,</span> <span class="s1">&#39;B22&#39;</span><span class="p">,</span><span class="s1">&#39;B40&#39;</span><span class="p">,</span><span class="s1">&#39;B42&#39;</span><span class="p">,</span> <span class="s1">&#39;B44&#39;</span><span class="p">,</span> <span class="s1">&#39;B60&#39;</span><span class="p">,</span><span class="s1">&#39;B62&#39;</span><span class="p">,</span><span class="s1">&#39;B64&#39;</span><span class="p">,</span><span class="s1">&#39;B66&#39;</span><span class="p">]:</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">parnames</span><span class="o">+</span><span class="s1">&#39; = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="n">parnames</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; meV&#39;</span><span class="p">)</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;fit_Parameters&#39;</span><span class="p">]</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Cost function value = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Value&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p><img alt="FittingINSSpectrum.png" src="../_images/FittingINSSpectrum.png" /></p>
</section>
<section id="fitting-with-resolution-function">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Fitting with resolution function</a><a class="headerlink" href="#fitting-with-resolution-function" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">CrystalField</span> <span class="kn">import</span> <span class="n">CrystalField</span><span class="p">,</span> <span class="n">CrystalFieldFit</span><span class="p">,</span> <span class="n">Background</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">ResolutionModel</span>
<span class="kn">from</span> <span class="nn">pychop.Instruments</span> <span class="kn">import</span> <span class="n">Instrument</span>

<span class="c1"># load the data</span>
<span class="n">data_ws1</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;MER38435_10p22meV.txt&#39;</span><span class="p">)</span>
<span class="n">data_ws2</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;MER38436_10p22meV.txt&#39;</span><span class="p">)</span>

<span class="c1"># Sets up a resolution function</span>
<span class="n">merlin</span> <span class="o">=</span> <span class="n">Instrument</span><span class="p">(</span><span class="s1">&#39;MERLIN&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="mf">250.</span><span class="p">)</span>
<span class="n">merlin</span><span class="o">.</span><span class="n">setEi</span><span class="p">(</span><span class="mf">10.</span><span class="p">)</span>
<span class="n">resmod</span> <span class="o">=</span> <span class="n">ResolutionModel</span><span class="p">(</span><span class="n">merlin</span><span class="o">.</span><span class="n">getResolution</span><span class="p">,</span> <span class="n">xstart</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">xend</span><span class="o">=</span><span class="mf">9.0</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

<span class="n">Kelvin_to_meV</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">11.6</span>

<span class="c1"># Parameters from https://doi.org/10.1016/0921-4526(91)90575-Y</span>
<span class="n">lit_par</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;B20&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">.27</span><span class="p">,</span> <span class="s1">&#39;B22&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">.34</span><span class="p">,</span> <span class="s1">&#39;B40&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span> <span class="s1">&#39;B42&#39;</span><span class="p">:</span><span class="mf">0.04158</span><span class="p">,</span> <span class="s1">&#39;B44&#39;</span><span class="p">:</span><span class="mf">0.01369</span><span class="p">,</span> <span class="s1">&#39;B60&#39;</span><span class="p">:</span><span class="mf">0.112e-3</span><span class="p">,</span> <span class="s1">&#39;B62&#39;</span><span class="p">:</span><span class="mf">0.4185e-3</span><span class="p">,</span> <span class="s1">&#39;B64&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.555e-3</span><span class="p">,</span> <span class="s1">&#39;B66&#39;</span><span class="p">:</span><span class="mf">0.588e-3</span><span class="p">}</span> <span class="c1"># K</span>
<span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">lit_par</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
   <span class="n">lit_par</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">*=</span> <span class="n">Kelvin_to_meV</span>

<span class="c1"># Set up the crystal field model.</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">CrystalField</span><span class="p">(</span><span class="s1">&#39;Ho&#39;</span><span class="p">,</span> <span class="s1">&#39;D2&#39;</span><span class="p">,</span> <span class="n">Temperature</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="n">FWHM</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">**</span><span class="n">lit_par</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">PeakShape</span> <span class="o">=</span> <span class="s1">&#39;Lorentzian&#39;</span>
<span class="n">cf</span><span class="o">.</span><span class="n">IntensityScaling</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>   <span class="c1"># Scale factor if data is not in absolute units (mbarn/sr/f.u./meV), will be fitted.</span>
<span class="n">cf</span><span class="o">.</span><span class="n">ResolutionModel</span> <span class="o">=</span> <span class="p">[</span><span class="n">resmod</span><span class="p">,</span> <span class="n">resmod</span><span class="p">]</span>
<span class="n">cf</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">Background</span><span class="p">(</span><span class="n">peak</span><span class="o">=</span><span class="n">Function</span><span class="p">(</span><span class="s1">&#39;Gaussian&#39;</span><span class="p">,</span> <span class="n">Height</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">Sigma</span><span class="o">=</span><span class="mf">0.4</span><span class="o">/</span><span class="mf">2.3</span><span class="p">))</span>
<span class="n">cf</span><span class="o">.</span><span class="n">background</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">peak</span><span class="o">.</span><span class="n">ties</span><span class="p">(</span><span class="n">Height</span><span class="o">=</span><span class="mi">1400</span><span class="p">,</span> <span class="n">PeakCentre</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Sigma</span><span class="o">=</span><span class="mf">0.4</span><span class="o">/</span><span class="mf">2.3</span><span class="p">)</span>

<span class="c1"># Runs the fit</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">CrystalFieldFit</span><span class="p">(</span><span class="n">Model</span><span class="o">=</span><span class="n">cf</span><span class="p">,</span> <span class="n">InputWorkspace</span><span class="o">=</span><span class="p">[</span><span class="n">data_ws1</span><span class="p">,</span> <span class="n">data_ws2</span><span class="p">],</span> <span class="n">MaxIterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Output</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">)</span>
<span class="n">fit</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Plots the fit</span>
<span class="n">res_ws</span> <span class="o">=</span> <span class="p">[</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;Fit_Workspace_0&#39;</span><span class="p">],</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;Fit_Workspace_1&#39;</span><span class="p">]]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;20K&#39;</span><span class="p">,</span> <span class="s1">&#39;50K&#39;</span><span class="p">]</span>
<span class="n">titley</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1300</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span><span class="s1">&#39;mantid&#39;</span><span class="p">})</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">res_ws</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;rs&#39;</span><span class="p">,</span> <span class="n">wkspIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">res_ws</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">wkspIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity (arb. units)&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">titley</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="FittingWithResolutionFunction.png" src="../_images/FittingWithResolutionFunction.png" /></p>
</section>
<section id="fitting-magnetic-susceptibility">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Fitting magnetic susceptibility</a><a class="headerlink" href="#fitting-magnetic-susceptibility" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">CrystalField</span> <span class="kn">import</span> <span class="n">CrystalField</span><span class="p">,</span> <span class="n">CrystalFieldFit</span><span class="p">,</span> <span class="n">PhysicalProperties</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">sus_a</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;NdOs2Al10_sus_a.txt&#39;</span><span class="p">)</span>
<span class="n">sus_b</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;NdOs2Al10_sus_b.txt&#39;</span><span class="p">)</span>
<span class="n">sus_c</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;NdOs2Al10_sus_c.txt&#39;</span><span class="p">)</span>

<span class="n">cf</span> <span class="o">=</span> <span class="n">CrystalField</span><span class="p">(</span><span class="s1">&#39;Nd&#39;</span><span class="p">,</span> <span class="s1">&#39;C2v&#39;</span><span class="p">,</span>
     <span class="n">B20</span><span class="o">=</span><span class="mf">0.19</span><span class="p">,</span> <span class="n">B22</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">B40</span><span class="o">=-</span><span class="mf">0.0004</span><span class="p">,</span> <span class="n">B42</span><span class="o">=-</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">B44</span><span class="o">=-</span><span class="mf">0.012</span><span class="p">,</span> <span class="n">B60</span><span class="o">=</span><span class="mf">5.e-05</span><span class="p">,</span> <span class="n">B62</span><span class="o">=</span><span class="mf">0.00054</span><span class="p">,</span> <span class="n">B64</span><span class="o">=-</span><span class="mf">0.0006</span><span class="p">,</span> <span class="n">B66</span><span class="o">=</span><span class="mf">0.0008</span><span class="p">)</span>

<span class="c1"># Simultaneously fit data measured in a, b and c directions</span>
<span class="n">cf</span><span class="o">.</span><span class="n">PhysicalProperty</span> <span class="o">=</span> <span class="p">[</span>
     <span class="n">PhysicalProperties</span><span class="p">(</span><span class="s1">&#39;susc&#39;</span><span class="p">,</span> <span class="n">Hdir</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Unit</span><span class="o">=</span><span class="s1">&#39;cgs&#39;</span><span class="p">),</span>
     <span class="n">PhysicalProperties</span><span class="p">(</span><span class="s1">&#39;susc&#39;</span><span class="p">,</span> <span class="n">Hdir</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">Inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Unit</span><span class="o">=</span><span class="s1">&#39;cgs&#39;</span><span class="p">),</span>
     <span class="n">PhysicalProperties</span><span class="p">(</span><span class="s1">&#39;susc&#39;</span><span class="p">,</span> <span class="n">Hdir</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Unit</span><span class="o">=</span><span class="s1">&#39;cgs&#39;</span><span class="p">)]</span>

<span class="n">fit</span> <span class="o">=</span> <span class="n">CrystalFieldFit</span><span class="p">(</span><span class="n">Model</span><span class="o">=</span><span class="n">cf</span><span class="p">,</span> <span class="n">InputWorkspace</span><span class="o">=</span><span class="p">[</span><span class="n">sus_a</span><span class="p">,</span> <span class="n">sus_b</span><span class="p">,</span> <span class="n">sus_c</span><span class="p">],</span> <span class="n">MaxIterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Output</span><span class="o">=</span><span class="s1">&#39;fit_susc&#39;</span><span class="p">)</span>
<span class="n">fit</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print fitted parameters and plot results</span>
<span class="n">blm</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">parname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;B20&#39;</span><span class="p">,</span><span class="s1">&#39;B22&#39;</span><span class="p">,</span> <span class="s1">&#39;B40&#39;</span><span class="p">,</span> <span class="s1">&#39;B42&#39;</span><span class="p">,</span> <span class="s1">&#39;B44&#39;</span><span class="p">,</span><span class="s1">&#39;B60&#39;</span><span class="p">,</span><span class="s1">&#39;B62&#39;</span><span class="p">,</span><span class="s1">&#39;B64&#39;</span><span class="p">,</span><span class="s1">&#39;B66&#39;</span><span class="p">]:</span>
    <span class="n">blm</span><span class="p">[</span><span class="n">parname</span><span class="p">]</span> <span class="o">=</span> <span class="n">cf</span><span class="p">[</span><span class="n">parname</span><span class="p">]</span>
    <span class="nb">print</span> <span class="n">parname</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cf</span><span class="p">[</span><span class="n">parname</span><span class="p">])</span>
<span class="n">calc_a</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;fit_susc_Workspaces&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">calc_b</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;fit_susc_Workspaces&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">calc_c</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;fit_susc_Workspaces&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">calc_a</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">calc_a</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\chi^a$ Fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sus_a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sus_a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;ok&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\chi^a$ Data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">calc_b</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">calc_b</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\chi^b$ Fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sus_b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sus_b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;ob&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\chi^b$ Data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">calc_c</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">calc_c</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\chi^c$ Fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sus_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sus_c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\chi^c$ Data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Inverse Susceptibility (mol/emu)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="FittingMagneticSusceptibility.png" src="../_images/FittingMagneticSusceptibility.png" /></p>
</section>
<section id="fitting-multiple-ins-spectra">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Fitting multiple INS spectra</a><a class="headerlink" href="#fitting-multiple-ins-spectra" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">CrystalField</span> <span class="kn">import</span> <span class="n">CrystalField</span><span class="p">,</span> <span class="n">CrystalFieldFit</span>

<span class="n">datadir</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">data_ws1</span><span class="o">=</span><span class="n">Load</span><span class="p">(</span><span class="n">datadir</span><span class="o">+</span><span class="s1">&#39;cecuga3Mlacuga3_15meV5K0to2p5angbp2V1.xye&#39;</span><span class="p">)</span>
<span class="n">data_ws2</span><span class="o">=</span><span class="n">Load</span><span class="p">(</span><span class="n">datadir</span><span class="o">+</span><span class="s1">&#39;cecuga3Mlacuga3fp824_15meV50K0to2p5angbp2V1.xye&#39;</span><span class="p">)</span>
<span class="n">data_ws3</span><span class="o">=</span><span class="n">Load</span><span class="p">(</span><span class="n">datadir</span><span class="o">+</span><span class="s1">&#39;cecuga3Mlacuga3fp824_15meV100K0to2p5angbp2V1.xye&#39;</span><span class="p">)</span>

<span class="c1"># Set up the crystal field model for multiple spectra.</span>
<span class="c1"># This is indicated by the number of elements in the list of temperatures.</span>
<span class="c1"># Optionally other parameters like FWHM and IntensityScaling can be lists if these initial parameters for each</span>
<span class="c1">#    spectra should differ.</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">CrystalField</span><span class="p">(</span><span class="s1">&#39;Ce&#39;</span><span class="p">,</span> <span class="s1">&#39;C4v&#39;</span><span class="p">,</span> <span class="n">Temperature</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">FWHM</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">B20</span><span class="o">=</span><span class="mf">0.0633</span><span class="p">,</span> <span class="n">B40</span><span class="o">=</span><span class="mf">0.01097</span><span class="p">,</span> <span class="n">B44</span><span class="o">=</span><span class="mf">0.09985</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">PeakShape</span> <span class="o">=</span> <span class="s1">&#39;Lorentzian&#39;</span>
<span class="n">cf</span><span class="o">.</span><span class="n">IntensityScaling</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>   <span class="c1"># Scale factor if data is not in absolute units (mbarn/sr/f.u./meV), will be fitted.</span>

<span class="c1"># Runs the fit</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">CrystalFieldFit</span><span class="p">(</span><span class="n">Model</span><span class="o">=</span><span class="n">cf</span><span class="p">,</span> <span class="n">InputWorkspace</span><span class="o">=</span><span class="p">[</span><span class="n">data_ws1</span><span class="p">,</span> <span class="n">data_ws2</span><span class="p">,</span> <span class="n">data_ws3</span><span class="p">],</span> <span class="n">MaxIterations</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">fit</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Plots the data and print fitted parameters</span>
<span class="n">plotSpectrum</span><span class="p">(</span><span class="s1">&#39;fit_Workspace_0&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">error_bars</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">])</span>
<span class="n">plotSpectrum</span><span class="p">(</span><span class="s1">&#39;fit_Workspace_1&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">error_bars</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">])</span>
<span class="n">plotSpectrum</span><span class="p">(</span><span class="s1">&#39;fit_Workspace_2&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">error_bars</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">])</span>

<span class="c1"># Prints output parameters and cost function.</span>
<span class="k">for</span> <span class="n">parnames</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;B20&#39;</span><span class="p">,</span> <span class="s1">&#39;B40&#39;</span><span class="p">,</span><span class="s1">&#39;B44&#39;</span><span class="p">]:</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">parnames</span><span class="o">+</span><span class="s1">&#39; = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="n">parnames</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; meV&#39;</span><span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;fit_Parameters&#39;</span><span class="p">]</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Cost function value = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Value&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/FittingMultipleINSSpectra_0.png"><img alt="FittingMultipleINSSpectra_0.png" src="../_images/FittingMultipleINSSpectra_0.png" style="width: 33%;" /></a> <a class="reference internal" href="../_images/FittingMultipleINSSpectra_1.png"><img alt="FittingMultipleINSSpectra_1.png" src="../_images/FittingMultipleINSSpectra_1.png" style="width: 33%;" /></a> <a class="reference internal" href="../_images/FittingMultipleINSSpectra_2.png"><img alt="FittingMultipleINSSpectra_2.png" src="../_images/FittingMultipleINSSpectra_2.png" style="width: 33%;" /></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">B20</span> <span class="o">=</span> <span class="mf">0.101723272944</span> <span class="n">meV</span>
<span class="n">B40</span> <span class="o">=</span> <span class="mf">0.012725904646</span> <span class="n">meV</span>
<span class="n">B44</span> <span class="o">=</span> <span class="mf">0.0890276949598</span> <span class="n">meV</span>
<span class="n">Cost</span> <span class="n">function</span> <span class="n">value</span> <span class="o">=</span> <span class="mf">1.79652249577</span>
</pre></div>
</div>
</section>
<section id="fixing-background-parameters">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Fixing Background Parameters</a><a class="headerlink" href="#fixing-background-parameters" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">CrystalField</span> <span class="kn">import</span> <span class="n">Background</span><span class="p">,</span> <span class="n">CrystalField</span><span class="p">,</span> <span class="n">Function</span>

<span class="c1"># Sets up the crystal field model</span>
<span class="n">refpars</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;B20&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;B40&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.00164</span><span class="p">,</span> <span class="s1">&#39;B60&#39;</span><span class="p">:</span><span class="mf">0.0001146</span><span class="p">,</span> <span class="s1">&#39;B66&#39;</span><span class="p">:</span><span class="mf">0.001509</span><span class="p">}</span>

<span class="n">cf</span> <span class="o">=</span> <span class="n">CrystalField</span><span class="p">(</span><span class="s1">&#39;Pr&#39;</span><span class="p">,</span> <span class="s1">&#39;C6v&#39;</span><span class="p">,</span> <span class="n">Temperature</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">refpars</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">IntensityScaling</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">cf</span><span class="o">.</span><span class="n">FWHMVariation</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">cf</span><span class="o">.</span><span class="n">PeakShape</span> <span class="o">=</span> <span class="s1">&#39;Gaussian&#39;</span>

<span class="c1"># Creates a background using a list of Function objects</span>
<span class="n">cf</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">Background</span><span class="p">(</span><span class="n">functions</span><span class="o">=</span><span class="p">[</span><span class="n">Function</span><span class="p">(</span><span class="s1">&#39;PseudoVoigt&#39;</span><span class="p">,</span> <span class="n">Intensity</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">FWHM</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">Mixing</span><span class="o">=</span><span class="mf">0.84</span><span class="p">,</span> <span class="n">PeakCentre</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">),</span>
                                      <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;Gaussian&#39;</span><span class="p">,</span> <span class="n">Height</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">Sigma</span><span class="o">=</span><span class="mf">0.27</span><span class="p">,</span> <span class="n">PeakCentre</span><span class="o">=</span><span class="mf">9.0</span><span class="p">)])</span>

<span class="c1"># Fixes all the parameters of the PseudoVoigt to their current values.</span>
<span class="n">cf</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

<span class="c1"># Fixes the PeakCentre and Height of the Gaussian to their current values.</span>
<span class="n">cf</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="s1">&#39;PeakCentre&#39;</span><span class="p">,</span> <span class="s1">&#39;Height&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tying-background-parameters">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Tying Background Parameters</a><a class="headerlink" href="#tying-background-parameters" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">CrystalField</span> <span class="kn">import</span> <span class="n">Background</span><span class="p">,</span> <span class="n">CrystalField</span><span class="p">,</span> <span class="n">Function</span>

<span class="c1"># Sets up the crystal field model</span>
<span class="n">refpars</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;B20&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;B40&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.00164</span><span class="p">,</span> <span class="s1">&#39;B60&#39;</span><span class="p">:</span><span class="mf">0.0001146</span><span class="p">,</span> <span class="s1">&#39;B66&#39;</span><span class="p">:</span><span class="mf">0.001509</span><span class="p">}</span>

<span class="n">cf</span> <span class="o">=</span> <span class="n">CrystalField</span><span class="p">(</span><span class="s1">&#39;Pr&#39;</span><span class="p">,</span> <span class="s1">&#39;C6v&#39;</span><span class="p">,</span> <span class="n">Temperature</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">refpars</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">IntensityScaling</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">cf</span><span class="o">.</span><span class="n">FWHMVariation</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">cf</span><span class="o">.</span><span class="n">PeakShape</span> <span class="o">=</span> <span class="s1">&#39;Gaussian&#39;</span>

<span class="c1"># Creates a background using a list of Function objects</span>
<span class="n">cf</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">Background</span><span class="p">(</span><span class="n">functions</span><span class="o">=</span><span class="p">[</span><span class="n">Function</span><span class="p">(</span><span class="s1">&#39;PseudoVoigt&#39;</span><span class="p">,</span> <span class="n">Intensity</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">FWHM</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">Mixing</span><span class="o">=</span><span class="mf">0.84</span><span class="p">,</span> <span class="n">PeakCentre</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">),</span>
                                      <span class="n">Function</span><span class="p">(</span><span class="s1">&#39;Gaussian&#39;</span><span class="p">,</span> <span class="n">Height</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">Sigma</span><span class="o">=</span><span class="mf">0.27</span><span class="p">,</span> <span class="n">PeakCentre</span><span class="o">=</span><span class="mf">9.0</span><span class="p">)])</span>

<span class="c1"># Ties some of the parameters in the Gaussian to different values.</span>
<span class="n">cf</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ties</span><span class="p">(</span><span class="n">PeakCentre</span><span class="o">=</span><span class="mf">9.0</span><span class="p">,</span> <span class="n">Height</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Category</strong>: <a class="reference external" href="categories/Techniques.html">Techniques</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CreateIkedaCarpenterParametersGSAS.html" title="Previous Chapter: Create Ikeda Carpenter Parameters GSAS"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Create Ikeda ...</span>
    </a>
  </li>
  <li>
    <a href="DirectILL.html" title="Next Chapter: Data reduction for ILL’s direct geometry instruments"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Data reductio... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>