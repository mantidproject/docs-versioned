<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Data reduction for reflectometry instruments at the ILL</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SANS TOML Files" href="SANS-Toml-v1.html" />
    <link rel="prev" title="Data reduction for D7 instrument at the ILL" href="PolarisedDiffractionILL.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Techniques</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">Data reduction for reflectometry instruments at the ILL</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="data-reduction-for-reflectometry-instruments-at-the-ill">
<span id="reflectometryill"></span><h1>Data reduction for reflectometry instruments at the ILL<a class="headerlink" href="#data-reduction-for-reflectometry-instruments-at-the-ill" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#reduction-basics" id="id4">Reduction basics</a></p></li>
<li><p><a class="reference internal" href="#loading-and-initial-fitting" id="id5">Loading and initial fitting</a></p></li>
<li><p><a class="reference internal" href="#preprocessing" id="id6">Preprocessing</a></p>
<ul>
<li><p><a class="reference internal" href="#measurement" id="id7">Measurement</a></p></li>
<li><p><a class="reference internal" href="#foreground-and-backgrounds" id="id8">Foreground and backgrounds</a></p></li>
<li><p><a class="reference internal" href="#gravity-correction" id="id9">Gravity correction</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#summing-foreground" id="id10">Summing foreground</a></p></li>
<li><p><a class="reference internal" href="#polarisation-correction" id="id11">Polarisation correction</a></p>
<ul>
<li><p><a class="reference internal" href="#workflow-diagram-and-working-example" id="id12">Workflow diagram and working example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#conversion-to-momentum-exchange" id="id13">Conversion to momentum exchange</a></p></li>
<li><p><a class="reference internal" href="#full-data-reduction-examples" id="id14">Full data reduction examples</a></p>
<ul>
<li><p><a class="reference internal" href="#d17-sample-angle-incoherent-summation" id="id15">D17 sample angle, incoherent summation</a></p></li>
<li><p><a class="reference internal" href="#d17-user-angle-incoherent-summation" id="id16">D17 user angle, incoherent summation</a></p></li>
<li><p><a class="reference internal" href="#figaro-detector-angle-gravity-correction" id="id17">FIGARO detector angle, gravity correction</a></p></li>
<li><p><a class="reference internal" href="#references" id="id18">References</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>There is one algorithm providing the entry point and steering the reduction workflow for both FIGARO and D17:</p>
<dl class="simple">
<dt><a class="reference internal" href="../algorithms/ReflectometryILLAutoProcess-v1.html#algm-reflectometryillautoprocess"><span class="std std-ref">ReflectometryILLAutoProcess v1</span></a></dt><dd><p>Controls the reduction workflow of both direct and reflected beams from loading, through corrections, to final reflectivity curve as a function of momentum exchange.</p>
</dd>
</dl>
<p>This algorithm depends on the number of dedicated ILL algorithms handling loading, corrections, and converting data:</p>
<dl class="simple">
<dt><a class="reference internal" href="../algorithms/LoadILLReflectometry-v1.html#algm-loadillreflectometry"><span class="std std-ref">LoadILLReflectometry v1</span></a></dt><dd><p>Loads D17 and FIGARO NeXus data, fits the foreground position and places the instrument such that the foreground falls at <span class="math notranslate nohighlight">\(2\theta = 0\)</span></p>
</dd>
<dt><a class="reference internal" href="../algorithms/ReflectometryILLPreprocess-v1.html#algm-reflectometryillpreprocess"><span class="std std-ref">ReflectometryILLPreprocess v1</span></a></dt><dd><p>Loads, merges, normalizes, subtracts background, and calculates gravity correction for FIGARO.</p>
</dd>
<dt><a class="reference internal" href="../algorithms/ReflectometryILLSumForeground-v1.html#algm-reflectometryillsumforeground"><span class="std std-ref">ReflectometryILLSumForeground v1</span></a></dt><dd><p>Sums foreground pixels in selected summation mode, optionally converting to reflectivity.</p>
</dd>
<dt><a class="reference internal" href="../algorithms/ReflectometryILLPolarizationCor-v1.html#algm-reflectometryillpolarizationcor"><span class="std std-ref">ReflectometryILLPolarizationCor v1</span></a></dt><dd><p>Performs polarization efficiency corrections.</p>
</dd>
<dt><a class="reference internal" href="../algorithms/ReflectometryILLConvertToQ-v1.html#algm-reflectometryillconverttoq"><span class="std std-ref">ReflectometryILLConvertToQ v1</span></a></dt><dd><p>Converts a reflectivity workspace from wavelength to momentum transfer.</p>
</dd>
</dl>
<p>Together with other algorithms and services provided by the Mantid framework, the reduction algorithms can handle a number of reduction scenarios. If this proves insufficient, however, the algorithms can be accessed using Python. Before making modifications it is recommended to copy the source files and rename the algorithms as not to break the original behavior.</p>
<p>This document tries to give an overview on how the algorithms work together via Python examples. Please refer to the algorithm documentation for details of each individual algorithm.</p>
<p>A description of the usage of the algorithms for the D17 and FIGARO data reduction is presented along with several possible workflows, depending on summation type, the source of the angle (detector, sample, user-defined), and whether the neutrons are polarized.</p>
<section id="reduction-basics">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Reduction basics</a><a class="headerlink" href="#reduction-basics" title="Permalink to this heading">¶</a></h2>
<p>A very basic data reduction would include a direct and a reflected beam measurement of the sample at one angle position, follow the following steps:</p>
<ol class="arabic simple">
<li><p>Preprocessing of direct and reflected beams in <a class="reference internal" href="../algorithms/ReflectometryILLPreprocess-v1.html#algm-reflectometryillpreprocess"><span class="std std-ref">ReflectometryILLPreProcess</span></a></p></li>
<li><p>Summing of foreground for both direct and reflected beams in <a class="reference internal" href="../algorithms/ReflectometryILLSumForeground-v1.html#algm-reflectometryillsumforeground"><span class="std std-ref">ReflectometryILLSumForeground</span></a></p></li>
<li><p>Finally, division of reflected beams workspace by direct measurement and conversion to momentum exchange in <a class="reference internal" href="../algorithms/ReflectometryILLConvertToQ-v1.html#algm-reflectometryillconverttoq"><span class="std std-ref">ReflectometryILLConvertToQ</span></a></p></li>
</ol>
<p>This workflow could be also represented as the diagram below.</p>
<img alt="../_images/ReflectometryILLAutoProcess-v1_wkflw.svg" src="../_images/ReflectometryILLAutoProcess-v1_wkflw.svg" /><div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
</section>
<section id="loading-and-initial-fitting">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Loading and initial fitting</a><a class="headerlink" href="#loading-and-initial-fitting" title="Permalink to this heading">¶</a></h2>
<p>The first step of working with reflectometry data is to separately load direct and reflected beams via dedicated loader, <a class="reference internal" href="../algorithms/LoadILLReflectometry-v1.html#algm-loadillreflectometry"><span class="std std-ref">LoadILLReflectometry</span></a>.
The loader handles the creation of appropriately sized workspace with the relevant instrument, filling it with data loaded from raw NeXus file, and adding all the metadata available.
The proper position and orientation of the instrument in 3D space is ensured by rotating the instrument such that the centre of the reflectometry peak <span class="math notranslate nohighlight">\(2\theta\)</span> falls at 0.0.
The position of the reflectometry peak can be provided by the user via <cite>ForegroundPeakCentre</cite> property, otherwise it is fitted using a Gaussian distribution on the workspace where
the TOF dimension is integrated over. In case of reflected beam, and either sample or user angle options, the reflectometry peak is not placed as 0.0, but at the angle provided
via <cite>BraggAngle</cite> property. This rotation takes place in either in horizontal or vertical plane, depending on the instrument, D17 and FIGARO, respectively.</p>
<p><strong>Example - Loading reflectometry data</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">LoadILLReflectometry</span><span class="p">(</span>
   <span class="n">Filename</span><span class="o">=</span><span class="s1">&#39;317369&#39;</span><span class="p">,</span>
   <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;direct_beam_ws&#39;</span><span class="p">,</span>
   <span class="n">Measurement</span><span class="o">=</span><span class="s1">&#39;DirectBeam&#39;</span><span class="p">,</span>
   <span class="n">XUnit</span><span class="o">=</span><span class="s1">&#39;TimeOfFlight&#39;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of TOF bins: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">blocksize</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min/max of TOF: </span><span class="si">{:.3f}</span><span class="s2">, </span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ws</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Number of TOF bins: 1000
Min/max of TOF: -470.036, 56529.964
</pre></div>
</div>
</section>
<section id="preprocessing">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Preprocessing</a><a class="headerlink" href="#preprocessing" title="Permalink to this heading">¶</a></h2>
<p>This algorithm is the first step in the ILL reflectometry reduction workflow. It:</p>
<ol class="arabic simple">
<li><p>loads data from disk by using <a class="reference internal" href="../algorithms/LoadAndMerge-v1.html#algm-loadandmerge"><span class="std std-ref">LoadAndMerge</span></a> (<a class="reference internal" href="../algorithms/LoadILLReflectometry-v1.html#algm-loadillreflectometry"><span class="std std-ref">LoadILLReflectometry</span></a>, <a class="reference internal" href="../algorithms/MergeRuns-v1.html#algm-mergeruns"><span class="std std-ref">MergeRuns</span></a>)</p></li>
<li><p>merges the numors</p></li>
<li><p>performs the detector angle calibration</p></li>
<li><p>normalizes to a (water) reference (optional)</p></li>
<li><p>normalizes to slit sizes (optional)</p></li>
<li><p>normalizes to experiment time or monitor counts (optional)</p></li>
<li><p>subtracts time-independent background (optional)</p></li>
<li><p>converts to wavelength</p></li>
<li><p>calculates gravity correction to wavelength and reflected angle (optional)</p></li>
</ol>
<p>The algorithm can be thought as an ‘advanced loader’, and should be used to load both direct beam and reflected beam measurements.</p>
<p>The <em>OutputWorkspace</em> can be further fed to <a class="reference internal" href="../algorithms/ReflectometryILLSumForeground-v1.html#algm-reflectometryillsumforeground"><span class="std std-ref">ReflectometryILLSumForeground</span></a>.</p>
<p>The option <em>Slit Normalisation AUTO</em> will select the slit normalisation depending on the instrument: for D17 and FIGARO, the slit normalisation will be turned on and off, respectively.</p>
<p>The workflow diagram below gives an overview of the algorithm for direct and reflected beam preprocessing respectively:</p>
<img alt="../_images/ReflectometryILLPreprocessDirect-v1_wkflw.svg" src="../_images/ReflectometryILLPreprocessDirect-v1_wkflw.svg" /><img alt="../_images/ReflectometryILLPreprocessReflected-v1_wkflw.svg" src="../_images/ReflectometryILLPreprocessReflected-v1_wkflw.svg" /><section id="measurement">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Measurement</a><a class="headerlink" href="#measurement" title="Permalink to this heading">¶</a></h3>
<p>This tag defines whether the runs need to be processed as direct or reflected beams.
In both cases the fractional foreground centre is fitted.
For direct beam, the detector is rotated such that the foreground centre corresponds exactly to zero scattering angle.
For reflected beam there are three possibilities, depending on the <strong>AngleOption</strong>:</p>
<ol class="arabic simple">
<li><p><strong>UserAngle</strong>: the detector is rotated such that the foreground centre of the reflected beam corresponds exactly to <strong>2*BraggAngle</strong>.</p></li>
<li><p><strong>SampleAngle</strong>: the detector is rotated such that the foreground centre if the reflected beam corresponds exactly to <strong>2*SAN</strong>, where the SAN is read from the nexus file of the reflected beam run.</p></li>
<li><p><strong>DetectorAngle</strong>: the detector is rotated such that the foreground centre of the corresponding direct beam corresponds exactly to <strong>DAN_RB - DAN_DB</strong>, where the two detector angles are read from the direct and reflected beams correspondingly. In this case the <strong>DirectBeamDetectorAngle</strong> and <strong>DirectBeamForegroundCentre</strong> are required, which could be retrieved from the sample logs of the pre-processed direct beam runs.</p></li>
</ol>
</section>
<section id="foreground-and-backgrounds">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Foreground and backgrounds</a><a class="headerlink" href="#foreground-and-backgrounds" title="Permalink to this heading">¶</a></h3>
<p>Foreground is a set of pixels intensities of which will be summed in <a class="reference internal" href="../algorithms/ReflectometryILLSumForeground-v1.html#algm-reflectometryillsumforeground"><span class="std std-ref">ReflectometryILLSumForeground</span></a>. However, foreground needs to be defined already in this algorithm as the information is needed for the background pixels. The foreground pixel information is stored in the sample logs of <em>OutputWorkspace</em> under the entries starting with <code class="docutils literal notranslate"><span class="pre">foreground.</span></code>.</p>
<p>Background, on the other hand, is a set of pixels which are be used for average (default), fitted constant or linear background by <a class="reference internal" href="../algorithms/CalculatePolynomialBackground-v1.html#algm-calculatepolynomialbackground"><span class="std std-ref">CalculatePolynomialBackground</span></a>.</p>
<p>The foreground pixels are defined by the foreground centre and <em>ForegroundHalfWidth</em> property. In normal use cases, the foreground center (workspace index) is taken from the fitting in <a class="reference internal" href="../algorithms/LoadILLReflectometry-v1.html#algm-loadillreflectometry"><span class="std std-ref">LoadILLReflectometry</span></a>. Fractional values are rounded to nearest integer.</p>
<p><em>ForegroundHalfWidth</em> is a list of one or two values. If a single value is given, then this number of pixels on both sides of the centre pixel are included in the foreground. For example, <code class="docutils literal notranslate"><span class="pre">ForegroundHalfWidth=[3]</span></code> means three pixel on both sides are included, making the foreground seven pixels wide in total.
<code class="docutils literal notranslate"><span class="pre">ForegroundHalfWidth=[0]</span></code> means that only the centre pixel is included. When two values are given, then the foreground is asymmetric around the centre. For instance, <code class="docutils literal notranslate"><span class="pre">ForegroundHalfWidth[2,5]</span></code> indicates that two pixel at lower <span class="math notranslate nohighlight">\(\theta\)</span> and five pixels at higher <span class="math notranslate nohighlight">\(\theta\)</span> are included in the foreground.</p>
<p><em>LowAngleBkgWidth</em> and <em>HighAngleBkgWidth</em> define the number of the background fitting pixels at low and high <span class="math notranslate nohighlight">\(\theta\)</span>. Either one or both widths can be defined. The distance between the background pixels and the foreground can in turn be given by <em>LowAngleBkgOffset</em> and <em>HighAngleBkgOffset</em>.</p>
</section>
<section id="gravity-correction">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Gravity correction</a><a class="headerlink" href="#gravity-correction" title="Permalink to this heading">¶</a></h3>
<p>Gravity correction is relevant for data reduction at FIGARO. Its execution is steered by a switch: <cite>CorrectGravity</cite>. Gravity correction approach follows the algorithm described
in Ref. <a class="footnote-reference brackets" href="#gutfreund" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, where both the wavelength and reflection angles are corrected for the neutron drop due to gravity. This approach assumes no significant change to the neutron speed.</p>
<p>In practice, this correction had to be split in two steps. Both the new wavelength axis and the corrected reflected angle distribution are calculated during the preprocessing, both
for direct and reflected beams. The corrected wavelength axis is applied immediately in the preprocess algorithm, while the reflected angle correction is applied only to the reflected beam
workspace at a later stage, in the <a class="reference internal" href="../algorithms/ReflectometryILLConvertToQ-v1.html#algm-reflectometryillconverttoq"><span class="std std-ref">ReflectometryILLConvertToQ</span></a> algorithm, immediately before the final conversion to the momentum exchange. This approach
was dictated by the Mantid architecture but is mathematically equivalent and does not impact the quality of the correction.</p>
</section>
</section>
<section id="summing-foreground">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Summing foreground</a><a class="headerlink" href="#summing-foreground" title="Permalink to this heading">¶</a></h2>
<p>The default summation type is incoherent (sum along constant <span class="math notranslate nohighlight">\(\lambda\)</span>), where the reflectivity curve is calculated by dividing the summed foreground of the reflected beam by the summed foreground of the direct beam. For coherent summing, first the reflected beam data is divided by the direct beam data in 2D, then the ratio is summed along the lines of the constant <span class="math notranslate nohighlight">\(Q_{z}\)</span>.</p>
</section>
<section id="polarisation-correction">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Polarisation correction</a><a class="headerlink" href="#polarisation-correction" title="Permalink to this heading">¶</a></h2>
<p>The polarisation correction is handled by <a class="reference internal" href="../algorithms/ReflectometryILLPolarizationCor-v1.html#algm-reflectometryillpolarizationcor"><span class="std std-ref">ReflectometryILLPolarizationCor</span></a> algorithm. This algorithm is an ILL-specific wrapper around <a class="reference internal" href="../algorithms/PolarizationEfficiencyCor-v1.html#algm-polarizationefficiencycor"><span class="std std-ref">PolarizationEffiencyCor</span></a>. It is typically run in reflectometry reduction workflow, namely the workflow in the <a class="reference internal" href="../algorithms/ReflectometryILLAutoProcess-v1.html#algm-reflectometryillautoprocess"><span class="std std-ref">ReflectometryILLAutoProcess</span></a> algorithm, between <a class="reference internal" href="../algorithms/ReflectometryILLSumForeground-v1.html#algm-reflectometryillsumforeground"><span class="std std-ref">ReflectometryILLSumForeground</span></a> and <a class="reference internal" href="../algorithms/ReflectometryILLConvertToQ-v1.html#algm-reflectometryillconverttoq"><span class="std std-ref">ReflectometryILLConvertToQ</span></a>.</p>
<p>The algorithm accepts a list of workspace names as <em>InputWorkspaces</em>. Thus, the workspaces have to be accessible from the the analysis data service. One to four workspaces can be named. If only a single workspace is given, it is treated as the direct beam. The algorithm loads the polarization efficiencies from <em>EfficiencyFile</em>. This file should be in the ILL format readable by <a class="reference internal" href="../algorithms/LoadILLPolarizationFactors-v1.html#algm-loadillpolarizationfactors"><span class="std std-ref">LoadILLPolarizationFactors</span></a>.</p>
<p>The first workspace in <em>InputWorkspaces</em> is picked as a reference. The instrument configuration is extracted from the sample logs of this workspace. Further, this workspace is used as <em>WavelengthReference</em> for <a class="reference internal" href="../algorithms/LoadILLPolarizationFactors-v1.html#algm-loadillpolarizationfactors"><span class="std std-ref">LoadILLPolarizationFactors</span></a>. To make sure the wavelength axes of all workspaces are consistent comply, they are run through <a class="reference internal" href="../algorithms/RebinToWorkspace-v1.html#algm-rebintoworkspace"><span class="std std-ref">RebinToWorkspace</span></a>, with workspaces being matched to the reference.</p>
<p>Finally, the algorithm extracts the flipper configurations from the input workspaces, reorders the workspaces accordingly and calls <a class="reference internal" href="../algorithms/PolarizationEfficiencyCor-v1.html#algm-polarizationefficiencycor"><span class="std std-ref">PolarizationEffiencyCor</span></a>. The output is a workspace group returned by <a class="reference internal" href="../algorithms/PolarizationEfficiencyCor-v1.html#algm-polarizationefficiencycor"><span class="std std-ref">PolarizationEffiencyCor</span></a>, containing workspaces corrected for polarization efficiency and ready for further processing and conversion to momentum exchange.</p>
<section id="workflow-diagram-and-working-example">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Workflow diagram and working example</a><a class="headerlink" href="#workflow-diagram-and-working-example" title="Permalink to this heading">¶</a></h3>
<p>Below is the relevant workflow diagram describing polarization correction workflow..</p>
<img alt="../_images/ReflectometryILLPolarizationCor-v1_wkflw.svg" src="../_images/ReflectometryILLPolarizationCor-v1_wkflw.svg" /><div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - analyzerless corrections</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use same foreground and background settings for direct and reflected</span>
<span class="c1"># beams.</span>
<span class="c1"># Python dictionaries can be passed to algorithms as &#39;keyword arguments&#39;.</span>
<span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ForegroundHalfWidth&#39;</span><span class="p">:[</span><span class="mi">5</span><span class="p">],</span>
    <span class="s1">&#39;LowAngleBkgOffset&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;LowAngleBkgWidth&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s1">&#39;HighAngleBkgOffset&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;HighAngleBkgWidth&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Direct beam</span>
<span class="n">direct</span> <span class="o">=</span> <span class="n">ReflectometryILLPreprocess</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/D17/317369.nxs&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">settings</span>
<span class="p">)</span>

<span class="n">directFgd</span> <span class="o">=</span> <span class="n">ReflectometryILLSumForeground</span><span class="p">(</span><span class="n">direct</span><span class="p">)</span>

<span class="c1"># Reflected beam. Flippers set to &#39;++&#39;</span>
<span class="n">reflected11</span> <span class="o">=</span> <span class="n">ReflectometryILLPreprocess</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/D17/317370.nxs&#39;</span><span class="p">,</span>
    <span class="n">Measurement</span><span class="o">=</span><span class="s1">&#39;ReflectedBeam&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">settings</span>
<span class="p">)</span>

<span class="n">reflectivity11</span> <span class="o">=</span> <span class="n">ReflectometryILLSumForeground</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="n">reflected11</span><span class="p">,</span>
    <span class="n">DirectForegroundWorkspace</span><span class="o">=</span><span class="n">directFgd</span><span class="p">,</span>
    <span class="n">DirectLineWorkspace</span><span class="o">=</span><span class="n">direct</span><span class="p">,</span>
    <span class="n">WavelengthRange</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1"># Reload the reflected be. We will fake the &#39;--&#39; flipper settings</span>
<span class="n">reflected00</span> <span class="o">=</span> <span class="n">ReflectometryILLPreprocess</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/D17/317370.nxs&#39;</span><span class="p">,</span>
    <span class="n">Measurement</span><span class="o">=</span><span class="s1">&#39;ReflectedBeam&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">settings</span>
<span class="p">)</span>

<span class="n">reflectivity00</span> <span class="o">=</span> <span class="n">ReflectometryILLSumForeground</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="n">reflected00</span><span class="p">,</span>
    <span class="n">DirectForegroundWorkspace</span><span class="o">=</span><span class="n">directFgd</span><span class="p">,</span>
    <span class="n">DirectLineWorkspace</span><span class="o">=</span><span class="n">direct</span><span class="p">,</span>
    <span class="n">WavelengthRange</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1"># Overwrite sample logs</span>
<span class="n">replace</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">logs</span> <span class="o">=</span> <span class="n">reflectivity00</span><span class="o">.</span><span class="n">mutableRun</span><span class="p">()</span>
<span class="n">logs</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s1">&#39;Flipper1.state&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">replace</span><span class="p">)</span>
<span class="n">logs</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s1">&#39;Flipper1.stateint&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">replace</span><span class="p">)</span>
<span class="n">logs</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s1">&#39;Flipper2.state&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">replace</span><span class="p">)</span>
<span class="n">logs</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s1">&#39;Flipper2.stateint&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">replace</span><span class="p">)</span>

<span class="c1"># Polarization efficiency correction</span>
<span class="c1"># The algorithm will think that the analyzer was off.</span>
<span class="n">ReflectometryILLPolarizationCor</span><span class="p">(</span>
    <span class="n">InputWorkspaces</span><span class="o">=</span><span class="s1">&#39;reflectivity00, reflectivity11&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;pol_corrected&#39;</span><span class="p">,</span>  <span class="c1"># Name of the group workspace</span>
    <span class="n">EfficiencyFile</span><span class="o">=</span><span class="s1">&#39;ILL/D17/PolarizationFactors.txt&#39;</span>
<span class="p">)</span>
<span class="c1"># The polarization corrected workspaces get automatically generated names</span>
<span class="n">polcorr00</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;pol_corrected_--&#39;</span><span class="p">]</span>
<span class="n">polcorr11</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;pol_corrected_++&#39;</span><span class="p">]</span>
<span class="c1"># The output is almost the same as from ReflectometryILLSumForeground</span>
<span class="c1"># except for small difference due to the polarization corrections.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Histograms in 00 workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">polcorr00</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Histograms in 11 workspace: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">polcorr11</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X unit: &#39;</span> <span class="o">+</span> <span class="n">polcorr00</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getUnit</span><span class="p">()</span><span class="o">.</span><span class="n">unitID</span><span class="p">())</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Histograms in 00 workspace: 1
Histograms in 11 workspace: 1
X unit: Wavelength
</pre></div>
</div>
<p><strong>Example - full data reduction with polarized sample</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ReflectometryILLAutoProcess</span><span class="p">(</span>
    <span class="n">PolarizationOption</span><span class="o">=</span><span class="s1">&#39;Polarized&#39;</span><span class="p">,</span>
    <span class="n">PolarizationEfficiencyFile</span><span class="o">=</span><span class="s1">&#39;2019_09_11_Polfac.txt&#39;</span><span class="p">,</span>
    <span class="n">Run00</span><span class="o">=</span><span class="s1">&#39;493143,493147&#39;</span><span class="p">,</span>
    <span class="n">Run01</span><span class="o">=</span><span class="s1">&#39;493146,493150&#39;</span><span class="p">,</span>
    <span class="n">Run10</span><span class="o">=</span><span class="s1">&#39;493144,493148&#39;</span><span class="p">,</span>
    <span class="n">Run11</span><span class="o">=</span><span class="s1">&#39;493145,493149&#39;</span><span class="p">,</span>
    <span class="n">DirectRun</span><span class="o">=</span><span class="s1">&#39;493151&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">outm</span><span class="p">,</span>
    <span class="n">AngleOption</span><span class="o">=</span><span class="s1">&#39;DetectorAngle&#39;</span><span class="p">,</span>
    <span class="n">SummationType</span><span class="o">=</span><span class="s1">&#39;Incoherent&#39;</span><span class="p">,</span>
    <span class="n">WavelengthLowerBound</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">WavelengthUpperBound</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">DeltaQFractionBinning</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">DirectLowAngleFrgHalfWidth</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span>
    <span class="n">DirectHighAngleFrgHalfWidth</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span>
    <span class="n">ReflLowAngleFrgHalfWidth</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span>
    <span class="n">ReflHighAngleFrgHalfWidth</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span>
    <span class="n">DirectLowAngleBkgOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">DirectLowAngleBkgWidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">DirectHighAngleBkgOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">DirectHighAngleBkgWidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">ReflLowAngleBkgOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">ReflLowAngleBkgWidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">ReflHighAngleBkgOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">ReflHighAngleBkgWidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">ReflFitStartWorkspaceIndex</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
    <span class="n">ReflFitEndWorkspaceIndex</span><span class="o">=</span><span class="mi">230</span><span class="p">,</span>
    <span class="n">DirectFitStartWorkspaceIndex</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
    <span class="n">DirectFitEndWorkspaceIndex</span><span class="o">=</span><span class="mi">230</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="conversion-to-momentum-exchange">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Conversion to momentum exchange</a><a class="headerlink" href="#conversion-to-momentum-exchange" title="Permalink to this heading">¶</a></h2>
<p>This algorithm is the last step in the reflectometry reduction workflow. Its main purpose is to convert reflectivity workspaces from wavelength to momentum transfer. This is achieved by <a class="reference internal" href="../algorithms/ReflectometryMomentumTransfer-v1.html#algm-reflectometrymomentumtransfer"><span class="std std-ref">ReflectometryMomentumTransfer</span></a>, which also computes the <span class="math notranslate nohighlight">\(Q_{z}\)</span> resolution. Further, histogrammed <em>InputWorkspace</em> is converted to point data by <a class="reference internal" href="../algorithms/ConvertToPointData-v1.html#algm-converttopointdata"><span class="std std-ref">ConvertToPointData</span></a> and, optionally, the points are grouped according to the <span class="math notranslate nohighlight">\(Q_{z}\)</span> resolution.</p>
<p>If the instrument is FIGARO, and <em>ThetaCorrection</em> is defined, the second step of the gravity correction is performed, where the gravity-corrected reflection angle is taken into account, and the X-axis transformed to momentum exchange replaces the X-axis of the <em>OutputWorkspace</em>.</p>
<p>The diagram below shows the workflow of this algorithm:</p>
<img alt="../_images/ReflectometryILLConvertToQ-v1_wkflw.svg" src="../_images/ReflectometryILLConvertToQ-v1_wkflw.svg" /><p>The algorithm expects to find a <code class="docutils literal notranslate"><span class="pre">foreground.summation_type</span></code> entry in the <em>InputWorkspace</em>’s sample logs containing either <code class="docutils literal notranslate"><span class="pre">SumInLambda</span></code> or <code class="docutils literal notranslate"><span class="pre">SumInQ</span></code>. This entry should be defined when processing was done in the <a class="reference internal" href="../algorithms/ReflectometryILLAutoProcess-v1.html#algm-reflectometryillautoprocess"><span class="std std-ref">ReflectometryILLAutoProcess</span></a> algorithm, as it is automatically added to the workspace in <a class="reference internal" href="../algorithms/ReflectometryILLSumForeground-v1.html#algm-reflectometryillsumforeground"><span class="std std-ref">ReflectometryILLSumForeground</span></a>.</p>
</section>
<section id="full-data-reduction-examples">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Full data reduction examples</a><a class="headerlink" href="#full-data-reduction-examples" title="Permalink to this heading">¶</a></h2>
<p>Below there is a number of full reduction examples utilizing <a class="reference internal" href="../algorithms/ReflectometryILLAutoProcess-v1.html#algm-reflectometryillautoprocess"><span class="std std-ref">ReflectometryILLAutoProcess</span></a> algorithm to handle the workflows.</p>
<section id="d17-sample-angle-incoherent-summation">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">D17 sample angle, incoherent summation</a><a class="headerlink" href="#d17-sample-angle-incoherent-summation" title="Permalink to this heading">¶</a></h3>
<p>The example below shows a silicon oxide reduction with coherent summation at two different angular positions (detector-defined) of a quartz sample measured by D17 instrument in the cycle 192.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># reduction based on data from cycle 192, internalUse, silicon oxide sample</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;SiO2&#39;</span>
<span class="n">directBeams</span> <span class="o">=</span> <span class="s1">&#39;541838,541839&#39;</span>
<span class="n">reflectedBeams</span> <span class="o">=</span> <span class="s1">&#39;541853,541854&#39;</span>
<span class="n">foregroundWidth</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">angleOffset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">angleWidth</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">ReflectometryILLAutoProcess</span><span class="p">(</span>
   <span class="n">Run</span><span class="o">=</span><span class="n">reflectedBeams</span><span class="p">,</span>
   <span class="n">DirectRun</span><span class="o">=</span><span class="n">directBeams</span><span class="p">,</span>
   <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
   <span class="n">SummationType</span><span class="o">=</span><span class="s1">&#39;Coherent&#39;</span><span class="p">,</span>
   <span class="n">AngleOption</span><span class="o">=</span><span class="s1">&#39;DetectorAngle&#39;</span><span class="p">,</span>
   <span class="n">DeltaQFractionBinning</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
   <span class="n">DirectLowAngleFrgHalfWidth</span><span class="o">=</span><span class="n">foregroundWidth</span><span class="p">,</span>
   <span class="n">DirectHighAngleFrgHalfWidth</span><span class="o">=</span><span class="n">foregroundWidth</span><span class="p">,</span>
   <span class="n">DirectLowAngleBkgOffset</span><span class="o">=</span><span class="n">angleOffset</span><span class="p">,</span>
   <span class="n">DirectLowAngleBkgWidth</span><span class="o">=</span><span class="n">angleWidth</span><span class="p">,</span>
   <span class="n">DirectHighAngleBkgOffset</span><span class="o">=</span><span class="n">angleOffset</span><span class="p">,</span>
   <span class="n">DirectHighAngleBkgWidth</span><span class="o">=</span><span class="n">angleWidth</span><span class="p">,</span>
   <span class="n">ReflLowAngleFrgHalfWidth</span><span class="o">=</span><span class="n">foregroundWidth</span><span class="p">,</span>
   <span class="n">ReflHighAngleFrgHalfWidth</span><span class="o">=</span><span class="n">foregroundWidth</span><span class="p">,</span>
   <span class="n">ReflLowAngleBkgOffset</span><span class="o">=</span><span class="n">angleOffset</span><span class="p">,</span>
   <span class="n">ReflLowAngleBkgWidth</span><span class="o">=</span><span class="n">angleWidth</span><span class="p">,</span>
   <span class="n">ReflHighAngleBkgOffset</span><span class="o">=</span><span class="n">angleOffset</span><span class="p">,</span>
   <span class="n">ReflHighAngleBkgWidth</span><span class="o">=</span><span class="n">angleWidth</span><span class="p">,</span>
   <span class="n">WavelengthLowerBound</span><span class="o">=</span><span class="p">[</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span>
   <span class="n">WavelengthUpperBound</span><span class="o">=</span><span class="p">[</span><span class="mf">27.</span><span class="p">,</span> <span class="mf">25.</span><span class="p">],</span>
   <span class="n">GlobalScaleFactor</span><span class="o">=</span><span class="mf">0.13</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of output workspaces: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">getNumberOfEntries</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Momentum exchange ranges: </span><span class="si">{:.4f}</span><span class="s2">, </span><span class="si">{:.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mtd</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X unit: &#39;</span> <span class="o">+</span> <span class="n">mtd</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getUnit</span><span class="p">()</span><span class="o">.</span><span class="n">unitID</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Number of output workspaces: 3
Momentum exchange ranges: 0.0066, 0.2522
X unit: MomentumTransfer
</pre></div>
</div>
</section>
<section id="d17-user-angle-incoherent-summation">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">D17 user angle, incoherent summation</a><a class="headerlink" href="#d17-user-angle-incoherent-summation" title="Permalink to this heading">¶</a></h3>
<p>The example below shows a quartz reduction with incoherent summation at four different angular positions (user-defined) of a quartz sample measured by D17 instrument in the cycle 213.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># reduction based on data from cycle 213, internalUse, quartz sample</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;D17_Quartz_213&#39;</span>
<span class="n">direct_beams</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;676978&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">reflected_beams</span> <span class="o">=</span> <span class="s1">&#39;676979,676980,676981+676982,676983+676985&#39;</span>
<span class="n">wavelength_lower</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">wavelength_upper</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">user_angles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.406</span><span class="p">,</span> <span class="mf">0.806</span><span class="p">,</span> <span class="mf">1.609</span><span class="p">,</span> <span class="mf">3.207</span><span class="p">]</span>
<span class="n">ReflectometryILLAutoProcess</span><span class="p">(</span>
   <span class="n">Run</span><span class="o">=</span><span class="n">reflected_beams</span><span class="p">,</span>
   <span class="n">DirectRun</span><span class="o">=</span><span class="n">direct_beams</span><span class="p">,</span>
   <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
   <span class="n">SummationType</span><span class="o">=</span><span class="s1">&#39;Incoherent&#39;</span><span class="p">,</span>
   <span class="n">WavelengthLowerBound</span><span class="o">=</span><span class="n">wavelength_lower</span><span class="p">,</span>
   <span class="n">WavelengthUpperBound</span><span class="o">=</span><span class="n">wavelength_upper</span><span class="p">,</span>
   <span class="n">DeltaQFractionBinning</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
   <span class="n">AngleOption</span><span class="o">=</span><span class="s1">&#39;UserAngle&#39;</span><span class="p">,</span>
   <span class="n">Theta</span><span class="o">=</span><span class="n">user_angles</span><span class="p">,</span>
   <span class="n">DirectLowAngleFrgHalfWidth</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
   <span class="n">DirectHighAngleFrgHalfWidth</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
   <span class="n">ReflLowAngleFrgHalfWidth</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
   <span class="n">ReflHighAngleFrgHalfWidth</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
   <span class="n">DirectLowAngleBkgOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
   <span class="n">DirectLowAngleBkgWidth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
   <span class="n">DirectHighAngleBkgOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
   <span class="n">DirectHighAngleBkgWidth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
   <span class="n">ReflLowAngleBkgOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
   <span class="n">ReflLowAngleBkgWidth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
   <span class="n">ReflHighAngleBkgOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
   <span class="n">ReflHighAngleBkgWidth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of output workspaces: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">getNumberOfEntries</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Momentum exchange ranges: </span><span class="si">{:.4f}</span><span class="s2">, </span><span class="si">{:.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mtd</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X unit: &#39;</span> <span class="o">+</span> <span class="n">mtd</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getUnit</span><span class="p">()</span><span class="o">.</span><span class="n">unitID</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Number of output workspaces: 5
Momentum exchange ranges: 0.0148, 0.1151
X unit: MomentumTransfer
</pre></div>
</div>
</section>
<section id="figaro-detector-angle-gravity-correction">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">FIGARO detector angle, gravity correction</a><a class="headerlink" href="#figaro-detector-angle-gravity-correction" title="Permalink to this heading">¶</a></h3>
<p>In this example, FIGARO data from cycle 212, exp_EASY-952 at two separate angular positions is reduced according to the workflow described in previous sections.
This reduction includes the gravity correction, which is set explicitly via <cite>CorrectGravity</cite> property.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># reduction based on data from cycle 212, exp_EASY-952</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Cell_d2O&#39;</span>
<span class="n">runs</span> <span class="o">=</span> <span class="s1">&#39;743465,743466&#39;</span>
<span class="n">direct_run</span> <span class="o">=</span> <span class="s1">&#39;732252+732254,732255&#39;</span>
<span class="n">ReflectometryILLAutoProcess</span><span class="p">(</span>
      <span class="n">Run</span><span class="o">=</span><span class="n">runs</span><span class="p">,</span>
      <span class="n">DirectRun</span><span class="o">=</span><span class="n">direct_run</span><span class="p">,</span>
      <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
      <span class="n">AngleOption</span><span class="o">=</span><span class="s1">&#39;DetectorAngle&#39;</span><span class="p">,</span>
      <span class="n">SummationType</span><span class="o">=</span><span class="s1">&#39;Incoherent&#39;</span><span class="p">,</span>
      <span class="n">WavelengthLowerBound</span><span class="o">=</span><span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span>
      <span class="n">WavelengthUpperBound</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">19</span><span class="p">],</span>
      <span class="n">DeltaQFractionBinning</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
      <span class="n">GlobalScaleFactor</span><span class="o">=</span><span class="mf">0.0484221</span><span class="p">,</span>
      <span class="n">Cleanup</span><span class="o">=</span><span class="s1">&#39;Cleanup ON&#39;</span><span class="p">,</span>
      <span class="n">ReflFitStartWorkspaceIndex</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
      <span class="n">ReflFitEndWorkspaceIndex</span><span class="o">=</span><span class="mi">230</span><span class="p">,</span>
      <span class="n">DirectFitStartWorkspaceIndex</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
      <span class="n">DirectFitEndWorkspaceIndex</span><span class="o">=</span><span class="mi">230</span><span class="p">,</span>
      <span class="n">DirectLowAngleFrgHalfWidth</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
      <span class="n">DirectHighAngleFrgHalfWidth</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
      <span class="n">ReflLowAngleFrgHalfWidth</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
      <span class="n">ReflHighAngleFrgHalfWidth</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
      <span class="n">DirectLowAngleBkgOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
      <span class="n">DirectLowAngleBkgWidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
      <span class="n">DirectHighAngleBkgOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
      <span class="n">DirectHighAngleBkgWidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
      <span class="n">ReflLowAngleBkgOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
      <span class="n">ReflLowAngleBkgWidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
      <span class="n">ReflHighAngleBkgOffset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
      <span class="n">ReflHighAngleBkgWidth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
      <span class="n">ReflFlatBackground</span><span class="o">=</span><span class="s1">&#39;Background Average&#39;</span><span class="p">,</span>
      <span class="n">DirectFlatBackground</span><span class="o">=</span><span class="s1">&#39;Background Average&#39;</span><span class="p">,</span>
      <span class="n">CorrectGravity</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of output workspaces: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">getNumberOfEntries</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Momentum exchange ranges: </span><span class="si">{:.4f}</span><span class="s2">, </span><span class="si">{:.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mtd</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X unit: &#39;</span> <span class="o">+</span> <span class="n">mtd</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getUnit</span><span class="p">()</span><span class="o">.</span><span class="n">unitID</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Number of output workspaces: 3
Momentum exchange ranges: 0.0092, 0.2785
X unit: MomentumTransfer
</pre></div>
</div>
</section>
<section id="references">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">References</a><a class="headerlink" href="#references" title="Permalink to this heading">¶</a></h3>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="gutfreund" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Gutfreund P., Saerbeck T., Gonzalez M., Pellegrini E., Dewhurst C., Cubitt R.
<em>Towards generalized data reduction on a chopper-based time-of-flight neutron reflectometer</em>,
<a class="reference external" href="https://doi.org/10.1107/S160057671800448X">J. Appl. Cryst. (2018). 51, 606-615,</a></p>
</aside>
</aside>
<p><strong>Category</strong>: <a class="reference external" href="categories/Techniques.html">Techniques</a></p>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="PolarisedDiffractionILL.html" title="Previous Chapter: Data reduction for D7 instrument at the ILL"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Data reductio...</span>
    </a>
  </li>
  <li>
    <a href="SANS-Toml-v1.html" title="Next Chapter: SANS TOML Files"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SANS TOML Files &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>