<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Peaks Workspace</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plugin" href="Plugin.html" />
    <link rel="prev" title="PSI Muon Bin File" href="PSIMuonBinFile.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Concepts</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">Peaks Workspace</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="peaks-workspace">
<span id="peaksworkspace"></span><h1>Peaks Workspace<a class="headerlink" href="#peaks-workspace" title="Permalink to this heading">¶</a></h1>
<p>The PeaksWorkspace is a special Workspace that holds a list of single crystal Peak objects.</p>
<section id="creating-a-peaksworkspace">
<h2>Creating a PeaksWorkspace<a class="headerlink" href="#creating-a-peaksworkspace" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../algorithms/FindPeaksMD-v1.html#algm-findpeaksmd"><span class="std std-ref">FindPeaksMD</span></a> will find peaks in reciprocal space in a <a class="reference internal" href="MDWorkspace.html#mdworkspace"><span class="std std-ref">MDWorkspace</span></a>.</p></li>
<li><p><a class="reference internal" href="../algorithms/FindSXPeaks-v1.html#algm-findsxpeaks"><span class="std std-ref">FindSXPeaks</span></a> will find peaks in detector space.</p></li>
<li><p><a class="reference internal" href="../algorithms/PredictPeaks-v1.html#algm-predictpeaks"><span class="std std-ref">PredictPeaks</span></a> will predict peak positions in a workspace given a UB matrix.</p></li>
<li><p>The <a class="reference internal" href="../algorithms/LoadIsawPeaks-v1.html#algm-loadisawpeaks"><span class="std std-ref">LoadIsawPeaks</span></a> algorithm will load a PeaksWorkspace from file.</p></li>
<li><p>The <a class="reference internal" href="../algorithms/SaveIsawPeaks-v1.html#algm-saveisawpeaks"><span class="std std-ref">SaveIsawPeaks</span></a> algorithm will save a PeaksWorkspace to a file.</p></li>
<li><p><a class="reference internal" href="../algorithms/CreatePeaksWorkspace-v1.html#algm-createpeaksworkspace"><span class="std std-ref">CreatePeaksWorkspace</span></a> will create an empty PeaksWorkspace that you can then edit.</p></li>
</ul>
</section>
<section id="viewing-a-peaksworkspace">
<h2>Viewing a PeaksWorkspace<a class="headerlink" href="#viewing-a-peaksworkspace" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Double-click a PeaksWorkspace to see the full list of data of each Peak object.</p></li>
<li><p>In MantidWorkbench, you can drag/drop a PeaksWorkspace from the list of workspaces onto the
<a class="reference internal" href="../workbench/instrumentviewer.html#instrumentviewer"><span class="std std-ref">Instrument View</span></a>. This will overlay the peaks onto the detector face.</p></li>
<li><p><a class="reference internal" href="../workbench/sliceviewer.html#sliceviewer-peaks-overlay"><span class="std std-ref">Peaks overlay</span></a> in the <a class="reference internal" href="../workbench/sliceviewer.html#sliceviewer"><span class="std std-ref">Sliceviewer</span></a>.</p></li>
</ul>
<p>Each peak object contains several pieces of information. Not all of them are necessary</p>
<ul class="simple">
<li><p>Detector position and wavelength</p></li>
<li><p>Q position (calculated from the detector position/wavelength)</p></li>
<li><p>H K L indices (optional)</p></li>
<li><p>Goniometer rotation matrix (for finding Q in the sample frame)</p></li>
<li><p>Integrated intensity and error (optional)</p></li>
<li><p>Row/column of detector (only for <a class="reference internal" href="RectangularDetector.html#rectangulardetector"><span class="std std-ref">RectangularDetectors</span></a> )</p></li>
<li><p>An integration shape (see below)</p></li>
</ul>
<section id="the-peak-shape">
<span id="id1"></span><h3>The Peak Shape<a class="headerlink" href="#the-peak-shape" title="Permalink to this heading">¶</a></h3>
<p>Each Peak object contains a PeakShape. Only the integration algorithms which act on, and return PeaksWorkspaces set the shape of the peaks. The PeakShape is owned by the Peak, not the PeaksWorkspace, so when PeaksWorkspaces are split, or concatinated, the integration shapes are unaltered. Aside from the Null Peak Shape, each peak shape contains at least the following information.</p>
<ul class="simple">
<li><p>The algorithm used to perform the integration</p></li>
<li><p>The version of the algorithm used to perform the integration</p></li>
<li><p>The frame in which the integration has been performed</p></li>
</ul>
<p>Subtypes of PeakShape will then provide additional information. For example PeakShapeSpherical provides the radius as well as background inner, and background outer radius.</p>
</section>
</section>
<section id="calculate-goniometer-for-constant-wavelength">
<h2>Calculate Goniometer For Constant Wavelength<a class="headerlink" href="#calculate-goniometer-for-constant-wavelength" title="Permalink to this heading">¶</a></h2>
<p>If you set the <cite>wavelength</cite> (in Å) or <cite>energy</cite> (in meV) property on a
PeaksWorkspace, or if the instrument on the PeaksWorkspace has the
<cite>wavelength</cite> parameter, the goniometer rotation will be calculated
when the createPeak method is used. This allows you to use one
instrument definition for multiple goniometer rotations, for example
adding peaks in Slice Viewer from multiple combined MD workspaces. It
only works for a constant wavelength source and only for Q sample
workspaces. It also assumes the goniometer rotation is around the
y-axis only. For details on the calculation see “Calculate Goniometer
For Constant Wavelength” at <a class="reference internal" href="../algorithms/FindPeaksMD-v1.html#algm-findpeaksmd"><span class="std std-ref">FindPeaksMD</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;name_of_peaks_workspace&#39;</span><span class="p">]</span>
<span class="n">pws</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="mf">1.54</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="c1"># or</span>
<span class="n">pws</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">addProperty</span><span class="p">(</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="mf">34.48</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="using-peaksworkspaces-in-python">
<h2>Using PeaksWorkspaces in Python<a class="headerlink" href="#using-peaksworkspaces-in-python" title="Permalink to this heading">¶</a></h2>
<p>The PeaksWorkspace and Peak objects are exposed to python.</p>
<section id="peaksworkspace-python-interface">
<h3>PeaksWorkspace Python Interface<a class="headerlink" href="#peaksworkspace-python-interface" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;name_of_peaks_workspace&#39;</span><span class="p">]</span>
<span class="n">pws</span><span class="o">.</span><span class="n">getNumberPeaks</span><span class="p">()</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pws</span><span class="o">.</span><span class="n">getPeak</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">pws</span><span class="o">.</span><span class="n">removePeak</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="peak-python-interface">
<h3>Peak Python Interface<a class="headerlink" href="#peak-python-interface" title="Permalink to this heading">¶</a></h3>
<p>You can get a handle to an existing peak with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">pws</span><span class="o">.</span><span class="n">getPeak</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<p>Or you can create a new peak in this way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">qlab</span> <span class="o">=</span> <span class="n">V3D</span><span class="p">(</span><span class="mf">1.23</span><span class="p">,</span> <span class="mf">3.45</span><span class="p">,</span> <span class="mf">2.22</span><span class="p">)</span> <span class="c1"># Q in the lab frame of the peak</span>
<span class="n">detector_distance</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="c1"># sample-detector distance in meters. Detector distances are optional. Calculated in not provided.</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pws</span><span class="o">.</span><span class="n">createPeak</span><span class="p">(</span><span class="n">qlab</span><span class="p">,</span> <span class="n">detector_distance</span><span class="p">)</span>
<span class="c1"># The peak can later be added to the workspace</span>
<span class="n">pws</span><span class="o">.</span><span class="n">addPeak</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>Once you have a handle on a peak “p” you have several methods to query/modify its values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">hkl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getHKL</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">setHKL</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getQSampleFrame</span><span class="p">()</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getQLabFrame</span><span class="p">()</span>
<span class="n">detid</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getDetectorID</span><span class="p">()</span>

<span class="n">p</span><span class="o">.</span><span class="n">setIntensity</span><span class="p">(</span><span class="mf">1000.0</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">setSigmaIntensity</span><span class="p">(</span><span class="mf">31.6</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getIntensity</span><span class="p">()</span>

<span class="n">wl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getWavelength</span><span class="p">()</span>
<span class="n">tof</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getTOF</span><span class="p">()</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getDSpacing</span><span class="p">()</span>
<span class="n">shape</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getPeakShape</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Category</strong>: <a class="reference external" href="../api/python/mantid/api/categories/Concepts.html">Concepts</a></p>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="PSIMuonBinFile.html" title="Previous Chapter: PSI Muon Bin File"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; PSI Muon Bin File</span>
    </a>
  </li>
  <li>
    <a href="Plugin.html" title="Next Chapter: Plugin"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Plugin &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>