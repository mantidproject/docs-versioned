<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SANSStitch v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=5b08953a"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SANSSubtract v1" href="SANSSubtract-v1.html" />
    <link rel="prev" title="SANSSolidAngleCorrection v1" href="SANSSolidAngleCorrection-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">SANSStitch v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="sansstitch-v1">
<span id="algm-sansstitch"></span><span id="algm-sansstitch-v1"></span><h1>SANSStitch v1<a class="headerlink" href="#sansstitch-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p>
<ul>
<li><p><a class="reference internal" href="#fit-modes" id="id5">Fit Modes</a></p></li>
<li><p><a class="reference internal" href="#can-runs" id="id6">Can Runs</a></p></li>
<li><p><a class="reference internal" href="#workflow" id="id7">Workflow</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#usage" id="id8">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id9">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Stitch the high angle and low angle banks of a workspace together</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HABCountsSample</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>High angle bank sample workspace in Q</p></td>
</tr>
<tr class="row-odd"><td><p>HABNormSample</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>High angle bank normalization workspace in Q</p></td>
</tr>
<tr class="row-even"><td><p>LABCountsSample</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Low angle bank sample workspace in Q</p></td>
</tr>
<tr class="row-odd"><td><p>LABNormSample</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Low angle bank normalization workspace in Q</p></td>
</tr>
<tr class="row-even"><td><p>ProcessCan</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Process the can</p></td>
</tr>
<tr class="row-odd"><td><p>HABCountsCan</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>High angle bank sample workspace in Q</p></td>
</tr>
<tr class="row-even"><td><p>HABNormCan</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>High angle bank normalization workspace in Q</p></td>
</tr>
<tr class="row-odd"><td><p>LABCountsCan</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>Low angle bank sample workspace in Q</p></td>
</tr>
<tr class="row-even"><td><p>LABNormCan</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>Low angle bank normalization workspace in Q</p></td>
</tr>
<tr class="row-odd"><td><p>Mode</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>None</p></td>
<td><p>What to fit. Free parameter(s). Allowed values: [‘ShiftOnly’, ‘ScaleOnly’, ‘Both’, ‘None’]</p></td>
</tr>
<tr class="row-even"><td><p>ScaleFactor</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Optional scaling factor</p></td>
</tr>
<tr class="row-odd"><td><p>ShiftFactor</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Optional shift factor</p></td>
</tr>
<tr class="row-even"><td><p>FitMin</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Optional minimum q for fit</p></td>
</tr>
<tr class="row-odd"><td><p>FitMax</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1000</p></td>
<td><p>Optional maximum q for fit</p></td>
</tr>
<tr class="row-even"><td><p>MergeMask</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Controls whether the user has manually specified the merge region</p></td>
</tr>
<tr class="row-odd"><td><p>MergeMin</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>The minimum of the merge region in q</p></td>
</tr>
<tr class="row-even"><td><p>MergeMax</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1000</p></td>
<td><p>The maximum of the merge region in q</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Stitched high and low Q 1-D data</p></td>
</tr>
<tr class="row-even"><td><p>OutScaleFactor</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>Applied scale factor</p></td>
</tr>
<tr class="row-odd"><td><p>OutShiftFactor</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>Applied shift factor</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This algorithm is used to stitch together reduced data typically provided by <a class="reference internal" href="Q1D-v2.html#algm-q1d"><span class="std std-ref">Q1D v2</span></a>. Data from high-angle and low-angle banks in a SANS experiment can be stitched together using this algorithm.</p>
<p>Merging of inputs is achieved using the following foruma, where <em>C</em> denotes counts, <em>N</em> denotes normalization and <em>f</em> and <em>r</em> relate to forward (high-angle) and rear (low-angle) respectively:</p>
<div class="math notranslate nohighlight">
\[\frac{C_f(Q)+(shift\cdot N_f(Q))+C_r(Q)}{\frac{N_f(Q)}{scale} + N_r(Q)}\]</div>
<section id="fit-modes">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Fit Modes</a><a class="headerlink" href="#fit-modes" title="Link to this heading">¶</a></h3>
<p>There are 4 available fit modes used to scale and shift the high angle bank data so that it can be stitched together with the low angle bank data. Where fitting is required <a class="reference internal" href="Fit-v1.html#algm-fit"><span class="std std-ref">Fit v1</span></a> is used with a composite function comprised of a <em>FlatBackground</em> and <em>TabulatedFunction</em>. In all cases the shift and scale are used to alter the counts and errors for the high angle bank.</p>
<p><em>None</em> is the mode for no fit determined scaling or shifting. In this case the <em>ScaleFactor</em> and <em>ShiftFactor</em> properties must both be provided. With <em>Both</em>, fitting is used to establish optimum parameters for both the scaling and shifting of the high angle bank data. <em>ScaleOnly</em> mode ties the shift, so <em>ShiftFactor</em> must be provided. <em>ShiftOnly</em> mode ties the scale so <em>ScaleFactor</em> must be provided.</p>
</section>
<section id="can-runs">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Can Runs</a><a class="headerlink" href="#can-runs" title="Link to this heading">¶</a></h3>
<p>When can runs are provided they are processed separately using the same merge formula above, and then subtracted from the processed sample run. If can runs are provided as inputs then the scale and shift factors are determined as part of fitting by operating on a workspace calculated from:</p>
<div class="math notranslate nohighlight">
\[\frac{C_{sample}(Q)}{N_{sample}(Q)} - \frac{C_{can}(Q)}{N_{can}(Q)}\]</div>
<p>This is analogous to how <a class="reference internal" href="Q1D-v2.html#algm-q1d"><span class="std std-ref">Q1D v2</span></a> operates on input workspaces.</p>
<p>Merging of front and rear banks for the can is achieved using a different form from that above.</p>
<div class="math notranslate nohighlight">
\[\frac{C_f(Q)+C_r(Q)}{\frac{N_f(Q)}{scale} + N_r(Q)}\]</div>
<p>where <em>C</em> denotes counts, <em>N</em> denotes normalization and <em>f</em> and <em>r</em> relate to forward (high-angle) and rear (low-angle) respectively. The can workspace is subtracted from the merged sample workspace to generate the output.</p>
</section>
<section id="workflow">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Workflow</a><a class="headerlink" href="#workflow" title="Link to this heading">¶</a></h3>
<figure class="align-default" id="id1">
<img alt="../_images/ImageNotFound.png" src="../_images/ImageNotFound.png" />
<figcaption>
<p><span class="caption-text">diagram generation was disabled</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - Simple shift:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">hab_counts</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">DataX</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">DataY</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">UnitX</span><span class="o">=</span><span class="s1">&#39;MomentumTransfer&#39;</span><span class="p">)</span>
<span class="n">hab_norm</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">DataX</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">DataY</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">UnitX</span><span class="o">=</span><span class="s1">&#39;MomentumTransfer&#39;</span><span class="p">)</span>
<span class="n">lab_counts</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">DataX</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">DataY</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">UnitX</span><span class="o">=</span><span class="s1">&#39;MomentumTransfer&#39;</span><span class="p">)</span>
<span class="n">lab_norm</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">DataX</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">DataY</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">UnitX</span><span class="o">=</span><span class="s1">&#39;MomentumTransfer&#39;</span><span class="p">)</span>

<span class="n">uniform_binning</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">hab_counts</span> <span class="o">=</span> <span class="n">Rebin</span><span class="p">(</span><span class="n">hab_counts</span><span class="p">,</span> <span class="n">Params</span><span class="o">=</span><span class="n">uniform_binning</span><span class="p">)</span>
<span class="n">hab_norm</span> <span class="o">=</span> <span class="n">Rebin</span><span class="p">(</span><span class="n">hab_norm</span><span class="p">,</span> <span class="n">Params</span><span class="o">=</span><span class="n">uniform_binning</span><span class="p">)</span>
<span class="n">lab_counts</span> <span class="o">=</span> <span class="n">Rebin</span><span class="p">(</span><span class="n">lab_counts</span><span class="p">,</span> <span class="n">Params</span><span class="o">=</span><span class="n">uniform_binning</span><span class="p">)</span>
<span class="n">lab_norm</span> <span class="o">=</span> <span class="n">Rebin</span><span class="p">(</span><span class="n">lab_norm</span><span class="p">,</span> <span class="n">Params</span><span class="o">=</span><span class="n">uniform_binning</span><span class="p">)</span>

<span class="n">stitched</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">shift</span> <span class="o">=</span> <span class="n">SANSStitch</span><span class="p">(</span><span class="n">HABCountsSample</span><span class="o">=</span><span class="n">hab_counts</span><span class="p">,</span>
    <span class="n">HABNormSample</span><span class="o">=</span><span class="n">hab_norm</span><span class="p">,</span>
    <span class="n">LABCountsSample</span><span class="o">=</span><span class="n">lab_counts</span><span class="p">,</span>
    <span class="n">LABNormSample</span><span class="o">=</span><span class="n">lab_norm</span><span class="p">,</span>
    <span class="n">Mode</span><span class="o">=</span><span class="s1">&#39;ShiftOnly&#39;</span><span class="p">,</span> <span class="n">ScaleFactor</span><span class="o">=</span><span class="mf">1.0</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scale</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shift</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1.0
6.0
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/SANS.html">SANS</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/66c74f87d9b779695dc85b538bc48767c5975b19/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/SANSStitch.py">SANSStitch.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="SANSSolidAngleCorrection-v1.html" title="Previous Chapter: SANSSolidAngleCorrection v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; SANSSolidAngl...</span>
    </a>
  </li>
  <li>
    <a href="SANSSubtract-v1.html" title="Next Chapter: SANSSubtract v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SANSSubtract v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>