<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ModeratorTzero v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=5b08953a"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ModeratorTzeroLinear v1" href="ModeratorTzeroLinear-v1.html" />
    <link rel="prev" title="MinusMD v1" href="MinusMD-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">ModeratorTzero v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="moderatortzero-v1">
<span id="algm-moderatortzero"></span><span id="algm-moderatortzero-v1"></span><h1>ModeratorTzero v1<a class="headerlink" href="#moderatortzero-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id2">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p></li>
<li><p><a class="reference internal" href="#source" id="id5">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Corrects the time of flight of an indirect geometry instrument by a time offset that is dependent on the energy of the neutron after passing through the moderator.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="ModeratorTzeroLinear-v1.html#algm-moderatortzerolinear"><span class="std std-ref">ModeratorTzeroLinear</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The name of the input workspace, containing events and/or histogram data, in units of time-of-flight</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The name of the output workspace</p></td>
</tr>
<tr class="row-even"><td><p>EMode</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Indirect</p></td>
<td><p>The energy mode (default: Indirect). Allowed values: [‘Indirect’, ‘Direct’, ‘Elastic’]</p></td>
</tr>
<tr class="row-odd"><td><p>tolTOF</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.1</p></td>
<td><p>Tolerance in the calculation of the emission time, in microseconds (default:1)</p></td>
</tr>
<tr class="row-even"><td><p>Niter</p></td>
<td><p>Input</p></td>
<td><p>unsigned __int64</p></td>
<td><p>1</p></td>
<td><p>Number of iterations (default:1)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>Corrects the time of flight (TOF) by a time offset that is dependent
on the energy of the neutron after passing through the moderator. A
heuristic formula for the correction is stored in the instrument
definition file. Below is shown the entry in the instrument file for the
VISION beamline:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- formula for t0 calculation. See http://muparser.sourceforge.net/mup_features.html#idDef2 for available operators --&gt;</span>
<span class="nt">&lt;parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;t0_formula&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;value</span><span class="w"> </span><span class="na">val=</span><span class="s">&quot;(incidentEnergy &lt; 34.7332) ? 37.011296*incidentEnergy^(-0.052874) : (incidentEnergy &lt; 88.7556) ? 124.267307*incidentEnergy^(-0.394282) : (incidentEnergy &lt; 252.471) ? 963.775145*incidentEnergy^(-0.850919) : (incidentEnergy &lt; 420.145) ? 33.225834*incidentEnergy^(-0.242105) : (incidentEnergy &lt; 100000.0) ? 120.569231*incidentEnergy^(-0.455477) : 0.0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/parameter&gt;</span>
</pre></div>
</div>
<p>The recorded <span class="math notranslate nohighlight">\(TOF = t_0 + t_i + t_f\)</span> with</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(t_0\)</span>: emission time from the moderator</p></li>
<li><p><span class="math notranslate nohighlight">\(t_1\)</span>: time from moderator to sample or monitor</p></li>
<li><p><span class="math notranslate nohighlight">\(t_2\)</span>: time from sample to detector</p></li>
</ul>
<p>This algorithm will replace <span class="math notranslate nohighlight">\(TOF\)</span> with <span class="math notranslate nohighlight">\(TOF^* = TOF-t_0 = t_i+t_f\)</span></p>
<p>For a direct geometry instrument, the incident energy <span class="math notranslate nohighlight">\(E_1\)</span> is
the same for all neutrons. Hence, the moderator emission time is the
same for all neutrons. For an indirect geometry instrument, <span class="math notranslate nohighlight">\(E_1\)</span>
is different for each neutron and is not known. However, the final
energy <span class="math notranslate nohighlight">\(E_2\)</span> selected by the analyzers is known.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(t_0 = func(E_1)\)</span> , a function of the incident energy</p></li>
<li><p><span class="math notranslate nohighlight">\(t_1 = L_1/v_1\)</span> with <span class="math notranslate nohighlight">\(L_1\)</span> the distance from moderator to
sample, and <span class="math notranslate nohighlight">\(v_1\)</span> the initial unknown velocity (<span class="math notranslate nohighlight">\(E_1=1/2*m*v_1^2\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(t_2 = L_2/v_2\)</span> with <span class="math notranslate nohighlight">\(L_2\)</span> the distance from sample to
detector, and <span class="math notranslate nohighlight">\(v_2\)</span> is the final fixed velocity (<span class="math notranslate nohighlight">\(E_2=1/2*m*v_2^2\)</span>)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We obtain <span class="math notranslate nohighlight">\(TOF^*\)</span> as an iterative process,
taking into account the fact that the correction <span class="math notranslate nohighlight">\(t_0\)</span> is much
smaller than <span class="math notranslate nohighlight">\(t_i+t_f\)</span>. Thus
<span class="math notranslate nohighlight">\(TOF-t_0^{(n)} = L_1/v_1^{(n)} + L_2/v_2\)</span> , <span class="math notranslate nohighlight">\(n=0, 1, 2,..\)</span>
Set <span class="math notranslate nohighlight">\(t_0^{(0)}=0\)</span> and obtain <span class="math notranslate nohighlight">\(v_1^{(0)}\)</span> from the previous
formula. From <span class="math notranslate nohighlight">\(v_1^{(0)}\)</span> we obtain <span class="math notranslate nohighlight">\(E_1^{(0)}\)</span>
Set <span class="math notranslate nohighlight">\(t_0^{(1)}=func( E_1^{(0)} )\)</span> and repeat the steps until
<span class="math notranslate nohighlight">\(|t_0^{(n+1)} - t_0^{(n+1)}| &lt; tolTOF\)</span>. With
<span class="math notranslate nohighlight">\(tolTOF=0.1 microsecond\)</span>, only one iteration is needed for convergence.</p>
</div>
<p>Here’s the result of applying ModeratorTzero to both the event list and
the histogrammed data of a run in the VISION beamline. The
transformation of either events or histograms shifts the curve to
smaller TOF’s. The transformed curves are not supposed to be identical,
but similar and differentiated from the original curve.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/ModeratorTzero_Fig.1.jpeg"><img alt="Summed Histogram" src="../_images/ModeratorTzero_Fig.1.jpeg" style="width: 400px;" /></a>
</figure>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/ModeratorTzero_Fig.2.jpeg"><img alt="Elastic Line" src="../_images/ModeratorTzero_Fig.2.jpeg" style="width: 400px;" /></a>
</figure>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/ModeratorTzero_Fig.3.jpeg"><img alt="Inelastic Peaks" src="../_images/ModeratorTzero_Fig.3.jpeg" style="width: 400px;" /></a>
</figure>
<p>For indirect instruments featuring an incoming neutron flux having a
sufficiently narrow distribution of energies, a linear relationship
between <span class="math notranslate nohighlight">\(t_0\)</span> and the wavelength of the incoming neutron can be
established. This relation allows for coding of an algorithm with faster
execution times. For indirect instruments that comply with these
conditions, use of <a class="reference internal" href="ModeratorTzeroLinear-v1.html#algm-moderatortzerolinear"><span class="std std-ref">ModeratorTzeroLinear v1</span></a> is
preferred.</p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/CorrectionFunctions/InstrumentCorrections.html">CorrectionFunctions\InstrumentCorrections</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/66c74f87d9b779695dc85b538bc48767c5975b19/Framework/Algorithms/inc/MantidAlgorithms/ModeratorTzero.h">ModeratorTzero.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/66c74f87d9b779695dc85b538bc48767c5975b19/Framework/Algorithms/src/ModeratorTzero.cpp">ModeratorTzero.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="MinusMD-v1.html" title="Previous Chapter: MinusMD v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; MinusMD v1</span>
    </a>
  </li>
  <li>
    <a href="ModeratorTzeroLinear-v1.html" title="Next Chapter: ModeratorTzeroLinear v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">ModeratorTzer... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>