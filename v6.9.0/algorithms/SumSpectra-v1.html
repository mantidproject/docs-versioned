<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SumSpectra v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=5b08953a"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SwapWidths v1" href="SwapWidths-v1.html" />
    <link rel="prev" title="SumRowColumn v1" href="SumRowColumn-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">SumSpectra v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="sumspectra-v1">
<span id="algm-sumspectra"></span><span id="algm-sumspectra-v1"></span><h1>SumSpectra v1<a class="headerlink" href="#sumspectra-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id2">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id5">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id6">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>The SumSpectra algorithm adds the data values in each time bin across a range of spectra; the output workspace has a single spectrum. If the input is an EventWorkspace, the output is also an EventWorkspace; otherwise it will be a Workspace2D.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="SumNeighbours-v1.html#algm-sumneighbours"><span class="std std-ref">SumNeighbours</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The workspace containing the spectra to be summed.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The name of the workspace to be created as the output of the algorithm.  A workspace of this name will be created and stored in the Analysis Data Service.</p></td>
</tr>
<tr class="row-even"><td><p>StartWorkspaceIndex</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>The first Workspace index to be included in the summing</p></td>
</tr>
<tr class="row-odd"><td><p>EndWorkspaceIndex</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The last Workspace index to be included in the summing</p></td>
</tr>
<tr class="row-even"><td><p>ListOfWorkspaceIndices</p></td>
<td><p>Input</p></td>
<td><p>int list</p></td>
<td></td>
<td><p>A list of workspace indices as a string with ranges, for example: 5-10,15,20-23.  Optional: if not specified, then the Start/EndWorkspaceIndex fields are used alone. If specified, the range and the list are combined (without duplicating indices). For example, a range of 10 to 20 and a list ‘12,15,26,28’ gives ‘10-20,26,28’.</p></td>
</tr>
<tr class="row-odd"><td><p>IncludeMonitors</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Whether to include monitor spectra in the summation.</p></td>
</tr>
<tr class="row-even"><td><p>WeightedSum</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Instead of the usual spectra sum, calculate the weighted sum. This has the form:  <span class="math notranslate nohighlight">\(nSpectra \times\Sigma(Signal_i/Error_i^2)/\Sigma(1/Error_i^2)\)</span>  This property is ignored for event workspace. The sums are defined for <span class="math notranslate nohighlight">\(Error_i != 0\)</span> only, so the values with zero error are dropped from the summation. To estimate the number of dropped values see the description.</p></td>
</tr>
<tr class="row-odd"><td><p>RemoveSpecialValues</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If enabled floating point special values such as NaN or Inf are removed before the spectra are summed.</p></td>
</tr>
<tr class="row-even"><td><p>MultiplyBySpectra</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>For unnormalized data one should multiply the weighted sum by the number of spectra contributing to the bin.</p></td>
</tr>
<tr class="row-odd"><td><p>UseFractionalArea</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Normalize the output workspace to the fractional area for RebinnedOutput workspaces.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>Takes a workspace as input and sums all of the spectra within it
maintaining the existing bin structure and units. Any masked spectra are
ignored. The result is stored as a new workspace containing a single
spectra.</p>
<p>If we define a the <span class="math notranslate nohighlight">\(i^{th}\)</span> spectrum with bins <span class="math notranslate nohighlight">\(j\)</span>. The unweighted sum is just (<code class="docutils literal notranslate"><span class="pre">WeightedSum=False</span></code>)</p>
<div class="math notranslate nohighlight">
\[Signal[j] = \displaystyle\Sigma_{i \in spectra} Signal_i[j]\]</div>
<p>The weighted sum (<code class="docutils literal notranslate"><span class="pre">WeightedSum=True</span></code> and <code class="docutils literal notranslate"><span class="pre">MultiplyBySpectra=True</span></code>, ignored for event workspaces), the sum is defined (skipping <span class="math notranslate nohighlight">\(Signal_i[j]\)</span> when <span class="math notranslate nohighlight">\(Error_i[j] == 0\)</span>),</p>
<div class="math notranslate nohighlight">
\[Signal[j] = NSpectra \times \displaystyle\Sigma_{i \in spectra} \left(\frac{Signal_i[j]}{Error_i^2[j]}\right) / \Sigma_{i \in spectra}\left(\frac{1}{Error_i^2[j]}\right)\]</div>
<p><span class="math notranslate nohighlight">\(NSpectra\)</span> is the number of spectra contributing to that bin. If the weights contributing to the sum are equal, these result in the same value. This should be used for unnormalized (e.g. not divided by vanadium spectrum) data. If the data has been normalized (e.g. divided by vanadium spectrum for total scattering) then multiplying by the number of spectra contributing to the bin is incorrect, use <code class="docutils literal notranslate"><span class="pre">WeightedSum=True</span></code> and <code class="docutils literal notranslate"><span class="pre">MultiplyBySpectra=False</span></code> to sum as</p>
<div class="math notranslate nohighlight">
\[Signal[j] = \displaystyle\Sigma_{i \in spectra} \left(\frac{Signal_i[j]}{Error_i^2[j]}\right) / \Sigma_{i \in spectra}\left(\frac{1}{Error_i^2[j]}\right)\]</div>
<p>The algorithm adds to the <code class="docutils literal notranslate"><span class="pre">OutputWorkspace</span></code> three additional
properties (Log values). The properties (Log) names are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">NumAllSpectra</span></code> is the number of spectra contributed to the sum</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NumMaskSpectra</span></code> is the spectra dropped from the summations because they are masked. Monitors are not included in this total if <code class="docutils literal notranslate"><span class="pre">IncludeMonitors=False</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NumZeroSpectra</span></code> is the number of zero bins in histogram workspace or empty spectra for event workspace. These spectra are dropped from the summation of histogram workspace when <code class="docutils literal notranslate"><span class="pre">WeightedSum=True</span></code>.</p></li>
</ul>
<p>Assuming <code class="docutils literal notranslate"><span class="pre">pWS</span></code> is the output workspace handle, from Python these
properties can be accessed using:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nSpectra</span>       <span class="o">=</span> <span class="n">pWS</span><span class="o">.</span><span class="n">getRun</span><span class="p">()</span><span class="o">.</span><span class="n">getLogData</span><span class="p">(</span><span class="s2">&quot;NumAllSpectra&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
<span class="n">nMaskedSpectra</span> <span class="o">=</span> <span class="n">pWS</span><span class="o">.</span><span class="n">getRun</span><span class="p">()</span><span class="o">.</span><span class="n">getLogData</span><span class="p">(</span><span class="s2">&quot;NumMaskSpectra&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
<span class="n">nZeroSpectra</span>   <span class="o">=</span> <span class="n">pWS</span><span class="o">.</span><span class="n">getRun</span><span class="p">()</span><span class="o">.</span><span class="n">getLogData</span><span class="p">(</span><span class="s2">&quot;NumZeroSpectra&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - a simple example of running SumSpectra.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="s2">&quot;Histogram&quot;</span><span class="p">,</span> <span class="n">Random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workspace has </span><span class="si">%d</span><span class="s2"> spectra&quot;</span> <span class="o">%</span> <span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">())</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">SumSpectra</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workspace has </span><span class="si">%d</span><span class="s2"> spectra&quot;</span> <span class="o">%</span> <span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">())</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Workspace has 200 spectra
Workspace has 1 spectra
</pre></div>
</div>
<p><strong>Example - running SumSpectra with a list of indices.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="s2">&quot;Histogram&quot;</span><span class="p">,</span> <span class="n">Random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workspace has </span><span class="si">%d</span><span class="s2"> spectra&quot;</span> <span class="o">%</span> <span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">())</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">SumSpectra</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">ListOfWorkspaceIndices</span><span class="o">=</span><span class="s1">&#39;0-3, 10-13&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workspace has </span><span class="si">%d</span><span class="s2"> spectra&quot;</span> <span class="o">%</span> <span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">())</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Workspace has 200 spectra
Workspace has 1 spectra
</pre></div>
</div>
<p><strong>Example - a running SumSpectra with a start and end index.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="s2">&quot;Histogram&quot;</span><span class="p">,</span> <span class="n">Random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workspace has </span><span class="si">%d</span><span class="s2"> spectra&quot;</span> <span class="o">%</span> <span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">())</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">SumSpectra</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">StartWorkspaceIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">EndWorkspaceIndex</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workspace has </span><span class="si">%d</span><span class="s2"> spectra&quot;</span> <span class="o">%</span> <span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">())</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Workspace has 200 spectra
Workspace has 1 spectra
</pre></div>
</div>
<p><strong>Example - a running SumSpectra in weighted sum mode.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="s2">&quot;Histogram&quot;</span><span class="p">,</span> <span class="n">Random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workspace has </span><span class="si">%d</span><span class="s2"> spectra&quot;</span> <span class="o">%</span> <span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">())</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">SumSpectra</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">WeightedSum</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Workspace has </span><span class="si">%d</span><span class="s2"> spectra&quot;</span> <span class="o">%</span> <span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">())</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Workspace has 200 spectra
Workspace has 1 spectra
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Transforms/Grouping.html">Transforms\Grouping</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/66c74f87d9b779695dc85b538bc48767c5975b19/Framework/Algorithms/inc/MantidAlgorithms/SumSpectra.h">SumSpectra.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/66c74f87d9b779695dc85b538bc48767c5975b19/Framework/Algorithms/src/SumSpectra.cpp">SumSpectra.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="SumRowColumn-v1.html" title="Previous Chapter: SumRowColumn v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; SumRowColumn v1</span>
    </a>
  </li>
  <li>
    <a href="SwapWidths-v1.html" title="Next Chapter: SwapWidths v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SwapWidths v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>