<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>PreprocessDetectorsToMD v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=5b08953a"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ProcessBackground v1" href="ProcessBackground-v1.html" />
    <link rel="prev" title="PredictSatellitePeaks v1" href="PredictSatellitePeaks-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">PreprocessDetectorsToMD v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="preprocessdetectorstomd-v1">
<span id="algm-preprocessdetectorstomd"></span><span id="algm-preprocessdetectorstomd-v1"></span><h1>PreprocessDetectorsToMD v1<a class="headerlink" href="#preprocessdetectorstomd-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id3">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id6">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id7">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Its a helper algorithm, used to make common part of transformation from real to reciprocal space. It is used by <a class="reference internal" href="ConvertToMD-v1.html#algm-converttomd"><span class="std std-ref">ConvertToMD v1</span></a> and <a class="reference internal" href="ConvertToMDMinMaxLocal-v1.html#algm-converttomdminmaxlocal"><span class="std std-ref">ConvertToMDMinMaxLocal v1</span></a> algorithms to save time spent on this transformation when the algorithm used multiple times for multiple measurements on the same instrument.</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Name of an input Matrix Workspace with instrument.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Name of the output Table workspace with pre-processed detectors data. If the workspace exists, it will be replaced.</p></td>
</tr>
<tr class="row-even"><td><p>GetMaskState</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Returns masked state of the detectors. If this option is false, the masked detectors are just dropped from the resulting workspace and spectra-to detectors map has to be used to analyse the spectra. This is temporary parameter and logic necessary until Mantid masks signal by 0 rather then NaN.</p></td>
</tr>
<tr class="row-odd"><td><p>UpdateMasksInfo</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If target workspace already exists as the result of previous deployment of this algorithm, the algorithm just updated masks states column instead of calculating the whole target workspace. The target workspace has to be appropriate for the source workspace This is temporary parameter and logic necessary until Mantid masks signal by 0 rather then NaN.</p></td>
</tr>
<tr class="row-even"><td><p>GetEFixed</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>This option makes sense for Indirect instrument, where each detector can have its own energy, defined by correspondent crystal-analyzer position. If this option is selected for other instrument types, the value of eFixed is taken from workspace property Ei or eFixed if Ei is missing and is set to NaN if no such properties are defined on the input workspace.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>The algorithm calculates expensive part of the transformation from real to reciprocal space, calculating namely,
detector positions, sample-detector distances, angular detectors positions, etc. These values can be slow to calculate
for composite detectors and other algorithms can substantially benefit from using preprocessed values.</p>
<p>The algorithm places processed values into a table workspace with the following columns:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Column Name :</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description:</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>DetDirections</p></td>
<td><p>V3D</p></td>
<td><p>unit 3D vector directed from sample to detector</p></td>
</tr>
<tr class="row-odd"><td><p>L2</p></td>
<td><p>double</p></td>
<td><p>sample-detector distance</p></td>
</tr>
<tr class="row-even"><td><p>TwoTheta</p></td>
<td><p>double</p></td>
<td><p>Composite detectors Polar angle</p></td>
</tr>
<tr class="row-odd"><td><p>Azimuthal</p></td>
<td><p>double</p></td>
<td><p>Composite detectors Azimutal angle</p></td>
</tr>
<tr class="row-even"><td><p>DetectorID</p></td>
<td><p>int</p></td>
<td><p>Unique detector number</p></td>
</tr>
<tr class="row-odd"><td><p>detIDMap</p></td>
<td><p>size_t</p></td>
<td><p>index of the detector in the detector’s array</p></td>
</tr>
<tr class="row-even"><td><p>detMask <a class="footnote-reference brackets" href="#f1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p></td>
<td><p>int</p></td>
<td><p>1 if masked and 0 if not</p></td>
</tr>
<tr class="row-odd"><td><p>efixed <a class="footnote-reference brackets" href="#f2" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p></td>
<td><p>double</p></td>
<td><p>energy of the detector (intirect only)</p></td>
</tr>
</tbody>
</table>
<p>In addition to the preprocessed detectors intofmation, the following log entries are added to the table workspace:</p>
<ul class="simple">
<li><p><strong>Ei</strong> – Incident neurtorns energy if such log value is attached to input workspace.</p></li>
<li><p><strong>L1</strong> – Source-sample distance.</p></li>
<li><p><strong>ActualDetectorsNum</strong> – total number of existing preprocessed detectors (number of rows in the table above).</p></li>
<li><p><strong>InstrumentName</strong> – the name of the source instrument.</p></li>
<li><dl class="simple">
<dt><strong>FakeDetectors</strong> – if detectors posisions were not actually preprocessed but fake detectros were used instead</dt><dd><p>(InstrumentName==*FakeInstrument* in this case).</p>
</dd>
</dl>
</li>
</ul>
<p class="rubric">Notes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f1" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Present if property <strong>GetMaskState</strong> is set to True.</p>
</aside>
<aside class="footnote brackets" id="f2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Present if <strong>Indirect</strong> mode selected.</p>
</aside>
</aside>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - Find min-max values for |Q| transformation :</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulates Load of a workspace with all necessary parameters #################</span>
<span class="n">detWS</span> <span class="o">=</span> <span class="n">CreateSimulationWorkspace</span><span class="p">(</span><span class="n">Instrument</span><span class="o">=</span><span class="s1">&#39;MAR&#39;</span><span class="p">,</span><span class="n">BinParams</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span><span class="n">UnitX</span><span class="o">=</span><span class="s1">&#39;DeltaE&#39;</span><span class="p">)</span>
<span class="n">AddSampleLog</span><span class="p">(</span><span class="n">detWS</span><span class="p">,</span><span class="n">LogName</span><span class="o">=</span><span class="s1">&#39;Ei&#39;</span><span class="p">,</span><span class="n">LogText</span><span class="o">=</span><span class="s1">&#39;52.&#39;</span><span class="p">,</span><span class="n">LogType</span><span class="o">=</span><span class="s1">&#39;Number&#39;</span><span class="p">);</span>
<span class="c1">#</span>
<span class="n">preprDetWS</span> <span class="o">=</span> <span class="n">PreprocessDetectorsToMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">detWS</span><span class="p">,</span><span class="n">GetMaskState</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">GetEFixed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Look at sample results:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The resulting table has the following columns:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">preprDetWS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The number of rows in the workspace is :  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">preprDetWS</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">&#39;L2&#39;</span><span class="p">))))</span>
<span class="n">polar</span> <span class="o">=</span> <span class="n">preprDetWS</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">&#39;TwoTheta&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The polar angle for detector N </span><span class="si">{0}</span><span class="s2"> is </span><span class="si">{1:5f}</span><span class="s2"> rad&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">polar</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The table workspace logs (properties) are currently not available from python&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The resulting table has the following columns:
[&#39;DetDirections&#39;, &#39;L2&#39;, &#39;TwoTheta&#39;, &#39;Azimuthal&#39;, &#39;DetectorID&#39;, &#39;detIDMap&#39;, &#39;spec2detMap&#39;, &#39;detMask&#39;, &#39;eFixed&#39;, &#39;DIFA&#39;, &#39;DIFC&#39;, &#39;TZERO&#39;]
The number of rows in the workspace is :  918
The polar angle for detector N 10 is 0.314159 rad
The table workspace logs (properties) are currently not available from python
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/MDAlgorithms/Utility.html">MDAlgorithms\Utility</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/66c74f87d9b779695dc85b538bc48767c5975b19/Framework/MDAlgorithms/inc/MantidMDAlgorithms/PreprocessDetectorsToMD.h">PreprocessDetectorsToMD.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/66c74f87d9b779695dc85b538bc48767c5975b19/Framework/MDAlgorithms/src/PreprocessDetectorsToMD.cpp">PreprocessDetectorsToMD.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="PredictSatellitePeaks-v1.html" title="Previous Chapter: PredictSatellitePeaks v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; PredictSatell...</span>
    </a>
  </li>
  <li>
    <a href="ProcessBackground-v1.html" title="Next Chapter: ProcessBackground v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">ProcessBackground v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>