<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>PoldiDataAnalysis v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=5b08953a"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PoldiFitPeaks1D v1" href="PoldiFitPeaks1D-v1.html" />
    <link rel="prev" title="PoldiCreatePeaksFromFile v1" href="PoldiCreatePeaksFromFile-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">PoldiDataAnalysis v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="poldidataanalysis-v1">
<span id="algm-poldidataanalysis"></span><span id="algm-poldidataanalysis-v1"></span><h1>PoldiDataAnalysis v1<a class="headerlink" href="#poldidataanalysis-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id2">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id3">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id4">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id5">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Run all necessary steps for a complete analysis of POLDI data.</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>MatrixWorkspace with 2D POLDI data and valid POLDI instrument.</p></td>
</tr>
<tr class="row-odd"><td><p>MaximumPeakNumber</p></td>
<td><p>Input</p></td>
<td><p>long</p></td>
<td><p>10</p></td>
<td><p>Maximum number of peaks to process in the analysis.</p></td>
</tr>
<tr class="row-even"><td><p>MinimumPeakSeparation</p></td>
<td><p>Input</p></td>
<td><p>long</p></td>
<td><p>10</p></td>
<td><p>Minimum number of points between neighboring peaks.</p></td>
</tr>
<tr class="row-odd"><td><p>MinimumPeakHeight</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Minimum height of peaks. If it is left at 0, the minimum peak height is calculatedfrom background noise.</p></td>
</tr>
<tr class="row-even"><td><p>MaximumRelativeFwhm</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.02</p></td>
<td><p>Peaks with a relative FWHM larger than this are removed during the 1D fit.</p></td>
</tr>
<tr class="row-odd"><td><p>ScatteringContributions</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>1</p></td>
<td><p>If there is more than one compound, you may supply estimates of their scattering contributions, which sometimes improves indexing.</p></td>
</tr>
<tr class="row-even"><td><p>ExpectedPeaks</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>TableWorkspace or WorkspaceGroup with expected peaks used for indexing.</p></td>
</tr>
<tr class="row-odd"><td><p>RemoveUnindexedPeaksFor2DFit</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Discard unindexed peaks for 2D fit, this is always the case if PawleyFit is active.</p></td>
</tr>
<tr class="row-even"><td><p>ProfileFunction</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Gaussian</p></td>
<td><p>Allowed values: [‘AsymmetricPearsonVII’, ‘Gaussian’, ‘Lorentzian’, ‘PseudoVoigt’, ‘Voigt’]</p></td>
</tr>
<tr class="row-odd"><td><p>TieProfileParameters</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>If this option is activated, certain parameters are kept the same for all peaks. An example is the mixing parameter of the PseudoVoigt function.</p></td>
</tr>
<tr class="row-even"><td><p>BoundProfileParameters</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>If this option is activated, certain parameters will be bound to a specific range of values for all peaks. It is implemented for the “LeftShape” and “RightShape” parameters of the asymmetric Pearson VII function, which are set to be bound to a [0, 20] range.</p></td>
</tr>
<tr class="row-odd"><td><p>PawleyFit</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Should the 2D-fit determine lattice parameters?</p></td>
</tr>
<tr class="row-even"><td><p>MultipleRuns</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If this is activated, peaks are searched again in theresiduals and the 1D- and 2D-fit is repeated with these data.</p></td>
</tr>
<tr class="row-odd"><td><p>PlotResult</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>If this is activated, plot the sum of residuals and calculated spectrum together with the theoretical spectrum and the residuals.</p></td>
</tr>
<tr class="row-even"><td><p>OutputIntegratedIntensities</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If this option is checked the peak intensities of the 2D-fit will be integrated, otherwise they will be the maximum intensity.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputRawFitParameters</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Activating this option produces an output workspace which contains the raw fit parameters.</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>WorkspaceGroup with result data from all processing steps.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This algorithm performs all necessary steps for a complete analysis of POLDI data, combining all algorithms that are
specific to POLDI. In detail, it performs these steps on the supplied data:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="PoldiAutoCorrelation-v5.html#algm-poldiautocorrelation"><span class="std std-ref">PoldiAutoCorrelation v5</span></a></p></li>
<li><p><a class="reference internal" href="PoldiPeakSearch-v1.html#algm-poldipeaksearch"><span class="std std-ref">PoldiPeakSearch v1</span></a></p></li>
<li><p><a class="reference internal" href="PoldiFitPeaks1D-v2.html#algm-poldifitpeaks1d"><span class="std std-ref">PoldiFitPeaks1D v2</span></a></p></li>
<li><p><a class="reference internal" href="PoldiIndexKnownCompounds-v1.html#algm-poldiindexknowncompounds"><span class="std std-ref">PoldiIndexKnownCompounds v1</span></a></p></li>
<li><p><a class="reference internal" href="PoldiFitPeaks2D-v1.html#algm-poldifitpeaks2d"><span class="std std-ref">PoldiFitPeaks2D v1</span></a></p></li>
<li><p><a class="reference internal" href="PoldiAnalyseResiduals-v1.html#algm-poldianalyseresiduals"><span class="std std-ref">PoldiAnalyseResiduals v1</span></a></p></li>
</ol>
<p>Finally, the calculated diffractogram and the residuals are added together and all three spectra are plotted to give
an impression of the result. If the <cite>MultipleRuns</cite> option is activated, steps 2 - 6 are repeated, but instead of
using the initial correlation spectrum, the sum or calculated and residuals is used. Because this is usually much
smoother than the initial correlation spectrum, additional peaks can be found there sometimes. The 2D-fit is still
performed with the original data.</p>
<p>The actual output is a WorkspaceGroup with content that varies a bit depending on the input parameters. If
<cite>PawleyFit</cite> was active, it contains refined cell parameters. For the <cite>ExpectedPeaks</cite> parameter, a WorkpsaceGroup may
be given (this is necessary when multiple phases are present in a sample).</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p>The algorithm requires relatively little input and can be run like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Load POLDI data</span>
<span class="n">PoldiLoadRuns</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">6903</span><span class="p">,</span> <span class="mi">6904</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;poldi&#39;</span><span class="p">,</span> <span class="n">MaskBadDetectors</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Create Silicon peaks</span>
<span class="n">PoldiCreatePeaksFromCell</span><span class="p">(</span><span class="n">SpaceGroup</span><span class="o">=</span><span class="s1">&#39;F d -3 m&#39;</span><span class="p">,</span> <span class="n">Atoms</span><span class="o">=</span><span class="s1">&#39;Si 0 0 0 1.0 0.01&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">5.431</span><span class="p">,</span>
                         <span class="n">LatticeSpacingMin</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                         <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;Si&#39;</span><span class="p">)</span>

<span class="n">PoldiDataAnalysis</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;poldi_data_6904&#39;</span><span class="p">,</span>
                  <span class="n">ExpectedPeaks</span><span class="o">=</span><span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="n">PawleyFit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">MaximumPeakNumber</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                  <span class="n">PlotResult</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;result&#39;</span><span class="p">)</span>

<span class="c1"># Take a look at the refined cell:</span>

<span class="n">cell</span> <span class="o">=</span> <span class="n">AnalysisDataService</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="s1">&#39;poldi_data_6904_cell_refined&#39;</span><span class="p">)</span>

<span class="n">cell_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">cell_a_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Refined lattice parameter a = </span><span class="si">{:.5f}</span><span class="s2"> +/- </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell_a</span><span class="p">,</span> <span class="n">cell_a_error</span><span class="p">))</span>
</pre></div>
</div>
<p>This will print the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Refined lattice parameter a = 5.43126 +/- 5e-05
</pre></div>
</div>
<p>If PlotResult is changed to True, a plot of the spectrum and the residuals is created as described above.</p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/SINQ/Poldi.html">SINQ\Poldi</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/66c74f87d9b779695dc85b538bc48767c5975b19/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/PoldiDataAnalysis.py">PoldiDataAnalysis.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="PoldiCreatePeaksFromFile-v1.html" title="Previous Chapter: PoldiCreatePeaksFromFile v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; PoldiCreatePe...</span>
    </a>
  </li>
  <li>
    <a href="PoldiFitPeaks1D-v1.html" title="Next Chapter: PoldiFitPeaks1D v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">PoldiFitPeaks1D v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>