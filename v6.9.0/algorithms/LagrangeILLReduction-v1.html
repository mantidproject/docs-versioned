<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>LagrangeILLReduction v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=5b08953a"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="LeBailFit v1" href="LeBailFit-v1.html" />
    <link rel="prev" title="LRSubtractAverageBackground v1" href="LRSubtractAverageBackground-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">LagrangeILLReduction v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="lagrangeillreduction-v1">
<span id="algm-lagrangeillreduction"></span><span id="algm-lagrangeillreduction-v1"></span><h1>LagrangeILLReduction v1<a class="headerlink" href="#lagrangeillreduction-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id2">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id3">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id4">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id5">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Reduces Lagrange data.</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SampleRuns</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Sample run(s). Allowed values: [‘’, ‘.nxs’]</p></td>
</tr>
<tr class="row-odd"><td><p>ContainerRuns</p></td>
<td><p>Input</p></td>
<td><p>list of str lists</p></td>
<td></td>
<td><p>Container run(s) (empty cell). Allowed values: [‘’, ‘.nxs’]</p></td>
</tr>
<tr class="row-even"><td><p>CorrectionFile</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Correction reference file. Allowed extensions: [‘.txt’]</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The output workspace containing reduced data.</p></td>
</tr>
<tr class="row-even"><td><p>NormaliseBy</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Monitor</p></td>
<td><p>What normalisation approach to use on data. Allowed values: [‘Monitor’, ‘None’]</p></td>
</tr>
<tr class="row-odd"><td><p>UseIncidentEnergy</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Show the energies as incident energies, not transfer ones.</p></td>
</tr>
<tr class="row-even"><td><p>ConvertToWaveNumber</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Convert axis unit to energy in wave number (cm-1)</p></td>
</tr>
<tr class="row-odd"><td><p>NexusInput</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Whether the input data contains NeXus files.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This algorithm reduces data from IN1 - Lagrange.</p>
<p>It can take as input multiple files from a single monochromator scan, the associated empty cell runs, and a correction file
if needed. Reduction consists of multiplying the data by the correction factor from the correction file, and subtracting
the empty cell from the raw data.</p>
<p>The X-axis of the result data can be offset by the incident energy using <cite>UseIncidentEnergy</cite>, and be converted to wave
number instead of the default energy using <cite>ConvertToWaveNumber</cite>.</p>
<p>All the files in each field are merged together in a single curve, with very close points (less than 10 umeV apart)
being removed to avoid interpolation artifacts.</p>
<p>Since the binning can be different between the raw data, the empty cell and the correction file, values are interpolated
through numpy to provide matching values.</p>
<p>Note that for simplicity reasons, this algorithm is taking care of the loading and formatting of the ASCII data itself,
and no separate loader exists for ASCII Lagrange data. Raw data can be checked by not filling any reduction parameter in this
algorithm. There exist a loader for NeXus Lagrange data: LoadILLLagrange, which allows to inspect the raw data.</p>
<p>The reduction can be performed when the input contains only ASCII or only NeXus files, mixing is not supported. The workflow
will automatically choose which way to load the input data. The reduction with either type of input gives the same result.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Simple Example with plotting of temperature vs initial energy</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># full correction of a single monochromator scan, with multiple files</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">LagrangeILLReduction</span><span class="p">(</span><span class="n">SampleRuns</span><span class="o">=</span><span class="s1">&#39;012869:012871&#39;</span><span class="p">,</span>
                              <span class="n">ContainerRuns</span><span class="o">=</span><span class="s1">&#39;012882:012884&#39;</span><span class="p">,</span>
                              <span class="n">CorrectionFile</span><span class="o">=</span><span class="s1">&#39;correction-water-cu220-2020.txt&#39;</span><span class="p">,</span>
                              <span class="n">UseIncidentEnergy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">ConvertToWaveNumber</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">run</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">getRun</span><span class="p">()</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">getLogData</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
<span class="n">eis</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">temperatures</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">getLogData</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eis</span><span class="p">,</span> <span class="n">temperatures</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Ei (meV)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;temperature (K)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Multiple monochromators example</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># complete reduction example for an entire experiment</span>

<span class="c1"># when reducing a scan spanning multiple monochromators, one needs to reduce each scan separately and then merge</span>
<span class="c1"># them together at the end</span>

<span class="c1"># import mantid algorithms</span>
<span class="kn">from</span> <span class="nn">mantid.simpleapi</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># setting search directory for data</span>
<span class="n">config</span><span class="o">.</span><span class="n">appendDataSearchDir</span><span class="p">(</span><span class="s2">&quot;/path/to/data&quot;</span><span class="p">)</span>

<span class="c1"># setting data grouped by monochromator</span>
<span class="n">samples</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Cu220&quot;</span><span class="p">:</span> <span class="s1">&#39;raw_cu220_0, raw_cu220_1&#39;</span><span class="p">,</span>
           <span class="s2">&quot;Si111&quot;</span><span class="p">:</span> <span class="s1">&#39;raw_si111_0&#39;</span><span class="p">,</span>
           <span class="s2">&quot;Si311&quot;</span><span class="p">:</span> <span class="s1">&#39;raw_si311_0&#39;</span><span class="p">}</span>

<span class="c1"># empty cell files</span>
<span class="n">ec</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Cu220&quot;</span><span class="p">:</span> <span class="s1">&#39;ec_cu220_0, ec_cu220_1&#39;</span><span class="p">,</span>
      <span class="s2">&quot;Si111&quot;</span><span class="p">:</span> <span class="s1">&#39;ec_si111_0&#39;</span><span class="p">,</span>
      <span class="s2">&quot;Si311&quot;</span><span class="p">:</span> <span class="s1">&#39;ec_si311_0&#39;</span><span class="p">}</span>

<span class="c1"># correction files</span>
<span class="n">corr</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Cu220&quot;</span><span class="p">:</span> <span class="s2">&quot;correction-factor-Cu220.txt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Si111&quot;</span><span class="p">:</span> <span class="s2">&quot;correction-factor-Si111.txt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Si311&quot;</span><span class="p">:</span> <span class="s2">&quot;correction_factor-Si311.txt&quot;</span><span class="p">}</span>

<span class="c1"># treating data for each monochromator</span>
<span class="k">for</span> <span class="n">mono</span> <span class="ow">in</span> <span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">LagrangeILLReduction</span><span class="p">(</span><span class="n">SampleRuns</span><span class="o">=</span><span class="n">samples</span><span class="p">[</span><span class="n">mono</span><span class="p">],</span>
                         <span class="n">ContainerRuns</span><span class="o">=</span><span class="n">ec</span><span class="p">[</span><span class="n">mono</span><span class="p">],</span>
                         <span class="n">CorrectionFile</span><span class="o">=</span><span class="n">corr</span><span class="p">[</span><span class="n">mono</span><span class="p">],</span>
                         <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">mono</span><span class="p">,</span>
                         <span class="n">UseIncidentEnergy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">ConvertToWaveNumber</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># stitching the results</span>
<span class="n">Stitch</span><span class="p">(</span><span class="n">InputWorkspaces</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">ReferenceWorkspace</span><span class="o">=</span><span class="s1">&#39;Si311&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;stitched&quot;</span><span class="p">)</span>

<span class="c1"># plotting all results</span>
<span class="n">plotSpectrum</span><span class="p">(</span><span class="n">workspaces</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;stitched&#39;</span><span class="p">],</span> <span class="n">indices</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/ILL/Indirect.html">ILL\Indirect</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/66c74f87d9b779695dc85b538bc48767c5975b19/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/LagrangeILLReduction.py">LagrangeILLReduction.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="LRSubtractAverageBackground-v1.html" title="Previous Chapter: LRSubtractAverageBackground v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; LRSubtractAve...</span>
    </a>
  </li>
  <li>
    <a href="LeBailFit-v1.html" title="Next Chapter: LeBailFit v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">LeBailFit v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>