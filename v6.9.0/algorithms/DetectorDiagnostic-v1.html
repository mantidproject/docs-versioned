<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>DetectorDiagnostic v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=5b08953a"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DetectorEfficiencyCor v1" href="DetectorEfficiencyCor-v1.html" />
    <link rel="prev" title="DeltaPDF3D v1" href="DeltaPDF3D-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">DetectorDiagnostic v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="detectordiagnostic-v1">
<span id="algm-detectordiagnostic"></span><span id="algm-detectordiagnostic-v1"></span><h1>DetectorDiagnostic v1<a class="headerlink" href="#detectordiagnostic-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p>
<ul>
<li><p><a class="reference internal" href="#workflow" id="id6">Workflow</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#source" id="id7">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Identifies histograms and their detectors that have total numbers of counts over a user defined maximum or less than the user define minimum.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="FindDetectorsOutsideLimits-v1.html#algm-finddetectorsoutsidelimits"><span class="std std-ref">FindDetectorsOutsideLimits</span></a>, <a class="reference internal" href="FindDeadDetectors-v1.html#algm-finddeaddetectors"><span class="std std-ref">FindDeadDetectors</span></a>, <a class="reference internal" href="MedianDetectorTest-v1.html#algm-mediandetectortest"><span class="std std-ref">MedianDetectorTest</span></a>, <a class="reference internal" href="DetectorEfficiencyVariation-v1.html#algm-detectorefficiencyvariation"><span class="std std-ref">DetectorEfficiencyVariation</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Name of the integrated detector vanadium (white beam) workspace.</p></td>
</tr>
<tr class="row-odd"><td><p>HardMaskWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>A hard mask to apply to the inputworkspace</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A MaskWorkspace containing the masked spectra as zeroes and ones.</p></td>
</tr>
<tr class="row-odd"><td><p>StartWorkspaceIndex</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>The index number of the first spectrum to include in the calculation (default 0)</p></td>
</tr>
<tr class="row-even"><td><p>EndWorkspaceIndex</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The index number of the last spectrum to include in the calculation (default the last histogram)</p></td>
</tr>
<tr class="row-odd"><td><p>RangeLower</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>No bin with a boundary at an x value less than this will be used in the summation that decides if a detector is ‘bad’ (default: the start of each histogram)</p></td>
</tr>
<tr class="row-even"><td><p>RangeUpper</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>No bin with a boundary at an x value higher than this value will be used in the summation that decides if a detector is ‘bad’ (default: the end of each histogram)</p></td>
</tr>
<tr class="row-odd"><td><p>LowThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Spectra whose total number of counts are equal to or below this value will be marked bad (default 0)</p></td>
</tr>
<tr class="row-even"><td><p>HighThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Spectra whose total number of counts are equal to or above this value will be marked bad (default off)</p></td>
</tr>
<tr class="row-odd"><td><p>LevelsUp</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Levels above pixel that will be used to compute the median. If no level is specified, or 0, the median is over the whole instrument.</p></td>
</tr>
<tr class="row-even"><td><p>SignificanceTest</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Error criterion as a multiple of error bar i.e. to fail the test, the magnitude of the difference with respect to the median value must also exceed this number of error bars</p></td>
</tr>
<tr class="row-odd"><td><p>LowThresholdFraction</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.1</p></td>
<td><p>Lower acceptable bound as fraction of median value</p></td>
</tr>
<tr class="row-even"><td><p>HighThresholdFraction</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1.5</p></td>
<td><p>Upper acceptable bound as fraction of median value</p></td>
</tr>
<tr class="row-odd"><td><p>LowOutlier</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.01</p></td>
<td><p>Lower bound defining outliers as fraction of median value</p></td>
</tr>
<tr class="row-even"><td><p>HighOutlier</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>100</p></td>
<td><p>Upper bound defining outliers as fraction of median value</p></td>
</tr>
<tr class="row-odd"><td><p>CorrectForSolidAngle</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Flag to correct for solid angle efficiency. False by default.</p></td>
</tr>
<tr class="row-even"><td><p>ExcludeZeroesFromMedian</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If false (default) zeroes will be included in the median calculation, otherwise they will not be included but they will be left unmasked</p></td>
</tr>
<tr class="row-odd"><td><p>DetVanCompare</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>Name of a matching second detector vanadium run from the same instrument. It must be treated in the same manner as the input detector vanadium.</p></td>
</tr>
<tr class="row-even"><td><p>DetVanRatioVariation</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1.1</p></td>
<td><p>Identify spectra whose total number of counts has changed by more than this factor of the median change between the two input workspaces</p></td>
</tr>
<tr class="row-odd"><td><p>SampleTotalCountsWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>A sample workspace integrated over the full axis range.</p></td>
</tr>
<tr class="row-even"><td><p>SampleBackgroundWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>A sample workspace integrated over the background region.</p></td>
</tr>
<tr class="row-odd"><td><p>SampleBkgLowAcceptanceFactor</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Low threshold for the background check MedianDetectorTest.</p></td>
</tr>
<tr class="row-even"><td><p>SampleBkgHighAcceptanceFactor</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>5</p></td>
<td><p>High threshold for the background check MedianDetectorTest.</p></td>
</tr>
<tr class="row-odd"><td><p>SampleBkgSignificanceTest</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>3.3</p></td>
<td><p>Error criterion as a multiple of error bar i.e. to fail the test, the magnitude of the difference with respect to the median value must also exceed this number of error bars</p></td>
</tr>
<tr class="row-even"><td><p>SampleCorrectForSolidAngle</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Flag to correct for solid angle efficiency for background check MedianDetectorTest. False by default.</p></td>
</tr>
<tr class="row-odd"><td><p>SampleWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>A sample workspace. This is used in the PSD Bleed calculation.</p></td>
</tr>
<tr class="row-even"><td><p>MaxTubeFramerate</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>The maximum rate allowed for a tube in counts/us/frame.</p></td>
</tr>
<tr class="row-odd"><td><p>NIgnoredCentralPixels</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>80</p></td>
<td><p>The number of pixels about the centre to ignore.</p></td>
</tr>
<tr class="row-even"><td><p>NumberOfFailures</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This algorithm is a C++ replacement for the Python diagnostics.diagnose
function located in the scripts/inelastic directory. The algorithm
expects processed workspaces as input just as the other function did.
The main functionality of the algorithm is to determine issues with
detector vanadium runs and mask out bad pixels. The algorithms that are
run on the detector vanadium are <a class="reference internal" href="FindDetectorsOutsideLimits-v1.html#algm-finddetectorsoutsidelimits"><span class="std std-ref">FindDetectorsOutsideLimits v1</span></a> and
<a class="reference internal" href="MedianDetectorTest-v1.html#algm-mediandetectortest"><span class="std std-ref">MedianDetectorTest v1</span></a>. It also performs a second set of diagnostics on
another detector vanadium run and <a class="reference internal" href="DetectorEfficiencyVariation-v1.html#algm-detectorefficiencyvariation"><span class="std std-ref">DetectorEfficiencyVariation v1</span></a> on the
two. The algorithm also checks processed sample workspaces (total counts
and background) for bad pixels as well. The total counts workspace is
tested with <a class="reference internal" href="FindDetectorsOutsideLimits-v1.html#algm-finddetectorsoutsidelimits"><span class="std std-ref">FindDetectorsOutsideLimits v1</span></a>. The background workspace is run
through <a class="reference internal" href="MedianDetectorTest-v1.html#algm-mediandetectortest"><span class="std std-ref">MedianDetectorTest v1</span></a>. A processed sample workspace can be given
to perform and <a class="reference internal" href="CreatePSDBleedMask-v1.html#algm-createpsdbleedmask"><span class="std std-ref">CreatePSDBleedMask v1</span></a> will be run on it.</p>
<section id="workflow">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Workflow</a><a class="headerlink" href="#workflow" title="Link to this heading">¶</a></h3>
<p>Parameters for the child algorithms are not shown due to the sheer number.
They are passed onto child algorithms that under the same name, except</p>
<ul class="simple">
<li><p>LowThreshold and HighThresold are not passed onto <a class="reference internal" href="FindDetectorsOutsideLimits-v1.html#algm-finddetectorsoutsidelimits"><span class="std std-ref">FindDetectorsOutsideLimits v1</span></a>, but are set as 1.0e-10 and 1.0e100 respectively.</p></li>
<li><p>LowOutLier, HighOutlier and ExcludeZeroesFromMedian are not passed onto <a class="reference internal" href="MedianDetectorTest-v1.html#algm-mediandetectortest"><span class="std std-ref">MedianDetectorTest v1</span></a>, but are set as 0.0, 1.0e100 and true respectively.</p></li>
<li><p>DetVanRatioVariation is passed onto <a class="reference internal" href="DetectorEfficiencyVariation-v1.html#algm-detectorefficiencyvariation"><span class="std std-ref">DetectorEfficiencyVariation v1</span></a> as Variation.</p></li>
<li><p>SampleBkgLowAcceptanceFactor, SampleBkgHighAcceptanceFactor, SampleBkgSignificanceTest and SampleCorrectForSolidAngle are passed onto <a class="reference internal" href="MedianDetectorTest-v1.html#algm-mediandetectortest"><span class="std std-ref">MedianDetectorTest v1</span></a> as LowThreshold, HighThreshold, SignicanceTest and CorrectForSolidAngle respectively.</p></li>
</ul>
<p>Numerous uses of <a class="reference internal" href="MaskDetectors-v1.html#algm-maskdetectors"><span class="std std-ref">MaskDetectors v1</span></a> are not shown and can be taken be be executed whenever appropriate.
Also the output property NumberOfFailures from the executed child algorithms are added together
to form the NumberOfFailures output by the main algorithm.</p>
<figure class="align-default" id="id1">
<img alt="../_images/ImageNotFound.png" src="../_images/ImageNotFound.png" />
<figcaption>
<p><span class="caption-text">diagram generation was disabled</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Diagnostics.html">Diagnostics</a> | <a class="reference external" href="categories/Workflow/Diagnostics.html">Workflow\Diagnostics</a></p>
</section>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/66c74f87d9b779695dc85b538bc48767c5975b19/Framework/Algorithms/inc/MantidAlgorithms/DetectorDiagnostic.h">DetectorDiagnostic.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/66c74f87d9b779695dc85b538bc48767c5975b19/Framework/Algorithms/src/DetectorDiagnostic.cpp">DetectorDiagnostic.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DeltaPDF3D-v1.html" title="Previous Chapter: DeltaPDF3D v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DeltaPDF3D v1</span>
    </a>
  </li>
  <li>
    <a href="DetectorEfficiencyCor-v1.html" title="Next Chapter: DetectorEfficiencyCor v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DetectorEffic... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>