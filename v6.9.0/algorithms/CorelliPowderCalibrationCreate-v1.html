<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>CorelliPowderCalibrationCreate v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=5b08953a"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CorrectKiKf v1" href="CorrectKiKf-v1.html" />
    <link rel="prev" title="CorelliCrossCorrelate v1" href="CorelliCrossCorrelate-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">CorelliPowderCalibrationCreate v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="corellipowdercalibrationcreate-v1">
<span id="algm-corellipowdercalibrationcreate"></span><span id="algm-corellipowdercalibrationcreate-v1"></span><h1>CorelliPowderCalibrationCreate v1<a class="headerlink" href="#corellipowdercalibrationcreate-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id6">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id7">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Adjust bank positions and orientations to optimize peak determination in d-spacing</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="PDCalibration-v1.html#algm-pdcalibration"><span class="std std-ref">PDCalibration</span></a>, <a class="reference internal" href="AlignDetectors-v1.html#algm-aligndetectors"><span class="std std-ref">AlignDetectors</span></a>, <a class="reference internal" href="AlignComponents-v1.html#algm-aligncomponents"><span class="std std-ref">AlignComponents</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Powder event data, ideally from a highly symmetric space group</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspacesPrefix</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>pdcal_</p></td>
<td><p>Prefix to be added to output workspaces</p></td>
</tr>
<tr class="row-even"><td><p>TofBinning</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Min, Step, and Max of TOF bins. Logarithmic binning is used if Step is negative. Chosen binning should ensure sufficient datapoints across the peaks to be fitted, considering the number of parameters required by PeakFunction and BackgroundType.</p></td>
</tr>
<tr class="row-odd"><td><p>PeakFunction</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Gaussian</p></td>
<td><p>Function to fit input peaks. Allowed values: [‘BackToBackExponential’, ‘Gaussian’, ‘Lorentzian’, ‘PseudoVoigt’, ‘IkedaCarpenterPV’]</p></td>
</tr>
<tr class="row-even"><td><p>PeakPositions</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Comma-delimited positions (d-spacing) of reference peaks. Care should be taken to avoid using peaks whose predicted positions are too close considering their peak windows.</p></td>
</tr>
<tr class="row-odd"><td><p>FixSource</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Fix source’s distance from the sample</p></td>
</tr>
<tr class="row-even"><td><p>SourceToSampleDistance</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>20.004</p></td>
<td><p>Set this value for a fixed distance from source to sample, in meters</p></td>
</tr>
<tr class="row-odd"><td><p>AdjustSource</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Adjust Z-coordinate of the source</p></td>
</tr>
<tr class="row-even"><td><p>SourceMaxTranslation</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.1</p></td>
<td><p>Maximum adjustment of source position along the beam (Z) axis (m)</p></td>
</tr>
<tr class="row-odd"><td><p>FixY</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Vertical bank position is left unchanged</p></td>
</tr>
<tr class="row-even"><td><p>ComponentList</p></td>
<td><p>Input</p></td>
<td><p>str list</p></td>
<td><p>bank1/sixteenpack,bank2/sixteenpack,bank3/sixteenpack,bank4/sixteenpack,bank5/sixteenpack,bank6/sixteenpack,bank7/sixteenpack,bank8/sixteenpack,bank9/sixteenpack,bank10/sixteenpack,bank11/sixteenpack,bank12/sixteenpack,bank13/sixteenpack,bank14/sixteenpack,bank15/sixteenpack,bank16/sixteenpack,bank17/sixteenpack,bank18/sixteenpack,bank19/sixteenpack,bank20/sixteenpack,bank21/sixteenpack,bank22/sixteenpack,bank23/sixteenpack,bank24/sixteenpack,bank25/sixteenpack,bank26/sixteenpack,bank27/sixteenpack,bank28/sixteenpack,bank29/sixteenpack,bank30/sixteenpack,bank31/sixteenpack,bank32/sixteenpack,bank33/sixteenpack,bank34/sixteenpack,bank35/sixteenpack,bank36/sixteenpack,bank37/sixteenpack,bank38/sixteenpack,bank39/sixteenpack,bank40/sixteenpack,bank41/sixteenpack,bank42/sixteenpack,bank43/sixteenpack,bank44/sixteenpack,bank45/sixteenpack,bank46/sixteenpack,bank47/sixteenpack,bank48/sixteenpack,bank49/sixteenpack,bank50/sixteenpack,bank51/sixteenpack,bank52/sixteenpack,bank53/sixteenpack,bank54/sixteenpack,bank55/sixteenpack,bank56/sixteenpack,bank57/sixteenpack,bank58/sixteenpack,bank59/sixteenpack,bank60/sixteenpack,bank61/sixteenpack,bank62/sixteenpack,bank63/sixteenpack,bank64/sixteenpack,bank65/sixteenpack,bank66/sixteenpack,bank67/sixteenpack,bank68/sixteenpack,bank69/sixteenpack,bank70/sixteenpack,bank71/sixteenpack,bank72/sixteenpack,bank73/sixteenpack,bank74/sixteenpack,bank75/sixteenpack,bank76/sixteenpack,bank77/sixteenpack,bank78/sixteenpack,bank79/sixteenpack,bank80/sixteenpack,bank81/sixteenpack,bank82/sixteenpack,bank83/sixteenpack,bank84/sixteenpack,bank85/sixteenpack,bank86/sixteenpack,bank87/sixteenpack,bank88/sixteenpack,bank89/sixteenpack,bank90/sixteenpack,bank91/sixteenpack</p></td>
<td><p>Comma separated list on banks to refine</p></td>
</tr>
<tr class="row-odd"><td><p>ComponentMaxTranslation</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.02</p></td>
<td><p>Maximum translation of each component along either of the X, Y, Z axes (m)</p></td>
</tr>
<tr class="row-even"><td><p>FixYaw</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Prevent rotations around the axis normal to the bank</p></td>
</tr>
<tr class="row-odd"><td><p>ComponentMaxRotation</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>3</p></td>
<td><p>Maximum rotation of each component along either of the X, Y, Z axes (deg)</p></td>
</tr>
<tr class="row-even"><td><p>Minimizer</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>L-BFGS-B</p></td>
<td><p>Minimizer to use, differential_evolution is more accurate and slower. Allowed values: [‘L-BFGS-B’, ‘differential_evolution’]</p></td>
</tr>
<tr class="row-odd"><td><p>MaxIterations</p></td>
<td><p>Input</p></td>
<td><p>long</p></td>
<td><p>20</p></td>
<td><p>Maximum number of iterations for minimizer differential_evolution</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>Standard powder samples with Bragg scattering diffraction rings of accurately known lattice spacings
can be used to adjust the position and/or orientation for the components of an instrument (moderator and
detector bank) such that the observed peak intensities yield lattice plane spacings as close as
possible to the standard reference values.</p>
<p>This algorithm adjusts the position of the moderator as well as the position and orientation of each bank
of detector pixels. The goal of these adjustments is to produce neutron paths and scattering angles that lead
to optimal comparison between observed and reference lattice plane spacings</p>
<p>It is recommended <em>not</em> to adjust the position of the moderator, but only that of the banks. By setting
all calibrations at a fixed source-to-sample distance, calibrations taken at different times
and with different samples can be combined. the default value (<cite>SourceSampleDistance=20.004</cite>) is
the result of adjusting the position of the moderator with three different samples (Si, LaB6, and CsLaNb2O7).</p>
<p>The execution workflow is as follows:</p>
<figure class="align-default" id="id1">
<img alt="../_images/ImageNotFound.png" src="../_images/ImageNotFound.png" />
<figcaption>
<p><span class="caption-text">diagram generation was disabled</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p>For best results, a tube calibration should be applied to the input event workspace, before attempting to
adjust the position and orientation of each bank.</p>
<ul class="simple">
<li><p>Example -  adjust banks 42 and 87</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mantid.simpleapi</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">corelli.calibration</span> <span class="kn">import</span> <span class="n">load_calibration_set</span><span class="p">,</span> <span class="n">apply_calibration</span>
<span class="c1">#</span>
<span class="c1"># Loading the runs for the standard powder sample</span>
<span class="n">LoadNexus</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s1">&#39;/tmp/CORELLI_124036_banks42_87.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;LaB6&#39;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># Apply the tube calibration</span>
<span class="n">table</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">load_calibration_set</span><span class="p">(</span><span class="n">input_workspace</span><span class="p">,</span> <span class="s1">&#39;/SNS/CORELLI/shared/tube_calibration/&#39;</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="s1">&#39;mask&#39;</span><span class="p">)</span>
<span class="n">apply_calibration</span><span class="p">(</span><span class="s1">&#39;LaB6&#39;</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># Adjust the position of the moderator. Adjust the position and orentation of banks 42 and 87</span>
<span class="n">CorelliPowderCalibrationCreate</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;LaB6&#39;</span><span class="p">,</span>
                               <span class="n">OutputWorkspacesPrefix</span><span class="o">=</span><span class="s1">&#39;LaB6_&#39;</span><span class="p">,</span>
                               <span class="n">TubeDatabaseDir</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span><span class="p">,</span>
                               <span class="n">TofBinning</span><span class="o">=</span><span class="p">[</span><span class="mi">3000</span><span class="p">,</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span><span class="mi">16660</span><span class="p">],</span>
                               <span class="n">PeakFunction</span><span class="o">=</span><span class="s1">&#39;Gaussian&#39;</span><span class="p">,</span>
                               <span class="n">PeakPositions</span><span class="o">=</span><span class="p">[</span><span class="mf">1.3143</span><span class="p">,</span> <span class="mf">1.3854</span><span class="p">,</span><span class="mf">1.6967</span><span class="p">,</span> <span class="mf">1.8587</span><span class="p">,</span> <span class="mf">2.0781</span><span class="p">,</span> <span class="mf">2.3995</span><span class="p">,</span> <span class="mf">2.9388</span><span class="p">,</span> <span class="mf">4.1561</span><span class="p">],</span>
                               <span class="n">SourceMaxTranslation</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                               <span class="n">ComponentList</span><span class="o">=</span><span class="s1">&#39;bank42/sixteenpack,bank87/sixteenpack&#39;</span><span class="p">,</span>
                               <span class="n">ComponentMaxTranslation</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
                               <span class="n">ComponentMaxRotation</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
</pre></div>
</div>
<p>A set of output workspaces are created, including the adjustment diagnostic workspaces.</p>
<a class="reference internal image-reference" href="../_images/CorelliPowderCalibrationCreate_1.png"><img alt="output workspaces" class="align-center" src="../_images/CorelliPowderCalibrationCreate_1.png" style="width: 800px;" /></a>
<p>All workspaces are prefixed by <code class="docutils literal notranslate"><span class="pre">LaB6_</span></code>, which is the value we set for option <code class="docutils literal notranslate"><span class="pre">OutputWorkspacesPrefix</span></code> when we
invoked the algorithm. A description of the output workspaces follows:</p>
<p>Workspace <code class="docutils literal notranslate"><span class="pre">LaB6_adjustments</span></code> is the main result, a table containing adjustments for different instrument components.
In our example, we have adjusted the moderator and banks 42 and 87.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>ComponentName</p></th>
<th class="head"><p>Xposition</p></th>
<th class="head"><p>Yposition</p></th>
<th class="head"><p>Zposition</p></th>
<th class="head"><p>XdirectionCosine</p></th>
<th class="head"><p>YdirectionCosine</p></th>
<th class="head"><p>ZdirectionCosine</p></th>
<th class="head"><p>RotationAngle</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>moderator</p></td>
<td><p>0.0</p></td>
<td><p>0.0</p></td>
<td><p>-19.9944</p></td>
<td><p>0.0</p></td>
<td><p>0.0</p></td>
<td><p>0.0</p></td>
<td><p>0.0</p></td>
</tr>
<tr class="row-odd"><td><p>bank42/sixteenpack</p></td>
<td><p>2.5941</p></td>
<td><p>0.0625</p></td>
<td><p>0.0870</p></td>
<td><p>0.0009</p></td>
<td><p>-0.9997</p></td>
<td><p>0.0210</p></td>
<td><p>92.3187</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Xposition</span></code>, <code class="docutils literal notranslate"><span class="pre">Yposition</span></code>, <code class="docutils literal notranslate"><span class="pre">Zposition</span></code>: coordinates for the center of <code class="docutils literal notranslate"><span class="pre">ComponentName</span></code> in the lab’s frame of reference. Units are in Angstroms.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">XdirectionCosine</span></code>, <code class="docutils literal notranslate"><span class="pre">YdirectionCosine</span></code>, <code class="docutils literal notranslate"><span class="pre">ZdirectionCosine</span></code>: direction cosines in the lab’s frame of reference. They define a rotation axis to set the orientation of <code class="docutils literal notranslate"><span class="pre">ComponentName</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RotationAngle</span></code>: rotate this many degrees around the previous rotation axis to set the orientation of <code class="docutils literal notranslate"><span class="pre">ComponentName</span></code>.</p></li>
</ul>
<p>While <code class="docutils literal notranslate"><span class="pre">LaB6_adjustments</span></code> contains absolute position and orientation values, table <code class="docutils literal notranslate"><span class="pre">LaB6_displacements</span></code> lists
changes in position and orientation for each Bank, as follows:</p>
<ul class="simple">
<li><p><cite>DeltaR</cite>: change in distance from Component to Sample (in mili-meter)</p></li>
<li><p><cite>DeltaX</cite>: change in X-coordinate of Component (in mili-meter)</p></li>
<li><p><cite>DeltaY</cite>: change in Y-coordinate of Component (in mili-meter)</p></li>
<li><p><cite>DeltaZ</cite>: change in Z-coordinate of Component (in mili-meter)</p></li>
<li><p><cite>DeltaAlpha</cite>: change in rotation around the Y-axis (in degrees)</p></li>
<li><p><cite>DeltaBeta</cite>: change in rotation around the X-axis (in degrees)</p></li>
<li><p><cite>DeltaGamma</cite>: change in rotation around the Z-axis (in degrees)</p></li>
</ul>
<p>Option <cite>FixY=True</cite> will result in <cite>DeltaY=0</cite> for all banks. Similarly, option <cite>FixYaw=True</cite> will result in
<cite>DeltaGamma=0</cite> for all banks.</p>
<p>The diagnostics workspaces are stored within <code class="docutils literal notranslate"><span class="pre">WorkspaceGroup</span> <span class="pre">LaB6_bank_adjustment_diagnostics</span></code>. These are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LaB6_PDCalibration_peaks_original</span></code> and <code class="docutils literal notranslate"><span class="pre">LaB6_PDCalibration_peaks_adjustments</span></code> contains one fitted-intensity spectrum per bank versus <code class="docutils literal notranslate"><span class="pre">d-spacing</span></code> before and after the banks are adjusted.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/CorelliPowderCalibrationCreate_2.png"><img alt="fitted-intensity spectrum for bank 87" class="align-center" src="../_images/CorelliPowderCalibrationCreate_2.png" style="width: 400px;" /></a>
<p>As one can see, intensity is displayed only in the neighborhood of those values of <cite>d-spacing</cite> where peaks are found.
In addition, we don’t show the raw intensity, but we substitute each raw peak with a Gaussian fit of the peak.
This substitution takes place on every pixel of the bank. Later, we add up all these fitted-intensity peaks for all
pixels within one bank.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LaB6_peak_deviations_original</span></code> and <code class="docutils literal notranslate"><span class="pre">LaB6_peak_deviations_adjustment</span></code> finds for each peak the difference between the peak center and the reference d-spacing value we know from the standard. These peak center deviations are collected for all peaks found in the pixels of the bank, and then histogrammed.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/CorelliPowderCalibrationCreate_3.png"><img alt="Histogram of peak center deviations for bank 42" class="align-center" src="../_images/CorelliPowderCalibrationCreate_3.png" style="width: 400px;" /></a>
<p>Adjusting the bank removes any observed systemic deviation, thus centering the histogram around the
no-deviation value. The FHWM of these histograms is only modestly reduced, indicating that the remaining
observed deviations are not due to misalignment in the position and orientation of the bank.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LaB6_percent_peak_deviations_original</span></code> and <code class="docutils literal notranslate"><span class="pre">LaB6_percent_peak_deviations_adjustment</span></code> histograms the unitless peak center deviations, this achieved dividing each deviation by its reference d-spacing, i.e. <span class="math notranslate nohighlight">\(\frac{d_{observed} - d_{reference}}{d_{reference}}\)</span>. This largely eliminates the scaling of the peak center deviation with the value of the peak center.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/CorelliPowderCalibrationCreate_4.png"><img alt="Histogram of peak center percent deviations for bank 42" class="align-center" src="../_images/CorelliPowderCalibrationCreate_4.png" style="width: 400px;" /></a>
<p>Adjusting the bank removes the previously observed systemic deviation and modestly reduces the FWHM of the histogram.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LaB6_percent_peak_deviations_summary</span></code> presents basics statistics for the histograms of <code class="docutils literal notranslate"><span class="pre">LaB6_percent_peak_deviations_original</span></code> and <code class="docutils literal notranslate"><span class="pre">LaB6_percent_peak_deviations_adjustment</span></code>, namely the average and FWHM of each histogram, as well as the average of the absolute value of the deviations.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/CorelliPowderCalibrationCreate_5.png"><img alt="Statistics for the histogram of peak center deviations for bank 42" class="align-center" src="../_images/CorelliPowderCalibrationCreate_5.png" style="width: 600px;" /></a>
<p>From the picture, peaks in bank87 deviated from their reference value between <span class="math notranslate nohighlight">\(mean - FWHM \simeq -1\%\)</span> and
<span class="math notranslate nohighlight">\(mean + FWHM \simeq +4.5\%\)</span> before adjustment. After adjustment the peaks deviated between <span class="math notranslate nohighlight">\(-2\%\)</span> and
<span class="math notranslate nohighlight">\(+2\%\)</span></p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Diffraction/Reduction.html">Diffraction\Reduction</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/66c74f87d9b779695dc85b538bc48767c5975b19/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/CorelliPowderCalibrationCreate.py">CorelliPowderCalibrationCreate.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CorelliCrossCorrelate-v1.html" title="Previous Chapter: CorelliCrossCorrelate v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; CorelliCrossC...</span>
    </a>
  </li>
  <li>
    <a href="CorrectKiKf-v1.html" title="Next Chapter: CorrectKiKf v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">CorrectKiKf v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>