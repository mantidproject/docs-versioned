<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Framework Changes</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <script src="../../_static/documentation_options.js?v=5b08953a"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Indirect Geometry Changes" href="indirect_geometry.html" />
    <link rel="prev" title="Direct Geometry Changes" href="direct_geometry.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="../index.html" >Release Notes</a> &#187;</li>
          
            <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Mantid 5.1.0 Release Notes</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">Framework Changes</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="framework-changes">
<h1>Framework Changes<a class="headerlink" href="#framework-changes" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#concepts" id="id2">Concepts</a></p></li>
<li><p><a class="reference internal" href="#new-algorithms" id="id3">New Algorithms</a></p></li>
<li><p><a class="reference internal" href="#algorithms" id="id4">Algorithms</a></p></li>
<li><p><a class="reference internal" href="#data-handling" id="id5">Data Handling</a></p></li>
<li><p><a class="reference internal" href="#data-objects" id="id6">Data Objects</a></p></li>
<li><p><a class="reference internal" href="#histogramdata" id="id7">HistogramData</a></p></li>
<li><p><a class="reference internal" href="#python" id="id8">Python</a></p></li>
<li><p><a class="reference internal" href="#improvements" id="id9">Improvements</a></p></li>
<li><p><a class="reference internal" href="#bugfixes" id="id10">Bugfixes</a></p></li>
<li><p><a class="reference internal" href="#deprecations" id="id11">Deprecations</a></p></li>
</ul>
</nav>
<section id="concepts">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Concepts</a><a class="headerlink" href="#concepts" title="Link to this heading">¶</a></h2>
</section>
<section id="new-algorithms">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">New Algorithms</a><a class="headerlink" href="#new-algorithms" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../../algorithms/PaalmanPingsMonteCarloAbsorption-v1.html#algm-paalmanpingsmontecarloabsorption"><span class="std std-ref">PaalmanPingsMonteCarloAbsorption</span></a> will calculate all 4 terms in self attenuation corrections following the Paalman and Pings formalism. Simple shapes are supported: <code class="docutils literal notranslate"><span class="pre">FlatPlate</span></code>, <code class="docutils literal notranslate"><span class="pre">Cylinder</span></code>, and <code class="docutils literal notranslate"><span class="pre">Annulus</span></code>. Both elastic and inelastic, as well as direct and indirect geometries, are supported.</p></li>
<li><p><a class="reference internal" href="../../algorithms/ISISJournalGetExperimentRuns-v1.html#algm-isisjournalgetexperimentruns"><span class="std std-ref">ISISJournalGetExperimentRuns</span></a> returns run information for a particular experiment from ISIS journal files.</p></li>
<li><p><a class="reference internal" href="../../algorithms/LoadILLPolarizedDiffraction-v1.html#algm-loadillpolarizeddiffraction"><span class="std std-ref">LoadILLPolarizedDiffraction</span></a> reads raw NeXuS ILL files for D7 instrument data.</p></li>
</ul>
</section>
<section id="algorithms">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Algorithms</a><a class="headerlink" href="#algorithms" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Algorithms now lazily load their documentation and function signatures, improving import times from the <code class="docutils literal notranslate"><span class="pre">simpleapi</span></code>.</p></li>
<li><p><a class="reference internal" href="../../algorithms/MonteCarloAbsorption-v1.html#algm-montecarloabsorption"><span class="std std-ref">MonteCarloAbsorption</span></a> has received a number of updates:</p>
<ul>
<li><p>Corrections are not calculated anymore for masked spectra.</p></li>
<li><p>Corrections can be calculated for a workspace without a sample, e.g. container only.</p></li>
<li><p>This algorithm now calculates the error on the absorption correction factors based on the spread of the attenuation factors across the simulated paths and the number of simulated paths. The error from any spatial interpolation and any wavelength interpolation performed is also included.</p></li>
<li><p>The random seed is now incremented for each detector.</p></li>
<li><p>Bug fixed where setting the <code class="docutils literal notranslate"><span class="pre">ResimulateTracksForDifferentWavelengths</span></code> parameter to True was ignored.</p></li>
<li><p>Added support for a Circular Beam Profile.</p></li>
</ul>
</li>
<li><p><a class="reference internal" href="../../algorithms/SetSample-v1.html#algm-setsample"><span class="std std-ref">SetSample</span></a> is extended to support composite shapes, such as <code class="docutils literal notranslate"><span class="pre">FlatPlateHolder</span></code> and <code class="docutils literal notranslate"><span class="pre">HollowCylinderHolder</span></code>. Also, the input validation is made more stringent.</p></li>
<li><p>Adjusted <a class="reference internal" href="../../algorithms/AddPeak-v1.html#algm-addpeak"><span class="std std-ref">AddPeak</span></a> to only allow peaks from the same instrument as the peaks workspace to be added to that workspace.</p></li>
<li><p><a class="reference internal" href="../../algorithms/ReplaceSpecialValues-v1.html#algm-replacespecialvalues"><span class="std std-ref">ReplaceSpecialValues</span></a> now can also check the Error axis for unwanted values if the appropriate checkbox is ticked.</p></li>
<li><p><a class="reference internal" href="../../algorithms/MaskDetectorsIf-v1.html#algm-maskdetectorsif"><span class="std std-ref">MaskDetectorsIf</span></a> has the following updates:</p>
<ul>
<li><p>The algorithm now checks all of the data bins for each spectrum of a workspace, previously it only checked the first bin.</p></li>
<li><p>A new Operator option has been added <code class="docutils literal notranslate"><span class="pre">NotFinite</span></code> that allows you to mask detectors that contain infinite or <a class="reference external" href="https://en.wikipedia.org/wiki/NaN">NaN</a> values.</p></li>
</ul>
</li>
<li><p>A form of reversible masking that could lead to misleading and incorrect results has been removed from Mantid,
this means that ClearMaskedSpectra is no longer necessary after calling <a class="reference internal" href="../../algorithms/MaskInstrument-v1.html#algm-maskinstrument"><span class="std std-ref">MaskInstrument</span></a> and <a class="reference internal" href="../../algorithms/MaskDetectorsIf-v1.html#algm-maskdetectorsif"><span class="std std-ref">MaskDetectorsIf</span></a>.
ClearMaskedSpectra has been removed as it no longer has a use,
and <a class="reference internal" href="../../algorithms/MaskInstrument-v1.html#algm-maskinstrument"><span class="std std-ref">MaskInstrument</span></a> is now deprecated and you should use <a class="reference internal" href="../../algorithms/MaskDetectors-v1.html#algm-maskdetectors"><span class="std std-ref">MaskDetectors</span></a> instead.</p></li>
<li><p>Enhanced <a class="reference internal" href="../../algorithms/LoadNGEM-v1.html#algm-loadngem"><span class="std std-ref">LoadNGEM</span></a> to handle partially written events in the data file.
When such incomplete data is encountered, it is skipped until the next valid data is encountered and a warning is printed at algorithm completion of the total number of data bytes discarded.</p></li>
<li><p>Added specialization to <a class="reference internal" href="../../algorithms/SetUncertainties-v1.html#algm-setuncertainties"><span class="std std-ref">SetUncertainties</span></a> for the
case where InputWorkspace == OutputWorkspace. Where possible, avoid the
cost of cloning the InputWorkspace.</p></li>
<li><p>Add parameters to <a class="reference internal" href="../../algorithms/LoadSampleShape-v1.html#algm-loadsampleshape"><span class="std std-ref">LoadSampleShape</span></a> to allow the mesh in the input file to be rotated and/or translated</p></li>
<li><p>Added alias for <a class="reference internal" href="../../algorithms/GeneratePythonScript-v1.html#algm-generatepythonscript"><span class="std std-ref">GeneratePythonScript</span></a> as <strong>ExportHistory</strong>.</p></li>
<li><p><a class="reference internal" href="../../algorithms/ExtractFFTSpectrum-v1.html#algm-extractfftspectrum"><span class="std std-ref">ExtractFFTSpectrum</span></a> has extra properties (Shift, AutoShift, and AcceptXRoundingErrors) to reflect those of the underlying FFT.</p></li>
</ul>
</section>
<section id="data-handling">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Data Handling</a><a class="headerlink" href="#data-handling" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Added a case to <a class="reference internal" href="../../algorithms/Load-v1.html#algm-load"><span class="std std-ref">Load</span></a> to handle <code class="docutils literal notranslate"><span class="pre">WorkspaceGroup</span></code> as the output type</p></li>
<li><p>The material definition has been extended to include an optional filename containing a profile of attenuation factor versus wavelength. This new filename has been added as a parameter to these algorithms:</p>
<ul>
<li><p><a class="reference internal" href="../../algorithms/SetSampleMaterial-v1.html#algm-setsamplematerial"><span class="std std-ref">SetSampleMaterial</span></a></p></li>
<li><p><a class="reference internal" href="../../algorithms/LoadSampleEnvironment-v1.html#algm-loadsampleenvironment"><span class="std std-ref">LoadSampleEnvironment</span></a></p></li>
</ul>
</li>
<li><p>The attenuation profile filename can also be specified in the materials section of the sample environment xml file.</p></li>
</ul>
<figure class="align-right" id="id1">
<a class="reference internal image-reference" href="../../_images/T-Rex.PNG"><img alt="An example of a CAD 3D Geometry" src="../../_images/T-Rex.PNG" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">An example of a CAD 3D Geometry - Not typically found on beamlines</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p><strong>The sample environment xml file now supports the geometry being supplied in the form of a .3mf format file (so far on the Windows platform only). Previously it only supported</strong> <code class="docutils literal notranslate"><span class="pre">.stl</span></code> <strong>files. The</strong> <code class="docutils literal notranslate"><span class="pre">.3mf</span></code> <strong>format is a 3D printing format that allows multiple mesh objects to be stored in a single file that can be generated from many popular CAD applications. As part of this change the algorithms</strong> <a class="reference internal" href="../../algorithms/LoadSampleEnvironment-v1.html#algm-loadsampleenvironment"><span class="std std-ref">LoadSampleEnvironment</span></a> <strong>and</strong> <a class="reference internal" href="../../algorithms/SaveSampleEnvironmentAndShape-v1.html#algm-savesampleenvironmentandshape"><span class="std std-ref">SaveSampleEnvironmentAndShape</span></a> <strong>have been updated to also support the .3mf format.</strong></p></li>
<li><p>Nexus log data alarms are now supported by Mantid. Log data that is marked as invalid will trigger a warning in the log and be filtered by default.  If the entire log is marked as invalid, then the values will be used as unfiltered as no better values exist, but the warning will still appear in the log.</p></li>
<li><p>A new Instrument Definition File for NIMROD is now shipped with Mantid, replacing the existing definition.</p></li>
<li><p>The <a class="reference internal" href="../../algorithms/LoadISISNexus-v2.html#algm-loadisisnexus"><span class="std std-ref">LoadISISNexus</span></a> algorithm has been modified to remove the need for the VMS compatibility block.
This has led to the removal of the following variables from the sample logs as they were deemed unnecessary: dmp,
dmp_freq, dmp_units dur, dur_freq, dur_secs, dur_wanted, durunits, mon_sum1, mon_sum2, mon_sum3, run_header (this is available in the workspace title).</p></li>
</ul>
</section>
<section id="data-objects">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Data Objects</a><a class="headerlink" href="#data-objects" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Added MatrixWorkspace::findY to find the histogram and bin with a given value</p></li>
<li><p>Matrix Workspaces now ignore non-finite values when integrating values for the instrument view.  Please note this is different from the <a class="reference internal" href="../../algorithms/Integration-v1.html#algm-integration"><span class="std std-ref">Integration</span></a> algorithm.</p></li>
</ul>
</section>
<section id="histogramdata">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">HistogramData</a><a class="headerlink" href="#histogramdata" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>The linear and spline interpolation functionality that acts on histograms has been updated to add the ability to calculate errors. This has involved swapping out the gsl implementations of linear and spline interpolation and replacing with a native Mantid implementation. The new functionality is off by default and has been explicitly enabled for the MonteCarloAbsorption algorithm. The histogram interpolation functionality is currently used by these algorithms: <a class="reference internal" href="../../algorithms/MonteCarloAbsorption-v1.html#algm-montecarloabsorption"><span class="std std-ref">MonteCarloAbsorption</span></a> , <a class="reference internal" href="../../algorithms/AbsorptionCorrection-v1.html#algm-absorptioncorrection"><span class="std std-ref">AbsorptionCorrection</span></a>, <a class="reference internal" href="../../algorithms/LoadILLPolarizationFactors-v1.html#algm-loadillpolarizationfactors"><span class="std std-ref">LoadILLPolarizationFactors</span></a>, <a class="reference internal" href="../../algorithms/JoinISISPolarizationEfficiencies-v1.html#algm-joinisispolarizationefficiencies"><span class="std std-ref">JoinISISPolarizationEfficiencies</span></a>.</p></li>
</ul>
</section>
<section id="python">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Python</a><a class="headerlink" href="#python" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>To get a list of Spectrum Numbers, call <code class="docutils literal notranslate"><span class="pre">getSpectrumNumbers()</span></code> on a
workspace. For example: <code class="docutils literal notranslate"><span class="pre">spec_nums</span> <span class="pre">=</span> <span class="pre">ws.getSpectrumNumbers()</span></code></p></li>
<li><p>Documentation for manipulating <a class="reference internal" href="../../tutorials/python_in_mantid/further_alg_ws/02_scripting_workspaces.html#scripting-workspaces"><span class="std std-ref">workspaces</span></a> and <a class="reference internal" href="../../tutorials/python_in_mantid/plotting/02_scripting_plots.html#scripting-plots"><span class="std std-ref">plots</span></a> within a script has been produced.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Property.units</span></code> now attempts to encode with windows-1252 if utf-8 fails.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Property.unitsAsBytes</span></code> has been added to retrieve the raw bytes from the units string.</p></li>
<li><p>Various file finding methods have been moved to <code class="docutils literal notranslate"><span class="pre">mantid.api.InstrumentFileFinder</span></code>. For compatibility
these still exist in <code class="docutils literal notranslate"><span class="pre">ExperimentInfo</span></code> but the helpers should be used instead in the future.</p></li>
<li><p>A new method for finding IPF files has been added to the <code class="docutils literal notranslate"><span class="pre">InstrumentFileFinder</span></code>
<code class="docutils literal notranslate"><span class="pre">getParameterPath</span></code>, which will accept an instrument name and return the full path to the associated
IPF file.</p></li>
</ul>
</section>
<section id="improvements">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Improvements</a><a class="headerlink" href="#improvements" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Updated the convolution function in the fitting framework to allow the convolution of two composite functions.</p></li>
<li><p>Added an unroll all checkbox in the Algorithm History Window, which allows all algorithms to be unrolled at once when copying the script.</p></li>
<li><p>Added a function to the Matrix class to support an analytic calculation of the inverse of a symmetric tridiagonal matrix</p></li>
</ul>
</section>
<section id="bugfixes">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Bugfixes</a><a class="headerlink" href="#bugfixes" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Loading empty fields from NeXus files now returns an empty vector.</p></li>
<li><p>Subscribing algorithms from a separate thread is now handled safely.</p></li>
<li><p>Log filtering (run status and period filtering) is now correctly being applied after reloading a Mantid processed NeXus file, as was configured by the user when processing the original data.</p></li>
<li><p>Running <a class="reference internal" href="../../algorithms/ExtractFFTSpectrum-v1.html#algm-extractfftspectrum"><span class="std std-ref">ExtractFFTSpectrum v1</span></a> with only a real input, no longer produces a blank output at the end of the workspace.</p></li>
<li><p><a class="reference internal" href="../../algorithms/ExtractFFTSpectrum-v1.html#algm-extractfftspectrum"><span class="std std-ref">ExtractFFTSpectrum v1</span></a> now gives the correct units.</p></li>
<li><p>Error values no longer tend to zero, after multiple instances of <a class="reference internal" href="../../algorithms/Rebin2D-v1.html#algm-rebin2d"><span class="std std-ref">Rebin2D</span></a> on the same workspace.</p></li>
<li><p>LoadRaw no longer tries to load non-existent log files that were listed in the alternate data stream.</p></li>
</ul>
</section>
<section id="deprecations">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Deprecations</a><a class="headerlink" href="#deprecations" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>CalculateMonteCarloAbsorption</strong> and <strong>SimpleShapeMonteCarloAbsorption</strong> are deprecated and functionality is replaced by the new <a class="reference internal" href="../../algorithms/PaalmanPingsMonteCarloAbsorption-v1.html#algm-paalmanpingsmontecarloabsorption"><span class="std std-ref">PaalmanPingsMonteCarloAbsorption</span></a>. While the new one provides more complete and more correct calculation, it can also fall back to the simpler calculation if the container is not specified.</p></li>
<li><p><strong>RecordPythonScript</strong> algorithm hsa been deprecated and functionality continues with <a class="reference internal" href="../../algorithms/GeneratePythonScript-v1.html#algm-generatepythonscript"><span class="std std-ref">GeneratePythonScript</span></a></p></li>
</ul>
<p><a class="reference internal" href="index.html#v5-1-0"><span class="std std-ref">Release 5.1.0</span></a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="direct_geometry.html" title="Previous Chapter: Direct Geometry Changes"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Direct Geomet...</span>
    </a>
  </li>
  <li>
    <a href="indirect_geometry.html" title="Next Chapter: Indirect Geometry Changes"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Indirect Geom... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>