<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Fit Script Generator</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Sample Transmission Calculator" href="Sample%20Transmission%20Calculator.html" />
    <link rel="prev" title="Manage User Directories" href="../framework/ManageUserDirectories.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.8</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Interfaces</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">Fit Script Generator</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="fit-script-generator">
<span id="fit-script-generator-ref"></span><h1>Fit Script Generator<a class="headerlink" href="#fit-script-generator" title="Permalink to this heading">¶</a></h1>
<a class="reference internal image-reference" href="../../_images/FitScriptGenerator.PNG"><img alt="../../_images/FitScriptGenerator.PNG" class="align-right" src="../../_images/FitScriptGenerator.PNG" style="height: 400px;" /></a>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#interface-overview" id="id1">Interface Overview</a></p></li>
<li><p><a class="reference internal" href="#interface-options" id="id2">Interface Options</a></p></li>
<li><p><a class="reference internal" href="#concepts" id="id3">Concepts</a></p></li>
<li><p><a class="reference internal" href="#sequential-fitting-concepts" id="id4">Sequential Fitting Concepts</a></p></li>
<li><p><a class="reference internal" href="#simultaneous-fitting-concepts" id="id5">Simultaneous Fitting Concepts</a></p></li>
<li><p><a class="reference internal" href="#usage-example-setup" id="id6">Usage Example setup</a></p></li>
<li><p><a class="reference internal" href="#usage-example-for-sequential-fitting" id="id7">Usage Example for Sequential Fitting</a></p></li>
<li><p><a class="reference internal" href="#usage-example-for-simultaneous-fitting" id="id8">Usage Example for Simultaneous Fitting</a></p></li>
</ul>
</nav>
<section id="interface-overview">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Interface Overview</a><a class="headerlink" href="#interface-overview" title="Permalink to this heading">¶</a></h2>
<p>This interface is used to generate a python script used for sequential or simultaneous fitting. The interface allows you to select
specific domains of a workspace, and choose different fit ranges for each domain. For simultaneous fitting, the interface allows
you to choose different fit functions for different domains. It also allows great flexibility when setting a Global tie. See the
usage examples below for a full explanation of how to use this interface.</p>
</section>
<section id="interface-options">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Interface Options</a><a class="headerlink" href="#interface-options" title="Permalink to this heading">¶</a></h2>
<p><strong>Remove Domains</strong>
Removes the selected domains from the domain data table.</p>
<p><strong>Add Domains</strong>
Choose workspace domains to load into the domain data table.</p>
<p><strong>Domain Data Table</strong>
Displays the loaded workspace domain data and their corresponding fit range. The fit ranges can be different for each domain, and
can be edited by double clicking the <code class="docutils literal notranslate"><span class="pre">StartX</span></code> or <code class="docutils literal notranslate"><span class="pre">EndX</span></code> cell. The Function Index corresponding to each domain is displayed when
Simultaneous fitting mode is selected.</p>
<p><strong>Apply function changes to</strong>
There are several changes you can make to the selected fit function such as adding or removing a fit function, changing the value of
a parameter, tying a parameter or constraining a parameter. These changes can be applied to all the domains in the <code class="docutils literal notranslate"><span class="pre">Domain</span> <span class="pre">Data</span> <span class="pre">Table</span></code>
if <code class="docutils literal notranslate"><span class="pre">All</span> <span class="pre">Domains</span></code> is selected, or only to the domains with highlighted rows if <code class="docutils literal notranslate"><span class="pre">Selected</span> <span class="pre">Domains</span></code> is selected.</p>
<p><strong>Function Browser</strong>
The Function Browser allows you to add or remove fit functions and adjust their parameters and attributes. It also allows you to add
Fixes, Ties and Constraints. The Function Index corresponding to a specific domain is displayed at the top of the Function Browser
when in Simultaneous fitting mode.</p>
<p><strong>Fitting Mode</strong>
Determines whether to generate a python script for Sequential or Simultaneous fitting.</p>
<p><strong>Generate Script to File</strong>
The data selected in the Fit Script Generator is used to generate a python script, which is then saved to a file.</p>
<p><strong>Generate Script to Clipboard</strong>
The data selected in the Fit Script Generator is used to generate a python script, which is then copied to the clipboard. Paste this
into a python script editor window.</p>
</section>
<section id="concepts">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Concepts</a><a class="headerlink" href="#concepts" title="Permalink to this heading">¶</a></h2>
<p><strong>Domain</strong>
This refers to a set of X, Y and error data at a specific index of a <a class="reference internal" href="../../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a>.</p>
<p><strong>Function Index</strong>
Different domains can have the same function, and therefore have identically named parameters. A Function Index is used to differentiate
between these identically named parameters by specifying the exact location of a parameter. For example if you are performing a simultaneous
fit with two domains each containing a <a class="reference internal" href="../../fitting/fitfunctions/FlatBackground.html#func-flatbackground"><span class="std std-ref">FlatBackground</span></a>, the first domain will have a Function Index of <cite>f0.</cite>
while the second domain has a Function Index of <cite>f1.</cite>. There are therefore two parameters, <cite>f0.A0</cite> and <cite>f1.A0</cite>.</p>
<p><strong>Attribute</strong>
An attribute is a property of a function which doesn’t change during fitting.</p>
<p><strong>Parameter</strong>
A parameter is a decimal value property of a function which will change during fitting. It has an error.</p>
<p><strong>Fix</strong>
A Fix is where a parameters value is forced to stay the same during a fit. It is a type of Tie.</p>
<p><strong>Constraint</strong>
A Constraint is where a parameters value is forced to stay within a defined region during a fit.</p>
<p><strong>Tie</strong>
A Tie is where a parameters value is set to be equal to the value of another parameter, or an expression, during a fit.</p>
</section>
<section id="sequential-fitting-concepts">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Sequential Fitting Concepts</a><a class="headerlink" href="#sequential-fitting-concepts" title="Permalink to this heading">¶</a></h2>
<p>During a Sequential fit, each domain is fitted one after another. The parameter values at the end of a domain fit are
passed to the next domain fit to be used as the initial parameter values.</p>
<p><strong>Local Tie</strong>
A local tie is when you tie a parameter to another parameter which is in the same domain. This can be done for both
sequential and simultaneous fitting.</p>
</section>
<section id="simultaneous-fitting-concepts">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Simultaneous Fitting Concepts</a><a class="headerlink" href="#simultaneous-fitting-concepts" title="Permalink to this heading">¶</a></h2>
<p>During a Simultaneous fit, each domain is fitted concurrently. This allows you to tie a parameter to another parameter
in a different domain.</p>
<p><strong>Global Tie</strong>
A global tie is when you tie a parameter to another parameter which is in a different domain. This can only be done for
simultaneous fitting.</p>
<p><strong>Global Parameter</strong>
A global parameter is a type of global tie. This is where each domain contains the same parameter, and it is ‘shared’ by
each domain during a simultaneous fit.</p>
</section>
<section id="usage-example-setup">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Usage Example setup</a><a class="headerlink" href="#usage-example-setup" title="Permalink to this heading">¶</a></h2>
<p>The following usage examples require some initial setup:</p>
<ol class="arabic simple">
<li><p>Download the ISIS Sample data set, <a class="reference external" href="http://download.mantidproject.org/">available here</a>.</p></li>
<li><p>Open the Manage User Directories dialog. Add the location of the ISIS Sample data set to the search path.</p></li>
</ol>
</section>
<section id="usage-example-for-sequential-fitting">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Usage Example for Sequential Fitting</a><a class="headerlink" href="#usage-example-for-sequential-fitting" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Run the following script to load some Indirect Inelastic reduced data</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mantid.simpleapi</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;irs26176_graphite002_red.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;irs26176_red&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Open the Fit Script Generator interface.</p></li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">Domains</span></code> and select the ‘irs26176_red’ workspace.</p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">Workspace</span> <span class="pre">Indices</span></code> field enter ‘0-3’.</p></li>
<li><p>Untick <code class="docutils literal notranslate"><span class="pre">Keep</span> <span class="pre">Open</span></code> and click <code class="docutils literal notranslate"><span class="pre">Ok</span></code>.</p></li>
<li><p>Right click on the <code class="docutils literal notranslate"><span class="pre">Function</span> <span class="pre">Browser</span></code> and add a <code class="docutils literal notranslate"><span class="pre">Lorentzian</span></code> function.</p></li>
<li><p>Add a second <code class="docutils literal notranslate"><span class="pre">Lorentzian</span></code> function in the same way.</p></li>
<li><p>Change the <code class="docutils literal notranslate"><span class="pre">Amplitude</span></code> parameter values to 1.5</p></li>
<li><p>Make sure the <code class="docutils literal notranslate"><span class="pre">Fitting</span> <span class="pre">Mode</span></code> is Sequential</p></li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Generate</span> <span class="pre">Script</span> <span class="pre">to</span> <span class="pre">Clipboard</span></code>, and then paste into an empty python script window.</p></li>
<li><p>Run the script and you will see the results of a sequential fit.</p></li>
</ol>
<a class="reference internal image-reference" href="../../_images/FitScriptGenerator_SequentialFit.png"><img alt="../../_images/FitScriptGenerator_SequentialFit.png" class="align-center" src="../../_images/FitScriptGenerator_SequentialFit.png" style="height: 300px;" /></a>
</section>
<section id="usage-example-for-simultaneous-fitting">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Usage Example for Simultaneous Fitting</a><a class="headerlink" href="#usage-example-for-simultaneous-fitting" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Run the following script to load some Indirect Inelastic reduced data. This will add a background to the first spectrum.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mantid.simpleapi</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">irs26176_red</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;irs26176_graphite002_red.nxs&#39;</span><span class="p">)</span>

<span class="c1"># Create a background workspace</span>
<span class="n">y_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">irs26176_red</span><span class="o">.</span><span class="n">dataY</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">*</span> <span class="n">irs26176_red</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">())</span>
<span class="n">y_values</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">irs26176_red</span><span class="o">.</span><span class="n">dataY</span><span class="p">(</span><span class="mi">0</span><span class="p">))]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">DataX</span><span class="o">=</span><span class="n">irs26176_red</span><span class="o">.</span><span class="n">dataX</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">DataY</span><span class="o">=</span><span class="n">y_values</span><span class="p">,</span> <span class="n">NSpec</span><span class="o">=</span><span class="n">irs26176_red</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">(),</span> <span class="n">UnitX</span><span class="o">=</span><span class="s1">&#39;DeltaE&#39;</span><span class="p">,</span> <span class="n">Distribution</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ParentWorkspace</span><span class="o">=</span><span class="s1">&#39;irs26176_red&#39;</span><span class="p">)</span>

<span class="c1"># Add the background</span>
<span class="n">Plus</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">irs26176_red</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="s1">&#39;background&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;irs26176_red&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Open the Fit Script Generator interface.</p></li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">Domains</span></code> and select the ‘irs26176_red’ workspace.</p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">Workspace</span> <span class="pre">Indices</span></code> field enter ‘0-3’.</p></li>
<li><p>Untick <code class="docutils literal notranslate"><span class="pre">Keep</span> <span class="pre">Open</span></code> and click <code class="docutils literal notranslate"><span class="pre">Ok</span></code>.</p></li>
<li><p>Change the <code class="docutils literal notranslate"><span class="pre">Fitting</span> <span class="pre">Mode</span></code> to Simultaneous.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">All</span> <span class="pre">Domains</span></code> to <code class="docutils literal notranslate"><span class="pre">Selected</span> <span class="pre">Domains</span></code>, and then select the top domain in the table.</p></li>
<li><p>Right click on the Function Browser and add a <code class="docutils literal notranslate"><span class="pre">FlatBackground</span></code>. This will only add this function to the selected domain.
Selecting the other table rows will show they do not have any fit functions yet.</p></li>
<li><p>Change the ‘A0’ parameter in the <code class="docutils literal notranslate"><span class="pre">FlatBackground</span></code> to a value of 1.0, and ‘Fix’ it by right clicking on the parameter.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">Selected</span> <span class="pre">Domains</span></code> back to <code class="docutils literal notranslate"><span class="pre">All</span> <span class="pre">Domains</span></code>.</p></li>
<li><p>Right click on the Function Browser and add a <code class="docutils literal notranslate"><span class="pre">Lorentzian</span></code>. This will add the <code class="docutils literal notranslate"><span class="pre">Lorentzian</span></code> function to all of the domains.</p></li>
<li><p>Add another <code class="docutils literal notranslate"><span class="pre">Lorentzian</span></code> so there are two in each of the domains.</p></li>
<li><p>Change the <code class="docutils literal notranslate"><span class="pre">Amplitude</span></code> parameter values in each of the domains to 1.5.</p></li>
<li><p>Select any table row that isn’t the first domain table row.</p></li>
<li><p>Select the first Peak Centre parameter, right click and add a tie to <code class="docutils literal notranslate"><span class="pre">f0.f1.PeakCentre</span></code>. This is a global tie.</p></li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Generate</span> <span class="pre">Script</span> <span class="pre">to</span> <span class="pre">Clipboard</span></code>, and then paste into an empty python script window.</p></li>
<li><p>Run the script and you will see the results of a simultaneous fit. Notice the background in the first spectrum has been accounted for.</p></li>
</ol>
<a class="reference internal image-reference" href="../../_images/FitScriptGenerator_SimultaneousFit.png"><img alt="../../_images/FitScriptGenerator_SimultaneousFit.png" class="align-center" src="../../_images/FitScriptGenerator_SimultaneousFit.png" style="height: 300px;" /></a>
<p><strong>Categories</strong>: <a class="reference external" href="../ILL/categories/Interfaces.html">Interfaces</a> | <a class="reference external" href="../../fitting/fitfunctions/categories/General.html">General</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="../framework/ManageUserDirectories.html" title="Previous Chapter: Manage User Directories"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Manage User D...</span>
    </a>
  </li>
  <li>
    <a href="Sample%20Transmission%20Calculator.html" title="Next Chapter: Sample Transmission Calculator"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Sample Transm... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>