<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>A more Complex case</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Fit Model Choices" href="03_fit_model_choices.html" />
    <link rel="prev" title="Fitting Models To Data" href="01_fitting_models_to_data.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../../../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.8</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="../../index.html" >Training</a> &#187;</li>
          
            <li class="nav-item nav-item-2"><a href="../index.html" >Mantid Basic Course</a> &#187;</li>
          
            <li class="nav-item nav-item-3"><a href="index.html" accesskey="U">Fitting Data</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">A more Complex case</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="a-more-complex-case">
<span id="complex-case"></span><h1>A more Complex case<a class="headerlink" href="#a-more-complex-case" title="Permalink to this heading">¶</a></h1>
<style> .red {color:#FF0000; font-weight:bold} </style>
<style> .green {color:#008000; font-weight:bold} </style>
<style> .blue {color:#0000FF; font-weight:bold} </style>
<style> .orange {color:#FF8C00; font-weight:bold} </style><section id="activating-the-fitting-tools">
<h2>Activating the Fitting tools<a class="headerlink" href="#activating-the-fitting-tools" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Load HRP39182.raw and plot the spectrum number 1</p></li>
<li><p>Zoom in on the peak near 93150 microseconds, as below</p></li>
<li><p>Click on the Fit Toolbar button:
<img alt="PeakFitToolbar.png" src="../../../_images/PeakFitToolbar.png" /></p></li>
</ol>
<p>Three things happens when you click on the Fit Toolbar button:</p>
<ul class="simple">
<li><p>The Fit Property Browser, by default, will position itself on the
left of the plot window</p></li>
<li><p>Fitting options become available by right-clicking on the plot</p></li>
<li><p>Fit function items are added to the plot, initially the two green vertical
dashed lines marking the start and end of the fitting range.</p></li>
</ul>
<figure class="align-center">
<img alt="FirstStartMantidPlotFitting_MBC.png" src="../../../_images/FirstStartMantidPlotFitting_MBC.png" />
</figure>
</section>
<section id="select-the-fitting-range">
<h2>Select the Fitting range<a class="headerlink" href="#select-the-fitting-range" title="Permalink to this heading">¶</a></h2>
<p>The fitting range is the region of the data where you will attempt to do
a fit, represented by the green vertical dashed lines.  These
match the <span class="green">StartX and EndX values</span> in the Fit Property Browser.</p>
<ol class="upperalpha simple">
<li><p>You can click and drag the vertical dashed lines to alter the range,
which will update the StartX and EndX values.</p></li>
<li><p>You can click on the StartX/EndX values and type in new ones,
which will update the dashed lines on the plot.</p></li>
</ol>
</section>
<section id="other-settings-properties">
<h2>Other Settings properties<a class="headerlink" href="#other-settings-properties" title="Permalink to this heading">¶</a></h2>
<p>In addition to StartX/EndX there are a number of other essential fit
setting properties including:</p>
<ul class="simple">
<li><p>Workspace and Workspace Index: which workspace to fit? Automatically filled based on the plotted spectrum</p></li>
<li><p>Minimizer: Choose the minimizer appropriate for your fit model</p></li>
<li><p>Cost function: A measure of the quality of a fit.</p></li>
<li><p>Plot Difference: When the result of a fit is displayed optionally the
difference between the model and the fit can also be displayed</p></li>
</ul>
<p>More documentation of these is available from <a class="reference internal" href="../../../concepts/Fitting.html#fitting"><span class="std std-ref">Fitting</span></a>.</p>
</section>
<section id="functions-properties-setting-up-a-fit-model">
<h2>Functions properties: Setting up a fit model<a class="headerlink" href="#functions-properties-setting-up-a-fit-model" title="Permalink to this heading">¶</a></h2>
<p>Let’s build a model consisting of a peak and a background function.</p>
<ol class="arabic simple">
<li><p>Right-click on the plot, and choose ‘Select peak type’ –&gt; select <em>Gaussian</em>.
Move the mouse cursor to click near the top of the peak.</p></li>
<li><p>Click on the central solid red line and drag it sideways and upwards to set the initial peak centre and height. Drag either one of the dashed red lines to set the initial
Full Width Half Maximum (FWHM) of the peak.</p></li>
</ol>
<figure class="align-center">
<img alt="ChangePeakWidth.png" src="../../../_images/ChangePeakWidth.png" />
</figure>
<ol class="arabic simple" start="3">
<li><p>Again, right-click on the plot, and choose ‘Add background’ –&gt; select <em>FlatBackground</em></p></li>
</ol>
<p>Note that two fit functions have appeared in the Fit
Property Browser called <code class="docutils literal notranslate"><span class="pre">f0-Gaussian</span></code> and <code class="docutils literal notranslate"><span class="pre">f1-FlatBackground</span></code>.
Click on the triangles beside these functions to reveal their fit parameters.
Just as with the StartX/EndX values, dragging the solid and dashed red lines on the plot updates these values, while changing the values will update the positions of the red lines on the plot.</p>
<figure class="align-center">
<img alt="PeakAndBackgroundSetup.png" src="../../../_images/PeakAndBackgroundSetup.png" />
</figure>
<p>Now you have created a <strong>CompositeFunction</strong> model, which is the sum of a Gaussian and a
Flat-background</p>
<p>i.e. <code class="docutils literal notranslate"><span class="pre">f0-Gaussian + f1-FlatBackground</span></code></p>
</section>
<section id="adjusting-fit-function-parameter">
<h2>Adjusting fit function parameter<a class="headerlink" href="#adjusting-fit-function-parameter" title="Permalink to this heading">¶</a></h2>
<p>The initial fit parameter values can affect the speed and the final result obtained from fitting. In
general you want starting parameter that are a close as possible
to the correct result.</p>
<p>Mantid has a tool to help you with this! Turn on “Display &gt; Plot Guess”.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/SelectPlotGuess.png"><img alt="SelectPlotGuess.png" src="../../../_images/SelectPlotGuess.png" style="width: 300px;" /></a>
</figure>
<p>This plots the <span class="orange">model of the initial parameters</span> on top of the <span class="blue">raw data</span>.</p>
<figure class="align-center">
<img alt="PlotGuess.png" src="../../../_images/PlotGuess.png" />
</figure>
<p>The aim is to have this plot and your data overlap reasonable well
before you do the actual fit. Note this is not an absolute requirement
but your chances of a successful fit increase this way.</p>
</section>
<section id="saving-a-model">
<h2>Saving a model<a class="headerlink" href="#saving-a-model" title="Permalink to this heading">¶</a></h2>
<p>You may set up a custom model, which you can save and reload later.</p>
<p><img alt="SaveSetup.png" src="../../../_images/SaveSetup.png" /> <img alt="ArrowRight.png" src="../../../_images/ArrowRight.png" /> <img alt="SaveSetupDialog.png" src="../../../_images/SaveSetupDialog.png" /></p>
<p>Save the setup with a memorable name. Clear the Model.
Next, try to import your setup under “Setup &gt; Custom Setup” (note this replaces all functions in the browser).</p>
</section>
<section id="tying-and-constraining-fit-parameters">
<h2>Tying and constraining fit parameters<a class="headerlink" href="#tying-and-constraining-fit-parameters" title="Permalink to this heading">¶</a></h2>
<p>The Mantid fitting framework allows you to tie or constrain parameters.</p>
<p><strong>Tying</strong> sets a parameter equal to an expression
of other parameters (from any of the selected functions).</p>
<p><strong>Fixing</strong> is basically tying a parameter to a number (constant).</p>
<p><strong>Constraining</strong> a parameter keeps its value above a lower bound,
below an upper bound, or both! The parameter value obeys the constraint within the error.
e.g. If a parameter is constrained to be positive, the result could be <cite>-1.0</cite> if the error is <cite>-1.1</cite>.</p>
<p>To set a constraint/tie right-click on a parameter name:</p>
<figure class="align-default">
<img alt="TieConstraintContextManu.png" src="../../../_images/TieConstraintContextManu.png" />
</figure>
<p>The menu offers three options:</p>
<ul class="simple">
<li><p><em>Fix</em> this parameter to its current value.</p></li>
<li><p>Constraint: define a lower or upper bound, or both.</p></li>
<li><p>Tie: tie this parameter to an arbitrary expression.</p></li>
</ul>
<p>The tying expression can be as simple as a parameter name:</p>
<p><code class="docutils literal notranslate"><span class="pre">f0.Height</span></code></p>
<p>Note that parameter names of a model include prefixes such as <code class="docutils literal notranslate"><span class="pre">f0.</span></code>
which indicate the particular function they belong to.</p>
<p>Try using the “Custom Tie” option from the menu to tie parameter f1.A0 from our built
model to the custom function:</p>
<p><code class="docutils literal notranslate"><span class="pre">2-f0.Height</span></code></p>
<p>As this sets the FlatBackground height, A0 = 2 - GaussianHeight, the calculated Peak Height will be exactly 2 units above 0 (the x-axis).</p>
</section>
<section id="execute-your-fit">
<h2>Execute your fit<a class="headerlink" href="#execute-your-fit" title="Permalink to this heading">¶</a></h2>
<p>After the model has been defined, its initial values set, any ties
and constraints defined, we are ready to run a fit. It is done by
selecting the Fit option from the Fit menu:</p>
<figure class="align-default">
<img alt="JustRunFitOption.png" src="../../../_images/JustRunFitOption.png" />
</figure>
<p>Now examine the results in the Fit Property Browser and the output workspaces, as before.
You can even show error bars to compare how good your fit is to the errors. To do so, as below, enter Figure Options (Gear Symbol) &gt; Curves tab, check the curve selected is “spec 1”. Then un-Hide Errorbars, giving them a capsize of 2, displaying an Error (bar) Every 2 (points) and click “Apply” at the bottom of the window.</p>
<figure class="align-center">
<img alt="HRPFitError" src="../../../_images/HRPFitError.png" />
</figure>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="01_fitting_models_to_data.html" title="Previous Chapter: Fitting Models To Data"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Fitting Model...</span>
    </a>
  </li>
  <li>
    <a href="03_fit_model_choices.html" title="Next Chapter: Fit Model Choices"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Fit Model Choices &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>