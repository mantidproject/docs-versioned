<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>FindCenterOfMassPosition v2</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FindClusterFaces v1" href="FindClusterFaces-v1.html" />
    <link rel="prev" title="FindCenterOfMassPosition v1" href="FindCenterOfMassPosition-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.8</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">FindCenterOfMassPosition v2</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="findcenterofmassposition-v2">
<span id="algm-findcenterofmassposition"></span><span id="algm-findcenterofmassposition-v2"></span><h1>FindCenterOfMassPosition v2<a class="headerlink" href="#findcenterofmassposition-v2" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ImageNotFound.png"><img alt="../_images/ImageNotFound.png" class="screenshot" src="../_images/ImageNotFound.png" style="width: 200px;" /></a>
<figcaption>
<p><span class="caption-text">Enable screenshots using DOCS_SCREENSHOTS in CMake</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id5">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id6">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Finds the beam center in a 2D SANS data set.</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Output</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>TableWorkspace will contain the center of mass position. When empty, a CenterOfMass output parameter with two elements (x,y) is created.</p></td>
</tr>
<tr class="row-even"><td><p>CenterX</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Initial estimate for the beam center in X in meters</p></td>
</tr>
<tr class="row-odd"><td><p>CenterY</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Initial estimate for the beam center in Y in meters</p></td>
</tr>
<tr class="row-even"><td><p>Tolerance</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.00125</p></td>
<td><p>Tolerance on the center of mass position between each iteration in meters. Suggested value is the size of a quarter of a pixel.</p></td>
</tr>
<tr class="row-odd"><td><p>DirectBeam</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>When true, the calculation will include the pixels within BeamRadius from the beam center. Since the process is iterative, the pixels masked by DirectBeam=False will move.</p></td>
</tr>
<tr class="row-even"><td><p>BeamRadius</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.0155</p></td>
<td><p>Radius of the direct beam area, in meters, used the exclude the beam when calculating the center of mass of the scattering pattern. This is ignored when DirectBeam=True</p></td>
</tr>
<tr class="row-odd"><td><p>IntegrationRadius</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Integration radius, in meters, used to include when calculating the center of mass of the scattering pattern.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>Finds the beam center using the direct beam method.
This algorithm is used by the EQSANS and HFIR SANS reduction.</p>
<p>The position of the beam center <span class="math notranslate nohighlight">\(\vec{p}\)</span> is given by</p>
<div class="math notranslate nohighlight">
\[\vec{p}=\frac{\sum_iI_i\vec{d}_i}{\sum_iI_i}\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> runs over all pixels within the largest square detector area centered on the initial guess for the beam center position.
The initial guess is (<code class="docutils literal notranslate"><span class="pre">CenterX</span></code>, <code class="docutils literal notranslate"><span class="pre">CenterY</span></code>) which defaults to the center of the detector.
<span class="math notranslate nohighlight">\(I_i\)</span> is the detector count for pixel <span class="math notranslate nohighlight">\(i\)</span>, and <span class="math notranslate nohighlight">\(\vec{d}_i\)</span> is x-y projection of the pixel position.
The range of pixels considered is limited to be those symmetric (in x and y separately) around the previous step’s found beam center.
The calculation above is repeated iteratively by replacing the initial guess with the position found with the previous iteration.
The process stops when the difference between the positions found with two consecutive iterations is smaller than <code class="docutils literal notranslate"><span class="pre">Tolerance</span></code> in meters.</p>
<p>The integration range within the symmetric area of the detector can be controlled using <code class="docutils literal notranslate"><span class="pre">BeamRadius</span></code> (when <code class="docutils literal notranslate"><span class="pre">DirectBeam=False</span></code>) and <code class="docutils literal notranslate"><span class="pre">IntegrationRadius</span></code>.
When both are in effect the pixels integrated are those that meet the equation</p>
<div class="math notranslate nohighlight">
\[BeamRadius &lt; |\vec{d}_i - \vec{p}| &lt; IntegrationRadius\]</div>
<p>where <span class="math notranslate nohighlight">\(\vec{p}\)</span> is the beam center from the previous iteration.
Again, when <code class="docutils literal notranslate"><span class="pre">DirectBeam=True</span></code> is specified, the lower bound is ignored.
When <code class="docutils literal notranslate"><span class="pre">IntegrationRadius</span></code> is not specified, the upper bound is ignored.
Not specifying any of these three parameters uses all data within the symmetric x/y region.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">Output</span></code> property is set, the beam centre will be placed in a table workspace.
Otherwise, the result is placed in an ArrayProperty named <code class="docutils literal notranslate"><span class="pre">CenterOfMass</span></code>.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p><strong>Example - Find the beam center for a BioSANS data file:</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load your data file</span>
<span class="n">LoadSpice2D</span><span class="p">(</span><span class="s1">&#39;BioSANS_empty_cell.xml&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;empty_cell&#39;</span><span class="p">)</span>

<span class="c1"># Compute the center position, which will be put in a table workspace</span>
<span class="n">center</span> <span class="o">=</span> <span class="n">FindCenterOfMassPosition</span><span class="p">(</span><span class="s1">&#39;empty_cell&#39;</span><span class="p">,</span> <span class="n">Output</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">center</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(x, y) = (</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(x, y) = (-0.0066, 0.0091)
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/SANS.html">SANS</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/b75cfaae9218e7d59662138c22a81da96e2235c1/Framework/Algorithms/inc/MantidAlgorithms/FindCenterOfMassPosition2.h">FindCenterOfMassPosition2.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/b75cfaae9218e7d59662138c22a81da96e2235c1/Framework/Algorithms/src/FindCenterOfMassPosition2.cpp">FindCenterOfMassPosition2.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="FindCenterOfMassPosition-v1.html" title="Previous Chapter: FindCenterOfMassPosition v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; FindCenterOfM...</span>
    </a>
  </li>
  <li>
    <a href="FindClusterFaces-v1.html" title="Next Chapter: FindClusterFaces v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">FindClusterFaces v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>