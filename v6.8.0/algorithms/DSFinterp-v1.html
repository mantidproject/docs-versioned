<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Description</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DakotaChiSquared v1" href="DakotaChiSquared-v1.html" />
    <link rel="prev" title="DNSMergeRuns v1" href="DNSMergeRuns-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.8</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">Description</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<p><strong>ERROR: No algorithm ‘DSFinterp’ version ‘1’, skipping directive</strong></p>
<p><strong>ERROR: No algorithm ‘DSFinterp’ version ‘1’, skipping directive</strong></p>
<p><strong>ERROR: No algorithm ‘DSFinterp’ version ‘1’, skipping directive</strong></p>
<p><strong>ERROR: No algorithm ‘DSFinterp’ version ‘1’, skipping directive</strong></p>
<section id="description">
<h1>Description<a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h1>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p>DSFinterp(Workspaces, OutputWorkspaces, [LoadErrors], [ParameterValues], [LocalRegression], [RegressionWindow], [RegressionType], TargetParameters], [Version])</p>
</section>
<section id="required">
<h2>Required<a class="headerlink" href="#required" title="Permalink to this heading">¶</a></h2>
<p>This algorithm requires python package <a class="reference external" href="https://github.com/camm-sns/dsfinterp">dsfinterp</a>, available at the
<a class="reference external" href="https://pypi.python.org/pypi/dsfinterp">python package index</a>.
If the package is not present, this algorithm will not be available. To install, type in a terminal ‘sudo pip install dsfinterp’</p>
</section>
<section id="details">
<h2>Details<a class="headerlink" href="#details" title="Permalink to this heading">¶</a></h2>
<p>For every “dynamical channel” defined by one particular (Q,E) pair, the sequence of scalars
{<span class="math notranslate nohighlight">\({S_i \equiv S(Q,E,T_i)}\)</span>} ordered by increasing value of T is interpolated
with a cubic spline, which then can be invoked to obtain
<span class="math notranslate nohighlight">\(S(Q,E,T)\)</span> at any T value.</p>
<p>Errors in the structure factor are incorporated when constructing the spline, so that the spline
need not necessarily pass trough the <span class="math notranslate nohighlight">\((T_i, S_i)\)</span> points.
This has the desirable effect of producing smooth spline curves when the variation of the
structure factors versus <span class="math notranslate nohighlight">\(T\)</span> contains significant noise.
For more details on the construction of the spline, see <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.UnivariateSpline.html">UnivariateSpline</a></p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/DSFinterp_local_regression.png"><img alt="DSFinterp_local_regression.png" src="../_images/DSFinterp_local_regression.png" style="width: 600pt; height: 400pt;" /></a>
<figcaption>
<p><span class="caption-text">Local quadratic regression of windowsize w=7 starting at index n=2</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>If the structure factors have no associated errors, an scenario typical of structure factors derived from simulations,
then error estimation can be implemented with the running, local regression option.
A local regression of windowsize <span class="math notranslate nohighlight">\(w\)</span> starting at index <span class="math notranslate nohighlight">\(n\)</span> performs a
linear squares minimization <span class="math notranslate nohighlight">\(F\)</span> on the set of points <span class="math notranslate nohighlight">\((T_n,S_n),..,(T_{n+w},S_{n+w})\)</span>.
After the minimization is done, we record the expected value and error at <span class="math notranslate nohighlight">\(T_{n+w/2}\)</span>:</p>
<p>value: <span class="math notranslate nohighlight">\(S'_{n+w/2} = F(T_{n+w/2})\)</span></p>
<p>error: <span class="math notranslate nohighlight">\(e_{n+w/2} = \sqrt(\frac{1}{w}\sum_{j=n}^{n+w}(S_j-F(T_j))^2)\)</span></p>
<p>As we slide the window along the T-axis, we obtain values and errors at every <span class="math notranslate nohighlight">\(T_i\)</span>.
We use the {<span class="math notranslate nohighlight">\(F(T_i)\)</span>} values and {<span class="math notranslate nohighlight">\(e_i\)</span>} errors to produce a smooth spline,
as well as expected errors at any <span class="math notranslate nohighlight">\(T\)</span> value.</p>
</section>
</section>
<section id="example">
<h1>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h1>
<p>Our example system is a simulation of a small crystal of octa-methyl <a class="reference external" href="http://en.wikipedia.org/wiki/Silsesquioxane">silsesqioxane</a> molecules.
A total of 26 molecular dynamics simulations were performed under different values of the energy barrier
to methyl rotations, <span class="math notranslate nohighlight">\(K\)</span>. Dynamics structure factors S(Q,E) were derived from each simulation.</p>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../_images/DSFinterp_fig3.png"><img alt="DSFinterp_fig3.png" src="../_images/DSFinterp_fig3.png" style="width: 600pt; height: 400pt;" /></a>
<figcaption>
<p><span class="caption-text">Interpolated spline (solid line) with associated errors at one (Q,E) dynamical channel. Red dots are values from the simulation used to construct the spline.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>There are as many splines as dynamical channels. The algorithm gathers the interpolations
for each channel and aggregates them into an interpolated structure factor.</p>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../_images/DSFinterp_fig4.png"><img alt="DSFinterp_fig4.png" src="../_images/DSFinterp_fig4.png" style="width: 600pt; height: 400pt;" /></a>
<figcaption>
<p><span class="caption-text">Interpolated structure factor <span class="math notranslate nohighlight">\(S(K,E|Q)\)</span>, in logarithm scaling, at fixed <span class="math notranslate nohighlight">\(Q=0.9A^{-1}\)</span>.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="id1">
<h1>Usage<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h1>
<p>In this example, we load experimental QENS data derived from a powder of octa-methyl silsesquioxane microcrystals
at temperatures 100 150 200 250 300 350, then user DSFinterp to guess structure factors for temperatures 175 and 275.
Finally, we load experimental data for these two temperatures so that we can compare with the DSFinterp predictions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">temp_flt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">350</span><span class="p">]</span>
<span class="n">workspaces</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;exp100K&#39;</span><span class="p">,</span> <span class="s1">&#39;exp150K&#39;</span><span class="p">,</span> <span class="s1">&#39;exp200K&#39;</span><span class="p">,</span> <span class="s1">&#39;exp250K&#39;</span><span class="p">,</span> <span class="s1">&#39;exp300K&#39;</span><span class="p">,</span> <span class="s1">&#39;exp350K&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_flt</span><span class="p">)</span> <span class="p">):</span>
  <span class="n">LoadNexus</span><span class="p">(</span><span class="n">FileName</span><span class="o">=</span><span class="s1">&#39;DSFinterp/</span><span class="si">{0}</span><span class="s1">.nxs&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workspaces</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">workspaces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1">#load QENS data</span>
<span class="n">target_temps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">175</span><span class="p">,</span> <span class="mi">225</span><span class="p">]</span>
<span class="n">outworkspaces</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;int175K&#39;</span><span class="p">,</span> <span class="s1">&#39;int225K&#39;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">dsfinterp</span>  <span class="c1"># Have you installed the dsfinterp module? (pip install dsfinterp)</span>
<span class="n">DSFinterp</span><span class="p">(</span><span class="n">Workspaces</span><span class="o">=</span><span class="n">workspaces</span><span class="p">,</span> <span class="n">ParameterValues</span><span class="o">=</span><span class="n">temp_flt</span><span class="p">,</span> <span class="n">RegressionWindow</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">TargetParameters</span><span class="o">=</span><span class="n">target_temps</span><span class="p">,</span> <span class="n">OutputWorkspaces</span><span class="o">=</span><span class="n">outworkspaces</span><span class="p">)</span>

<span class="c1">#Now load experimental data for target temperatures</span>
<span class="n">LoadNexus</span><span class="p">(</span><span class="n">FileName</span><span class="o">=</span><span class="s1">&#39;DSFinterp/exp175K.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;exp175K&#39;</span><span class="p">)</span>
<span class="n">LoadNexus</span><span class="p">(</span><span class="n">FileName</span><span class="o">=</span><span class="s1">&#39;DSFinterp/exp225K.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;exp225K&#39;</span><span class="p">)</span>

<span class="c1">#Compare one of the predicted spectrum with a fit to experimental data</span>
<span class="n">myFunc</span><span class="o">=</span> <span class="s1">&#39;name=TabulatedFunction,Workspace=int225K,WorkspaceIndex=8,Scaling=1.00424&#39;</span>
<span class="n">fitStatus</span><span class="p">,</span> <span class="n">chiSq</span><span class="p">,</span> <span class="n">covarianceTable</span><span class="p">,</span> <span class="n">paramTable</span><span class="p">,</span> <span class="n">fitWorkspace</span> <span class="o">=</span>\
<span class="n">Fit</span><span class="p">(</span><span class="n">Function</span><span class="o">=</span><span class="n">myFunc</span><span class="p">,</span> <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;exp225K&#39;</span><span class="p">,</span> <span class="n">WorkspaceIndex</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">Output</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>ERROR: No algorithm ‘DSFinterp’ version ‘1’, skipping directive</strong></p>
<p><strong>ERROR: No algorithm ‘DSFinterp’ version ‘1’, skipping directive</strong></p>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DNSMergeRuns-v1.html" title="Previous Chapter: DNSMergeRuns v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DNSMergeRuns v1</span>
    </a>
  </li>
  <li>
    <a href="DakotaChiSquared-v1.html" title="Next Chapter: DakotaChiSquared v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DakotaChiSquared v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>