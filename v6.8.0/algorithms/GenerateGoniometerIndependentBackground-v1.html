<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>GenerateGoniometerIndependentBackground v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GenerateGroupingPowder v1" href="GenerateGroupingPowder-v1.html" />
    <link rel="prev" title="GenerateEventsFilter v1" href="GenerateEventsFilter-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.8</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">GenerateGoniometerIndependentBackground v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="generategoniometerindependentbackground-v1">
<span id="algm-generategoniometerindependentbackground"></span><span id="algm-generategoniometerindependentbackground-v1"></span><h1>GenerateGoniometerIndependentBackground v1<a class="headerlink" href="#generategoniometerindependentbackground-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ImageNotFound.png"><img alt="../_images/ImageNotFound.png" class="screenshot" src="../_images/ImageNotFound.png" style="width: 200px;" /></a>
<figcaption>
<p><span class="caption-text">Enable screenshots using DOCS_SCREENSHOTS in CMake</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id5">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id6">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Extract the background from a dataset where sample is rotated through multiple positions</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspaces</p></td>
<td><p>Input</p></td>
<td><p>str list</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Input workspaces. Must be <a class="reference internal" href="../concepts/EventWorkspace.html#eventworkspace"><span class="std std-ref">Event Workspace</span></a> and have at least 2 input workspaces.</p></td>
</tr>
<tr class="row-odd"><td><p>GroupingFile</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A file that consists of lists of spectra numbers to group. To be read by <a class="reference internal" href="LoadDetectorsGroupingFile-v1.html#algm-loaddetectorsgroupingfile"><span class="std std-ref">LoadDetectorsGroupingFile v1</span></a>. Allowed extensions: [‘.map’, ‘.xml’]</p></td>
</tr>
<tr class="row-even"><td><p>PercentMin</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Starting percentage range of input files that will be combined to create the background</p></td>
</tr>
<tr class="row-odd"><td><p>PercentMax</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>20</p></td>
<td><p>Ending percentage range of input files that will be combined to create the background</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/EventWorkspace.html#eventworkspace"><span class="std std-ref">EventWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Extracted background workspace.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>This algorithm will extract the background from a dataset where sample is rotated through multiple positions, so that I don’t need to make a separate background measurement.</p>
<p>This algorithm requires at least 2 input <a class="reference internal" href="../concepts/EventWorkspace.html#eventworkspace"><span class="std std-ref">Event Workspace</span></a> that are all binned identically. The proton charge of the workspaces are check to be within 1% of each other as this algorithm assume all the data was collected in the same conditions.</p>
<p>This algorithm operates by first grouping the detectors of the input workspaces with the provided <code class="docutils literal notranslate"><span class="pre">GroupingFile</span></code>.  Then iterating through each bin of each spectra of the grouped workspaces, selecting the range (defined by <code class="docutils literal notranslate"><span class="pre">PercentMin</span></code> and <code class="docutils literal notranslate"><span class="pre">PercentMax</span></code> properties) of workspaces sorted by intensity for that bin, copying the events from the associated ungrouped input to the output workspace. The output is then normalized by the number of input workspaces selected.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p><strong>Example - GenerateGoniometerIndependentBackground</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create 4 sample workspaces with different intensities</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">WorkspaceType</span><span class="o">=</span><span class="s1">&#39;Event&#39;</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s1">&#39;Flat background&#39;</span><span class="p">,</span> <span class="n">BinWidth</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">NumEvents</span><span class="o">=</span><span class="n">n</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">NumBanks</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;w</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input workspace w</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> intensity = &quot;</span><span class="p">,</span> <span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># create a grouping workspace, group by bank</span>
<span class="n">CreateGroupingWorkspace</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;w1&#39;</span><span class="p">,</span> <span class="n">GroupDetectorsBy</span><span class="o">=</span><span class="s1">&#39;bank&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;groups&#39;</span><span class="p">)</span>
<span class="n">SaveDetectorsGrouping</span><span class="p">(</span><span class="s2">&quot;groups&quot;</span><span class="p">,</span> <span class="s2">&quot;/tmp/groups.xml&quot;</span><span class="p">)</span>

<span class="c1"># select only the lowest 25% intensity workspaces</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">GenerateGoniometerIndependentBackground</span><span class="p">(</span><span class="s1">&#39;w1,w2,w3,w4&#39;</span><span class="p">,</span> <span class="n">GroupingFile</span><span class="o">=</span><span class="s2">&quot;/tmp/groups.xml&quot;</span><span class="p">,</span> <span class="n">PercentMin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">PercentMax</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Background intensity, lowest 25% =&quot;</span><span class="p">,</span> <span class="n">background</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="c1"># select only the highest 25% intensity workspaces</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">GenerateGoniometerIndependentBackground</span><span class="p">(</span><span class="s1">&#39;w1,w2,w3,w4&#39;</span><span class="p">,</span> <span class="n">GroupingFile</span><span class="o">=</span><span class="s2">&quot;/tmp/groups.xml&quot;</span><span class="p">,</span> <span class="n">PercentMin</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">PercentMax</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Background intensity, highest 25% =&quot;</span><span class="p">,</span> <span class="n">background</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="c1"># select only the middle 50%intensity workspaces</span>
<span class="n">background</span> <span class="o">=</span> <span class="n">GenerateGoniometerIndependentBackground</span><span class="p">(</span><span class="s1">&#39;w1,w2,w3,w4&#39;</span><span class="p">,</span> <span class="n">GroupingFile</span><span class="o">=</span><span class="s2">&quot;/tmp/groups.xml&quot;</span><span class="p">,</span> <span class="n">PercentMin</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">PercentMax</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Background intensity, middle 50% =&quot;</span><span class="p">,</span> <span class="n">background</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Input workspace w1 intensity =  [ 500.  500.]
Input workspace w2 intensity =  [ 1000.  1000.]
Input workspace w3 intensity =  [ 1500.  1500.]
Input workspace w4 intensity =  [ 2000.  2000.]
Background intensity, lowest 25% = [ 500.  500.]
Background intensity, highest 25% = [ 2000.  2000.]
Background intensity, middle 50% = [ 1250.  1250.]
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/CorrectionFunctions/BackgroundCorrections.html">CorrectionFunctions\BackgroundCorrections</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/b75cfaae9218e7d59662138c22a81da96e2235c1/Framework/Algorithms/inc/MantidAlgorithms/GenerateGoniometerIndependentBackground.h">GenerateGoniometerIndependentBackground.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/b75cfaae9218e7d59662138c22a81da96e2235c1/Framework/Algorithms/src/GenerateGoniometerIndependentBackground.cpp">GenerateGoniometerIndependentBackground.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="GenerateEventsFilter-v1.html" title="Previous Chapter: GenerateEventsFilter v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; GenerateEvent...</span>
    </a>
  </li>
  <li>
    <a href="GenerateGroupingPowder-v1.html" title="Next Chapter: GenerateGroupingPowder v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">GenerateGroup... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>