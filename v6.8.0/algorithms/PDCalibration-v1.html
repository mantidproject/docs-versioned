<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>PDCalibration v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PDConvertRealSpace v1" href="PDConvertRealSpace-v1.html" />
    <link rel="prev" title="OrMD v1" href="OrMD-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.8</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">PDCalibration v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="pdcalibration-v1">
<span id="algm-pdcalibration"></span><span id="algm-pdcalibration-v1"></span><h1>PDCalibration v1<a class="headerlink" href="#pdcalibration-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ImageNotFound.png"><img alt="../_images/ImageNotFound.png" class="screenshot" src="../_images/ImageNotFound.png" style="width: 200px;" /></a>
<figcaption>
<p><span class="caption-text">Enable screenshots using DOCS_SCREENSHOTS in CMake</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p></li>
<li><p><a class="reference internal" href="#limiting-spectra-calibrated" id="id5">Limiting Spectra Calibrated</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id6">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id7">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>Calibrate the detector pixels and create a calibration table</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>InOut</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Input signal workspace</p></td>
</tr>
<tr class="row-odd"><td><p>StartWorkspaceIndex</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Starting workspace index for fit</p></td>
</tr>
<tr class="row-even"><td><p>StopWorkspaceIndex</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Last workspace index to fit (which is included). If a value larger than the workspace index of last spectrum, then the workspace index of last spectrum is used.</p></td>
</tr>
<tr class="row-odd"><td><p>TofBinning</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Min, Step, and Max of time-of-flight bins. Logarithmic binning is used if Step is negative.</p></td>
</tr>
<tr class="row-even"><td><p>PreviousCalibrationFile</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Previous calibration file. Allowed extensions: [‘.h5’, ‘.cal’]</p></td>
</tr>
<tr class="row-odd"><td><p>PreviousCalibrationTable</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Previous calibration table. This overrides results from previous file.</p></td>
</tr>
<tr class="row-even"><td><p>PeakFunction</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Gaussian</p></td>
<td><p>Allowed values: [‘BackToBackExponential’, ‘Gaussian’, ‘Lorentzian’, ‘PseudoVoigt’, ‘IkedaCarpenterPV’]</p></td>
</tr>
<tr class="row-odd"><td><p>BackgroundType</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Linear</p></td>
<td><p>Type of Background. Allowed values: [‘Flat’, ‘Linear’, ‘Quadratic’]</p></td>
</tr>
<tr class="row-even"><td><p>PeakPositions</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Comma delimited d-space positions of reference peaks.</p></td>
</tr>
<tr class="row-odd"><td><p>PeakWindow</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td><p>0.1</p></td>
<td><p>Window over which to fit a peak in d-spacing (if a single value is supplied it will used as half the window width for all peaks, otherwise a comma delimited list of boundaries).</p></td>
</tr>
<tr class="row-even"><td><p>PeakWidthPercent</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>The estimated peak width as a percent of the peakcenter value, in d-spacing or TOF units.</p></td>
</tr>
<tr class="row-odd"><td><p>MinimumPeakHeight</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>2</p></td>
<td><p>Minimum peak height such that all the fitted peaks with height under this value will be excluded. The same property is used for pre-checking peaks before fitting, such that all the peaks with the total Y-count under this value will be excluded.</p></td>
</tr>
<tr class="row-even"><td><p>MaxChiSq</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>100</p></td>
<td><p>Maximum chisq value for individual peak fit allowed. (Default: 100)</p></td>
</tr>
<tr class="row-odd"><td><p>ConstrainPeakPositions</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If true, peak centers will be constrained by estimated positions (highest Y value position) and the peak width will either be estimated by observation or calculated.</p></td>
</tr>
<tr class="row-even"><td><p>HighBackground</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Flag whether the data has high background comparing to peaks’ intensities. For example, vanadium peaks usually have high background.</p></td>
</tr>
<tr class="row-odd"><td><p>MinimumSignalToNoiseRatio</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Minimum signal-to-noise ratio such that all the peaks with signal-to-noise ratio under this value will be excluded.Note, the algorithm will not exclude a peak for which the noise cannot be estimated.</p></td>
</tr>
<tr class="row-even"><td><p>CalibrationParameters</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>DIFC</p></td>
<td><p>Select calibration parameters to fit. Allowed values: [‘DIFC’, ‘DIFC+TZERO’, ‘DIFC+TZERO+DIFA’]</p></td>
</tr>
<tr class="row-odd"><td><p>TZEROrange</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td></td>
<td><p>Range for allowable TZERO from calibration (default is all)</p></td>
</tr>
<tr class="row-even"><td><p>DIFArange</p></td>
<td><p>Input</p></td>
<td><p>dbl list</p></td>
<td></td>
<td><p>Range for allowable DIFA from calibration (default is all)</p></td>
</tr>
<tr class="row-odd"><td><p>UseChiSq</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>By default the square of the peak height is used as weights in the least-squares fit to find the diffractometer constants, if UseChiSq is true then the inverse square of the error on the fitted peak centres will be used instead.</p></td>
</tr>
<tr class="row-even"><td><p>OutputCalibrationTable</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Output table workspace containing the calibration</p></td>
</tr>
<tr class="row-odd"><td><p>DiagnosticWorkspaces</p></td>
<td><p>Output</p></td>
<td><p>WorkspaceGroup</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Workspaces to promote understanding of calibration results</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p>This algorithm calibrates the detector pixels and creates a
<a class="reference internal" href="../concepts/DiffractionCalibrationWorkspace.html#diffractioncalibrationworkspace"><span class="std std-ref">diffraction calibration workspace</span></a>. Unlike
<cite>CalibrateRectangularDetectors</cite> the peak fitting and
calibration is done in TOF not d spacing. The peak d values are
converted to TOF based on either the old calibration or the instrument
geometry. The <code class="docutils literal notranslate"><span class="pre">InputWorkspace</span></code> contains the data from a standard
sample. The results are then fitted with up to (in order) <code class="docutils literal notranslate"><span class="pre">difc</span></code>,
<code class="docutils literal notranslate"><span class="pre">t_zero</span></code>, and <code class="docutils literal notranslate"><span class="pre">difa</span></code>. These values are described in detail
in <a class="reference internal" href="AlignDetectors-v1.html#algm-aligndetectors"><span class="std std-ref">AlignDetectors v1</span></a>.</p>
<p>The peak fitting properties are explained in more detail in
<a class="reference internal" href="FitPeaks-v1.html#algm-fitpeaks"><span class="std std-ref">FitPeaks v1</span></a>. This is used to perform a refinement of peaks
using as much information as is provided as possible. Each input
spectrum is calibrated separately following the same basic steps:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">PeakPositions</span></code> are used to determine fit windows in combination with <code class="docutils literal notranslate"><span class="pre">PeakWindow</span></code>. The windows are half the distance between the provided peak positions, with a maximum size of <code class="docutils literal notranslate"><span class="pre">PeakWindow</span></code>.</p></li>
<li><p>The positions and windows are converted to time-of-flight for the spectrum using either the previous calibration information or the spectrum’s geometry.</p></li>
<li><p>For each peak, the background is estimated from the first and last ten points in the fit window.</p></li>
<li><p>For each peak, the nominal center is selected by locating the highest point near the expected position. The height is used as the initial guess as well.</p></li>
<li><p>For each peak, the width is estimated by multiplying the peak center position with <code class="docutils literal notranslate"><span class="pre">PeakWidthPercent</span></code> or by calculating the second moment of the data in the window.</p></li>
<li><p>For each peak, the peak fit parameters are refined.</p></li>
<li><p>All of the fitted peak centers are used to fit the calibration constants, weighted by peak height.</p></li>
</ol>
<p>If more than one constant is requested, the result that has the lowest
<a class="reference external" href="https://en.wikipedia.org/wiki/Reduced_chi-squared_statistic">reduced chi-squared value</a> is
returned. This favors using less parameters.</p>
<p>A mask workspace is created, named with the <code class="docutils literal notranslate"><span class="pre">OutputCalibrationTable</span></code> parameter + <code class="docutils literal notranslate"><span class="pre">_mask</span></code>,
with uncalibrated pixels masked.</p>
<p>The resulting calibration table can be saved with
<a class="reference internal" href="SaveDiffCal-v1.html#algm-savediffcal"><span class="std std-ref">SaveDiffCal v1</span></a>, loaded with <a class="reference internal" href="LoadDiffCal-v1.html#algm-loaddiffcal"><span class="std std-ref">LoadDiffCal v1</span></a> and
applied to a workspace with <a class="reference internal" href="AlignDetectors-v1.html#algm-aligndetectors"><span class="std std-ref">AlignDetectors v1</span></a>. There are also
three workspaces placed in the <code class="docutils literal notranslate"><span class="pre">DiagnosticWorkspace</span></code> group. They are:</p>
<ul class="simple">
<li><p>evaluated fit functions (<code class="docutils literal notranslate"><span class="pre">_fitted</span></code>) which is the <code class="docutils literal notranslate"><span class="pre">OutputPeakParametersWorkspace</span></code> from <a class="reference internal" href="FitPeaks-v1.html#algm-fitpeaks"><span class="std std-ref">FitPeaks</span></a></p></li>
<li><p>raw peak fit values (<code class="docutils literal notranslate"><span class="pre">_fitparam</span></code>) which is the <code class="docutils literal notranslate"><span class="pre">FittedPeaksWorkspace</span></code> from <a class="reference internal" href="FitPeaks-v1.html#algm-fitpeaks"><span class="std std-ref">FitPeaks</span></a></p></li>
<li><p>uncertainties in raw fit values (<code class="docutils literal notranslate"><span class="pre">_fiterror</span></code>) which is the <code class="docutils literal notranslate"><span class="pre">OutputParameterFitErrorsWorkspace</span></code> from <a class="reference internal" href="FitPeaks-v1.html#algm-fitpeaks"><span class="std std-ref">FitPeaks</span></a> when <code class="docutils literal notranslate"><span class="pre">UseChisSq=True</span></code> is set</p></li>
<li><p>contain the fitted positions in dspace( <code class="docutils literal notranslate"><span class="pre">_dspacing</span></code>) derived from the effective peak parameters</p></li>
<li><p>peak widths (<code class="docutils literal notranslate"><span class="pre">_width</span></code>) derived from the effective peak parameters</p></li>
<li><p>peak heights (<code class="docutils literal notranslate"><span class="pre">_height</span></code>) derived from the effective peak parameters</p></li>
<li><p>instrument resolution (delta-d/d <code class="docutils literal notranslate"><span class="pre">_resolution</span></code>) derived from the average of effective width/height of each peak.
This is only correct for Gaussian and Lorentzian peak shapes</p></li>
</ul>
<p>Since multiple peak shapes can be used,
see the documentation for the individual <a class="reference internal" href="../fitting/fitfunctions/index.html#fit-functions-list"><span class="std std-ref">fit functions</span></a> to see how they relate to the effective
values displayed in the diagnostic tables. For <code class="docutils literal notranslate"><span class="pre">Gaussian</span></code> and
<code class="docutils literal notranslate"><span class="pre">Lorentzian</span></code>, the widths and resolution are converted to values that
can be directly compared with the results of
<a class="reference internal" href="EstimateResolutionDiffraction-v1.html#algm-estimateresolutiondiffraction"><span class="std std-ref">EstimateResolutionDiffraction v1</span></a>.</p>
</section>
<section id="limiting-spectra-calibrated">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Limiting Spectra Calibrated</a><a class="headerlink" href="#limiting-spectra-calibrated" title="Permalink to this heading">¶</a></h2>
<p>Supplying <code class="docutils literal notranslate"><span class="pre">StartWorkspaceIndex</span></code> and/or <code class="docutils literal notranslate"><span class="pre">StopWorkspaceIndex</span></code> will limit the spectra that are fitted.
Only those that are fitted will exist in the output table, <code class="docutils literal notranslate"><span class="pre">OutputCalibrationTable</span></code>.
<a class="reference internal" href="CombineDiffCal-v1.html#algm-combinediffcal"><span class="std std-ref">CombineDiffCal</span></a> can accept input of partial instrument calibration as the <code class="docutils literal notranslate"><span class="pre">GroupedCalibration</span></code> and will copy all other values fom the <code class="docutils literal notranslate"><span class="pre">PixelCalibration</span></code>.
In this mode, the <code class="docutils literal notranslate"><span class="pre">CalibrationWorkspace</span></code> supplied to <a class="reference internal" href="CombineDiffCal-v1.html#algm-combinediffcal"><span class="std std-ref">CombineDiffCal</span></a>  should still be the <code class="docutils literal notranslate"><span class="pre">InputWorkspace</span></code> supplied to <code class="docutils literal notranslate"><span class="pre">PDCalibration</span></code>.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p><strong>Example - PDCalibration</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># If you have an old calibration it can be used as the starting point</span>
<span class="n">oldCal</span> <span class="o">=</span> <span class="s1">&#39;NOM_calibrate_d72460_2016_05_23.h5&#39;</span>

<span class="c1"># list of d values for diamond</span>
<span class="n">dvalues</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.3117</span><span class="p">,</span><span class="mf">0.3257</span><span class="p">,</span><span class="mf">0.3499</span><span class="p">,</span><span class="mf">0.4205</span><span class="p">,</span><span class="mf">0.4645</span><span class="p">,</span><span class="mf">0.4768</span><span class="p">,</span><span class="mf">0.4996</span><span class="p">,</span><span class="mf">0.5150</span><span class="p">,</span><span class="mf">0.5441</span><span class="p">,</span><span class="mf">0.5642</span><span class="p">,</span><span class="mf">0.5947</span><span class="p">,</span><span class="mf">0.6307</span><span class="p">,</span><span class="mf">.6866</span><span class="p">,</span><span class="mf">.7283</span><span class="p">,</span><span class="mf">.8185</span><span class="p">,</span><span class="mf">.8920</span><span class="p">,</span><span class="mf">1.0758</span><span class="p">,</span><span class="mf">1.2615</span><span class="p">,</span><span class="mf">2.0599</span><span class="p">)</span>

<span class="n">LoadEventNexus</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s1">&#39;NOM_72460&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;NOM_72460&#39;</span><span class="p">)</span>
<span class="n">PDCalibration</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;NOM_72460&#39;</span><span class="p">,</span>
              <span class="n">TofBinning</span><span class="o">=</span><span class="p">[</span><span class="mi">300</span><span class="p">,</span><span class="o">-</span><span class="mf">.001</span><span class="p">,</span><span class="mf">16666.7</span><span class="p">],</span>
              <span class="n">PreviousCalibrationFile</span><span class="o">=</span><span class="n">oldCal</span><span class="p">,</span>
              <span class="n">PeakPositions</span><span class="o">=</span><span class="n">dvalues</span><span class="p">,</span>
              <span class="n">PeakWidthPercent</span><span class="o">=</span><span class="mf">.008</span><span class="p">,</span>
              <span class="n">OutputCalibrationTable</span><span class="o">=</span><span class="s1">&#39;cal&#39;</span><span class="p">,</span>
              <span class="n">DiagnosticWorkspaces</span><span class="o">=</span><span class="s1">&#39;diag&#39;</span><span class="p">)</span>

<span class="c1"># Print the result</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The calibrated difc at detid </span><span class="si">{detid}</span><span class="s2"> is </span><span class="si">{difc}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;cal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">40000</span><span class="p">)))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The calibrated difc at detid 40896 is 5523.060327692842
</pre></div>
</div>
<p><strong>Example - PDCalibration with BackToBackExponential fit function</strong></p>
<p>The following example shows how to use PDCalibration with the BackToBackExponential fit function. The fit works best if sensible initial values for the parameters are specified in an instrument definition or parameter file (for more details, see the <a class="reference internal" href="../concepts/InstrumentDefinitionFile.html#using-fitting-parameter"><span class="std std-ref">fitting parameters</span></a> documentation):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;ENGINX00193749.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;193749&#39;</span><span class="p">)</span>
<span class="n">dpks</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.913220892</span><span class="p">,</span> <span class="mf">1.631600313</span><span class="p">,</span>
        <span class="mf">1.562138267</span><span class="p">,</span> <span class="mf">1.352851554</span><span class="p">,</span> <span class="mf">1.104598643</span><span class="p">)</span>

<span class="c1"># initial values for GSAS parameters A, B, S are in ENGINX parameters .xml</span>
<span class="c1"># use log binning</span>
<span class="n">PDCalibration</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;193749&#39;</span><span class="p">,</span>
              <span class="n">TofBinning</span><span class="o">=</span><span class="p">[</span><span class="mi">10000</span><span class="p">,</span><span class="o">-</span><span class="mf">0.0005</span><span class="p">,</span><span class="mi">46000</span><span class="p">],</span>
              <span class="n">PeakPositions</span><span class="o">=</span><span class="n">dpks</span><span class="p">,</span>
              <span class="n">PeakWindow</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span>
              <span class="n">MinimumPeakHeight</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
              <span class="n">PeakFunction</span> <span class="o">=</span> <span class="s1">&#39;BackToBackExponential&#39;</span><span class="p">,</span>
              <span class="n">CalibrationParameters</span> <span class="o">=</span> <span class="s1">&#39;DIFC&#39;</span><span class="p">,</span>
              <span class="n">OutputCalibrationTable</span><span class="o">=</span><span class="s1">&#39;cal_B2B_DIFC_chisqTrue&#39;</span><span class="p">,</span>
              <span class="n">DiagnosticWorkspaces</span> <span class="o">=</span> <span class="s1">&#39;diag_B2B_DIFC_chisqTrue&#39;</span><span class="p">,</span>
              <span class="n">UseChiSq</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Print the result</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The calibrated difc at detid </span><span class="si">{detid}</span><span class="s2"> is </span><span class="si">{difc}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;cal_B2B_DIFC_chisqTrue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">1000</span><span class="p">)))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The calibrated difc at detid 108041 is 16834.952770921267
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Diffraction/Calibration.html">Diffraction\Calibration</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/b75cfaae9218e7d59662138c22a81da96e2235c1/Framework/Algorithms/inc/MantidAlgorithms/PDCalibration.h">PDCalibration.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/b75cfaae9218e7d59662138c22a81da96e2235c1/Framework/Algorithms/src/PDCalibration.cpp">PDCalibration.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="OrMD-v1.html" title="Previous Chapter: OrMD v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; OrMD v1</span>
    </a>
  </li>
  <li>
    <a href="PDConvertRealSpace-v1.html" title="Next Chapter: PDConvertRealSpace v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">PDConvertRealSpace v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>