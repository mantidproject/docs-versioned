<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>EnggVanadiumCorrections v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="EqualToMD v1" href="EqualToMD-v1.html" />
    <link rel="prev" title="EnggSaveSinglePeakFitResultsToHDF5 v1" href="EnggSaveSinglePeakFitResultsToHDF5-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.8</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">EnggVanadiumCorrections v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="enggvanadiumcorrections-v1">
<span id="algm-enggvanadiumcorrections"></span><span id="algm-enggvanadiumcorrections-v1"></span><h1>EnggVanadiumCorrections v1<a class="headerlink" href="#enggvanadiumcorrections-v1" title="Permalink to this heading">¶</a></h1>
<figure class="align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ImageNotFound.png"><img alt="../_images/ImageNotFound.png" class="screenshot" src="../_images/ImageNotFound.png" style="width: 200px;" /></a>
<figcaption>
<p><span class="caption-text">Enable screenshots using DOCS_SCREENSHOTS in CMake</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id5">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id6">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>This algorithm is deprecated as of May 2021, use a workflow with the Integration algorithm instead.Calculates correction features and / or uses them to correct diffraction data with respect to reference Vanadium data.</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Workspace</p></td>
<td><p>InOut</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>Workspace with the diffraction data to correct. The Vanadium corrections will be applied on it.</p></td>
</tr>
<tr class="row-odd"><td><p>VanadiumWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>Workspace with the reference Vanadium diffraction data.</p></td>
</tr>
<tr class="row-even"><td><p>OutIntegrationWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Output integration workspace produced when given an input Vanadium workspace</p></td>
</tr>
<tr class="row-odd"><td><p>OutCurvesWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>Output curves workspace produced when given an input Vanadium workspace</p></td>
</tr>
<tr class="row-even"><td><p>SplineBreakPoints</p></td>
<td><p>Input</p></td>
<td><p>l</p></td>
<td><p>50</p></td>
<td><p>Number of break points used when fitting the bank profiles with a spline function.</p></td>
</tr>
<tr class="row-odd"><td><p>IntegrationWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Workspace with the integrated values for every spectra of the reference Vanadium diffraction data. One row per spectrum.</p></td>
</tr>
<tr class="row-even"><td><p>CurvesWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td></td>
<td><p>Workspace with the curves fitted on bank-aggregated Vanadium diffraction data, one per bank. This workspace has three spectra per bank, as produced by the algorithm Fit. This is meant to be used as an alternative input VanadiumWorkspace</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This algorithm is being developed for a specific instrument and
technique. It might get changed or even removed without a
notification, should instrument scientists decide to do so.</p>
</div>
<p>This algorithm performs calculations related to two types of
corrections with respect to a reference Vanadium diffraction dataset
(workspace), in the following order:</p>
<ol class="arabic simple">
<li><p>sensitivity correction</p></li>
<li><p>pixel-by-pixel correction</p></li>
</ol>
<p>The algorithm outputs the features extracted from the Vanadium data
that are used to perform the two types of corrections, respectively:</p>
<ol class="arabic simple">
<li><p>the <em>integration</em> of every individual Vanadium spectrum</p></li>
<li><p>a list of <em>curves</em> of aggregated counts as a function of
time-of-flight (one per bank)</p></li>
</ol>
<p>If an input/output workspace with diffraction data is passed, the
algorithm applies the corrections on the diffraction data workspace by
using the integration and curves calculated from the reference
Vanadium datasset.</p>
<p>These outputs can be used to apply the corrections on a diffraction
data workspace in the same algorithm run, or be used subsequently to
apply corrections to different input workspaces. In practice, both
outputs need to be calculated only once for every reference Vanadium
dataset, while they would normally be used to correct a (possibly
long) series of different diffraction data workspaces.</p>
<p>If a vanadium data workspace is passed, the algorithm will calculate
features that can then be used to apply Vanadium corrections in other
<em>Engg</em> algorithms. If in addition an input/output workspace with
diffraction data is passed, the corrections will be applied on
it. Afterwards the same corrections can be applied on different
diffraction data workspaces by calling again this algorithm and
providing as inputs the integraion and curves workspaces produced by
the first call. The same correction features (integration and curves)
can be re-used for as long as the same reference Vanadium diffraction
data is still valid.</p>
<p>Normally this algorithm can be used in two different ways:</p>
<ol class="arabic simple">
<li><p>Pre-calculate correction features from a Vanadium data workspace.</p></li>
<li><p>Apply Vanadium corrections once the correction features have been
calculated.</p></li>
</ol>
<p>Examples of these two alternatives are shown below. In the first
option, only the input VanadiumWorkspace is required, and the two
outputs (integration and curves workspaces) are produced
normally. Optionally, a diffraction data workspace can be passed in
the input property InputWorkspace for it to be corrected. In the
second option, the corrections can be applied by using pre-calculated
features from a previous run of this algorithm (both
IntegrationWorkspace and CurvesWorkspace have to be passed as input
properties, If these two properties are not passed, they will be
re-calculated provided that a VanadiumWorkspace is passed which is not
recommended). All the calculations (integration, sums, divisions,
etc.) are done in the d-spacing space.</p>
<p>This algorithm is used as a child algorithm in the algorithms
<a class="reference internal" href="EnggFocus-v1.html#algm-enggfocus"><span class="std std-ref">EnggFocus v1</span></a> and <a class="reference internal" href="EnggCalibrateFull-v1.html#algm-enggcalibratefull"><span class="std std-ref">EnggCalibrateFull v1</span></a>.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p><strong>Example - apply Vanadium corrections on a sample workspace from an EnginX run file:</strong></p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # To generate the pre-calculated features (integration and curves), for a new</span>
<span class="c1"># Vanadium run, and apply the corrections on a workspace:</span>
<span class="c1">#</span>
<span class="c1"># sample_ws = Load(&#39;ENGINX00213855.nxs&#39;)</span>
<span class="c1"># van_ws = Load(&#39;ENGINX00236516.nxs&#39;)</span>
<span class="c1"># EnggVanadiumCorrections(Workspace = sample_ws, VanadiumWorkspace = van_ws</span>
<span class="c1">#                         OutIntegrationWorkspace = &#39;integ_ws&#39;,</span>
<span class="c1">#                         OutCurvesWorkspace = &#39;curves_ws&#39;)</span>
<span class="c1">#</span>
<span class="c1"># # Now you can save the two pre-calculated features / workspaces:</span>
<span class="c1"># SaveNexus(InputWorkspace=&#39;integ_ws&#39;,</span>
<span class="c1">#           Filename=&#39;ENGINX_precalculated_vanadium_run000236516_integration.nxs&#39;,)</span>
<span class="c1"># SaveNexus(InputWorkspace=&#39;curves_ws&#39;,</span>
<span class="c1">#           Filename=&#39;ENGINX_precalculated_vanadium_run000236516_bank_curves.nxs&#39;)</span>
<span class="c1">#</span>
<span class="c1"># # (not done here because the Vanadium run file has a large number of events)</span>
<span class="c1">#</span>
<span class="c1"># # Below we use the pre-calculated features that can be obtained with</span>
<span class="c1"># # the commands listed above.</span>

<span class="n">sample_ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;ENGINX00213855.nxs&#39;</span><span class="p">)</span>
<span class="n">integ_ws</span> <span class="o">=</span> <span class="n">LoadNexus</span><span class="p">(</span><span class="s1">&#39;ENGINX_precalculated_vanadium_run000236516_integration.nxs&#39;</span><span class="p">)</span>
<span class="n">curves_ws</span> <span class="o">=</span> <span class="n">LoadNexus</span><span class="p">(</span><span class="s1">&#39;ENGINX_precalculated_vanadium_run000236516_bank_curves.nxs&#39;</span><span class="p">)</span>
<span class="n">EnggVanadiumCorrections</span><span class="p">(</span><span class="n">Workspace</span> <span class="o">=</span> <span class="n">sample_ws</span><span class="p">,</span>
                        <span class="n">IntegrationWorkspace</span> <span class="o">=</span> <span class="n">integ_ws</span><span class="p">,</span>
                        <span class="n">CurvesWorkspace</span> <span class="o">=</span> <span class="n">curves_ws</span><span class="p">)</span>

<span class="c1"># Should have one spectrum only</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No. of spectra: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample_ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>

<span class="c1"># Print a few arbitrary integrated spectra</span>
<span class="n">ws_idx</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">idx_count</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">integ_ws</span> <span class="o">=</span> <span class="n">Integration</span><span class="p">(</span><span class="n">sample_ws</span><span class="p">,</span> <span class="n">StartWorkspaceIndex</span><span class="o">=</span><span class="n">ws_idx</span><span class="p">,</span>
                       <span class="n">EndWorkspaceIndex</span><span class="o">=</span><span class="n">ws_idx</span><span class="o">+</span><span class="n">idx_count</span><span class="p">)</span>
<span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;For workspace index </span><span class="si">{0:d}</span><span class="s2"> the spectrum integration is </span><span class="si">{1:.3f}</span><span class="s2">&quot;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx_count</span><span class="p">):</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws_idx</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="n">integ_ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>No. of spectra: 2513
For workspace index 400 the spectrum integration is 23.998
For workspace index 401 the spectrum integration is 23.799
For workspace index 402 the spectrum integration is 22.872
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Diffraction/Engineering.html">Diffraction\Engineering</a> | <a class="reference external" href="categories/CorrectionFunctions/BackgroundCorrections.html">CorrectionFunctions\BackgroundCorrections</a> | <a class="reference external" href="categories/CorrectionFunctions/EfficiencyCorrections.html">CorrectionFunctions\EfficiencyCorrections</a> | <a class="reference external" href="categories/CorrectionFunctions/NormalisationCorrections.html">CorrectionFunctions\NormalisationCorrections</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Permalink to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/b75cfaae9218e7d59662138c22a81da96e2235c1/Framework/PythonInterface/plugins/algorithms/EnggVanadiumCorrections.py">EnggVanadiumCorrections.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="EnggSaveSinglePeakFitResultsToHDF5-v1.html" title="Previous Chapter: EnggSaveSinglePeakFitResultsToHDF5 v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; EnggSaveSingl...</span>
    </a>
  </li>
  <li>
    <a href="EqualToMD-v1.html" title="Next Chapter: EqualToMD v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">EqualToMD v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>