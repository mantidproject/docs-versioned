<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Main Algorithm Body</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <script src="../../../_static/documentation_options.js?v=ff701123"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Logging" href="05_logging.html" />
    <link rel="prev" title="Validating Input" href="03_validating_input.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="../../index.html" >Training</a> &#187;</li>
          
            <li class="nav-item nav-item-2"><a href="../index.html" >Extending Mantid With Python</a> &#187;</li>
          
            <li class="nav-item nav-item-3"><a href="index.html" accesskey="U">Python Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">Main Algorithm Body</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="main-algorithm-body">
<span id="id1"></span><h1>Main Algorithm Body<a class="headerlink" href="#main-algorithm-body" title="Link to this heading">¶</a></h1>
<p>After the properties have been created within the <code class="docutils literal notranslate"><span class="pre">PyInit</span></code> function it is time to turn attention to what the algorithm does with its inputs, i.e. what happens when we execute it.</p>
<p>In order to define what happens when the algorithm is executed we must write another function called <code class="docutils literal notranslate"><span class="pre">PyExec</span></code>, whose definition takes only <code class="docutils literal notranslate"><span class="pre">self</span></code> as an input.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">PyExec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Code to run algorithm</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Inside <code class="docutils literal notranslate"><span class="pre">PyExec</span></code> you can write any python code that is necessary to run your desired processing.
It can of course call Mantid python functions but you can also run any python code you like</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">PyExec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="nb">sum</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<section id="retrieving-input">
<h2>Retrieving Input<a class="headerlink" href="#retrieving-input" title="Link to this heading">¶</a></h2>
<p>It is most likely that the algorithm has input properties and the values that have been given by the user will need to be retrieved.
This is done through the <code class="docutils literal notranslate"><span class="pre">getProperty</span></code> method, which returns the named property.
This can then be used to query the value, units, defaults etc.
See <a class="reference internal" href="../../../api/python/mantid/kernel/Property.html#mantid.kernel.Property" title="mantid.kernel.Property"><code class="xref py py-class docutils literal notranslate"><span class="pre">mantid.kernel.Property</span></code></a> for more details.
The actual value of the property is retrieved with <code class="docutils literal notranslate"><span class="pre">.value</span></code> and is returned as an appropriate type.</p>
<p>For example, to parameterize the loop above, instead of the hard-coded 100,
we could define an input parameter, <code class="docutils literal notranslate"><span class="pre">NIterations</span></code>, which will be used to constrain the loop:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">PyInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 2</span>    <span class="bp">self</span><span class="o">.</span><span class="n">declareProperty</span><span class="p">(</span><span class="s2">&quot;NIterations&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span>
<span class="linenos"> 3</span>                         <span class="n">IntBoundedValidator</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
<span class="linenos"> 4</span>                         <span class="s2">&quot;The number of iterations of the loop to perform (default=100)&quot;</span><span class="p">)</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="k">def</span> <span class="nf">PyExec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 7</span>    <span class="n">nloops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s2">&quot;NIterations&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
<span class="linenos"> 8</span>    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 9</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nloops</span><span class="p">):</span>
<span class="linenos">10</span>        <span class="nb">sum</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Line 7, <code class="docutils literal notranslate"><span class="pre">self.getProperty(&quot;[NAME]&quot;).value</span></code>, is valid regardless of the type of the property: <em>float</em>, <em>workspace</em> etc.</p>
</section>
<section id="output-properties">
<h2>Output Properties<a class="headerlink" href="#output-properties" title="Link to this heading">¶</a></h2>
<p>Most algorithms will want to do something and return some output to the user.
We do this by using output properties so that they can be used in a generic manner, without knowing what needs to be returned.</p>
<p>Output properties are declared in a similar manner to input properties, with the exception that their direction is <code class="docutils literal notranslate"><span class="pre">Direction.Output</span></code>.
As an example, we could extend the code above to output the final sum like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">PyInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 2</span>    <span class="bp">self</span><span class="o">.</span><span class="n">declareProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;NIterations&quot;</span><span class="p">,</span> <span class="n">defaultValue</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="linenos"> 3</span>                         <span class="n">validator</span><span class="o">=</span><span class="n">IntBoundedValidator</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
<span class="linenos"> 4</span>                         <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;The number of iterations of the loop to perform (default=100)&quot;</span><span class="p">)</span>
<span class="linenos"> 5</span>    <span class="bp">self</span><span class="o">.</span><span class="n">declareProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;SummedValue&quot;</span><span class="p">,</span> <span class="n">defaultValue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="linenos"> 6</span>                         <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Outputs the sum of the n iterations&quot;</span><span class="p">,</span>
<span class="linenos"> 7</span>                         <span class="n">direction</span> <span class="o">=</span> <span class="n">Direction</span><span class="o">.</span><span class="n">Output</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="k">def</span> <span class="nf">PyExec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">10</span>    <span class="n">nloops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s2">&quot;NIterations&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
<span class="linenos">11</span>    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">12</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nloops</span><span class="p">):</span>
<span class="linenos">13</span>        <span class="nb">sum</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="bp">self</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s2">&quot;SummedValue&quot;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">)</span>
</pre></div>
</div>
<p>The second property on lines 5-7, <code class="docutils literal notranslate"><span class="pre">SummedValue</span></code>, is defined as an output property.
The <code class="docutils literal notranslate"><span class="pre">self.setProperty(&quot;SummedValue&quot;,</span> <span class="pre">sum)</span></code> on line 15 is used as the point to tell the algorithm that this value is to be used for that property.
It will then be returned as part of the generated python function wrapper.</p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="03_validating_input.html" title="Previous Chapter: Validating Input"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Validating Input</span>
    </a>
  </li>
  <li>
    <a href="05_logging.html" title="Next Chapter: Logging"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Logging &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>