<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>DNSMergeRuns v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=ff701123"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Description" href="DSFinterp-v1.html" />
    <link rel="prev" title="DNSFlippingRatioCorr v1" href="DNSFlippingRatioCorr-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">DNSMergeRuns v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="dnsmergeruns-v1">
<span id="algm-dnsmergeruns"></span><span id="algm-dnsmergeruns-v1"></span><h1>DNSMergeRuns v1<a class="headerlink" href="#dnsmergeruns-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id2">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p>
<ul>
<li><p><a class="reference internal" href="#valid-input-workspaces" id="id5">Valid input workspaces</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#usage" id="id6">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id7">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Merges runs performed at different detector bank positions into one matrix workspace.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="LoadDNSLegacy-v1.html#algm-loaddnslegacy"><span class="std std-ref">LoadDNSLegacy</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WorkspaceNames</p></td>
<td><p>Input</p></td>
<td><p>str list</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>List of Workspace names to merge.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A workspace name to save the merged data.</p></td>
</tr>
<tr class="row-even"><td><p>HorizontalAxis</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>2theta</p></td>
<td><p>X axis in the merged workspace. Allowed values: [‘2theta’, ‘|Q|’, ‘d-Spacing’]</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This algorithm is being developed for a specific instrument. It might get changed or even
removed without a notification, should instrument scientists decide to do so.</p>
</div>
<p>This algorithm merges given matrix workspaces to a <a class="reference internal" href="../concepts/Workspace2D.html#workspace2d"><span class="std std-ref">Workspace2D</span></a>. The purpose of this algorithm is to merge the DNS diffraction mode data measured at different detector bank positions. The algorithm is not suitable to merge DNS single crystal diffraction data measured at different sample rotation angles.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <strong>OutputWorkspace</strong> will have no connection to the instrument. Part of the sample logs will be lost either. This algorithm can be executed at any step of the data reduction to view the result. However, further data reduction must be performed on the original workspaces.</p>
</div>
<p>As a result, a workspace containing a single spectrum will be produced. Values on X-axis depend on user’s choice.</p>
<p>Absolute value of the momentum transfer <span class="math notranslate nohighlight">\(|Q|\)</span> is calculated as</p>
<p><span class="math notranslate nohighlight">\(|Q| = \left|\frac{4\pi\sin\theta}{\lambda}\right|\)</span></p>
<p>where <span class="math notranslate nohighlight">\(\theta\)</span> is the scattering angle and <span class="math notranslate nohighlight">\(\lambda\)</span> is the neutron wavelength.</p>
<p>d-Spacing <span class="math notranslate nohighlight">\(d\)</span> is calculated as:</p>
<p><span class="math notranslate nohighlight">\(d = \left|\frac{\lambda}{2\,\sin\theta}\right|\)</span></p>
<section id="valid-input-workspaces">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Valid input workspaces</a><a class="headerlink" href="#valid-input-workspaces" title="Link to this heading">¶</a></h3>
<p>The input workspaces (<strong>WorkspaceNames</strong>) have to have the following in order to be valid inputs for this algorithm.</p>
<ul class="simple">
<li><p>The same number of dimensions</p></li>
<li><p>The same number of spectra</p></li>
<li><p>The same number of bins</p></li>
<li><p>The same wavelength in the sample logs</p></li>
<li><p>The same value of <em>normalized</em> sample log. Algorithm cannot merge data with different normalizations.</p></li>
</ul>
<p>For the physically meaningful merge result, it is also important that these workspaces have the same slits size, polarisation, and flipper status. If some of these parameters are different, algorithm produces warning. If these properties are not specified in the workspace sample logs, no comparison is performed.</p>
</section>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - Merge a set of selected runs</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">splitext</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># path to the directory containing data files</span>
<span class="n">mypath</span> <span class="o">=</span> <span class="s2">&quot;/path/to/data/dns/rc36b_standard_dz&quot;</span>
<span class="n">coilcurrents</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">mypath</span><span class="p">,</span> <span class="s1">&#39;currents.txt&#39;</span><span class="p">)</span>

<span class="c1"># filter the data files in the given directory</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^dz(\d</span><span class="si">{8}</span><span class="s1">)vana.d_dat$&#39;</span><span class="p">)</span>

<span class="c1"># we choose only the runs with &#39;x&#39; polarisation</span>
<span class="n">filelist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">29100501</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">is_in_filelist</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">flist</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">flist</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="n">datafiles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="n">mypath</span><span class="p">)</span> <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">mypath</span><span class="p">,</span><span class="n">f</span><span class="p">))</span> <span class="ow">and</span> <span class="n">is_in_filelist</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">filelist</span><span class="p">)])</span>

<span class="c1"># load data to workspaces</span>
<span class="n">wslist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">datafiles</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">wname</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#print(&quot;Processing {}&quot;.format(wname))  # uncomment if needed</span>
        <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">mypath</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">wname</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">coilcurrents</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wslist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wname</span><span class="p">)</span>

<span class="c1"># merge the given workspaces</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">DNSMergeRuns</span><span class="p">(</span><span class="n">wslist</span><span class="p">,</span> <span class="n">HorizontalAxis</span><span class="o">=</span><span class="s1">&#39;2theta&#39;</span><span class="p">)</span>
<span class="n">mergedQ</span> <span class="o">=</span> <span class="n">DNSMergeRuns</span><span class="p">(</span><span class="n">wslist</span><span class="p">,</span> <span class="n">HorizontalAxis</span><span class="o">=</span><span class="s1">&#39;|Q|&#39;</span><span class="p">)</span>
<span class="n">mergedD</span> <span class="o">=</span> <span class="n">DNSMergeRuns</span><span class="p">(</span><span class="n">wslist</span><span class="p">,</span> <span class="n">HorizontalAxis</span><span class="o">=</span><span class="s1">&#39;d-Spacing&#39;</span><span class="p">)</span>

<span class="c1"># print selected values from merged workspaces</span>
<span class="n">two_theta</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">extractX</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 5 2Theta values: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">two_theta</span><span class="p">[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">mergedQ</span><span class="o">.</span><span class="n">extractX</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 5 |Q| values: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">q</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">mergedD</span><span class="o">.</span><span class="n">extractX</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 5 d values: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">d</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="mi">3</span><span class="p">)))</span>
</pre></div>
</div>
<p>Output:</p>
<blockquote>
<div><p>First 5 2Theta values: [ 7.5  8.   8.5  9.   9.5]</p>
<p>First 5 Q values: [ 0.249  0.266  0.282  0.299  0.315]</p>
<p>First 5 d values: [ 1.844  1.848  1.852  1.856  1.86 ]</p>
</div></blockquote>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Workflow/MLZ/DNS.html">Workflow\MLZ\DNS</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/171b44b29330a2303790637329340bb3b6de0d0a/Framework/PythonInterface/plugins/algorithms/DNSMergeRuns.py">DNSMergeRuns.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DNSFlippingRatioCorr-v1.html" title="Previous Chapter: DNSFlippingRatioCorr v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DNSFlippingRa...</span>
    </a>
  </li>
  <li>
    <a href="DSFinterp-v1.html" title="Next Chapter: Description"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Description &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>