<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>DirectILLDiagnostics v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=ff701123"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DirectILLIntegrateVanadium v1" href="DirectILLIntegrateVanadium-v1.html" />
    <link rel="prev" title="DirectILLCollectData v1" href="DirectILLCollectData-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">DirectILLDiagnostics v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="directilldiagnostics-v1">
<span id="algm-directilldiagnostics"></span><span id="algm-directilldiagnostics-v1"></span><h1>DirectILLDiagnostics v1<a class="headerlink" href="#directilldiagnostics-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id2">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id3">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p>
<ul>
<li><p><a class="reference internal" href="#diagnostics-performed" id="id6">Diagnostics performed</a></p>
<ul>
<li><p><a class="reference internal" href="#elastic-peak-diagnostics" id="id7">Elastic peak diagnostics</a></p></li>
<li><p><a class="reference internal" href="#flat-background-diagnostics" id="id8">Flat background diagnostics</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#beam-stop" id="id9">Beam stop</a></p></li>
<li><p><a class="reference internal" href="#default-mask" id="id10">Default mask</a></p></li>
<li><p><a class="reference internal" href="#diagnostics-reporting" id="id11">Diagnostics reporting</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#defaults-and-ill-s-instrument-specific-values" id="id12">Defaults and ILL’s instrument specific values</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id13">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id14">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Perform detector diagnostics and masking for the direct geometry TOF spectrometers at ILL.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="DirectILLReduction-v1.html#algm-directillreduction"><span class="std std-ref">DirectILLReduction</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A ‘raw’ workspace from DirectILLCollectData to calculate the diagnostics from.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A diagnostics mask workspace.</p></td>
</tr>
<tr class="row-even"><td><p>Cleanup</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Cleanup ON</p></td>
<td><p>What to do with intermediate workspaces. Allowed values: [‘Cleanup ON’, ‘Cleanup OFF’]</p></td>
</tr>
<tr class="row-odd"><td><p>SubalgorithmLogging</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Logging OFF</p></td>
<td><p>Enable or disable subalgorithms to print in the logs. Allowed values: [‘Logging OFF’, ‘Logging ON’]</p></td>
</tr>
<tr class="row-even"><td><p>EPPWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Table workspace containing results from the FindEPP algorithm.</p></td>
</tr>
<tr class="row-odd"><td><p>ElasticPeakDiagnostics</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Peak Diagnostics AUTO</p></td>
<td><p>Enable or disable elastic peak diagnostics. Allowed values: [‘Peak Diagnostics AUTO’, ‘Peak Diagnostics ON’, ‘Peak Diagnostics OFF’]</p></td>
</tr>
<tr class="row-even"><td><p>ElasticPeakWidthInSigmas</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>3</p></td>
<td><p>Integration half width of the elastic peak in multiples  of ‘Sigma’ in the EPP table.</p></td>
</tr>
<tr class="row-odd"><td><p>ElasticPeakLowThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Multiplier for lower acceptance limit used in elastic peak diagnostics.</p></td>
</tr>
<tr class="row-even"><td><p>ElasticPeakHighThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Multiplier for higher acceptance limit used in elastic peak diagnostics.</p></td>
</tr>
<tr class="row-odd"><td><p>ElasticPeakErrorThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>To fail the elastic peak diagnostics, the intensity must also exceed this number of error bars with respect to the median intensity.</p></td>
</tr>
<tr class="row-even"><td><p>BkgDiagnostics</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Bkg Diagnostics AUTO</p></td>
<td><p>Control the background diagnostics. Allowed values: [‘Bkg Diagnostics AUTO’, ‘Bkg Diagnostics ON’, ‘Bkg Diagnostics OFF’]</p></td>
</tr>
<tr class="row-odd"><td><p>NonBkgRegionInSigmas</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>10</p></td>
<td><p>Width of the range excluded from background integration around the elastic peaks in multiplies of ‘Sigma’ in the EPP table</p></td>
</tr>
<tr class="row-even"><td><p>NoisyBkgLowThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Multiplier for lower acceptance limit used in noisy background diagnostics.</p></td>
</tr>
<tr class="row-odd"><td><p>NoisyBkgHighThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Multiplier for higher acceptance limit used in noisy background diagnostics.</p></td>
</tr>
<tr class="row-even"><td><p>NoisyBkgErrorThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>To fail the background diagnostics, the background level must also exceed this number of error bars with respect to the median level.</p></td>
</tr>
<tr class="row-odd"><td><p>BeamStopDiagnostics</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Beam Stop Diagnostics AUTO</p></td>
<td><p>Control the beam stop diagnostics. Allowed values: [‘Beam Stop Diagnostics AUTO’, ‘Beam Stop Diagnostics ON’, ‘Beam Stop Diagnostics OFF’]</p></td>
</tr>
<tr class="row-even"><td><p>BeamStopThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.67</p></td>
<td><p>Multiplier for the lower acceptance limit for beam stop diagnostics.</p></td>
</tr>
<tr class="row-odd"><td><p>DefaultMask</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Default Mask ON</p></td>
<td><p>Enable or disable instrument specific default mask. Allowed values: [‘Default Mask ON’, ‘Default Mask OFF’]</p></td>
</tr>
<tr class="row-even"><td><p>MaskedDetectors</p></td>
<td><p>Input</p></td>
<td><p>long list</p></td>
<td></td>
<td><p>List of spectra to mask.</p></td>
</tr>
<tr class="row-odd"><td><p>MaskedComponents</p></td>
<td><p>Input</p></td>
<td><p>str list</p></td>
<td></td>
<td><p>List of instrument components to mask.</p></td>
</tr>
<tr class="row-even"><td><p>OutputReportWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td></td>
<td><p>Output table workspace for detector diagnostics reporting.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputReport</p></td>
<td><p>Output</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Diagnostics report as a string.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This algorithm performs detector diagnostics and masking. It is part of <a class="reference internal" href="../techniques/DirectILL.html#directill"><span class="std std-ref">ILL’s direct geometry data reduction suite</span></a>. The diagnostics are calculated using the counts from <em>InputWorkspace</em> which is preferably the raw workspace provided by the <em>OutputRawWorkspace</em> property of <a class="reference internal" href="DirectILLCollectData-v1.html#algm-directillcollectdata"><span class="std std-ref">DirectILLCollectData</span></a>. The output is a special mask workspace which can be further fed to <a class="reference internal" href="DirectILLReduction-v1.html#algm-directillreduction"><span class="std std-ref">DirectILLReduction</span></a> to mask the detectors diagnosed as bad. Optionally, an instrument specific default mask, a beam stop mask and/or a user specified hard mask given by <em>MaskedDetectors</em> or <em>MaskedComponents</em> can be added to the diagnostics mask.</p>
<p>A workflow diagram for the diagnostics is shown below:</p>
<figure class="align-default" id="id1">
<img alt="../_images/ImageNotFound.png" src="../_images/ImageNotFound.png" />
<figcaption>
<p><span class="caption-text">diagram generation was disabled</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<section id="diagnostics-performed">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Diagnostics performed</a><a class="headerlink" href="#diagnostics-performed" title="Link to this heading">¶</a></h3>
<p>The algorithm performs two tests for each spectrum in <em>InputWorkspace</em>: elastic peak diagnostics and flat background diagnostics. Basically both tests calculate the median of the test values over all spectra, then compare the individual values to the median. For more detailed information, see <a class="reference internal" href="MedianDetectorTest-v1.html#algm-mediandetectortest"><span class="std std-ref">MedianDetectorTest</span></a>.</p>
<section id="elastic-peak-diagnostics">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Elastic peak diagnostics</a><a class="headerlink" href="#elastic-peak-diagnostics" title="Link to this heading">¶</a></h4>
<p>The EPP table given in <em>EPPWorkspace</em> and the value of <em>ElasticPeakWidthInSigmas</em> are used to integrate the spectra around the elastic peaks, giving the elastic intensities. The intensities are further normalised by the opening solid angles of the detectors, given by <a class="reference internal" href="SolidAngle-v1.html#algm-solidangle"><span class="std std-ref">SolidAngle</span></a> before the actual diagnostics.</p>
</section>
<section id="flat-background-diagnostics">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">Flat background diagnostics</a><a class="headerlink" href="#flat-background-diagnostics" title="Link to this heading">¶</a></h4>
<p>Similarly to elastic peak diagnostics, <em>EPPWorkspace</em> and <em>NonBgkRegionInSigmas</em> are used to integrate the time-independent background regions of <em>InputWorkspace</em>. <em>NonBkgRegionInSigmas</em> is a factor applied to the ‘Sigma’ column in <em>EPPWorkspace</em> and this interval around the elastic peak positions is excluded from the integration. No opening angle corrections are applied to the background diagnostics.</p>
</section>
</section>
<section id="beam-stop">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Beam stop</a><a class="headerlink" href="#beam-stop" title="Link to this heading">¶</a></h3>
<p>The shadow cast on the detectors by a beam stop can be masked by the diagnostics, as well. This functionality is automatically enabled when ‘beam_stop_diagnostics_spectra’ instrument parameter is defined and can be disabled by <em>BeamStopDiagnostics</em>. The algorithm tries to mask a continuous region within the spectra listed in ‘beam_stop_diagnostics_spectra’. The <em>BeamStopThreshold</em> property can be used to fine-tune the operation.</p>
<p>The ‘beam_stop_diagnostics_spectra’ instrument parameter lists ranges of spectrum numbers. Each range should cover a region of a physical detector tube, part of which is behind the beam stop.</p>
<p>The masking procedure proceeds as follows:</p>
<ol class="arabic simple">
<li><p>Pick a range from ‘beam_stop_diagnostics_spectra’.</p></li>
<li><p>Integrate the spectra within the range.</p></li>
<li><p>Divide the range into two halves from the middle.</p></li>
<li><p>Pick one of the halves, take the maximum integrated value.</p></li>
<li><p>Starting from the spectrum containing the maximum value, and stepping towards the center of the range, find the first spectrum where the integrated intensity is less than the maximum intensity multiplied by <em>BeamStopThreshold</em>. Lets call this the threshold spectrum.</p></li>
<li><p>Mark all spectra from the middle of the range to the threshold spectrum as masked.</p></li>
<li><p>Repeat for the other half.</p></li>
</ol>
</section>
<section id="default-mask">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Default mask</a><a class="headerlink" href="#default-mask" title="Link to this heading">¶</a></h3>
<p>The default mask file is defined by the ‘Workflow.MaskFile’ instrument parameter.</p>
<p>Currently, there is a default mask available for ILL’s IN5 and PANTHER instruments.</p>
</section>
<section id="diagnostics-reporting">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Diagnostics reporting</a><a class="headerlink" href="#diagnostics-reporting" title="Link to this heading">¶</a></h3>
<p>The optional <em>OutputReportWorkspace</em> property returns a table workspace summarizing the diagnostics. The table has six columns:</p>
<ol class="arabic simple">
<li><p>‘WorkspaceIndex’</p></li>
<li><p>‘UserMask’: Holds non-zero values for spectra masked by the default mask, <em>MaskedDetectors</em> and <em>MaskedComponents</em>.</p></li>
<li><p>‘ElasticIntensity’: Holds the value of integrated elastic peaks used for the diagnostics.</p></li>
<li><p>‘IntensityDiagnosed’: Holds non-zero values for spectra diagnosed as ‘bad’ in elastic peak diagnostics.</p></li>
<li><p>‘FlagBkg’: Holds the value of the flat backgrounds used for the diagnostics.</p></li>
<li><p>‘FlatBkgDiagnosed’: Non-zero values in this column indicate that the spectrum did not pass the background diagnostics.</p></li>
</ol>
<p>The columns can be plotted to get an overview of the diagnostics.</p>
<p>Additionally, a string listing the masked and diagnosed detectors can be accessed via the <em>OutputReport</em> property.</p>
</section>
</section>
<section id="defaults-and-ill-s-instrument-specific-values">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Defaults and ILL’s instrument specific values</a><a class="headerlink" href="#defaults-and-ill-s-instrument-specific-values" title="Link to this heading">¶</a></h2>
<p>The following settings are used when not explicitly overwritten by the algorithm’s properties or the IPFs of non-ILL instruments:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>IN4</p></th>
<th class="head"><p>IN5</p></th>
<th class="head"><p>IN6</p></th>
<th class="head"><p>PANTHER</p></th>
<th class="head"><p>SHARP</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ElasticPeakDiagnostics</p></td>
<td><p>Peak Diagnostics ON</p></td>
<td><p>Peak Diagnostics OFF</p></td>
<td><p>Peak Diagnostics ON</p></td>
<td><p>Peak Diagnostics OFF</p></td>
<td><p>Peak Diagnostics ON</p></td>
<td><p>Peak Diagnostics ON</p></td>
</tr>
<tr class="row-odd"><td><p>ElasticPeakLowThreshold</p></td>
<td><p>0.1</p></td>
<td><p>0.1</p></td>
<td><p>0.45</p></td>
<td><p>0.1</p></td>
<td><p>0.1</p></td>
<td><p>0.1</p></td>
</tr>
<tr class="row-even"><td><p>ElasticPeakHighThreshold</p></td>
<td><p>3.0</p></td>
<td><p>3.0</p></td>
<td><p>3.0</p></td>
<td><p>3.0</p></td>
<td><p>3.0</p></td>
<td><p>3.0</p></td>
</tr>
<tr class="row-odd"><td><p>ElasticPeakErrorThreshold</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
</tr>
<tr class="row-even"><td><p>BkgDiagnostics</p></td>
<td><p>Bkg Diagnostics ON</p></td>
<td><p>Bkg Diagnostics OFF</p></td>
<td><p>Bkg Diagnostics ON</p></td>
<td><p>Bkg Diagnostics OFF</p></td>
<td><p>Bkg Diagnostics OFF</p></td>
<td><p>Bkg Diagnostics ON</p></td>
</tr>
<tr class="row-odd"><td><p>NoisyLowThreshold</p></td>
<td><p>0.1</p></td>
<td><p>0.1</p></td>
<td><p>0.1</p></td>
<td><p>0.1</p></td>
<td><p>0.1</p></td>
<td><p>0.1</p></td>
</tr>
<tr class="row-even"><td><p>NoisyBkgHighThreshold</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
</tr>
<tr class="row-odd"><td><p>NoisyBkgErrorThreshold</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
<td><p>3.3</p></td>
</tr>
<tr class="row-even"><td><p>BeamStopDiagnostics</p></td>
<td><p>Beam Stop Diagnostics OFF</p></td>
<td><p>Beam Stop Diagnostics ON</p></td>
<td><p>Beam Stop Diagnostics OFF</p></td>
<td><p>Beam Stop Diagnostics ON</p></td>
<td><p>Beam Stop Diagnostics OFF</p></td>
<td><p>Beam Stop Diagnostics OFF</p></td>
</tr>
</tbody>
</table>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p>For usage of this algorithm as part of the direct geometry data reduction, check the examples <a class="reference internal" href="../techniques/DirectILL.html#directill"><span class="std std-ref">here</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p><strong>Example - Diagnostics on IN4 workspace</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN4/087283-087290.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;preprocessed&#39;</span><span class="p">,</span>
    <span class="n">OutputRawWorkspace</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span>  <span class="c1"># Needed for the diagnostics</span>
    <span class="n">OutputEPPWorkspace</span><span class="o">=</span><span class="s1">&#39;epps&#39;</span>  <span class="c1"># Needed for the diagnostics</span>
<span class="p">)</span>

<span class="n">diagnostics</span> <span class="o">=</span> <span class="n">DirectILLDiagnostics</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span>  <span class="c1"># Use &#39;raw&#39; rather than &#39;preprocessed&#39; for background diagnostics</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;mask&#39;</span><span class="p">,</span>  <span class="c1"># A special MaskWorkspace</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s1">&#39;epps&#39;</span><span class="p">,</span>
    <span class="n">MaskedComponents</span><span class="o">=</span><span class="s1">&#39;rosace&#39;</span><span class="p">,</span>
    <span class="n">OutputReportWorkspace</span><span class="o">=</span><span class="s1">&#39;diagnostics_report&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">OutputReport</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Spectra masked by default mask file:
None
Spectra masked by beam stop diagnostics:
None
Additional spectra marked as bad by elastic peak diagnostics:
13, 40, 51, 64, 72-73, 78-79, 81-83, 100-101, 139, 150-151, 165, 173, 180-181, 183-184, 213, 239-240, 264, 272-273, 278-279, 281-283, 300-308, 313-320, 325-331, 337-344, 348-354, 361-366, 373-376, 378, 385-391
Additional spectra marked as bad by flat background diagnostics:
13, 100-101, 132, 213, 300-309, 313-319, 321, 325-331, 337-343, 345, 348-357, 361-367, 373-378, 381, 385-391
</pre></div>
</div>
<p><strong>Example - Default and beam stop masks on IN5 workspace</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># On IN5 we don&#39;t usually diagnose the pixels, but apply</span>
<span class="c1"># a hark mask + beam stop mask.</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;ILL/IN5/104007.nxs&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;preprocessed&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">DirectILLDiagnostics</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;preprocessed&#39;</span><span class="p">,</span>  <span class="c1"># Any IN5 workspace goes, doesn&#39;t have to be &#39;raw&#39;</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;mask&#39;</span><span class="p">,</span>  <span class="c1"># A special MaskWorkspace</span>
    <span class="n">OutputReportWorkspace</span><span class="o">=</span><span class="s1">&#39;report&#39;</span>
<span class="p">)</span>
<span class="c1"># Read some data from the report table workspace</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">]</span>
<span class="n">default_column</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">&#39;DefaultMask&#39;</span><span class="p">)</span>
<span class="n">beam_stop_column</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">&#39;BeamStopMask&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of pixels masked by default mask: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">default_column</span><span class="p">))))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of pixels masked under beam stop: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">beam_stop_column</span><span class="p">))))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Total number of pixels masked by default mask: 7261
Total number of pixels masked under beam stop: 2457
</pre></div>
</div>
<p>The figure below shows the mask produced by the IN5 example script above. The green pixels show the default hard mask and the beam stop.</p>
<figure class="align-default">
<img alt="Default and beam stop masks of IN5 spectrometer." src="../_images/DiagnosticsMaskIN5.png" />
</figure>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/ILL/Direct.html">ILL\Direct</a> | <a class="reference external" href="categories/Inelastic/Reduction.html">Inelastic\Reduction</a> | <a class="reference external" href="categories/Workflow/Inelastic.html">Workflow\Inelastic</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/171b44b29330a2303790637329340bb3b6de0d0a/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/DirectILLDiagnostics.py">DirectILLDiagnostics.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DirectILLCollectData-v1.html" title="Previous Chapter: DirectILLCollectData v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DirectILLColl...</span>
    </a>
  </li>
  <li>
    <a href="DirectILLIntegrateVanadium-v1.html" title="Next Chapter: DirectILLIntegrateVanadium v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DirectILLInte... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>