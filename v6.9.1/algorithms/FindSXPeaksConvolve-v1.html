<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>FindSXPeaksConvolve v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=ff701123"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FindSatellitePeaks v1" href="FindSatellitePeaks-v1.html" />
    <link rel="prev" title="FindSXPeaks v1" href="FindSXPeaks-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">FindSXPeaksConvolve v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="findsxpeaksconvolve-v1">
<span id="algm-findsxpeaksconvolve"></span><span id="algm-findsxpeaksconvolve-v1"></span><h1>FindSXPeaksConvolve v1<a class="headerlink" href="#findsxpeaksconvolve-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id2">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id5">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id6">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Find single-crystal Bragg peaks in MatrixWorkspaces for instruments comprising rectangular detctors (such as SXD at ISIS).</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="FindSXPeaks-v1.html#algm-findsxpeaks"><span class="std std-ref">FindSXPeaks</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A MatrixWorkspace to integrate (x-axis must be TOF).</p></td>
</tr>
<tr class="row-odd"><td><p>PeaksWorkspace</p></td>
<td><p>Output</p></td>
<td><p>IPeaksWorkspace</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A PeaksWorkspace containing the peaks to integrate.</p></td>
</tr>
<tr class="row-even"><td><p>ThresholdIoverSigma</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>5</p></td>
<td><p>Threshold value for I/sigma used to identify statistically significant peaks.</p></td>
</tr>
<tr class="row-odd"><td><p>NRows</p></td>
<td><p>Input</p></td>
<td><p>long</p></td>
<td><p>5</p></td>
<td><p>Number of row components in the detector to use in the convolution kernel. For WISH row components correspond to pixels along a single tube.</p></td>
</tr>
<tr class="row-even"><td><p>NCols</p></td>
<td><p>Input</p></td>
<td><p>long</p></td>
<td><p>5</p></td>
<td><p>Number of column components in the detector to use in the convolution kernel. For WISH column components correspond to tubes.</p></td>
</tr>
<tr class="row-odd"><td><p>NBins</p></td>
<td><p>Input</p></td>
<td><p>long</p></td>
<td><p>10</p></td>
<td><p>Number of TOF bins to use in the convolution kernel.</p></td>
</tr>
<tr class="row-even"><td><p>GetNBinsFromBackToBackParams</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If true the number of TOF bins used in the convolution kernel will be calculated from the FWHM of the BackToBackExponential peak using parameters defined in the instrument parameters.xml file.</p></td>
</tr>
<tr class="row-odd"><td><p>NFWHM</p></td>
<td><p>Input</p></td>
<td><p>long</p></td>
<td><p>4</p></td>
<td><p>If GetNBinsFromBackToBackParams=True then the number of TOF bins will be NFWHM x FWHM of the BackToBackExponential peak at the center of each detector panel at the middle of the spectrum.</p></td>
</tr>
<tr class="row-even"><td><p>MinFracSize</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.125</p></td>
<td><p>Minimum peak size as a fraction of the kernel size.</p></td>
</tr>
<tr class="row-odd"><td><p>RemoveOnEdge</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If RemoveOnEdge=True then peaks at the edge of the data (within roughly 1/4 of the kernel size) will be removed. Convolution produces invalid results at the edges of the data. To some extent such edge effects are reduced in this algorithm due to the choice of padding and by dividing the convolution results of the signal and error. However, some artifacts remain because the kernel used in the convolution of the signal has some negative values and the kernel used for the error does not.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This is an algorithm to find single-crystal Bragg peaks in a <a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a> with detector
banks of type <a class="reference internal" href="../concepts/RectangularDetector.html#rectangulardetector"><span class="std std-ref">RectangularDetector</span></a> (e.g. SXD, TOPAZ) by integrating the data using a
convolution with a shoebox kernel.</p>
<p>The size of the kernel is defined in the input to the algorithm and should match the approximate extent of a typical peak.
The size on the detector is governed by <code class="docutils literal notranslate"><span class="pre">NRows</span></code> and <code class="docutils literal notranslate"><span class="pre">NCols</span></code> which are in units of pixels.
The size of the kernel along the TOF dimension can be specified in one of two ways:</p>
<ol class="arabic simple">
<li><p>Provide <code class="docutils literal notranslate"><span class="pre">NBins</span></code> - number of TOF bins in the kernel</p></li>
<li><p>Setting <code class="docutils literal notranslate"><span class="pre">GetNBinsFromBackToBackParams=True</span></code> and providing <code class="docutils literal notranslate"><span class="pre">NFWHM</span></code> - in which case <code class="docutils literal notranslate"><span class="pre">NBins</span></code>  will be NFWHM x FWHM
of a <a class="reference internal" href="../fitting/fitfunctions/BackToBackExponential.html#func-backtobackexponential"><span class="std std-ref">BackToBackExponential</span></a> peak at the center of each detector panel/bank at the
middle of the spectrum.</p></li>
</ol>
<p>Note to use method 2, back-to-back exponential coefficients must be defined in the Parameters.xml file for the
instrument.</p>
<p>The integration requires a background shell with negative weights, such that the total kernel size is increased by a
factor 1.25 along each dimension (such that there are approximately the same number of elements in the kernel and the
background shell). The integral of the kernel and background shell together is zero.</p>
<p>The integrated intensity is evaluated by convolution of the signal array with the kernel and the square of the error on
the integrated intensity is determined by convolution of the squared error array with the squared value of the kernel.</p>
<p>The threshold for peak detection is given by <code class="docutils literal notranslate"><span class="pre">ThresholdIoverSigma</span></code> which is the cutoff ratio of intensity/sigma (i.e.
a valid peak would be expected to have intensity/sigma &gt; 3). Stronger peaks will have a larger intensity/sigma.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - FindSXPeaksConvolve</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mantid.simpleapi</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s2">&quot;SXD23767.raw&quot;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;SXD23767&quot;</span><span class="p">)</span>
<span class="n">peaks</span> <span class="o">=</span> <span class="n">FindSXPeaksConvolve</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span> <span class="n">PeaksWorkspace</span><span class="o">=</span><span class="s1">&#39;peaks_out&#39;</span><span class="p">,</span> <span class="n">GetNBinsFromBackToBackParams</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ThresholdIoverSigma</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">peaks</span><span class="o">.</span><span class="n">getNumberPeaks</span><span class="p">()</span><span class="si">}</span><span class="s2"> peaks&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Found 307 peaks
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Diffraction/Reduction.html">Diffraction\Reduction</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/171b44b29330a2303790637329340bb3b6de0d0a/Framework/PythonInterface/plugins/algorithms/FindSXPeaksConvolve.py">FindSXPeaksConvolve.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="FindSXPeaks-v1.html" title="Previous Chapter: FindSXPeaks v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; FindSXPeaks v1</span>
    </a>
  </li>
  <li>
    <a href="FindSatellitePeaks-v1.html" title="Next Chapter: FindSatellitePeaks v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">FindSatellitePeaks v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>