<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>FindGoniometerAngles v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=770b529d"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FindGoniometerFromUB v1" href="FindGoniometerFromUB-v1.html" />
    <link rel="prev" title="FindGlobalBMatrix v1" href="FindGlobalBMatrix-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.10</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">FindGoniometerAngles v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="findgoniometerangles-v1">
<span id="algm-findgoniometerangles"></span><span id="algm-findgoniometerangles-v1"></span><h1>FindGoniometerAngles v1<a class="headerlink" href="#findgoniometerangles-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id2">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id5">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id6">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Do a brute force search for the goniometer rotation angles that maximize the number of peaks indexed by the specified UB.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="OptimizeCrystalPlacement-v1.html#algm-optimizecrystalplacement"><span class="std std-ref">OptimizeCrystalPlacement</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PeaksWorkspace</p></td>
<td><p>Input</p></td>
<td><p>IPeaksWorkspace</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Workspace of Peaks with UB loaded</p></td>
</tr>
<tr class="row-odd"><td><p>MaxAngle</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>5</p></td>
<td><p>The maximum change in angle to try for any of the goniometer angles, phi, chi and omega, in degrees.</p></td>
</tr>
<tr class="row-even"><td><p>Tolerance</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.15</p></td>
<td><p>The tolerance on Miller indices for a peak to be considered indexed</p></td>
</tr>
<tr class="row-odd"><td><p>Apply</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Update goniometer in peaks workspace</p></td>
</tr>
<tr class="row-even"><td><p>Phi</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>Phi found</p></td>
</tr>
<tr class="row-odd"><td><p>Chi</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>Chi found</p></td>
</tr>
<tr class="row-even"><td><p>Omega</p></td>
<td><p>Output</p></td>
<td><p>number</p></td>
<td></td>
<td><p>Omega found</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>Do a brute force search for the goniometer rotation angles that maximize the number of peaks indexed by the UB on the peaks workspace.  The peaks must have peaks from only one run.  The search will start with the goniometer position set on the PeaksWoskpace and deviations from that goniometer up to MaxAngle will be tried, seaching for the gonomater angles that maximize the number of peaks indexed and minimize the total indexing error. This algorithm was ported from ISAW.</p>
<p>The best goniometer angles found will be returned in terms of phi, chi, omega (“YZY”) and if Apply is selected then the goniometer will be updated on the PeaksWorkspace and the Peaks.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - FindGoniometerAngles</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a peaks workspace with particular lattice and goniometer</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">LoadEmptyInstrument</span><span class="p">(</span><span class="n">InstrumentName</span><span class="o">=</span><span class="s2">&quot;TOPAZ&quot;</span><span class="p">)</span>
<span class="n">SetGoniometer</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">Axis0</span><span class="o">=</span><span class="s2">&quot;45,0,0,1,1&quot;</span><span class="p">)</span>
<span class="n">SetUB</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">peaks</span> <span class="o">=</span> <span class="n">PredictPeaks</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
<span class="n">num_peaks</span> <span class="o">=</span> <span class="n">peaks</span><span class="o">.</span><span class="n">getNumberPeaks</span><span class="p">()</span>

<span class="c1"># create new peaks workspace with wrong goniometer</span>
<span class="n">new_peaks</span> <span class="o">=</span> <span class="n">CreatePeaksWorkspace</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">SetGoniometer</span><span class="p">(</span><span class="n">new_peaks</span><span class="p">,</span> <span class="n">Axis0</span><span class="o">=</span><span class="s2">&quot;42,0,0,1,1&quot;</span><span class="p">)</span>
<span class="n">SetUB</span><span class="p">(</span><span class="n">new_peaks</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

<span class="c1"># copy peak q_lab vectors, q_sample will be wrong since wrong goniometer</span>
<span class="kn">from</span> <span class="nn">mantid.kernel</span> <span class="kn">import</span> <span class="n">SpecialCoordinateSystem</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_peaks</span><span class="p">):</span>
    <span class="n">new_peaks</span><span class="o">.</span><span class="n">addPeak</span><span class="p">(</span><span class="n">peaks</span><span class="o">.</span><span class="n">getPeak</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">getQLabFrame</span><span class="p">(),</span> <span class="n">SpecialCoordinateSystem</span><span class="o">.</span><span class="n">QLab</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">IndexPeaks</span><span class="p">(</span><span class="n">new_peaks</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting with </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">NumIndexed</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="n">num_peaks</span><span class="si">}</span><span class="s2"> peaks indexed&quot;</span><span class="p">)</span>
<span class="n">angles</span> <span class="o">=</span> <span class="n">FindGoniometerAngles</span><span class="p">(</span><span class="n">new_peaks</span><span class="p">,</span> <span class="n">Apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">IndexPeaks</span><span class="p">(</span><span class="n">new_peaks</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found Chi=</span><span class="si">{</span><span class="n">angles</span><span class="o">.</span><span class="n">Chi</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> and there are now </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">NumIndexed</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="n">num_peaks</span><span class="si">}</span><span class="s2"> peaks indexed&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Starting with 0 out of 65 peaks indexed
Found Chi=44.99 and there are now 65 out of 65 peaks indexed
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Crystal/Corrections.html">Crystal\Corrections</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/1b00e0b0644260219c488cf4142569b296f21ab0/Framework/Crystal/inc/MantidCrystal/FindGoniometerAngles.h">FindGoniometerAngles.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/1b00e0b0644260219c488cf4142569b296f21ab0/Framework/Crystal/src/FindGoniometerAngles.cpp">FindGoniometerAngles.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="FindGlobalBMatrix-v1.html" title="Previous Chapter: FindGlobalBMatrix v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; FindGlobalBMatrix v1</span>
    </a>
  </li>
  <li>
    <a href="FindGoniometerFromUB-v1.html" title="Next Chapter: FindGoniometerFromUB v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">FindGoniomete... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>