<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>PoldiFitPeaks1D v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=770b529d"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PoldiFitPeaks1D v2" href="PoldiFitPeaks1D-v2.html" />
    <link rel="prev" title="PoldiDataAnalysis v1" href="PoldiDataAnalysis-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.10</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">PoldiFitPeaks1D v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="poldifitpeaks1d-v1">
<span id="algm-poldifitpeaks1d-v1"></span><h1>PoldiFitPeaks1D v1<a class="headerlink" href="#poldifitpeaks1d-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id2">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id3">Description</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id4">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id5">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>PoldiPeakFit1D fits peak profiles to POLDI auto-correlation data.</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace2D.html#workspace2d"><span class="std std-ref">Workspace2D</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>An input workspace containing a POLDI auto-correlation spectrum.</p></td>
</tr>
<tr class="row-odd"><td><p>FwhmMultiples</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>2</p></td>
<td><p>Each peak will be fitted using x times FWHM data in each direction.</p></td>
</tr>
<tr class="row-even"><td><p>PeakFunction</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Gaussian</p></td>
<td><p>Peak function that will be fitted to all peaks. Allowed values: [‘AsymmetricPearsonVII’, ‘BackToBackExponential’, ‘Bk2BkExpConvPV’, ‘DeltaFunction’, ‘ElasticDiffRotDiscreteCircle’, ‘ElasticDiffSphere’, ‘ElasticIsoRotDiff’, ‘ExamplePeakFunction’, ‘Gaussian’, ‘IkedaCarpenterPV’, ‘Lorentzian’, ‘PseudoVoigt’, ‘Voigt’]</p></td>
</tr>
<tr class="row-odd"><td><p>PoldiPeakTable</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A table workspace containing POLDI peak data.</p></td>
</tr>
<tr class="row-even"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></p></td>
<td><p>RefinedPeakTable</p></td>
<td><p>Output workspace with refined peak data.</p></td>
</tr>
<tr class="row-odd"><td><p>FitPlotsWorkspace</p></td>
<td><p>Output</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td><p>FitPlots</p></td>
<td><p>Plots of all peak fits.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>PoldiFitPeaks1D takes a TableWorkspace with peaks (for example from <a class="reference internal" href="PoldiPeakSearch-v1.html#algm-poldipeaksearch"><span class="std std-ref">PoldiPeakSearch v1</span></a>) and a spectrum from <a class="reference internal" href="PoldiAutoCorrelation-v5.html#algm-poldiautocorrelation"><span class="std std-ref">PoldiAutoCorrelation v5</span></a> and tries to fit a Gaussian peak profile to the spectrum for each peak. As described on the page of <a class="reference internal" href="PoldiAutoCorrelation-v5.html#algm-poldiautocorrelation"><span class="std std-ref">PoldiAutoCorrelation v5</span></a>, each peak is surrounded by a dip. This dip is modeled by adding a quadratic background of the form</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(f(x) = a_0\cdot(x - x_0)^2 + a_1\)</span></p>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(x_0\)</span> is the peak position and <span class="math notranslate nohighlight">\(a_i\)</span> are the coefficients of the polynome.</p>
<p>The implementation is very close to the original POLDI analysis software
(using the same profile function). One point where this routine differs
is error calculation. In the original program the parameter errors were
adjusted by averaging <span class="math notranslate nohighlight">\(\chi^2\)</span>-values, but this does not work
properly if there is an outlier caused by a bad fit for one of the
peaks, so this step is not performed, the errors are derived directly from the fit.</p>
<p>The algorithm produces a number of output workspaces. One with refined peak parameters (OutputWorkspace), which is equivalent to the input TableWorkspace, except that the parameters are fitted and have errors. ResultTableWorkspace mimics the result files produced by the original data analysis software. FitCharacteristicsWorkspace contains the raw fitting results and the errors of the parameters, as well as <span class="math notranslate nohighlight">\(\chi^2\)</span>-values for each profile fit. FitPlotsWorkspace is a GroupWorkspace that contains plots for each peak profile fit with measured data, fitted data and a difference curve.</p>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p>The following small usage example performs a peak fit on the sample data already used in <a class="reference internal" href="PoldiAutoCorrelation-v5.html#algm-poldiautocorrelation"><span class="std std-ref">PoldiAutoCorrelation v5</span></a> and <a class="reference internal" href="PoldiPeakSearch-v1.html#algm-poldipeaksearch"><span class="std std-ref">PoldiPeakSearch v1</span></a>. After the fit, the plots can be viewed and used to visually judge the quality of the fits.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data file and instrument, perform correlation analysis</span>
<span class="n">raw_6904</span> <span class="o">=</span> <span class="n">LoadSINQFile</span><span class="p">(</span><span class="n">Filename</span> <span class="o">=</span> <span class="s2">&quot;poldi2013n006904.hdf&quot;</span><span class="p">,</span> <span class="n">Instrument</span> <span class="o">=</span> <span class="s2">&quot;POLDI&quot;</span><span class="p">)</span>
<span class="n">LoadInstrument</span><span class="p">(</span><span class="n">raw_6904</span><span class="p">,</span> <span class="n">InstrumentName</span> <span class="o">=</span> <span class="s2">&quot;POLDI&quot;</span><span class="p">,</span> <span class="n">RewriteSpectraMap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">correlated_6904</span> <span class="o">=</span> <span class="n">PoldiAutoCorrelation</span><span class="p">(</span><span class="n">raw_6904</span><span class="p">)</span>

<span class="c1"># Run peak search algorithm, store peaks in TableWorkspace</span>
<span class="n">peaks_6904</span> <span class="o">=</span> <span class="n">PoldiPeakSearch</span><span class="p">(</span><span class="n">correlated_6904</span><span class="p">)</span>

<span class="n">PoldiFitPeaks1D</span><span class="p">(</span><span class="n">InputWorkspace</span> <span class="o">=</span> <span class="n">correlated_6904</span><span class="p">,</span> <span class="n">FwhmMultiples</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
                <span class="n">PeakFunction</span> <span class="o">=</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">,</span> <span class="n">PoldiPeakTable</span> <span class="o">=</span> <span class="n">peaks_6904</span><span class="p">,</span>
                <span class="n">OutputWorkspace</span> <span class="o">=</span> <span class="s2">&quot;peaks_refined_6904&quot;</span><span class="p">,</span>
                <span class="n">FitPlotsWorkspace</span> <span class="o">=</span> <span class="s2">&quot;fit_plots_6904&quot;</span><span class="p">,</span>
                <span class="n">Version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There are </span><span class="si">{}</span><span class="s2"> plots available for inspection.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;fit_plots_6904&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getNumberOfEntries</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>There are 14 plots available for inspection.
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/SINQ/Poldi.html">SINQ\Poldi</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/1b00e0b0644260219c488cf4142569b296f21ab0/Framework/SINQ/inc/MantidSINQ/PoldiFitPeaks1D.h">PoldiFitPeaks1D.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/1b00e0b0644260219c488cf4142569b296f21ab0/Framework/SINQ/src/PoldiFitPeaks1D.cpp">PoldiFitPeaks1D.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="PoldiDataAnalysis-v1.html" title="Previous Chapter: PoldiDataAnalysis v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; PoldiDataAnalysis v1</span>
    </a>
  </li>
  <li>
    <a href="PoldiFitPeaks1D-v2.html" title="Next Chapter: PoldiFitPeaks1D v2"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">PoldiFitPeaks1D v2 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>