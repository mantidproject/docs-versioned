<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SaveISISReflectometryORSO v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=770b529d"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SaveIsawDetCal v1" href="SaveIsawDetCal-v1.html" />
    <link rel="prev" title="SaveISISNexus v1" href="SaveISISNexus-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.10</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">SaveISISReflectometryORSO v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="saveisisreflectometryorso-v1">
<span id="algm-saveisisreflectometryorso"></span><span id="algm-saveisisreflectometryorso-v1"></span><h1>SaveISISReflectometryORSO v1<a class="headerlink" href="#saveisisreflectometryorso-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id3">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id4">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id5">Description</a></p></li>
<li><p><a class="reference internal" href="#dataset-names" id="id6">Dataset names</a></p></li>
<li><p><a class="reference internal" href="#data-values" id="id7">Data values</a></p></li>
<li><p><a class="reference internal" href="#header-metadata" id="id8">Header Metadata</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id9">Usage</a></p></li>
<li><p><a class="reference internal" href="#references" id="id10">References</a></p></li>
<li><p><a class="reference internal" href="#source" id="id11">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Saves ISIS processed reflectometry workspaces into either the ASCII or Nexus implementation of the ORSO data standard.</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>WorkspaceList</p></td>
<td><p>Input</p></td>
<td><p>str list</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A list of workspace names containing the reduced reflectivity data to be saved.</p></td>
</tr>
<tr class="row-odd"><td><p>WriteResolution</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Whether to compute resolution values and write them as the fourth data column.</p></td>
</tr>
<tr class="row-even"><td><p>IncludeAdditionalColumns</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Whether to include the four additional columns lambda, dlambda, theta and dtheta for unstitched datasets. If set to True then a resolution column will be included for all datasets, regardless of the value of the WriteResolution parameter.</p></td>
</tr>
<tr class="row-odd"><td><p>Filename</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>File path to save the ORSO file to. Must end with a supported ORSO file extension. Use .ort to save into the ASCII format or .orb to save into the Nexus format. Allowed extensions: [‘.ort’, ‘.orb’]</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This algorithm saves the data and relevant metadata from a reduced ISIS Reflectometry workspace into either the ASCII (<code class="docutils literal notranslate"><span class="pre">.ort</span></code>) or Nexus (<code class="docutils literal notranslate"><span class="pre">.orb</span></code>) implementation of the ORSO data standard <a class="footnote-reference brackets" href="#orso" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.
The orsopy library <a class="footnote-reference brackets" href="#orsopy" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> is used to format and write out the file.
Currently this algorithm is unable to collect all of the mandatory information required by the ORSO standard so it produces a file that is not fully ORSO compliant.
A comment is included at the top of the file to reflect this. This algorithm is only suitable for use with Reflectometry data collected at the ISIS Neutron and Muon facility.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">WorkspaceList</span></code> passed to the algorithm should be a list of one or more reduced Reflectometry workspaces, or workspace groups, in units of momentum transfer (Q).
For each individual workspace, the algorithm attempts to find metadata for the file header and the resolution (dQ/Q) from the instrument, workspace history and sample logs associated with the workspace.
As a result, this algorithm may produce a file that is missing information if it is passed a workspace that wasn’t reduced via the <a class="reference internal" href="../interfaces/reflectometry/ISIS%20Reflectometry.html#interface-isis-refl"><span class="std std-ref">ISIS Reflectometry Interface</span></a>.
See below for further information about where the metadata and resolution are searched for in the workspace.</p>
<p>If more than one workspace name is passed in then the algorithm will save all the data and metadata to a single ORSO file as a series of datasets.
Dataset names must be unique, so an error will be thrown if duplicate dataset names are generated from the workspaces in the list. See below for more information about how these are generated.</p>
<p>When passed a workspace group, the algorithm will save each workspace in the group as an individual dataset within the same file, as described above.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Filename</span></code> property is used to provide the save location and name for the file. The save path must end with a valid ORSO file extension - use <code class="docutils literal notranslate"><span class="pre">.ort</span></code> to save into the ORSO ASCII format or <code class="docutils literal notranslate"><span class="pre">.orb</span></code> to save into the ORSO Nexus format.</p>
</section>
<section id="dataset-names">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Dataset names</a><a class="headerlink" href="#dataset-names" title="Link to this heading">¶</a></h2>
<p>A dataset name is generated automatically for each individual workspace in the input list or workspace group. This is done as follows:</p>
<ul class="simple">
<li><p>If there is a call to <a class="reference internal" href="Stitch1DMany-v1.html#algm-stitch1dmany"><span class="std std-ref">Stitch1DMany v1</span></a> in the workspace history then the dataset is given the name “Stitched”.</p></li>
<li><p>If it is not a stitched dataset then, if available in the workspace reduction history, the value of theta that was used for conversion to Q is given as the dataset name.</p></li>
<li><p>If a dataset name cannot be generated from either of the above, then the workspace name is used as the dataset name.</p></li>
</ul>
<p>For a workspace that is a member of a workspace group, if the generated dataset name is either “Stitched” or the theta value, then the individual workspace name is also included in the dataset name.
This is done to ensure a unique name.</p>
<p>Depending on the combination of workspaces and workspace groups passed in, it is possible that duplicate dataset names will be generated. If this happens then the algorithm will give an error and
fail to save out a file.</p>
</section>
<section id="data-values">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Data values</a><a class="headerlink" href="#data-values" title="Link to this heading">¶</a></h2>
<p>The saved ORSO file contains at least three columns of data: the normal wavevector transfer (Qz), the reflectivity (R) and the error of the reflectivity.
The data is converted to point data using algorithm <a class="reference internal" href="ConvertToPointData-v1.html#algm-converttopointdata"><span class="std std-ref">ConvertToPointData v1</span></a> before being saved to file.</p>
<p>If parameter <code class="docutils literal notranslate"><span class="pre">WriteResolution</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> then the algorithm will also attempt to include a fourth column that calculates the resolution of the normal wavevector transfer as: <span class="math notranslate nohighlight">\(resolution * Qz\)</span>.
The resolution (dQ/Q) is looked up from the workspace history as follows:</p>
<ul class="simple">
<li><p>Find the last occurrence of <a class="reference internal" href="Stitch1DMany-v1.html#algm-stitch1dmany"><span class="std std-ref">Stitch1DMany v1</span></a> in the workspace history. If this can be found, then the absolute value of the stitch <code class="docutils literal notranslate"><span class="pre">Params</span></code> parameter is used for the resolution.</p></li>
<li><p>Otherwise, find the last occurrence of <a class="reference internal" href="ReflectometryReductionOneAuto-v3.html#algm-reflectometryreductiononeauto"><span class="std std-ref">ReflectometryReductionOneAuto v3</span></a>. This algorithm makes a call to <a class="reference internal" href="Rebin-v1.html#algm-rebin"><span class="std std-ref">Rebin v1</span></a> and the absolute value of the middle rebin <code class="docutils literal notranslate"><span class="pre">Params</span></code> parameter is used as the resolution.</p></li>
</ul>
<p>If a resolution value cannot be found from the workspace history then the file is saved without this column included.</p>
<p>If parameter <code class="docutils literal notranslate"><span class="pre">IncludeAdditionalColumns</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> then the value of parameter <code class="docutils literal notranslate"><span class="pre">WriteResolution</span></code> is ignored and the algorithm will output the four columns described above for stitched datasets.
For non-stitched datasets there will be the four columns described above plus an additional four columns as follows:</p>
<ul class="simple">
<li><p><em>lambda</em> - the wavelength values. If the original conversion to Q was performed using <a class="reference internal" href="RefRoi-v1.html#algm-refroi"><span class="std std-ref">RefRoi v1</span></a> then the Qz column values are converted back to wavelength using: <span class="math notranslate nohighlight">\(\lambda=\frac{4\pi}{Q}sin(\theta)\)</span>. If the original conversion was performed using <a class="reference internal" href="ConvertUnits-v1.html#algm-convertunits"><span class="std std-ref">ConvertUnits v1</span></a> then this algorithm is used to convert back to wavelength.</p></li>
<li><p><em>error of lambda</em> - currently assumed to be 0.</p></li>
<li><p><em>incident theta</em> - the value of theta used for the final conversion to Q.</p></li>
<li><p><em>error of incident theta</em> - calculated as <span class="math notranslate nohighlight">\(resolution * \theta\)</span>.</p></li>
</ul>
<p>If it is not possible to calculate the values for the additional columns then a warning is logged and they are excluded from the file.</p>
</section>
<section id="header-metadata">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Header Metadata</a><a class="headerlink" href="#header-metadata" title="Link to this heading">¶</a></h2>
<p>Some of the metadata for the ORSO file header is retrieved directly from the input workspace, as detailed below.
For values retrieved from the workspace history, if any information cannot be extracted from the history then
the file is saved without this metadata included.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Header value</p></th>
<th class="head"><p>Workspace location</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>instrument</p></td>
<td><p>The name of the instrument associated with the workspace.</p></td>
</tr>
<tr class="row-odd"><td><p>start_date</p></td>
<td><p>The value of the <code class="docutils literal notranslate"><span class="pre">run_start</span></code> sample log.</p></td>
</tr>
<tr class="row-even"><td><p>proposalID</p></td>
<td><p>The value of either the <code class="docutils literal notranslate"><span class="pre">rb_proposal</span></code> or <code class="docutils literal notranslate"><span class="pre">experiment_identifier</span></code> sample log.</p></td>
</tr>
<tr class="row-odd"><td><p>sample name</p></td>
<td><p>The workspace title (same as the value of the <code class="docutils literal notranslate"><span class="pre">run_title</span></code> sample log).</p></td>
</tr>
<tr class="row-even"><td><p>reduction timestamp</p></td>
<td><p>The execution time of the last occurrence of <a class="reference internal" href="ReflectometryReductionOneAuto-v3.html#algm-reflectometryreductiononeauto"><span class="std std-ref">ReflectometryReductionOneAuto v3</span></a> in the
workspace history.</p></td>
</tr>
<tr class="row-odd"><td><p>reduction call</p></td>
<td><p>The sequence of algorithm calls from the workspace history that is generated by
<a class="reference internal" href="GeneratePythonScript-v1.html#algm-generatepythonscript"><span class="std std-ref">GeneratePythonScript v1</span></a>. This is excluded for workspaces that are members of a
workspace group.</p></td>
</tr>
<tr class="row-even"><td><p>measurement
data_files</p></td>
<td><p>The individual file names for all of the run numbers passed to the <code class="docutils literal notranslate"><span class="pre">InputRunList</span></code> parameter
from all calls to <a class="reference internal" href="ReflectometryISISLoadAndProcess-v1.html#algm-reflectometryisisloadandprocess"><span class="std std-ref">ReflectometryISISLoadAndProcess v1</span></a> in the workspace history.</p></td>
</tr>
<tr class="row-odd"><td><p>measurement
additional_files</p></td>
<td><p>The individual file names for all of the run numbers passed to parameters
<code class="docutils literal notranslate"><span class="pre">FirstTransmissionRunList</span></code> and <code class="docutils literal notranslate"><span class="pre">SecondTransmissionRunList</span></code> from all calls to
<a class="reference internal" href="ReflectometryISISLoadAndProcess-v1.html#algm-reflectometryisisloadandprocess"><span class="std std-ref">ReflectometryISISLoadAndProcess v1</span></a> in the workspace history. Also the flood
correction workspace or file name and the calibration file name from
<a class="reference internal" href="ReflectometryISISLoadAndProcess-v1.html#algm-reflectometryisisloadandprocess"><span class="std std-ref">ReflectometryISISLoadAndProcess v1</span></a> in the workspace history.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - Save a workspace in ISIS Reflectometry ORSO ASCII format</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the os path libraries for directory functions</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">XUnit</span><span class="o">=</span><span class="s2">&quot;MomentumTransfer&quot;</span><span class="p">,</span> <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Create an absolute path by joining the proposed filename to a directory</span>
<span class="c1"># os.path.expanduser(&quot;~&quot;) used in this case returns the home directory of the current user</span>
<span class="c1"># Specify the .ort extension to save to the ORSO ASCII format</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span> <span class="s2">&quot;ws.ort&quot;</span><span class="p">)</span>

<span class="c1"># Add Sample Log entries</span>
<span class="n">AddSampleLog</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span> <span class="n">LogName</span><span class="o">=</span><span class="s1">&#39;rb_proposal&#39;</span><span class="p">,</span> <span class="n">LogText</span><span class="o">=</span><span class="s1">&#39;1234&#39;</span><span class="p">,</span> <span class="n">LogType</span><span class="o">=</span><span class="s1">&#39;Number&#39;</span><span class="p">)</span>

<span class="c1"># Save the ORSO file</span>
<span class="n">SaveISISReflectometryORSO</span><span class="p">(</span><span class="n">WorkspaceList</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span> <span class="n">Filename</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">WriteResolution</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Open the file and read the first line</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">((</span><span class="n">file</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">myFile</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">myFile</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># # ORSO reflectivity data file | ... standard | YAML encoding | https://www.reflectometry.org/
</pre></div>
</div>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">References</a><a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="orso" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>ORSO file format specification: <a class="reference external" href="https://www.reflectometry.org/file_format/specification">https://www.reflectometry.org/file_format/specification</a></p>
</aside>
<aside class="footnote brackets" id="orsopy" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>orsopy Python library: <a class="reference external" href="https://orsopy.readthedocs.io/en/latest/">https://orsopy.readthedocs.io/en/latest/</a></p>
</aside>
</aside>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Reflectometry/ISIS.html">Reflectometry\ISIS</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/1b00e0b0644260219c488cf4142569b296f21ab0/Framework/PythonInterface/plugins/algorithms/SaveISISReflectometryORSO.py">SaveISISReflectometryORSO.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="SaveISISNexus-v1.html" title="Previous Chapter: SaveISISNexus v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; SaveISISNexus v1</span>
    </a>
  </li>
  <li>
    <a href="SaveIsawDetCal-v1.html" title="Next Chapter: SaveIsawDetCal v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SaveIsawDetCal v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>