<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>FindSatellitePeaks v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=fadd4351" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=77160d70" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=770b529d"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FindUBUsingFFT v1" href="FindUBUsingFFT-v1.html" />
    <link rel="prev" title="FindSXPeaksConvolve v1" href="FindSXPeaksConvolve-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.10</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://www.mantidproject.org">Home</a></li>
                <li><a href="https://download.mantidproject.org">Download</a></li>
                <li><a href="https://docs.mantidproject.org">Documentation</a></li>
                <li><a href="https://www.mantidproject.org/contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">FindSatellitePeaks v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><span class="math notranslate nohighlight">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<section id="findsatellitepeaks-v1">
<span id="algm-findsatellitepeaks"></span><span id="algm-findsatellitepeaks-v1"></span><h1>FindSatellitePeaks v1<a class="headerlink" href="#findsatellitepeaks-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id4">Summary</a></p></li>
<li><p><a class="reference internal" href="#properties" id="id5">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id6">Description</a></p></li>
<li><p><a class="reference internal" href="#related-algorithms" id="id7">Related Algorithms</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id8">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id9">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Algorithm for finding satellite peaks in an MDWorkspace in the HKL frame.</p>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NuclearPeaks</p></td>
<td><p>Input</p></td>
<td><p>PeaksWorkspace</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Main integer HKL peaks. Q vectors will be calculated relative to these peaks.</p></td>
</tr>
<tr class="row-odd"><td><p>SatellitePeaks</p></td>
<td><p>Input</p></td>
<td><p>PeaksWorkspace</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Positions of seed satellite peaks. These will be used to define the modulation (q)                              vectors for each satellite.</p></td>
</tr>
<tr class="row-even"><td><p>MDWorkspace</p></td>
<td><p>Input</p></td>
<td><p><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>MD workspace to search for satellites peak in. This data must be in the HKL frame.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p>PeaksWorkspace</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>All found satellite peaks. These will be given with satellite coordinates.</p></td>
</tr>
<tr class="row-even"><td><p>NumOfQs</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>-1</p></td>
<td><p>The number of satellite peaks to look for. If this option is not set to the default then all the                              provided satellites will be grouped into exactly this number of modulation (q) vectors</p></td>
</tr>
<tr class="row-odd"><td><p>ClusterThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1.5</p></td>
<td><p>Threshold for automaticallty deciding on the number of modulation (q) vectors to use. If NumOfQs found is set then this is property is ignored.</p></td>
</tr>
<tr class="row-even"><td><p>PeakRadius</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.1</p></td>
<td><p>The peak radius used to integrate the satellite peaks. This is Euclidean distance in HKL space.                              This is passed directly to IntegratePeaksMD</p></td>
</tr>
<tr class="row-odd"><td><p>BackgroundInnerRadius</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.1</p></td>
<td><p>The inner background radius used to integrate the satellite peaks. This is Euclidean distance in HKL space. This is passed directly to IntegratePeaksMD</p></td>
</tr>
<tr class="row-even"><td><p>BackgroundOuterRadius</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.2</p></td>
<td><p>The outer background radius used to integrate satellite peaks. This is Euclidean distance in HKL space. his is passed directly to IntegratePeaksMD</p></td>
</tr>
<tr class="row-odd"><td><p>IOverSigma</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>2</p></td>
<td><p>The I/sigma threshold use to identify if peaks exist. This is passed direclty to FilterPeaks</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>FindSatellitePeaks can be used to refine the locations of “satellite” peaks
occurring at fractional HKL locations in reciprocal space. FindSatellitePeaks
takes a <a class="reference internal" href="../concepts/MDWorkspace.html#mdworkspace"><span class="std std-ref">MDWorkspace</span></a> of experimental data, a
<a class="reference internal" href="../concepts/PeaksWorkspace.html#peaksworkspace"><span class="std std-ref">PeaksWorkspace</span></a> containing the locations of peaks with
integer HKL, and another PeaksWorkspace containing a subset of peaks found at
fractional HKL.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../_images/FindSatellitePeaks-satellites.png"><img alt="FindSatellitePeaks-satellites.png" src="../_images/FindSatellitePeaks-satellites.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text">Satellite peaks exist at fractional HKL coordinates. The vector <cite>q</cite> is the
Euclidean distance from the nearest integer HKL peak to the satellite. A
schematic of this is shown in the HKL plane in the diagram above.</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>For each satellite peak the euclidean distance between the nearest integer peak
and satellite are computed in the HKL frame. Peaks are then grouped according
to euclidean distance using using the properties <cite>NumOfQs</cite> and
<cite>ClusterThreshold</cite>. If <cite>NumOfQs</cite> is specified then each offset will be grouped
into exactly <cite>k</cite> clusters. If <cite>ClusterThreshold</cite> is specified then offsets will
be grouped into clusters separated by no more than a cophenetic distance below
this threshold.  The centroid of each cluster calculated for each group and is
used as the offset to predict the location of fractional peaks everywhere in
the <a class="reference internal" href="../concepts/MDWorkspace.html#mdworkspace"><span class="std std-ref">MDWorkspace</span></a>.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/FindSatellitePeaks-clustering.png"><img alt="FindSatellitePeaks-clustering.png" src="../_images/FindSatellitePeaks-clustering.png" style="width: 700px;" /></a>
<figcaption>
<p><span class="caption-text">Due to noise in the experimental data the <cite>q</cite> vector for every satellite may
vary slightly. This algorithm calculates the <cite>q</cite> vectors for all peaks passed
as starting points into distinct sets of <cite>q</cite> vectors. The centroid of each
cluster is then taken as the “true” value of <cite>q</cite> and is used to predict the
position of all other fractional peaks with this <cite>q</cite>.</span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>For each predicted fractional peak, the local centroid (the radius of which is
defined by <cite>PeakRadius</cite>) in the MD data is found and this is taken as the actual
position of the satellite peaks.</p>
<p>Finally the found satellite peaks are integerated using the
<a class="reference internal" href="IntegratePeaksMD-v2.html#algm-integratepeaksmd-v2"><span class="std std-ref">IntegratePeaksMD</span></a> algorithm with the parameters <cite>PeakRadius</cite>,
<cite>BackgroundInnerRadius</cite>, and <cite>BackgroundOuterRadius</cite>. Satellite peaks are
discarded if there I/sigma value is less than the parameter <cite>IOverSigma</cite>.</p>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../_images/FindSatellitePeaks-centroids.png"><img alt="FindSatellitePeaks-centroid.png" src="../_images/FindSatellitePeaks-centroids.png" style="width: 700px;" /></a>
<figcaption>
<p><span class="caption-text">Finally, using the predicted satellite peak positions (green) the local
centroid is found and this is used as the true position of the experimental
satellite peak (orange). The area to search for the centroid is controlled by
the <cite>PeakRadius</cite> parameter. All centroids are integrated a filtered by
intensity and <span class="math notranslate nohighlight">\(\frac{I}{\sigma}\)</span>. If the experimental satellite has
zero intensity or is below the <span class="math notranslate nohighlight">\(\frac{I}{\sigma}\)</span> threshold then it is
discarded.</span><a class="headerlink" href="#id3" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The output of the algorithm is a peaks workspace containing all of the
satellite peaks found by the algorithm in fractional coordinates. Each of the
peaks will have an intensity value from the <a class="reference internal" href="IntegratePeaksMD-v2.html#algm-integratepeaksmd-v2"><span class="std std-ref">IntegratePeaksMD</span></a> algorithm.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This integration is very approximate and may not produce the best
possible values. It is recommended that satellite peaks are reintegrated
using one of the many peak integration algorithms and to tune their
parameters to obtain the best possible peak integration.</p>
</div>
<p>For more information on superspace crystallography see:</p>
<ul class="simple">
<li><p>Van Smaalen, Sander. “An elementary introduction to superspace
crystallography.” Zeitschrift für Kristallographie-Crystalline Materials
219, no. 11 (2004): 681-691.</p></li>
<li><p>Van Smaalen, Sander. “Incommensurate crystal structures.” Crystallography
Reviews 4, no. 2 (1995): 79-202.</p></li>
</ul>
</section>
<section id="related-algorithms">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Related Algorithms</a><a class="headerlink" href="#related-algorithms" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="PredictFractionalPeaks-v1.html#algm-predictfractionalpeaks-v1"><span class="std std-ref">PredictFractionalPeaks</span></a> predicts the
position of fractional peaks given a <a class="reference internal" href="../concepts/PeaksWorkspace.html#peaksworkspace"><span class="std std-ref">PeaksWorkspace</span></a> of
nuclear peaks and a set of HKL offsets.</p></li>
<li><p><a class="reference internal" href="CentroidPeaksMD-v2.html#algm-centroidpeaksmd-v2"><span class="std std-ref">CentroidPeaksMD</span></a> is used to find the local
centroid from a predicted peak position.</p></li>
<li><p><a class="reference internal" href="IntegratePeaksMD-v2.html#algm-integratepeaksmd-v2"><span class="std std-ref">IntegratePeaksMD</span></a> is used to integrate
satellite peaks to check if they actually exist at the predicted position.</p></li>
<li><p><a class="reference internal" href="FilterPeaks-v1.html#algm-filterpeaks-v1"><span class="std std-ref">FilterPeaks</span></a> is used to remove peaks with zero
intensity or a I/sigma below the desired threshold.</p></li>
<li><p><a class="reference internal" href="IndexSatellitePeaks-v1.html#algm-indexsatellitepeaks-v1"><span class="std std-ref">IndexSatellitePeaks</span></a> can be used to
obtain a superspace indexing of the peaks workspace output from this
algorithm.</p></li>
</ul>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path.
In Mantid this is done using <a class="reference internal" href="../interfaces/framework/ManageUserDirectories.html#manageuserdirectories"><span class="std std-ref">Manage User Directories</span></a>.</p>
</div>
<p><strong>Example - calling FindSatellitePeaks:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">md_workspace</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s1">&#39;WISH_md_small.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;WISH_md_small&#39;</span><span class="p">)</span>
<span class="n">satellite_peaks</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s1">&#39;WISH_peak_hkl_frac_small.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;WISH_peak_hkl_frac_small&#39;</span><span class="p">)</span>
<span class="n">main_peaks</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s1">&#39;WISH_peak_hkl_small.nxs&#39;</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;WISH_peak_hkl_small&#39;</span><span class="p">)</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;PeakRadius&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="s2">&quot;BackgroundInnerRadius&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="s2">&quot;BackgroundOuterRadius&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
    <span class="s2">&quot;OutputWorkspace&quot;</span><span class="p">:</span> <span class="s2">&quot;refined_peaks&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NumOfQs&quot;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>


<span class="n">satellites_refined</span> <span class="o">=</span> <span class="n">FindSatellitePeaks</span><span class="p">(</span><span class="n">NuclearPeaks</span><span class="o">=</span><span class="n">main_peaks</span><span class="p">,</span> <span class="n">SatellitePeaks</span><span class="o">=</span><span class="n">satellite_peaks</span><span class="p">,</span> <span class="n">MDWorkspace</span><span class="o">=</span><span class="n">md_workspace</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">satellites_refined</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>4
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Crystal/Peaks.html">Crystal\Peaks</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/1b00e0b0644260219c488cf4142569b296f21ab0/Framework/PythonInterface/plugins/algorithms/FindSatellitePeaks.py">FindSatellitePeaks.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="FindSXPeaksConvolve-v1.html" title="Previous Chapter: FindSXPeaksConvolve v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; FindSXPeaksCo...</span>
    </a>
  </li>
  <li>
    <a href="FindUBUsingFFT-v1.html" title="Next Chapter: FindUBUsingFFT v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">FindUBUsingFFT v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>