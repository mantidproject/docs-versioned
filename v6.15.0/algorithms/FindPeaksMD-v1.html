<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>FindPeaksMD v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=4468db6d" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=9aca6aaf" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=1afa37e1"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script>window.MathJax = {"tex": {"macros": {"AA": "\\unicode{x212B}"}}, "startup": {"polyfillHasOwn": true}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FindReflectometryLines v2" href="FindReflectometryLines-v2.html" />
    <link rel="prev" title="FindPeaksConvolve v1" href="FindPeaksConvolve-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





<nav id="navbar" class="navbar navbar-default navbar-fixed-top">
  <div id="navbar-main" class="container">
    <ul class="nav navbar-nav">
      
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <li>
        <a class="navbar-brand" href="http://www.mantidproject.org">
         </a>
      </li>
      <span class="navbar-text navbar-version pull-left"><b>6.15</b></span>
    </ul>

    
    <div class="collapse navbar-collapse nav-collapse">
    
      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        
          <li>
            <a href="https://www.mantidproject.org">Home</a>
          </li>
          <li>
            <a href="https://download.mantidproject.org">Download</a>
          </li>
          <li>
            <a href="https://docs.mantidproject.org">Documentation</a>
          </li>
          <li>
            <a href="https://www.mantidproject.org/contact">Contact Us</a>
          </li>
        
        
          
          
        
        
        
        
      </ul>
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          </div>
  </div> <!-- /navbar-main -->
<div id="navbar-breadcrumbs" class="related" role="navigation" aria-label="related navigation">
  <h3>Navigation</h3>
  <ul>
    <li class="nav-item nav-item-0">
      <a href="../index.html">Documentation</a>
         &#187;
    </li>
    
    <li class="nav-item nav-item-1">
      <a href="index.html" accesskey="U">
        Algorithms
      </a>
       &#187;
    </li>
    
    
    
    
    <li class="nav-item nav-item-this">
      <a href="">FindPeaksMD v1</a>
    </li>
    
    
  </ul>
</div>
</nav>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="findpeaksmd-v1">
<span id="algm-findpeaksmd"></span><span id="algm-findpeaksmd-v1"></span><h1>FindPeaksMD v1<a class="headerlink" href="#findpeaksmd-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id2">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p>
<ul>
<li><p><a class="reference internal" href="#calculate-goniometer-for-constant-wavelength" id="id5">Calculate Goniometer For Constant Wavelength</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#usage" id="id6">Usage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id7">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Find peaks in reciprocal space in a MDEventWorkspace or a MDHistoWorkspace.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="FindPeaks-v1.html#algm-findpeaks"><span class="std std-ref">FindPeaks</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InputWorkspace</p></td>
<td><p>Input</p></td>
<td><p>IMDWorkspace</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>An input MDEventWorkspace or MDHistoWorkspace with at least 3 dimensions.</p></td>
</tr>
<tr class="row-odd"><td><p>PeakDistanceThreshold</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.1</p></td>
<td><p>Threshold distance for rejecting peaks that are found to be too close from each other. This should be some multiple of the radius of a peak. Default: 0.1.</p></td>
</tr>
<tr class="row-even"><td><p>MaxPeaks</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>500</p></td>
<td><p>Maximum number of peaks to find. Default: 500.</p></td>
</tr>
<tr class="row-odd"><td><p>PeakFindingStrategy</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>VolumeNormalization</p></td>
<td><p>Strategy for finding peaks in an MD workspace.1. VolumeNormalization: This is the default strategy. It will sort all boxes in the workspace by deacresing order of signal density (total weighted event sum divided by box volume). 2.NumberOfEventsNormalization: This option is only valid for MDEventWorkspaces. It will use the total weighted event sum dividedby the number of events. This can improve peak finding for histogram-basedraw data which has been converted to an EventWorkspace. The threshold forpeak finding can be controlled by the SingalThresholdFactor property which shouldbe larger than 1. Note that this approach does not work for event-based raw data.  Allowed values: [‘VolumeNormalization’, ‘NumberOfEventsNormalization’]</p></td>
</tr>
<tr class="row-even"><td><p>DensityThresholdFactor</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>10</p></td>
<td><p>The overall signal density of the workspace will be multiplied by this factor  to get a threshold signal density below which boxes are NOT considered to be peaks. See the help. Default: 10.0</p></td>
</tr>
<tr class="row-odd"><td><p>SignalThresholdFactor</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1.5</p></td>
<td><p>The overal signal value (not density!) normalized by the number of events is compared to the specified signal threshold. Boxes which are below this threshold are NOT considered to be peaks.This property is enabled when the PeakFindingStrategy has been set to NumberOfEventsNormalization. The value of boxes which contain peaks will be above 1. See the below for more information. Default: 1.50</p></td>
</tr>
<tr class="row-even"><td><p>CalculateGoniometerForCW</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>This will calculate the goniometer rotation (around y-axis only) for a constant wavelength. This only works for Q sample workspaces.</p></td>
</tr>
<tr class="row-odd"><td><p>Wavelength</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p><em>Optional</em></p></td>
<td><p>Wavelength to use when calculating goniometer angle. If notset will use the wavelength parameter on the instrument.</p></td>
</tr>
<tr class="row-even"><td><p>InnerGoniometer</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Whether the goniometer to be calculated is the most inner (phi) or most outer (omega)</p></td>
</tr>
<tr class="row-odd"><td><p>FlipX</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Used when calculating goniometer angle if the q_lab x value should be negative, hence the detector of the other side (right) of the beam</p></td>
</tr>
<tr class="row-even"><td><p>OutputType</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>Automatic</p></td>
<td><p>Type of Peak in OutputWorkspace. Allowed values: [‘Automatic’, ‘Peak’, ‘LeanElasticPeak’]</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p>IPeaksWorkspace</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>An output PeaksWorkspace with the peaks’ found positions.</p></td>
</tr>
<tr class="row-even"><td><p>AppendPeaks</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>If checked, then append the peaks in the output workspace if it exists.  If unchecked, the output workspace is replaced (Default).</p></td>
</tr>
<tr class="row-odd"><td><p>EdgePixels</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Remove peaks that are at pixels this close to edge.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This algorithm is used to find single-crystal peaks in a
multi-dimensional workspace (<a class="reference internal" href="../concepts/MDWorkspace.html#mdworkspace"><span class="std std-ref">MDEventWorkspace</span></a> or
<a class="reference internal" href="../concepts/MDHistoWorkspace.html#mdhistoworkspace"><span class="std std-ref">MDHistoWorkspace</span></a>). It looks for high signal
density areas, and is based on an algorithm designed by Dennis Mikkelson
for ISAW.</p>
<p>The algorithm proceeds in this way:</p>
<ul class="simple">
<li><p>Sorts all the boxes in the workspace by decreasing order of signal
density (total weighted event sum divided by box volume).</p>
<ul>
<li><p>It will skip any boxes with a density below a threshold. The
threshold is
<span class="math notranslate nohighlight">\(TotalSignal / TotalVolume * DensityThresholdFactor\)</span>.</p></li>
</ul>
</li>
<li><p>The centroid of the strongest box is considered a peak.</p></li>
<li><p>The centroid of the next strongest box is calculated.</p>
<ul>
<li><p>We look through all the peaks that have already been found. If the
box is too close to an existing peak, it is rejected. This
distance is PeakDistanceThreshold.</p></li>
</ul>
</li>
<li><p>This is repeated until we find up to MaxPeaks peaks.</p></li>
</ul>
<p>Each peak created is placed in the output <a class="reference internal" href="../concepts/PeaksWorkspace.html#peaksworkspace"><span class="std std-ref">PeaksWorkspace</span></a> or <a class="reference internal" href="../concepts/LeanElasticPeaksWorkspace.html#leanelasticpeaksworkspace"><span class="std std-ref">LeanElasticPeaksWorkspace</span></a> (depending on the <cite>OutputType</cite> option),
which can be a new workspace or replace the old one. If <cite>OutputType</cite>
is the default <cite>Automatic</cite> then the output type will be PeakWorkspace
unless the input workspace doesn’t contain an experiment info in which
case it will default to LeanElasticPeaksWorkspace.</p>
<p>This algorithm works on a <a class="reference internal" href="../concepts/MDHistoWorkspace.html#mdhistoworkspace"><span class="std std-ref">MDHistoWorkspace</span></a>
resulting from the <a class="reference internal" href="BinMD-v1.html#algm-binmd"><span class="std std-ref">BinMD v1</span></a> algorithm also. It works in the
same way, except that the center of each bin is used since the centroid
is not accessible. It may give better results on
<a class="reference internal" href="../concepts/Workspace2D.html#workspace2d"><span class="std std-ref">Workspace2D</span></a>’s that were converted to
<a class="reference internal" href="../concepts/MDWorkspace.html#mdworkspace"><span class="std std-ref">MDWorkspaces</span></a>.</p>
<p>For data which has originally been based on histogram-type data and that has been converted to
event-based data it might be beneficial to select the NumberOfEventNormalization for the <cite>PeakFindingStrategy</cite> property instead of the VolumeNormalization which is the default. This
will disable the <cite>DensityThresholdFactor</cite> property and enable the <cite>SignalThresholdFactor</cite> property.
The algorithmic steps remain the same as above but instead of using the signal density as the sorting
quantity the signal count (total weighted event sum divided by the number of events) is used. If
the events are weighted this will result in boxes with signal counts larger than one for peaks and for the majority of background counts the signal count will be 1. Hence it is possible to discriminate between peaks and background. Note that the NumberOfEventNormalization selection of the <cite>PeakFindingStrategy</cite> property  does not make sense for all scenarios and infact might not produce useful results for your particular case.</p>
<section id="calculate-goniometer-for-constant-wavelength">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Calculate Goniometer For Constant Wavelength</a><a class="headerlink" href="#calculate-goniometer-for-constant-wavelength" title="Link to this heading">¶</a></h3>
<p>The CalculateGoniometerForCW option allows you to keep only one
instrument definition from a set of merged MD workspaces. It only
works for a constant wavelength source and only for Q sample
workspaces. It also assumes the goniometer rotation is around the
y-axis only.</p>
<p>You can specify if the goniometer to calculated is omega or phi, outer
or inner respectively, by setting the option InnerGoniometer. The
existing goniometer on the workspace will then be taken into account
correctly.</p>
<p>The goniometer (<span class="math notranslate nohighlight">\(G\)</span>) is calculated from
<span class="math notranslate nohighlight">\(\textbf{Q}_{sample}\)</span> for a given wavelength (<span class="math notranslate nohighlight">\(\lambda\)</span>)
by:</p>
<p>First calculate the <span class="math notranslate nohighlight">\(\textbf{Q}_{lab}\)</span> using
<span class="math notranslate nohighlight">\(\textbf{Q}_{sample}\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span>.</p>
<div class="math notranslate nohighlight">
\[k = \frac{2 \pi}{\lambda}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}G \textbf{Q}_{sample} = \textbf{Q}_{lab} = \left(\begin{array}{c}
-k\sin(\theta)\cos(\phi) \\
-k\sin(\theta)\sin(\phi) \\
k (1-\cos(\theta))
\end{array}\right) (1)\end{split}\]</div>
<div class="math notranslate nohighlight">
\[|\textbf{Q}_{sample}|^2 = |\textbf{Q}_{lab}|^2 = 2 k^2 (1-\cos(\theta))\]</div>
<p><span class="math notranslate nohighlight">\(\therefore\)</span></p>
<div class="math notranslate nohighlight">
\[\theta = \cos^{-1}(1-\frac{|\textbf{Q}_{sample}|^2}{2k^2})\]</div>
<div class="math notranslate nohighlight">
\[\phi = \sin^{-1}(-\frac{\textbf{Q}_{sample}^y}{k \sin(\theta)})\]</div>
<p>where <span class="math notranslate nohighlight">\(\theta\)</span> is from 0 to <span class="math notranslate nohighlight">\(\pi\)</span> and <span class="math notranslate nohighlight">\(\phi\)</span> is from
<span class="math notranslate nohighlight">\(-\pi/2\)</span> to <span class="math notranslate nohighlight">\(\pi/2\)</span>. This means that it will assume your
detector position is on the left of the beam even it it’s not, unless
the option FlipX is set to True then the <span class="math notranslate nohighlight">\(\textbf{Q}_{lab}^x = -\textbf{Q}_{lab}^x\)</span>.</p>
<p>Now you have <span class="math notranslate nohighlight">\(\theta\)</span>, <span class="math notranslate nohighlight">\(\phi\)</span> and k you can get <span class="math notranslate nohighlight">\(\textbf{Q}_{lab}\)</span> using (1).</p>
<p>We need to now solve <span class="math notranslate nohighlight">\(G \textbf{Q}_{sample} =
\textbf{Q}_{lab}\)</span>. For a rotation around y-axis only we want to find
<span class="math notranslate nohighlight">\(\psi\)</span> for:</p>
<div class="math notranslate nohighlight">
\[\begin{split}G = \begin{bmatrix}
\cos(\psi)  &amp; 0 &amp; \sin(\psi) \\
0           &amp; 1 &amp; 0 \\
-\sin(\psi) &amp; 0 &amp; \cos(\psi)
\end{bmatrix} (2)\end{split}\]</div>
<p>which gives two equations</p>
<div class="math notranslate nohighlight">
\[\cos(\psi)\textbf{Q}_{sample}^x+\sin(\psi)\textbf{Q}_{sample}^z = \textbf{Q}_{lab}^x\]</div>
<div class="math notranslate nohighlight">
\[-\sin(\psi)\textbf{Q}_{sample}^x+\cos(\psi)\textbf{Q}_{sample}^z = \textbf{Q}_{lab}^z\]</div>
<p>make</p>
<div class="math notranslate nohighlight">
\[\begin{split}A = \begin{bmatrix}
\textbf{Q}_{sample}^x &amp; \textbf{Q}_{sample}^z \\
\textbf{Q}_{sample}^z &amp; -\textbf{Q}_{sample}^x
\end{bmatrix}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}B = \begin{bmatrix}
\textbf{Q}_{lab}^x \\
\textbf{Q}_{lab}^z
\end{bmatrix}\end{split}\]</div>
<p>Then we need to solve <span class="math notranslate nohighlight">\(A X = B\)</span> for <span class="math notranslate nohighlight">\(X\)</span> where</p>
<div class="math notranslate nohighlight">
\[\begin{split}X = \begin{bmatrix}
\cos{\psi} \\
\sin{\psi}
\end{bmatrix} = A^{-1} B\end{split}\]</div>
<p>then</p>
<div class="math notranslate nohighlight">
\[\psi = \tan^{-1}\left(\frac{\sin{\psi}}{\cos{\psi}}\right)\]</div>
<p>Put <span class="math notranslate nohighlight">\(\psi\)</span> into (2) and you have the goniometer for that peak.</p>
</section>
</section>
<section id="usage">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Usage</a><a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><strong>Example - IntegratePeaks:</strong></p>
<p>The code iteslef works but disabled from doc tests as takes too long to complete. User should provide its own
event nexus file instead of <strong>TOPAZ_3132_event.nxs</strong> used within this example. The original <strong>TOPAZ_3132_event.nxs</strong>
file is available in <a class="reference external" href="https://github.com/mantidproject/systemtests/tree/master/Data/TOPAZ_3132_event.nxs">Mantid system tests repository</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">#.. testcode:: exFindPeaksMD</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span><span class="w"> </span><span class="nf">print_tableWS</span><span class="p">(</span><span class="n">pTWS</span><span class="p">,</span><span class="n">nRows</span><span class="p">):</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="sd">&#39;&#39;&#39; Method to print part of the table workspace &#39;&#39;&#39;</span>
<span class="linenos"> 6</span>    <span class="n">tab_names</span><span class="o">=</span><span class="n">pTWS</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="linenos"> 7</span>    <span class="n">row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="linenos"> 8</span>    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">tab_names</span><span class="p">:</span>
<span class="linenos"> 9</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">8</span><span class="p">:</span>
<span class="linenos">10</span>           <span class="n">name</span><span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span>
<span class="linenos">11</span>        <span class="n">row</span> <span class="o">+=</span> <span class="s2">&quot;| </span><span class="si">{:8}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="linenos">12</span>    <span class="nb">print</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="p">)</span>
<span class="linenos">13</span>
<span class="linenos">14</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nRows</span><span class="p">):</span>
<span class="linenos">15</span>        <span class="n">row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="linenos">16</span>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">tab_names</span><span class="p">:</span>
<span class="linenos">17</span>              <span class="n">col</span> <span class="o">=</span> <span class="n">pTWS</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="linenos">18</span>              <span class="n">data2pr</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="linenos">19</span>              <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data2pr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos">20</span>                  <span class="n">row</span> <span class="o">+=</span> <span class="s2">&quot;| </span><span class="si">{:8.1f}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data2pr</span><span class="p">)</span>
<span class="linenos">21</span>              <span class="k">else</span><span class="p">:</span>
<span class="linenos">22</span>                  <span class="n">row</span> <span class="o">+=</span> <span class="s2">&quot;| </span><span class="si">{:8}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data2pr</span><span class="p">))</span>
<span class="linenos">23</span>        <span class="nb">print</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="c1"># load test workspace</span>
<span class="linenos">26</span><span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;TOPAZ_3132_event.nxs&#39;</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;TOPAZ_3132_event&#39;</span><span class="p">,</span><span class="n">LoadMonitors</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="c1"># build peak workspace necessary for IntegrateEllipsoids algorithm to work</span>
<span class="linenos">29</span><span class="n">ConvertToMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;TOPAZ_3132_event&#39;</span><span class="p">,</span><span class="n">QDimensions</span><span class="o">=</span><span class="s1">&#39;Q3D&#39;</span><span class="p">,</span><span class="n">dEAnalysisMode</span><span class="o">=</span><span class="s1">&#39;Elastic&#39;</span><span class="p">,</span><span class="n">Q3DFrames</span><span class="o">=</span><span class="s1">&#39;Q_sample&#39;</span><span class="p">,</span><span class="n">LorentzCorrection</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;TOPAZ_3132_md&#39;</span><span class="p">,</span>\
<span class="linenos">30</span><span class="n">MinValues</span><span class="o">=</span><span class="s1">&#39;-25,-25,-25&#39;</span><span class="p">,</span><span class="n">MaxValues</span><span class="o">=</span><span class="s1">&#39;25,25,25&#39;</span><span class="p">,</span><span class="n">SplitInto</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">SplitThreshold</span><span class="o">=</span><span class="s1">&#39;50&#39;</span><span class="p">,</span><span class="n">MaxRecursionDepth</span><span class="o">=</span><span class="s1">&#39;13&#39;</span><span class="p">,</span><span class="n">MinRecursionDepth</span><span class="o">=</span><span class="s1">&#39;7&#39;</span><span class="p">)</span>
<span class="linenos">31</span><span class="n">peaks</span><span class="o">=</span><span class="n">FindPeaksMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;TOPAZ_3132_md&#39;</span><span class="p">,</span><span class="n">PeakDistanceThreshold</span><span class="o">=</span><span class="s1">&#39;0.37680&#39;</span><span class="p">,</span><span class="n">MaxPeaks</span><span class="o">=</span><span class="s1">&#39;50&#39;</span><span class="p">,</span><span class="n">DensityThresholdFactor</span><span class="o">=</span><span class="s1">&#39;100&#39;</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;TOPAZ_3132_peaks&#39;</span><span class="p">)</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="c1"># print 10 rows of table workspace</span>
<span class="linenos">34</span><span class="n">print_tableWS</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>| RunNumbe | DetID    | h        | k        | l        | Waveleng | Energy   | TOF      | DSpacing | Intens   | SigInt   | BinCount | BankName | Row      | Col      | QLab     | QSample  | PeakNumb |
<span class="linenos"> 2</span>| 3132     | 1124984  |      0.0 |      0.0 |      0.0 |      3.1 |      8.5 |  14482.3 |      2.0 |      0.0 |      0.0 |   1668.0 | bank17   |    120.0 |     42.0 | [1.57771,1.21779,2.37854] | [2.99396,0.815958,0.00317344] | 1        |
<span class="linenos"> 3</span>| 3132     | 1156753  |      0.0 |      0.0 |      0.0 |      2.1 |     18.8 |   9725.7 |      1.3 |      0.0 |      0.0 |   1060.0 | bank17   |    145.0 |    166.0 | [2.48964,1.45725,3.88666] | [4.52618,1.71025,0.129461] | 2        |
<span class="linenos"> 4</span>| 3132     | 1141777  |      0.0 |      0.0 |      0.0 |      1.7 |     28.1 |   7963.2 |      1.0 |      0.0 |      0.0 |     96.0 | bank17   |     17.0 |    108.0 | [2.60836,2.31423,4.86391] | [5.69122,1.79492,-0.452799] | 3        |
<span class="linenos"> 5</span>| 3132     | 1125241  |      0.0 |      0.0 |      0.0 |      1.6 |     33.9 |   7252.2 |      1.0 |      0.0 |      0.0 |     83.0 | bank17   |    121.0 |     43.0 | [3.15504,2.42573,4.75121] | [5.97829,1.63473,0.0118744] | 4        |
<span class="linenos"> 6</span>| 3132     | 1170598  |      0.0 |      0.0 |      0.0 |      1.5 |     34.1 |   7224.6 |      0.9 |      0.0 |      0.0 |     73.0 | bank17   |    166.0 |    220.0 | [3.43363,1.70178,5.39301] | [6.07726,2.59962,0.281759] | 5        |
<span class="linenos"> 7</span>| 3132     | 1214951  |      0.0 |      0.0 |      0.0 |      1.9 |     22.8 |   8839.5 |      1.7 |      0.0 |      0.0 |    719.0 | bank18   |    231.0 |    137.0 | [2.73683,1.43808,2.11574] | [3.5786,0.470838,1.00329] | 6        |
<span class="linenos"> 8</span>| 3132     | 1207827  |      0.0 |      0.0 |      0.0 |      1.7 |     27.9 |   7991.7 |      1.3 |      0.0 |      0.0 |    447.0 | bank18   |     19.0 |    110.0 | [2.80324,2.29519,3.09134] | [4.71517,0.554412,0.37714] | 7        |
<span class="linenos"> 9</span>| 3132     | 1232949  |      0.0 |      0.0 |      0.0 |      1.2 |     53.3 |   5782.1 |      0.9 |      0.0 |      0.0 |     45.0 | bank18   |     53.0 |    208.0 | [4.29033,2.63319,4.46168] | [6.52658,1.27985,1.00646] | 8        |
<span class="linenos">10</span>| 3132     | 1189484  |      0.0 |      0.0 |      0.0 |      1.1 |     63.4 |   5299.3 |      1.0 |      0.0 |      0.0 |     31.0 | bank18   |    108.0 |     38.0 | [4.02414,3.39659,3.83664] | [6.4679,0.298896,0.726133] | 9        |
<span class="linenos">11</span>| 3132     | 1218337  |      0.0 |      0.0 |      0.0 |      1.0 |     79.8 |   4724.1 |      0.8 |      0.0 |      0.0 |     15.0 | bank18   |     33.0 |    151.0 | [4.96622,3.61607,5.32554] | [7.99244,1.19363,0.892655] | 10       |
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Optimization/PeakFinding.html">Optimization\PeakFinding</a> | <a class="reference external" href="categories/MDAlgorithms/Peaks.html">MDAlgorithms\Peaks</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/6762777a1cda710ac427c4efdb2a7fa75b50dc69/Framework/MDAlgorithms/inc/MantidMDAlgorithms/FindPeaksMD.h">FindPeaksMD.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/6762777a1cda710ac427c4efdb2a7fa75b50dc69/Framework/MDAlgorithms/src/FindPeaksMD.cpp">FindPeaksMD.cpp</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul id="footer-nav" class="nav navbar-nav">
      
      
          
            
  <li>
    <a href="FindPeaksConvolve-v1.html" title="Previous Chapter: FindPeaksConvolve v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; FindPeaksConvolve v1</span>
    </a>
  </li>
  <li>
    <a href="FindReflectometryLines-v2.html" title="Next Chapter: FindReflectometryLines v2"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">FindReflectom... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>