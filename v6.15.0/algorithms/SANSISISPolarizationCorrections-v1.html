<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SANSISISPolarizationCorrections v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=4468db6d" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=9aca6aaf" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=1afa37e1"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SANSLoad v1" href="SANSLoad-v1.html" />
    <link rel="prev" title="SANSILLReduction v2" href="SANSILLReduction-v2.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





<nav id="navbar" class="navbar navbar-default navbar-fixed-top">
  <div id="navbar-main" class="container">
    <ul class="nav navbar-nav">
      
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <li>
        <a class="navbar-brand" href="http://www.mantidproject.org">
         </a>
      </li>
      <span class="navbar-text navbar-version pull-left"><b>6.15</b></span>
    </ul>

    
    <div class="collapse navbar-collapse nav-collapse">
    
      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        
          <li>
            <a href="https://www.mantidproject.org">Home</a>
          </li>
          <li>
            <a href="https://download.mantidproject.org">Download</a>
          </li>
          <li>
            <a href="https://docs.mantidproject.org">Documentation</a>
          </li>
          <li>
            <a href="https://www.mantidproject.org/contact">Contact Us</a>
          </li>
        
        
          
          
        
        
        
        
      </ul>
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          </div>
  </div> <!-- /navbar-main -->
<div id="navbar-breadcrumbs" class="related" role="navigation" aria-label="related navigation">
  <h3>Navigation</h3>
  <ul>
    <li class="nav-item nav-item-0">
      <a href="../index.html">Documentation</a>
         &#187;
    </li>
    
    <li class="nav-item nav-item-1">
      <a href="index.html" accesskey="U">
        Algorithms
      </a>
       &#187;
    </li>
    
    
    
    
    <li class="nav-item nav-item-this">
      <a href="">SANSISISPolarizationCorrections v1</a>
    </li>
    
    
  </ul>
</div>
</nav>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="sansisispolarizationcorrections-v1">
<span id="algm-sansisispolarizationcorrections"></span><span id="algm-sansisispolarizationcorrections-v1"></span><h1>SANSISISPolarizationCorrections v1<a class="headerlink" href="#sansisispolarizationcorrections-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id5">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id6">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id7">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id8">Description</a></p></li>
<li><p><a class="reference internal" href="#calibration" id="id9">Calibration</a></p></li>
<li><p><a class="reference internal" href="#correction" id="id10">Correction</a></p></li>
<li><p><a class="reference internal" href="#references" id="id11">References</a></p></li>
<li><p><a class="reference internal" href="#source" id="id12">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Wrapper algorithm that calculates a spin leakage calibration and correction for a PA-SANS setup. In ISIS, compatible with ZOOM and LARMOR instruments.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="HeliumAnalyserEfficiency-v1.html#algm-heliumanalyserefficiency"><span class="std std-ref">HeliumAnalyserEfficiency</span></a>, <a class="reference internal" href="PolarizerEfficiency-v1.html#algm-polarizerefficiency"><span class="std std-ref">PolarizerEfficiency</span></a>, <a class="reference internal" href="FlipperEfficiency-v1.html#algm-flipperefficiency"><span class="std std-ref">FlipperEfficiency</span></a>, <a class="reference internal" href="PolarizationEfficiencyCor-v1.html#algm-polarizationefficiencycor"><span class="std std-ref">PolarizationEfficiencyCor</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>UserFilePath</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>Allowed extensions: [‘.toml’]</p></td>
</tr>
<tr class="row-odd"><td><p>TransmissionRuns</p></td>
<td><p>Input</p></td>
<td><p>str list</p></td>
<td></td>
<td><p>Input transmission runs. Comma separated run numbers of the transmission runs. Used for calibration of efficiencies.</p></td>
</tr>
<tr class="row-even"><td><p>ScatteringRuns</p></td>
<td><p>Input</p></td>
<td><p>str list</p></td>
<td></td>
<td><p>Input scattering runs. Comma separated run numbers to which to apply corrections.</p></td>
</tr>
<tr class="row-odd"><td><p>DirectBeamRun</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Direct beam run. Used for calibration of efficiencies.</p></td>
</tr>
<tr class="row-even"><td><p>DepolarizedCellRun</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Depolarized cell run. Used for calibration of efficiencies.</p></td>
</tr>
<tr class="row-odd"><td><p>ReductionType</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>CalibrationAndCorrection</p></td>
<td><p>The type of reduction: Choose Calibration to generate and save efficiency files, Correction to apply efficiency corrections to scattering data, or CalibrationAndCorrections to do both. Allowed values: [‘Calibration’, ‘CalibrationAndCorrection’, ‘Correction’]</p></td>
</tr>
<tr class="row-even"><td><p>OutputSuffix</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Suffix to identify processed efficiencies. This is useful, for example, if a set of different cells or samples are used as inputs.</p></td>
</tr>
<tr class="row-odd"><td><p>SavePath</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Path to save directory of processed workspaces.</p></td>
</tr>
<tr class="row-even"><td><p>KeepWsOnADS</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Whether to keep reduced files on the ADS. Can’t be unchecked unless a save path is provided in SavePath.</p></td>
</tr>
<tr class="row-odd"><td><p>AssertSpinState</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Whether to use AssertSpinStateOrder to determine that the expected spin state order is the same for all transmission runs. Set to False if there is no confidence that the spin can be determined accurately from the DetermineSpinStateOrder algorithm</p></td>
</tr>
<tr class="row-even"><td><p>DeletePartialWsOnFail</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>If the algorithm fails due to poor fitting or some other reason, partial workspaces are automatically deletedunless this property is set to False. Useful for diagnostics.</p></td>
</tr>
<tr class="row-odd"><td><p>SecondFlipperEfficiency</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>False</p></td>
<td><p>Whether to perform calculation for second flipper efficiency in calibration, as well as use second flipper efficiency on correction if a path for the second flipper is found on the UserFile</p></td>
</tr>
<tr class="row-even"><td><p>PxDInitialValue</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>12.6</p></td>
<td><p>Initial value of mean path length (pxd) for fitting in DepolarizedAnalyserTransmission algorithm</p></td>
</tr>
<tr class="row-odd"><td><p>LifetimeInitialValue</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>54</p></td>
<td><p>Initial value of lifetime (in hours) for fitting in HeliumAnalyserEfficiency algorithm</p></td>
</tr>
<tr class="row-even"><td><p>HePolInitialValue</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.6</p></td>
<td><p>Initial value of helium gas polarization for fitting in HeliumAnalyserEfficiency algorithm</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>This is a wrapper algorithm that calculates the spin leakage calibration and correction for a PA-SANS setup <a class="footnote-reference brackets" href="#krycka" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, compatible with the ISIS instruments <code class="docutils literal notranslate"><span class="pre">ZOOM</span></code> and <code class="docutils literal notranslate"><span class="pre">LARMOR</span></code>.
To process the data, it combines several Mantid <code class="docutils literal notranslate"><span class="pre">PolarizationCorrections</span></code> algorithms.</p>
<p>The reduction is split in two separate steps, first; a calibration of transmission runs that generates the efficiency workspaces for the polarizing components of the setup, namely: Polarizer, Flippers and Helium Analyzer.
The second step corrects the spin leakage contribution on the scattering runs using the previously calculated efficiencies with the Wildes method <a class="footnote-reference brackets" href="#wildes" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p>
<p>The type of reduction; calibration or correction, can be set through  the <code class="docutils literal notranslate"><span class="pre">ReductionType</span></code> property, which selects from a list of values: <code class="docutils literal notranslate"><span class="pre">Calibration</span></code>, <code class="docutils literal notranslate"><span class="pre">Correction</span></code> and <code class="docutils literal notranslate"><span class="pre">CalibrationAndCorrection</span></code>.
If either <code class="docutils literal notranslate"><span class="pre">Calibration</span></code> or <code class="docutils literal notranslate"><span class="pre">Correction</span></code> are selected, only the respective reduction process will be processed. If <code class="docutils literal notranslate"><span class="pre">CalibrationAndCorrection</span></code> is selected, both the calibration and the correction
will be processed in sequence.</p>
<p>A path to a valid user file is mandatory and must be set through the <code class="docutils literal notranslate"><span class="pre">UserFilePath</span></code> property. The user file is expected to be a toml file in the <a class="reference internal" href="../techniques/SANS-Toml-v1.html#sans-toml-v1-ref"><span class="std std-ref">SANS Toml V2 Format</span></a>, which  includes
fields for polarization settings. The user file will be used to extract information about the instrument: name, monitors, detector offsets and binning as well as the experiment flipper configuration and paths to the efficiency files.</p>
<p>A save path can be set with the <code class="docutils literal notranslate"><span class="pre">SavePath</span></code> property, which will save the efficiencies, fitting tables and processed transmission workspaces to nexus files.
If no output path is chosen, the produced workspaces will be kept on memory at Mantid’s Analysis Data Service (ADS).</p>
<p>A suffix can be appended to the names of the efficiency workspaces and fitting tables by setting the <code class="docutils literal notranslate"><span class="pre">OutputSuffix</span></code> property.</p>
<p>The property <code class="docutils literal notranslate"><span class="pre">KeepWSOnADS</span></code>, when set to <code class="code docutils literal notranslate"><span class="pre">False</span></code>, will delete the workspaces published to the ADS when the reduction is completed. It is only enabled when a valid path is chosen in <code class="docutils literal notranslate"><span class="pre">SavePath</span></code>.
The wrapper can be called sequentially and the processed transmission and scattering workspaces, as well as the depolarized and direct runs won’t be reloaded and reprocessed
if they are found on the ADS.</p>
</section>
<section id="calibration">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Calibration</a><a class="headerlink" href="#calibration" title="Link to this heading">¶</a></h2>
<p>For calibration, a list of transmission runs must be specified in the <code class="docutils literal notranslate"><span class="pre">TransmissionRuns</span></code> property, as well as a direct run in <code class="docutils literal notranslate"><span class="pre">DirectBeamRun</span></code> and a depolarized run in <code class="docutils literal notranslate"><span class="pre">DepolarizedCellRun</span></code>.
The following steps are part of a calibration sequence <a class="footnote-reference brackets" href="#krycka" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>:</p>
<ul class="simple">
<li><p>Load and normalize the direct (<code class="docutils literal notranslate"><span class="pre">DirectBeamRun</span></code>), depolarized (<code class="docutils literal notranslate"><span class="pre">DepolarizedCellRun</span></code>), empty cell (loaded from path in user file) and transmission runs (<code class="docutils literal notranslate"><span class="pre">TransmissionRuns</span></code>).</p></li>
<li><p>Fit the <a class="reference internal" href="DepolarizedAnalyserTransmission-v1.html#algm-depolarizedanalysertransmission"><span class="std std-ref">cell opacity</span></a> from the transmission between the depolarized and empty cell runs.</p></li>
<li><p>Calculate the <a class="reference internal" href="HeliumAnalyserEfficiency-v1.html#algm-heliumanalyserefficiency"><span class="std std-ref">Helium Analyser Efficiency</span></a> for each transmission run and fit to an exponential decay to extract the initial polarization and decay rate of the analyzer cell.</p></li>
<li><p>Calculate the <a class="reference internal" href="FlipperEfficiency-v1.html#algm-flipperefficiency"><span class="std std-ref">Flipper</span></a> and <a class="reference internal" href="PolarizerEfficiency-v1.html#algm-polarizerefficiency"><span class="std std-ref">Polarizer</span></a> efficiencies for each transmission run. The flipper configuration is expected to be the same for all input transmission runs, and
it is retrieved from the user file or calculated using <a class="reference internal" href="DetermineSpinStateOrder-v1.html#algm-determinespinstateorder"><span class="std std-ref">DetermineSpinStateOrder v1</span></a> if the configuration is missing in the file. If the property <code class="docutils literal notranslate"><span class="pre">AssertSpinState</span></code> is set to <code class="code docutils literal notranslate"><span class="pre">False</span></code>, the spin state set on <code class="docutils literal notranslate"><span class="pre">FlipperConfiguration</span></code> field
of the user file will be used in all runs without any further check.</p></li>
<li><p>Average the calculated efficiencies for all transmission runs.</p></li>
<li><p>Save the results in the path chosen in <code class="docutils literal notranslate"><span class="pre">SavePath</span></code>. Additionally, the cell opacity and analyzer decay parameters are also stored in a table workspace at this location.</p></li>
</ul>
</section>
<section id="correction">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Correction</a><a class="headerlink" href="#correction" title="Link to this heading">¶</a></h2>
<p>For correction, a list of scattering runs must be specified in the <code class="docutils literal notranslate"><span class="pre">ScatteringRuns</span></code> property. Efficiency files are needed to calculate the corrections; If the reduction
type is <code class="docutils literal notranslate"><span class="pre">CalibrationAndCorrection</span></code>, the efficiency workspaces on the ADS will be used. Otherwise if the reduction type is <code class="docutils literal notranslate"><span class="pre">Correction</span></code>, efficiency workspaces will be loaded from file paths extracted from the user file.
The following steps are part of a correction sequence:</p>
<ul class="simple">
<li><p>Load scattering runs (<code class="docutils literal notranslate"><span class="pre">ScatteringRuns</span></code>) as well as efficiencies and polarization decay parameters if necessary.</p></li>
<li><p>For each scattering run, calculate the Helium Analyzer Efficiency at the time of the experiment using the analyzer cell polarization decay parameters <a class="footnote-reference brackets" href="#krycka" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p></li>
<li><p>Join the polarizer, flippers and analyzer efficiencies with the <a class="reference internal" href="JoinISISPolarizationEfficiencies-v1.html#algm-joinisispolarizationefficiencies"><span class="std std-ref">JoinISISPolarizationEfficiencies v1</span></a> algorithm.</p></li>
<li><p>Correct the scattering data using the <a class="reference internal" href="PolarizationEfficiencyCor-v1.html#algm-polarizationefficiencycor"><span class="std std-ref">PolarizationEfficiencyCor v1</span></a> algorithm.</p></li>
<li><p>Save the results in the path chosen in <code class="docutils literal notranslate"><span class="pre">SavePath</span></code>.</p></li>
</ul>
</section>
<section id="references">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">References</a><a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="krycka" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id3">2</a>,<a role="doc-backlink" href="#id4">3</a>)</span>
<p>K. Krycka et al., <em>J. Appl. Crystallogr.</em>, <strong>45</strong> (2012)
<a class="reference external" href="https://doi.org/10.1107/S0021889812003445">doi: 10.1107/S0021889812003445</a></p>
</aside>
<aside class="footnote brackets" id="wildes" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>A. R. Wildes, <em>Neutron News</em>, <strong>17</strong> 17 (2006)
<a class="reference external" href="https://doi.org/10.1080/10448630600668738">doi: 10.1080/10448630600668738</a></p>
</aside>
</aside>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/SANS/PolarizationCorrections.html">SANS\PolarizationCorrections</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/6762777a1cda710ac427c4efdb2a7fa75b50dc69/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/SANSISISPolarizationCorrections.py">SANSISISPolarizationCorrections.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul id="footer-nav" class="nav navbar-nav">
      
      
          
            
  <li>
    <a href="SANSILLReduction-v2.html" title="Previous Chapter: SANSILLReduction v2"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; SANSILLReduction v2</span>
    </a>
  </li>
  <li>
    <a href="SANSLoad-v1.html" title="Next Chapter: SANSLoad v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SANSLoad v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>