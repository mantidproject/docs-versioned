<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>FindMultipleUMatrices v1</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=4468db6d" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=9aca6aaf" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=2d21b807"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FindPeakBackground v1" href="FindPeakBackground-v1.html" />
    <link rel="prev" title="FindGoniometerFromUB v1" href="FindGoniometerFromUB-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head><body>





<nav id="navbar" class="navbar navbar-default navbar-fixed-top">
  <div id="navbar-main" class="container">
    <ul class="nav navbar-nav">
      
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <li>
        <a class="navbar-brand" href="http://www.mantidproject.org">
         </a>
      </li>
      <span class="navbar-text navbar-version pull-left"><b>6.15</b></span>
    </ul>

    
    <div class="collapse navbar-collapse nav-collapse">
    
      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        
          <li>
            <a href="https://www.mantidproject.org">Home</a>
          </li>
          <li>
            <a href="https://download.mantidproject.org">Download</a>
          </li>
          <li>
            <a href="https://docs.mantidproject.org">Documentation</a>
          </li>
          <li>
            <a href="https://www.mantidproject.org/contact">Contact Us</a>
          </li>
        
        
          
          
        
        
        
        
      </ul>
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          </div>
  </div> <!-- /navbar-main -->
<div id="navbar-breadcrumbs" class="related" role="navigation" aria-label="related navigation">
  <h3>Navigation</h3>
  <ul>
    <li class="nav-item nav-item-0">
      <a href="../index.html">Documentation</a>
         &#187;
    </li>
    
    <li class="nav-item nav-item-1">
      <a href="index.html" accesskey="U">
        Algorithms
      </a>
       &#187;
    </li>
    
    
    
    
    <li class="nav-item nav-item-this">
      <a href="">FindMultipleUMatrices v1</a>
    </li>
    
    
  </ul>
</div>
</nav>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="findmultipleumatrices-v1">
<span id="algm-findmultipleumatrices"></span><span id="algm-findmultipleumatrices-v1"></span><h1>FindMultipleUMatrices v1<a class="headerlink" href="#findmultipleumatrices-v1" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<span id="index-0"></span><p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#summary" id="id1">Summary</a></p>
<ul>
<li><p><a class="reference internal" href="#see-also" id="id2">See Also</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#properties" id="id3">Properties</a></p></li>
<li><p><a class="reference internal" href="#description" id="id4">Description</a></p></li>
<li><p><a class="reference internal" href="#useage" id="id5">Useage</a></p></li>
<li><p><a class="reference internal" href="#source" id="id6">Source</a></p></li>
</ul>
</nav>
<section id="summary">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>Finds multiple UB matrices using lattice parameters - can be used to find UBs in the presence of mutiple domains, crystallites or in the presence of spurious peaks.</p>
<section id="see-also">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="FindUBUsingLatticeParameters-v1.html#algm-findubusinglatticeparameters"><span class="std std-ref">FindUBUsingLatticeParameters</span></a>, <a class="reference internal" href="CalculateUMatrix-v1.html#algm-calculateumatrix"><span class="std std-ref">CalculateUMatrix</span></a></p>
</section>
</section>
<section id="properties">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Properties</a><a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PeaksWorkspace</p></td>
<td><p>Input</p></td>
<td><p>IPeaksWorkspace</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>A PeaksWorkspace containing the peaks to integrate.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputWorkspace</p></td>
<td><p>Output</p></td>
<td><p>WorkspaceGroup</p></td>
<td><p><em>Mandatory</em></p></td>
<td><p>The output peak workspaces with UBs set - 1 per UB requested.</p></td>
</tr>
<tr class="row-even"><td><p>NumberOfUBs</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Number of UB matrices to find.</p></td>
</tr>
<tr class="row-odd"><td><p>a</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Lattice parameter a</p></td>
</tr>
<tr class="row-even"><td><p>b</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Lattice parameter b</p></td>
</tr>
<tr class="row-odd"><td><p>c</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Lattice parameter c</p></td>
</tr>
<tr class="row-even"><td><p>alpha</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>90</p></td>
<td><p>Lattice angle alpha (in degrees)</p></td>
</tr>
<tr class="row-odd"><td><p>beta</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>90</p></td>
<td><p>Lattice angle beta (in degrees)</p></td>
</tr>
<tr class="row-even"><td><p>gamma</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>90</p></td>
<td><p>Lattice angle gamma (in degrees)</p></td>
</tr>
<tr class="row-odd"><td><p>HKLTolerance</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.15</p></td>
<td><p>Tolerance to index peaks in in H,K and L - see IndexPeaks for details.</p></td>
</tr>
<tr class="row-even"><td><p>DSpacingTolerance</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0.05</p></td>
<td><p>Tolerance in d-spacing used to try and index peaks</p></td>
</tr>
<tr class="row-odd"><td><p>AngleTolerance</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>1</p></td>
<td><p>Tolerance (in degrees) of angle between peaks in QLab when identifying possible pairs of HKL.</p></td>
</tr>
<tr class="row-even"><td><p>MinAngleBetweenPeaks</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>2</p></td>
<td><p>Minimum angle in QLab (in degrees) between pairs of peaks in when calculating U matrix.</p></td>
</tr>
<tr class="row-odd"><td><p>MinAngleBetweenUB</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>2</p></td>
<td><p>Minimum angle in degrees between u and v vectors (converted from HKL to QLab) of different UB.</p></td>
</tr>
<tr class="row-even"><td><p>MinDSpacing</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Min d-spacing of reflections to consider.</p></td>
</tr>
<tr class="row-odd"><td><p>MaxDSpacing</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Max d-spacing of reflections to consider.</p></td>
</tr>
<tr class="row-even"><td><p>Spacegroup</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td></td>
<td><p>Spacegroup Hermann–Mauguin symbol used to determine the point group of the Laue class.</p></td>
</tr>
<tr class="row-odd"><td><p>MaxOrder</p></td>
<td><p>Input</p></td>
<td><p>number</p></td>
<td><p>0</p></td>
<td><p>Maximum order to apply ModVectors. Default = 0</p></td>
</tr>
<tr class="row-even"><td><p>ModVector1</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>0.0,0.0,0.0</p></td>
<td><p>Offsets for h, k, l directions</p></td>
</tr>
<tr class="row-odd"><td><p>ModVector2</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>0.0,0.0,0.0</p></td>
<td><p>Offsets for h, k, l directions</p></td>
</tr>
<tr class="row-even"><td><p>ModVector3</p></td>
<td><p>Input</p></td>
<td><p>string</p></td>
<td><p>0.0,0.0,0.0</p></td>
<td><p>Offsets for h, k, l directions</p></td>
</tr>
<tr class="row-odd"><td><p>OptimiseFoundUBs</p></td>
<td><p>Input</p></td>
<td><p>boolean</p></td>
<td><p>True</p></td>
<td><p>Optimise final UBs using all peaks indexed best by that UB.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Description</a><a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>FindMultipleUMatrices will use the lattice parameters and spacegroup provided to optimise a number (<code class="docutils literal notranslate"><span class="pre">NumberOfUBs</span></code>)
of UB matrices (B is hard-coded due to the lattice parameters provided) and returns a group of peak workspaces
one for each UB, containing the peaks that are indexed most accurately by that UB.</p>
<p>This algorithm is useful for finding a single UB in the presence of spurious peaks, or finding multiple UBs when there
are multiple domains.</p>
<p>The algorithm proceeds by looping over each pair of peaks in <code class="docutils literal notranslate"><span class="pre">PeaksWorkspace</span></code> within the d-spacing limits
(<code class="docutils literal notranslate"><span class="pre">MinDSpacing</span></code> and <code class="docutils literal notranslate"><span class="pre">MaxDSpacing</span></code>), trying to index them based on their d-spacing and angle between the
peaks (within tolerances given by <code class="docutils literal notranslate"><span class="pre">DSpacingTolerance</span></code> and <code class="docutils literal notranslate"><span class="pre">AngleTolerance</span></code>). It then calculates the HKL
errors (difference in HKL residuals squared) for all peaks in <code class="docutils literal notranslate"><span class="pre">PeaksWorkspace</span></code> and identifies the UBs that
index the most peaks with the highest accuracy (i.e. better than any other UB found)</p>
<p>Note that although the user can provide modulation vectors, these are not currently used to index pairs of
peaks but are indexed by each candidate UB found and used to determine the best UBs to return.</p>
<p>Peaks with relatively higher d-spacing are easier to index correctly, try using a smaller number of higher
d-spacing peaks to start.</p>
</section>
<section id="useage">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Useage</a><a class="headerlink" href="#useage" title="Link to this heading">¶</a></h2>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mantid.simpleapi</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.spatial.transform</span><span class="w"> </span><span class="kn">import</span> <span class="n">Rotation</span> <span class="k">as</span> <span class="n">rot</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">LoadEmptyInstrument</span><span class="p">(</span><span class="n">InstrumentName</span><span class="o">=</span><span class="s1">&#39;SXD&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;empty_SXD&#39;</span><span class="p">)</span>
<span class="n">axis</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">axis</span><span class="o">.</span><span class="n">setUnit</span><span class="p">(</span><span class="s2">&quot;TOF&quot;</span><span class="p">)</span>

<span class="c1"># create a peak tables of orthorhombic domains with lattice parameters a=4, b=5, c=10</span>
<span class="n">alatt</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">}</span>
<span class="n">ubs</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="mi">1</span><span class="o">/</span><span class="n">alatt</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="o">/</span><span class="n">alatt</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="o">/</span><span class="n">alatt</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]])]</span>
<span class="n">ubs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rot</span><span class="o">.</span><span class="n">from_rotvec</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">],</span> <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>  <span class="o">@</span> <span class="n">ubs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">peaks</span> <span class="o">=</span> <span class="n">CreatePeaksWorkspace</span><span class="p">(</span><span class="n">InstrumentWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span> <span class="n">NumberOfPeaks</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;peaks&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iub</span><span class="p">,</span> <span class="n">ub</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ubs</span><span class="p">):</span>
    <span class="n">SetUB</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">UB</span><span class="o">=</span><span class="n">ub</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">pk</span> <span class="o">=</span> <span class="n">peaks</span><span class="o">.</span><span class="n">createPeakHKL</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span> <span class="p">,</span><span class="n">l</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">pk</span><span class="o">.</span><span class="n">getDetectorID</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">peaks</span><span class="o">.</span><span class="n">addPeak</span><span class="p">(</span><span class="n">pk</span><span class="p">)</span>

<span class="n">peaks_out</span> <span class="o">=</span> <span class="n">FindMultipleUMatrices</span><span class="p">(</span><span class="n">PeaksWorkspace</span><span class="o">=</span><span class="n">peaks</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;peaks_out&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">alatt</span><span class="p">,</span>
                                  <span class="n">MinDSpacing</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">MaxDSpacing</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span> <span class="n">Spacegroup</span><span class="o">=</span><span class="s1">&#39;P m m m&#39;</span><span class="p">,</span>
                                  <span class="n">NumberOfUBs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ipk</span><span class="p">,</span> <span class="n">pks</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">peaks_out</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HKL along x-axis of QLab = &quot;</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">pks</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">getOrientedLattice</span><span class="p">()</span><span class="o">.</span><span class="n">getvVector</span><span class="p">())))</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>HKL along x-axis of QLab =  [4. 0. 0.]
HKL along x-axis of QLab =  [0. 5. 0.]
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Diffraction/Reduction.html">Diffraction\Reduction</a> | <a class="reference external" href="categories/Crystal/UBMatrix.html">Crystal\UBMatrix</a></p>
</section>
<section id="source">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Source</a><a class="headerlink" href="#source" title="Link to this heading">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/6762777a1cda710ac427c4efdb2a7fa75b50dc69/Framework/PythonInterface/plugins/algorithms/FindMultipleUMatrices.py">FindMultipleUMatrices.py</a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul id="footer-nav" class="nav navbar-nav">
      
      
          
            
  <li>
    <a href="FindGoniometerFromUB-v1.html" title="Previous Chapter: FindGoniometerFromUB v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; FindGoniomete...</span>
    </a>
  </li>
  <li>
    <a href="FindPeakBackground-v1.html" title="Next Chapter: FindPeakBackground v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">FindPeakBackground v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>